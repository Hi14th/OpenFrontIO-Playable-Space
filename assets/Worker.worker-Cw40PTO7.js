(function(){"use strict";var Md=`x.xx.xx
`;const{entries:Ha,setPrototypeOf:Ga,isFrozen:Id,getPrototypeOf:xd,getOwnPropertyDescriptor:Cd}=Object;let{freeze:Zt,seal:oe,create:Za}=Object,{apply:Zr,construct:Yr}=typeof Reflect<"u"&&Reflect;Zt||(Zt=function(t){return t}),oe||(oe=function(t){return t}),Zr||(Zr=function(t,e,i){return t.apply(e,i)}),Yr||(Yr=function(t,e){return new t(...e)});const Ni=Xt(Array.prototype.forEach),Pd=Xt(Array.prototype.lastIndexOf),Ya=Xt(Array.prototype.pop),Cn=Xt(Array.prototype.push),Dd=Xt(Array.prototype.splice),Ri=Xt(String.prototype.toLowerCase),Xr=Xt(String.prototype.toString),Xa=Xt(String.prototype.match),Pn=Xt(String.prototype.replace),Nd=Xt(String.prototype.indexOf),Rd=Xt(String.prototype.trim),he=Xt(Object.prototype.hasOwnProperty),Yt=Xt(RegExp.prototype.test),Dn=Od(TypeError);function Xt(n){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return Zr(n,t,i)}}function Od(n){return function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Yr(n,e)}}function J(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ri;Ga&&Ga(n,null);let i=t.length;for(;i--;){let r=t[i];if(typeof r=="string"){const s=e(r);s!==r&&(Id(t)||(t[i]=s),r=s)}n[r]=!0}return n}function Bd(n){for(let t=0;t<n.length;t++)he(n,t)||(n[t]=null);return n}function Se(n){const t=Za(null);for(const[e,i]of Ha(n))he(n,e)&&(Array.isArray(i)?t[e]=Bd(i):i&&typeof i=="object"&&i.constructor===Object?t[e]=Se(i):t[e]=i);return t}function Nn(n,t){for(;n!==null;){const i=Cd(n,t);if(i){if(i.get)return Xt(i.get);if(typeof i.value=="function")return Xt(i.value)}n=xd(n)}function e(){return null}return e}const Va=Zt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Vr=Zt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Kr=Zt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ld=Zt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Jr=Zt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),zd=Zt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ka=Zt(["#text"]),Ja=Zt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Qr=Zt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Qa=Zt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Oi=Zt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ud=oe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Wd=oe(/<%[\w\W]*|[\w\W]*%>/gm),$d=oe(/\$\{[\w\W]*/gm),Fd=oe(/^data-[\-\w.\u00B7-\uFFFF]+$/),qd=oe(/^aria-[\-\w]+$/),to=oe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),jd=oe(/^(?:\w+script|data):/i),Hd=oe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),eo=oe(/^html$/i),Gd=oe(/^[a-z][.\w]*(-[.\w]+)+$/i);var no=Object.freeze({__proto__:null,ARIA_ATTR:qd,ATTR_WHITESPACE:Hd,CUSTOM_ELEMENT:Gd,DATA_ATTR:Fd,DOCTYPE_NAME:eo,ERB_EXPR:Wd,IS_ALLOWED_URI:to,IS_SCRIPT_OR_DATA:jd,MUSTACHE_EXPR:Ud,TMPLIT_EXPR:$d});const Rn={element:1,text:3,progressingInstruction:7,comment:8,document:9},Zd=function(){return typeof window>"u"?null:window},Yd=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null;const r="data-tt-policy-suffix";e&&e.hasAttribute(r)&&(i=e.getAttribute(r));const s="dompurify"+(i?"#"+i:"");try{return t.createPolicy(s,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},io=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ro(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zd();const t=F=>ro(F);if(t.version="3.2.6",t.removed=[],!n||!n.document||n.document.nodeType!==Rn.document||!n.Element)return t.isSupported=!1,t;let{document:e}=n;const i=e,r=i.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:o,Element:c,NodeFilter:l,NamedNodeMap:h=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:d,DOMParser:f,trustedTypes:g}=n,p=c.prototype,b=Nn(p,"cloneNode"),S=Nn(p,"remove"),w=Nn(p,"nextSibling"),v=Nn(p,"childNodes"),A=Nn(p,"parentNode");if(typeof a=="function"){const F=e.createElement("template");F.content&&F.content.ownerDocument&&(e=F.content.ownerDocument)}let E,C="";const{implementation:x,createNodeIterator:O,createDocumentFragment:N,getElementsByTagName:I}=e,{importNode:q}=i;let U=io();t.isSupported=typeof Ha=="function"&&typeof A=="function"&&x&&x.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:K,ERB_EXPR:D,TMPLIT_EXPR:X,DATA_ATTR:ct,ARIA_ATTR:et,IS_SCRIPT_OR_DATA:st,ATTR_WHITESPACE:Mt,CUSTOM_ELEMENT:Y}=no;let{IS_ALLOWED_URI:Q}=no,V=null;const Et=J({},[...Va,...Vr,...Kr,...Jr,...Ka]);let nt=null;const jt=J({},[...Ja,...Qr,...Qa,...Oi]);let W=Object.seal(Za(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),qt=null,Kt=null,be=!0,fe=!0,we=!1,Bt=!0,ee=!1,le=!0,ln=!1,Ba=!1,La=!1,An=!1,$r=!1,Fr=!1,ld=!0,hd=!1;const Z_="user-content-";let za=!0,Ci=!1,En={},kn=null;const ud=J({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let dd=null;const fd=J({},["audio","video","img","source","image","track"]);let Ua=null;const md=J({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),qr="http://www.w3.org/1998/Math/MathML",jr="http://www.w3.org/2000/svg",Ie="http://www.w3.org/1999/xhtml";let Mn=Ie,Wa=!1,$a=null;const Y_=J({},[qr,jr,Ie],Xr);let Hr=J({},["mi","mo","mn","ms","mtext"]),Gr=J({},["annotation-xml"]);const X_=J({},["title","style","font","a","script"]);let Pi=null;const V_=["application/xhtml+xml","text/html"],K_="text/html";let Lt=null,In=null;const J_=e.createElement("form"),gd=function(y){return y instanceof RegExp||y instanceof Function},Fa=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(In&&In===y)){if((!y||typeof y!="object")&&(y={}),y=Se(y),Pi=V_.indexOf(y.PARSER_MEDIA_TYPE)===-1?K_:y.PARSER_MEDIA_TYPE,Lt=Pi==="application/xhtml+xml"?Xr:Ri,V=he(y,"ALLOWED_TAGS")?J({},y.ALLOWED_TAGS,Lt):Et,nt=he(y,"ALLOWED_ATTR")?J({},y.ALLOWED_ATTR,Lt):jt,$a=he(y,"ALLOWED_NAMESPACES")?J({},y.ALLOWED_NAMESPACES,Xr):Y_,Ua=he(y,"ADD_URI_SAFE_ATTR")?J(Se(md),y.ADD_URI_SAFE_ATTR,Lt):md,dd=he(y,"ADD_DATA_URI_TAGS")?J(Se(fd),y.ADD_DATA_URI_TAGS,Lt):fd,kn=he(y,"FORBID_CONTENTS")?J({},y.FORBID_CONTENTS,Lt):ud,qt=he(y,"FORBID_TAGS")?J({},y.FORBID_TAGS,Lt):Se({}),Kt=he(y,"FORBID_ATTR")?J({},y.FORBID_ATTR,Lt):Se({}),En=he(y,"USE_PROFILES")?y.USE_PROFILES:!1,be=y.ALLOW_ARIA_ATTR!==!1,fe=y.ALLOW_DATA_ATTR!==!1,we=y.ALLOW_UNKNOWN_PROTOCOLS||!1,Bt=y.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ee=y.SAFE_FOR_TEMPLATES||!1,le=y.SAFE_FOR_XML!==!1,ln=y.WHOLE_DOCUMENT||!1,An=y.RETURN_DOM||!1,$r=y.RETURN_DOM_FRAGMENT||!1,Fr=y.RETURN_TRUSTED_TYPE||!1,La=y.FORCE_BODY||!1,ld=y.SANITIZE_DOM!==!1,hd=y.SANITIZE_NAMED_PROPS||!1,za=y.KEEP_CONTENT!==!1,Ci=y.IN_PLACE||!1,Q=y.ALLOWED_URI_REGEXP||to,Mn=y.NAMESPACE||Ie,Hr=y.MATHML_TEXT_INTEGRATION_POINTS||Hr,Gr=y.HTML_INTEGRATION_POINTS||Gr,W=y.CUSTOM_ELEMENT_HANDLING||{},y.CUSTOM_ELEMENT_HANDLING&&gd(y.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(W.tagNameCheck=y.CUSTOM_ELEMENT_HANDLING.tagNameCheck),y.CUSTOM_ELEMENT_HANDLING&&gd(y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(W.attributeNameCheck=y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),y.CUSTOM_ELEMENT_HANDLING&&typeof y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(W.allowCustomizedBuiltInElements=y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ee&&(fe=!1),$r&&(An=!0),En&&(V=J({},Ka),nt=[],En.html===!0&&(J(V,Va),J(nt,Ja)),En.svg===!0&&(J(V,Vr),J(nt,Qr),J(nt,Oi)),En.svgFilters===!0&&(J(V,Kr),J(nt,Qr),J(nt,Oi)),En.mathMl===!0&&(J(V,Jr),J(nt,Qa),J(nt,Oi))),y.ADD_TAGS&&(V===Et&&(V=Se(V)),J(V,y.ADD_TAGS,Lt)),y.ADD_ATTR&&(nt===jt&&(nt=Se(nt)),J(nt,y.ADD_ATTR,Lt)),y.ADD_URI_SAFE_ATTR&&J(Ua,y.ADD_URI_SAFE_ATTR,Lt),y.FORBID_CONTENTS&&(kn===ud&&(kn=Se(kn)),J(kn,y.FORBID_CONTENTS,Lt)),za&&(V["#text"]=!0),ln&&J(V,["html","head","body"]),V.table&&(J(V,["tbody"]),delete qt.tbody),y.TRUSTED_TYPES_POLICY){if(typeof y.TRUSTED_TYPES_POLICY.createHTML!="function")throw Dn('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof y.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Dn('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=y.TRUSTED_TYPES_POLICY,C=E.createHTML("")}else E===void 0&&(E=Yd(g,r)),E!==null&&typeof C=="string"&&(C=E.createHTML(""));Zt&&Zt(y),In=y}},pd=J({},[...Vr,...Kr,...Ld]),yd=J({},[...Jr,...zd]),Q_=function(y){let M=A(y);(!M||!M.tagName)&&(M={namespaceURI:Mn,tagName:"template"});const L=Ri(y.tagName),wt=Ri(M.tagName);return $a[y.namespaceURI]?y.namespaceURI===jr?M.namespaceURI===Ie?L==="svg":M.namespaceURI===qr?L==="svg"&&(wt==="annotation-xml"||Hr[wt]):!!pd[L]:y.namespaceURI===qr?M.namespaceURI===Ie?L==="math":M.namespaceURI===jr?L==="math"&&Gr[wt]:!!yd[L]:y.namespaceURI===Ie?M.namespaceURI===jr&&!Gr[wt]||M.namespaceURI===qr&&!Hr[wt]?!1:!yd[L]&&(X_[L]||!pd[L]):!!(Pi==="application/xhtml+xml"&&$a[y.namespaceURI]):!1},_e=function(y){Cn(t.removed,{element:y});try{A(y).removeChild(y)}catch{S(y)}},xn=function(y,M){try{Cn(t.removed,{attribute:M.getAttributeNode(y),from:M})}catch{Cn(t.removed,{attribute:null,from:M})}if(M.removeAttribute(y),y==="is")if(An||$r)try{_e(M)}catch{}else try{M.setAttribute(y,"")}catch{}},bd=function(y){let M=null,L=null;if(La)y="<remove></remove>"+y;else{const Rt=Xa(y,/^[\r\n\t ]+/);L=Rt&&Rt[0]}Pi==="application/xhtml+xml"&&Mn===Ie&&(y='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+y+"</body></html>");const wt=E?E.createHTML(y):y;if(Mn===Ie)try{M=new f().parseFromString(wt,Pi)}catch{}if(!M||!M.documentElement){M=x.createDocument(Mn,"template",null);try{M.documentElement.innerHTML=Wa?C:wt}catch{}}const Ht=M.body||M.documentElement;return y&&L&&Ht.insertBefore(e.createTextNode(L),Ht.childNodes[0]||null),Mn===Ie?I.call(M,ln?"html":"body")[0]:ln?M.documentElement:Ht},wd=function(y){return O.call(y.ownerDocument||y,y,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT|l.SHOW_PROCESSING_INSTRUCTION|l.SHOW_CDATA_SECTION,null)},qa=function(y){return y instanceof d&&(typeof y.nodeName!="string"||typeof y.textContent!="string"||typeof y.removeChild!="function"||!(y.attributes instanceof h)||typeof y.removeAttribute!="function"||typeof y.setAttribute!="function"||typeof y.namespaceURI!="string"||typeof y.insertBefore!="function"||typeof y.hasChildNodes!="function")},_d=function(y){return typeof o=="function"&&y instanceof o};function xe(F,y,M){Ni(F,L=>{L.call(t,y,M,In)})}const Sd=function(y){let M=null;if(xe(U.beforeSanitizeElements,y,null),qa(y))return _e(y),!0;const L=Lt(y.nodeName);if(xe(U.uponSanitizeElement,y,{tagName:L,allowedTags:V}),le&&y.hasChildNodes()&&!_d(y.firstElementChild)&&Yt(/<[/\w!]/g,y.innerHTML)&&Yt(/<[/\w!]/g,y.textContent)||y.nodeType===Rn.progressingInstruction||le&&y.nodeType===Rn.comment&&Yt(/<[/\w]/g,y.data))return _e(y),!0;if(!V[L]||qt[L]){if(!qt[L]&&vd(L)&&(W.tagNameCheck instanceof RegExp&&Yt(W.tagNameCheck,L)||W.tagNameCheck instanceof Function&&W.tagNameCheck(L)))return!1;if(za&&!kn[L]){const wt=A(y)||y.parentNode,Ht=v(y)||y.childNodes;if(Ht&&wt){const Rt=Ht.length;for(let ne=Rt-1;ne>=0;--ne){const Ce=b(Ht[ne],!0);Ce.__removalCount=(y.__removalCount||0)+1,wt.insertBefore(Ce,w(y))}}}return _e(y),!0}return y instanceof c&&!Q_(y)||(L==="noscript"||L==="noembed"||L==="noframes")&&Yt(/<\/no(script|embed|frames)/i,y.innerHTML)?(_e(y),!0):(ee&&y.nodeType===Rn.text&&(M=y.textContent,Ni([K,D,X],wt=>{M=Pn(M,wt," ")}),y.textContent!==M&&(Cn(t.removed,{element:y.cloneNode()}),y.textContent=M)),xe(U.afterSanitizeElements,y,null),!1)},Td=function(y,M,L){if(ld&&(M==="id"||M==="name")&&(L in e||L in J_))return!1;if(!(fe&&!Kt[M]&&Yt(ct,M))){if(!(be&&Yt(et,M))){if(!nt[M]||Kt[M]){if(!(vd(y)&&(W.tagNameCheck instanceof RegExp&&Yt(W.tagNameCheck,y)||W.tagNameCheck instanceof Function&&W.tagNameCheck(y))&&(W.attributeNameCheck instanceof RegExp&&Yt(W.attributeNameCheck,M)||W.attributeNameCheck instanceof Function&&W.attributeNameCheck(M))||M==="is"&&W.allowCustomizedBuiltInElements&&(W.tagNameCheck instanceof RegExp&&Yt(W.tagNameCheck,L)||W.tagNameCheck instanceof Function&&W.tagNameCheck(L))))return!1}else if(!Ua[M]){if(!Yt(Q,Pn(L,Mt,""))){if(!((M==="src"||M==="xlink:href"||M==="href")&&y!=="script"&&Nd(L,"data:")===0&&dd[y])){if(!(we&&!Yt(st,Pn(L,Mt,"")))){if(L)return!1}}}}}}return!0},vd=function(y){return y!=="annotation-xml"&&Xa(y,Y)},Ad=function(y){xe(U.beforeSanitizeAttributes,y,null);const{attributes:M}=y;if(!M||qa(y))return;const L={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:nt,forceKeepAttr:void 0};let wt=M.length;for(;wt--;){const Ht=M[wt],{name:Rt,namespaceURI:ne,value:Ce}=Ht,Di=Lt(Rt),ja=Ce;let Gt=Rt==="value"?ja:Rd(ja);if(L.attrName=Di,L.attrValue=Gt,L.keepAttr=!0,L.forceKeepAttr=void 0,xe(U.uponSanitizeAttribute,y,L),Gt=L.attrValue,hd&&(Di==="id"||Di==="name")&&(xn(Rt,y),Gt=Z_+Gt),le&&Yt(/((--!?|])>)|<\/(style|title)/i,Gt)){xn(Rt,y);continue}if(L.forceKeepAttr)continue;if(!L.keepAttr){xn(Rt,y);continue}if(!Bt&&Yt(/\/>/i,Gt)){xn(Rt,y);continue}ee&&Ni([K,D,X],kd=>{Gt=Pn(Gt,kd," ")});const Ed=Lt(y.nodeName);if(!Td(Ed,Di,Gt)){xn(Rt,y);continue}if(E&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!ne)switch(g.getAttributeType(Ed,Di)){case"TrustedHTML":{Gt=E.createHTML(Gt);break}case"TrustedScriptURL":{Gt=E.createScriptURL(Gt);break}}if(Gt!==ja)try{ne?y.setAttributeNS(ne,Rt,Gt):y.setAttribute(Rt,Gt),qa(y)?_e(y):Ya(t.removed)}catch{xn(Rt,y)}}xe(U.afterSanitizeAttributes,y,null)},tS=function F(y){let M=null;const L=wd(y);for(xe(U.beforeSanitizeShadowDOM,y,null);M=L.nextNode();)xe(U.uponSanitizeShadowNode,M,null),Sd(M),Ad(M),M.content instanceof s&&F(M.content);xe(U.afterSanitizeShadowDOM,y,null)};return t.sanitize=function(F){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=null,L=null,wt=null,Ht=null;if(Wa=!F,Wa&&(F="<!-->"),typeof F!="string"&&!_d(F))if(typeof F.toString=="function"){if(F=F.toString(),typeof F!="string")throw Dn("dirty is not a string, aborting")}else throw Dn("toString is not a function");if(!t.isSupported)return F;if(Ba||Fa(y),t.removed=[],typeof F=="string"&&(Ci=!1),Ci){if(F.nodeName){const Ce=Lt(F.nodeName);if(!V[Ce]||qt[Ce])throw Dn("root node is forbidden and cannot be sanitized in-place")}}else if(F instanceof o)M=bd("<!---->"),L=M.ownerDocument.importNode(F,!0),L.nodeType===Rn.element&&L.nodeName==="BODY"||L.nodeName==="HTML"?M=L:M.appendChild(L);else{if(!An&&!ee&&!ln&&F.indexOf("<")===-1)return E&&Fr?E.createHTML(F):F;if(M=bd(F),!M)return An?null:Fr?C:""}M&&La&&_e(M.firstChild);const Rt=wd(Ci?F:M);for(;wt=Rt.nextNode();)Sd(wt),Ad(wt),wt.content instanceof s&&tS(wt.content);if(Ci)return F;if(An){if($r)for(Ht=N.call(M.ownerDocument);M.firstChild;)Ht.appendChild(M.firstChild);else Ht=M;return(nt.shadowroot||nt.shadowrootmode)&&(Ht=q.call(i,Ht,!0)),Ht}let ne=ln?M.outerHTML:M.innerHTML;return ln&&V["!doctype"]&&M.ownerDocument&&M.ownerDocument.doctype&&M.ownerDocument.doctype.name&&Yt(eo,M.ownerDocument.doctype.name)&&(ne="<!DOCTYPE "+M.ownerDocument.doctype.name+`>
`+ne),ee&&Ni([K,D,X],Ce=>{ne=Pn(ne,Ce," ")}),E&&Fr?E.createHTML(ne):ne},t.setConfig=function(){let F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Fa(F),Ba=!0},t.clearConfig=function(){In=null,Ba=!1},t.isValidAttribute=function(F,y,M){In||Fa({});const L=Lt(F),wt=Lt(y);return Td(L,wt,M)},t.addHook=function(F,y){typeof y=="function"&&Cn(U[F],y)},t.removeHook=function(F,y){if(y!==void 0){const M=Pd(U[F],y);return M===-1?void 0:Dd(U[F],M,1)[0]}return Ya(U[F])},t.removeHooks=function(F){U[F]=[]},t.removeAllHooks=function(){U=io()},t}ro();const so=["Akkadian","Babylonian","Sumerian","Hittite","Phoenician","Canaanite","Minoan","Mycenaean","Etruscan","Scythian","Thracian","Dacian","Illyrian","Median","Chaldean","Roman","Greek","Byzantine","Persian","Parthian","Seleucid","Ptolemaic","Palmyrene","Macedonian","Carthaginian","Ming","Tang","Song","Yuan","Mauryan","Kushan","Rajput","Mughal","Satavahana","Vijayanagara","Egyptian","Nubian","Kushite","Aksumite","Ethiopian","Songhai","Malian","Ghanaian","Benin","Ashanti","Zulu","Tuareg","Berber","Kanem-Bornu","Buganda","Mossi","Swahili","Somali","Wolof","Umayyad","Abbasid","Ayyubid","Fatimid","Mamluk","Seljuk","Safavid","Ottoman","Almoravid","Almohad","Rashidun","Ziyarid","Frankish","Visigothic","Ostrogothic","Viking","Norman","Saxon","Anglo-Saxon","Celtic","Gaulish","Carolingian","Merovingian","Capetian","Plantagenet","Tudor","Stuart","Habsburg","Romanov","Lancaster","York","Bourbon","Napoleonic","British","French","Spanish","Portuguese","Dutch","Russian","German","Italian","Swedish","Norwegian","Danish","Polish","Hungarian","Austrian","Swiss","Czech","Slovak","Serbian","Croatian","Bosnian","Montenegrin","Bulgarian","Romanian","Apache","Sioux","Cherokee","Navajo","Iroquois","Inuit","Arawak","Carib","Taino","Aztec","Mayan","Incan","Mapuche","Guarani","Tupi","Yanomami","Zuni","Hopi","Kiowa","Comanche","Shoshone","Japanese","Ryukyu","Ainu","Cham","Khmer","Thai","Vietnamese","Burmese","Balinese","Malay","Filipino","Mongolian","Korean","Tibetan","Manchu","Uyghur","Hmong","Karen","Pyu","Hawaiian","Fijian","Tongan","Samoan","Maori","Micronesian","Hebrew","Armenian","Circassian","Georgian","Phoenician","Chaldean","Kurdish","Turkic","Kazakh","Uzbek","Kyrgyz","Tajik","Uighur","Pashtun","Baloch","Afghan","Persian","Kenyan","Ugandan","Bhutanese","Latin","Moldovan","Militant","Spartan"],ao=["Empire","Dynasty","Kingdom","Queendom","Sultanate","Confederation","Union","Republic","Caliphate","Dominion","Realm","State","Federation","Territory","Commonwealth","League","Duchy","Province","Protectorate","Colony","Mandate","Free State","Canton","Region","Nation","Assembly","Hierarchy","Archduchy","Grand Duchy","Metropolis","Cluster","Alliance","Tribunal","Council","Confederacy","Order","Regime","Dominion","Syndicate","Guild","Corporation","Patriarchy","Matriarchy","Legion","Horde","Clan","Brotherhood","Sisterhood","Ascendancy","Supremacy","Province","Tribe","Dominion","Assembly","Republics","Army","Dictatorship","Country","Oligarchy","Monkdom","Throng","Host","Area","District","Fief","Wilderness","Settlement","Parliament","Anarchy","Democracy","Autocracy"];function Pe(n,t,e){return Math.min(Math.max(n,t),e)}function oo(n,t){const e=typeof t=="number"?t:t.tile();return(i,r)=>n.manhattanDist(i.tile(),e)-n.manhattanDist(r.tile(),e)}function It(n){let t=0;for(let e=0;e<n.length;e++){const i=n.charCodeAt(e);t=(t<<5)-t+i,t=t&t}return Math.abs(t)}function Ze(n,t){let e=1/0,i=1/0,r=-1/0,s=-1/0;for(const a of t){const o=n.x(a),c=n.y(a);e=Math.min(e,o),i=Math.min(i,c),r=Math.max(r,o),s=Math.max(s,c)}return{min:new Dt(e,i),max:new Dt(r,s)}}function co(n,t,e){const i=[],r=n.x(t),s=n.y(t),a=r-e,o=r+e,c=s-e,l=s+e;for(let h=a;h<=o;h++)n.isValidCoord(h,c)&&i.push(n.ref(h,c)),n.isValidCoord(h,l)&&c!==l&&i.push(n.ref(h,l));for(let h=c+1;h<l;h++)n.isValidCoord(a,h)&&i.push(n.ref(a,h)),n.isValidCoord(o,h)&&a!==o&&i.push(n.ref(o,h));return i}function Xd(n){let t=null,e=0;for(const[i,r]of n)r>e&&(e=r,t=i);return t}function Vd(n,t){const{min:e,max:i}=Ze(n,t);return lo({min:e,max:i})}function lo(n){return new Dt(n.min.x+Math.floor((n.max.x-n.min.x)/2),n.min.y+Math.floor((n.max.y-n.min.y)/2))}function ho(n,t){return n.min.x<=t.min.x&&n.min.y<=t.min.y&&n.max.x>=t.max.x&&n.max.y>=t.max.y}function dt(n){throw new Error("Unexpected value: "+n)}function De(n){return BigInt(n===1/0?Number.MAX_SAFE_INTEGER:n===-1/0?Number.MIN_SAFE_INTEGER:Math.floor(n))}function Kd(n,t){return n>t?n:t}function ts(n,t){return n<t?n:t}function Jd(n,t,e){const i=Kd(n,t);return ts(i,e)}const es=[["ðŸ˜€","ðŸ˜Š","ðŸ¥°","ðŸ˜‡","ðŸ˜Ž"],["ðŸ˜ž","ðŸ¥º","ðŸ˜­","ðŸ˜±","ðŸ˜¡"],["ðŸ˜ˆ","ðŸ¤¡","ðŸ¥±","ðŸ«¡","ðŸ–•"],["ðŸ‘‹","ðŸ‘","âœ‹","ðŸ™","ðŸ’ª"],["ðŸ‘","ðŸ‘Ž","ðŸ«´","ðŸ¤Œ","ðŸ¤¦â€â™‚ï¸"],["ðŸ¤","ðŸ†˜","ðŸ•Šï¸","ðŸ³ï¸","â³"],["ðŸ”¥","ðŸ’¥","ðŸ’€","â˜¢ï¸","âš ï¸"],["â†–ï¸","â¬†ï¸","â†—ï¸","ðŸ‘‘","ðŸ¥‡"],["â¬…ï¸","ðŸŽ¯","âž¡ï¸","ðŸ¥ˆ","ðŸ¥‰"],["â†™ï¸","â¬‡ï¸","â†˜ï¸","â¤ï¸","ðŸ’”"],["ðŸ’°","âš“","â›µ","ðŸ¡","ðŸ›¡ï¸"],["ðŸ­","ðŸš‚","â“","ðŸ”","ðŸ€"]].flat();function uo(n,t,e){return 1/(1+Math.exp(-t*(n-e)))}function Qd(n){const t=fo(n);return t?t[1].toUpperCase():null}function tf(n){const t=fo(n);return t?t[1]:null}const ef="a-zA-Z0-9",nf=new RegExp(`\\[([${ef}]{2,5})\\]`);function fo(n){return!n.includes("[")||!n.includes("]")?null:n.match(nf)}const xt="AllPlayers";var _=(n=>(n.Easy="Easy",n.Medium="Medium",n.Hard="Hard",n.Impossible="Impossible",n))(_||{});const mo="Duos",go="Trios",po="Quads",On="Humans Vs Nations",ft={Red:"Red",Blue:"Blue",Teal:"Teal",Purple:"Purple",Yellow:"Yellow",Orange:"Orange",Green:"Green",Bot:"Bot",Humans:"Humans",Nations:"Nations"};var Bn=(n=>(n.World="World",n.GiantWorldMap="Giant World Map",n.Europe="Europe",n.EuropeClassic="Europe Classic",n.Mena="Mena",n.NorthAmerica="North America",n.SouthAmerica="South America",n.Oceania="Oceania",n.BlackSea="Black Sea",n.Africa="Africa",n.Pangaea="Pangaea",n.Asia="Asia",n.Mars="Mars",n.BritanniaClassic="Britannia Classic",n.Britannia="Britannia",n.GatewayToTheAtlantic="Gateway to the Atlantic",n.Australia="Australia",n.Iceland="Iceland",n.EastAsia="East Asia",n.BetweenTwoSeas="Between Two Seas",n.FaroeIslands="Faroe Islands",n.DeglaciatedAntarctica="Deglaciated Antarctica",n.FalklandIslands="Falkland Islands",n.Baikal="Baikal",n.Halkidiki="Halkidiki",n.StraitOfGibraltar="Strait of Gibraltar",n.Italia="Italia",n.Japan="Japan",n.Pluto="Pluto",n.Montreal="Montreal",n.NewYorkCity="New York City",n.Achiran="Achiran",n.BaikalNukeWars="Baikal Nuke Wars",n.FourIslands="Four Islands",n.Svalmel="Svalmel",n.GulfOfStLawrence="Gulf of St. Lawrence",n.Lisbon="Lisbon",n.Manicouagan="Manicouagan",n.Lemnos="Lemnos",n.Sierpinski="Sierpinski",n.TheBox="The Box",n.TwoLakes="Two Lakes",n.StraitOfHormuz="Strait of Hormuz",n.Surrounded="Surrounded",n.Didier="Didier",n.DidierFrance="Didier France",n.AmazonRiver="Amazon River",n.Yenisei="Yenisei",n))(Bn||{}),Ln=(n=>(n.Singleplayer="Singleplayer",n.Public="Public",n.Private="Private",n))(Ln||{}),Ct=(n=>(n.FFA="Free For All",n.Team="Team",n))(Ct||{}),ns=(n=>(n.OneVOne="1v1",n))(ns||{}),Ne=(n=>(n.Compact="Compact",n.Normal="Normal",n))(Ne||{}),m=(n=>(n.TransportShip="Transport",n.Warship="Warship",n.Shell="Shell",n.SAMMissile="SAMMissile",n.Port="Port",n.AtomBomb="Atom Bomb",n.HydrogenBomb="Hydrogen Bomb",n.TradeShip="Trade Ship",n.MissileSilo="Missile Silo",n.DefensePost="Defense Post",n.SAMLauncher="SAM Launcher",n.City="City",n.MIRV="MIRV",n.MIRVWarhead="MIRV Warhead",n.Train="Train",n.Factory="Factory",n))(m||{}),zn=(n=>(n.Engine="Engine",n.TailEngine="TailEngine",n.Carriage="Carriage",n))(zn||{});const yo=new Set(["City","Defense Post","SAM Launcher","Missile Silo","Port","Factory"]),is=[...yo];function bo(n){return yo.has(n)}var Pt=(n=>(n[n.Hostile=0]="Hostile",n[n.Distrustful=1]="Distrustful",n[n.Neutral=2]="Neutral",n[n.Friendly=3]="Friendly",n))(Pt||{});class wo{constructor(t,e){this.spawnCell=t,this.playerInfo=e}}class Dt{constructor(t,e){this.x=t,this.y=e,this.strRepr=`Cell[${this.x},${this.y}]`}pos(){return{x:this.x,y:this.y}}toString(){return this.strRepr}}var _t=(n=>(n[n.Plains=0]="Plains",n[n.Highland=1]="Highland",n[n.Mountain=2]="Mountain",n[n.Lake=3]="Lake",n[n.Ocean=4]="Ocean",n))(_t||{}),P=(n=>(n.Bot="BOT",n.Human="HUMAN",n.Nation="NATION",n))(P||{});class Bi{constructor(t,e,i,r,s=!1){this.name=t,this.playerType=e,this.clientID=i,this.id=r,this.isLobbyCreator=s,this.clan=Qd(t)}}function rs(n){return n&&typeof n=="object"&&"isUnit"in n&&typeof n.isUnit=="function"&&n.isUnit()}var at=(n=>(n[n.ATTACK_FAILED=0]="ATTACK_FAILED",n[n.ATTACK_CANCELLED=1]="ATTACK_CANCELLED",n[n.ATTACK_REQUEST=2]="ATTACK_REQUEST",n[n.CONQUERED_PLAYER=3]="CONQUERED_PLAYER",n[n.MIRV_INBOUND=4]="MIRV_INBOUND",n[n.NUKE_INBOUND=5]="NUKE_INBOUND",n[n.HYDROGEN_BOMB_INBOUND=6]="HYDROGEN_BOMB_INBOUND",n[n.NAVAL_INVASION_INBOUND=7]="NAVAL_INVASION_INBOUND",n[n.SAM_MISS=8]="SAM_MISS",n[n.SAM_HIT=9]="SAM_HIT",n[n.CAPTURED_ENEMY_UNIT=10]="CAPTURED_ENEMY_UNIT",n[n.UNIT_CAPTURED_BY_ENEMY=11]="UNIT_CAPTURED_BY_ENEMY",n[n.UNIT_DESTROYED=12]="UNIT_DESTROYED",n[n.ALLIANCE_ACCEPTED=13]="ALLIANCE_ACCEPTED",n[n.ALLIANCE_REJECTED=14]="ALLIANCE_REJECTED",n[n.ALLIANCE_REQUEST=15]="ALLIANCE_REQUEST",n[n.ALLIANCE_BROKEN=16]="ALLIANCE_BROKEN",n[n.ALLIANCE_EXPIRED=17]="ALLIANCE_EXPIRED",n[n.SENT_GOLD_TO_PLAYER=18]="SENT_GOLD_TO_PLAYER",n[n.RECEIVED_GOLD_FROM_PLAYER=19]="RECEIVED_GOLD_FROM_PLAYER",n[n.RECEIVED_GOLD_FROM_TRADE=20]="RECEIVED_GOLD_FROM_TRADE",n[n.SENT_TROOPS_TO_PLAYER=21]="SENT_TROOPS_TO_PLAYER",n[n.RECEIVED_TROOPS_FROM_PLAYER=22]="RECEIVED_TROOPS_FROM_PLAYER",n[n.CHAT=23]="CHAT",n[n.RENEW_ALLIANCE=24]="RENEW_ALLIANCE",n))(at||{});function _o(n,t){const e=t.largestClusterBoundingBox??Ze(n,t.borderTiles());let i=1;const r=e.max.x-e.min.x,s=e.max.y-e.min.y,a=Math.min(r,s);a<25?i=1:a<50?i=2:a<100?i=4:a<250?i=8:a<500?i=16:i=32;const o=rf(n,t,e,i),c=sf(o);c.x=c.x*i,c.y=c.y*i,c.width=c.width*i,c.height=c.height*i;let l=new Dt(Math.floor(c.x+c.width/2+e.min.x),Math.floor(c.y+c.height/2+e.min.y));const h=of(c,t.name());return l=new Dt(l.x,l.y-h/3),{x:Math.ceil(l.x),y:Math.ceil(l.y),size:h}}function rf(n,t,e,i){const r={min:{x:Math.floor(e.min.x/i),y:Math.floor(e.min.y/i)},max:{x:Math.floor(e.max.x/i),y:Math.floor(e.max.y/i)}},s=r.max.x-r.min.x+1,a=r.max.y-r.min.y+1,o=Array(s).fill(null).map(()=>Array(a).fill(!1));for(let c=r.min.x;c<=r.max.x;c++)for(let l=r.min.y;l<=r.max.y;l++){const h=new Dt(c*i,l*i);if(n.isOnMap(h)){const d=n.ref(h.x,h.y);o[c-r.min.x][l-r.min.y]=n.isLake(d)||n.isShore(d)||n.owner(d)===t||n.hasFallout(d)}}return o}function sf(n){const t=n[0].length,e=n.length,i=new Array(e).fill(0);let r={x:0,y:0,width:0,height:0};for(let s=0;s<t;s++){for(let o=0;o<e;o++)n[o][s]?i[o]++:i[o]=0;const a=af(i);a.width*a.height>r.width*r.height&&(r={x:a.x,y:s-a.height+1,width:a.width,height:a.height})}return r}function af(n){const t=[];let e=0,i={x:0,y:0,width:0,height:0};for(let r=0;r<=n.length;r++){const s=r===n.length?0:n[r];for(;t.length>0&&s<n[t[t.length-1]];){const a=n[t.pop()],o=t.length===0?r:r-t[t.length-1]-1;a*o>e&&(e=a*o,i={x:t.length===0?0:t[t.length-1]+1,y:0,width:o,height:a})}t.push(r)}return i}function of(n,t){const e=n.width/t.length*2,i=n.height/3;return Math.min(e,i)}var Re=(n=>(n[n.Dev=0]="Dev",n[n.Preprod=1]="Preprod",n[n.Prod=2]="Prod",n))(Re||{});function T(n,t,e){function i(o,c){var l;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(l=o._zod).traits??(l.traits=new Set),o._zod.traits.add(n),t(o,c);for(const h in a.prototype)h in o||Object.defineProperty(o,h,{value:a.prototype[h].bind(o)});o._zod.constr=a,o._zod.def=c}const r=e?.Parent??Object;class s extends r{}Object.defineProperty(s,"name",{value:n});function a(o){var c;const l=e?.Parent?new s:this;i(l,o),(c=l._zod).deferred??(c.deferred=[]);for(const h of l._zod.deferred)h();return l}return Object.defineProperty(a,"init",{value:i}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>e?.Parent&&o instanceof e.Parent?!0:o?._zod?.traits?.has(n)}),Object.defineProperty(a,"name",{value:n}),a}class Un extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const So={};function Oe(n){return So}function cf(n){const t=Object.values(n).filter(i=>typeof i=="number");return Object.entries(n).filter(([i,r])=>t.indexOf(+i)===-1).map(([i,r])=>r)}function lf(n,t){return typeof t=="bigint"?t.toString():t}function ss(n){return{get value(){{const t=n();return Object.defineProperty(this,"value",{value:t}),t}}}}function as(n){return n==null}function os(n){const t=n.startsWith("^")?1:0,e=n.endsWith("$")?n.length-1:n.length;return n.slice(t,e)}function hf(n,t){const e=(n.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,r=e>i?e:i,s=Number.parseInt(n.toFixed(r).replace(".","")),a=Number.parseInt(t.toFixed(r).replace(".",""));return s%a/10**r}function it(n,t,e){Object.defineProperty(n,t,{get(){{const i=e();return n[t]=i,i}},set(i){Object.defineProperty(n,t,{value:i})},configurable:!0})}function cs(n,t,e){Object.defineProperty(n,t,{value:e,writable:!0,enumerable:!0,configurable:!0})}function Wn(n){return JSON.stringify(n)}const To=Error.captureStackTrace?Error.captureStackTrace:(...n)=>{};function Li(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}const uf=ss(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const n=Function;return new n(""),!0}catch{return!1}});function zi(n){if(Li(n)===!1)return!1;const t=n.constructor;if(t===void 0)return!0;const e=t.prototype;return!(Li(e)===!1||Object.prototype.hasOwnProperty.call(e,"isPrototypeOf")===!1)}const df=new Set(["string","number","symbol"]);function $n(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ye(n,t,e){const i=new n._zod.constr(t??n._zod.def);return(!t||e?.parent)&&(i._zod.parent=n),i}function z(n){const t=n;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function ff(n){return Object.keys(n).filter(t=>n[t]._zod.optin==="optional"&&n[t]._zod.optout==="optional")}const mf={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function gf(n,t){const e={},i=n._zod.def;for(const r in t){if(!(r in i.shape))throw new Error(`Unrecognized key: "${r}"`);t[r]&&(e[r]=i.shape[r])}return Ye(n,{...n._zod.def,shape:e,checks:[]})}function pf(n,t){const e={...n._zod.def.shape},i=n._zod.def;for(const r in t){if(!(r in i.shape))throw new Error(`Unrecognized key: "${r}"`);t[r]&&delete e[r]}return Ye(n,{...n._zod.def,shape:e,checks:[]})}function yf(n,t){if(!zi(t))throw new Error("Invalid input to extend: expected a plain object");const e={...n._zod.def,get shape(){const i={...n._zod.def.shape,...t};return cs(this,"shape",i),i},checks:[]};return Ye(n,e)}function bf(n,t){return Ye(n,{...n._zod.def,get shape(){const e={...n._zod.def.shape,...t._zod.def.shape};return cs(this,"shape",e),e},catchall:t._zod.def.catchall,checks:[]})}function wf(n,t,e){const i=t._zod.def.shape,r={...i};if(e)for(const s in e){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(r[s]=n?new n({type:"optional",innerType:i[s]}):i[s])}else for(const s in i)r[s]=n?new n({type:"optional",innerType:i[s]}):i[s];return Ye(t,{...t._zod.def,shape:r,checks:[]})}function _f(n,t,e){const i=t._zod.def.shape,r={...i};if(e)for(const s in e){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(r[s]=new n({type:"nonoptional",innerType:i[s]}))}else for(const s in i)r[s]=new n({type:"nonoptional",innerType:i[s]});return Ye(t,{...t._zod.def,shape:r,checks:[]})}function Fn(n,t=0){for(let e=t;e<n.issues.length;e++)if(n.issues[e]?.continue!==!0)return!0;return!1}function Be(n,t){return t.map(e=>{var i;return(i=e).path??(i.path=[]),e.path.unshift(n),e})}function Ui(n){return typeof n=="string"?n:n?.message}function Le(n,t,e){const i={...n,path:n.path??[]};if(!n.message){const r=Ui(n.inst?._zod.def?.error?.(n))??Ui(t?.error?.(n))??Ui(e.customError?.(n))??Ui(e.localeError?.(n))??"Invalid input";i.message=r}return delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}function ls(n){return Array.isArray(n)?"array":typeof n=="string"?"string":"unknown"}function qn(...n){const[t,e,i]=n;return typeof t=="string"?{message:t,code:"custom",input:e,inst:i}:{...t}}const vo=(n,t)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:t,enumerable:!1}),Object.defineProperty(n,"message",{get(){return JSON.stringify(t,lf,2)},enumerable:!0}),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},Ao=T("$ZodError",vo),Eo=T("$ZodError",vo,{Parent:Error});function Sf(n,t=e=>e.message){const e={},i=[];for(const r of n.issues)r.path.length>0?(e[r.path[0]]=e[r.path[0]]||[],e[r.path[0]].push(t(r))):i.push(t(r));return{formErrors:i,fieldErrors:e}}function Tf(n,t){const e=t||function(s){return s.message},i={_errors:[]},r=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(o=>r({issues:o}));else if(a.code==="invalid_key")r({issues:a.issues});else if(a.code==="invalid_element")r({issues:a.issues});else if(a.path.length===0)i._errors.push(e(a));else{let o=i,c=0;for(;c<a.path.length;){const l=a.path[c];c===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(e(a))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return r(n),i}function vf(n){const t=[];for(const e of n)typeof e=="number"?t.push(`[${e}]`):typeof e=="symbol"?t.push(`[${JSON.stringify(String(e))}]`):/[^\w$]/.test(e)?t.push(`[${JSON.stringify(e)}]`):(t.length&&t.push("."),t.push(e));return t.join("")}function Af(n){const t=[],e=[...n.issues].sort((i,r)=>i.path.length-r.path.length);for(const i of e)t.push(`âœ– ${i.message}`),i.path?.length&&t.push(`  â†’ at ${vf(i.path)}`);return t.join(`
`)}const Ef=n=>(t,e,i,r)=>{const s=i?Object.assign(i,{async:!1}):{async:!1},a=t._zod.run({value:e,issues:[]},s);if(a instanceof Promise)throw new Un;if(a.issues.length){const o=new(r?.Err??n)(a.issues.map(c=>Le(c,s,Oe())));throw To(o,r?.callee),o}return a.value},kf=n=>async(t,e,i,r)=>{const s=i?Object.assign(i,{async:!0}):{async:!0};let a=t._zod.run({value:e,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const o=new(r?.Err??n)(a.issues.map(c=>Le(c,s,Oe())));throw To(o,r?.callee),o}return a.value},ko=n=>(t,e,i)=>{const r=i?{...i,async:!1}:{async:!1},s=t._zod.run({value:e,issues:[]},r);if(s instanceof Promise)throw new Un;return s.issues.length?{success:!1,error:new(n??Ao)(s.issues.map(a=>Le(a,r,Oe())))}:{success:!0,data:s.value}},Mf=ko(Eo),Mo=n=>async(t,e,i)=>{const r=i?Object.assign(i,{async:!0}):{async:!0};let s=t._zod.run({value:e,issues:[]},r);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new n(s.issues.map(a=>Le(a,r,Oe())))}:{success:!0,data:s.value}},If=Mo(Eo),xf=/^[cC][^\s-]{8,}$/,Cf=/^[0-9a-z]+$/,Pf=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Df=/^[0-9a-vA-V]{20}$/,Nf=/^[A-Za-z0-9]{27}$/,Rf=/^[a-zA-Z0-9_-]{21}$/,Of=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Bf=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Io=n=>n?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${n}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,Lf=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,zf="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Uf(){return new RegExp(zf,"u")}const Wf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$f=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Ff=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,qf=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,jf=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,xo=/^[A-Za-z0-9_-]*$/,Hf=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,Gf=/^\+(?:[0-9]){6,14}[0-9]$/,Co="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Zf=new RegExp(`^${Co}$`);function Po(n){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof n.precision=="number"?n.precision===-1?`${t}`:n.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${n.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Yf(n){return new RegExp(`^${Po(n)}$`)}function Xf(n){const t=Po({precision:n.precision}),e=["Z"];n.local&&e.push(""),n.offset&&e.push("([+-]\\d{2}:\\d{2})");const i=`${t}(?:${e.join("|")})`;return new RegExp(`^${Co}T(?:${i})$`)}const Vf=n=>{const t=n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Kf=/^\d+n?$/,Jf=/^\d+$/,Qf=/^-?\d+(?:\.\d+)?/i,tm=/true|false/i,em=/^[^A-Z]*$/,nm=/^[^a-z]*$/,Jt=T("$ZodCheck",(n,t)=>{var e;n._zod??(n._zod={}),n._zod.def=t,(e=n._zod).onattach??(e.onattach=[])}),Do={number:"number",bigint:"bigint",object:"date"},No=T("$ZodCheckLessThan",(n,t)=>{Jt.init(n,t);const e=Do[typeof t.value];n._zod.onattach.push(i=>{const r=i._zod.bag,s=(t.inclusive?r.maximum:r.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),n._zod.check=i=>{(t.inclusive?i.value<=t.value:i.value<t.value)||i.issues.push({origin:e,code:"too_big",maximum:t.value,input:i.value,inclusive:t.inclusive,inst:n,continue:!t.abort})}}),Ro=T("$ZodCheckGreaterThan",(n,t)=>{Jt.init(n,t);const e=Do[typeof t.value];n._zod.onattach.push(i=>{const r=i._zod.bag,s=(t.inclusive?r.minimum:r.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),n._zod.check=i=>{(t.inclusive?i.value>=t.value:i.value>t.value)||i.issues.push({origin:e,code:"too_small",minimum:t.value,input:i.value,inclusive:t.inclusive,inst:n,continue:!t.abort})}}),im=T("$ZodCheckMultipleOf",(n,t)=>{Jt.init(n,t),n._zod.onattach.push(e=>{var i;(i=e._zod.bag).multipleOf??(i.multipleOf=t.value)}),n._zod.check=e=>{if(typeof e.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof e.value=="bigint"?e.value%t.value===BigInt(0):hf(e.value,t.value)===0)||e.issues.push({origin:typeof e.value,code:"not_multiple_of",divisor:t.value,input:e.value,inst:n,continue:!t.abort})}}),rm=T("$ZodCheckNumberFormat",(n,t)=>{Jt.init(n,t),t.format=t.format||"float64";const e=t.format?.includes("int"),i=e?"int":"number",[r,s]=mf[t.format];n._zod.onattach.push(a=>{const o=a._zod.bag;o.format=t.format,o.minimum=r,o.maximum=s,e&&(o.pattern=Jf)}),n._zod.check=a=>{const o=a.value;if(e){if(!Number.isInteger(o)){a.issues.push({expected:i,format:t.format,code:"invalid_type",input:o,inst:n});return}if(!Number.isSafeInteger(o)){o>0?a.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:i,continue:!t.abort}):a.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:i,continue:!t.abort});return}}o<r&&a.issues.push({origin:"number",input:o,code:"too_small",minimum:r,inclusive:!0,inst:n,continue:!t.abort}),o>s&&a.issues.push({origin:"number",input:o,code:"too_big",maximum:s,inst:n})}}),sm=T("$ZodCheckMaxLength",(n,t)=>{var e;Jt.init(n,t),(e=n._zod.def).when??(e.when=i=>{const r=i.value;return!as(r)&&r.length!==void 0}),n._zod.onattach.push(i=>{const r=i._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(i._zod.bag.maximum=t.maximum)}),n._zod.check=i=>{const r=i.value;if(r.length<=t.maximum)return;const a=ls(r);i.issues.push({origin:a,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:n,continue:!t.abort})}}),am=T("$ZodCheckMinLength",(n,t)=>{var e;Jt.init(n,t),(e=n._zod.def).when??(e.when=i=>{const r=i.value;return!as(r)&&r.length!==void 0}),n._zod.onattach.push(i=>{const r=i._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(i._zod.bag.minimum=t.minimum)}),n._zod.check=i=>{const r=i.value;if(r.length>=t.minimum)return;const a=ls(r);i.issues.push({origin:a,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:n,continue:!t.abort})}}),om=T("$ZodCheckLengthEquals",(n,t)=>{var e;Jt.init(n,t),(e=n._zod.def).when??(e.when=i=>{const r=i.value;return!as(r)&&r.length!==void 0}),n._zod.onattach.push(i=>{const r=i._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),n._zod.check=i=>{const r=i.value,s=r.length;if(s===t.length)return;const a=ls(r),o=s>t.length;i.issues.push({origin:a,...o?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:i.value,inst:n,continue:!t.abort})}}),Wi=T("$ZodCheckStringFormat",(n,t)=>{var e,i;Jt.init(n,t),n._zod.onattach.push(r=>{const s=r._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(e=n._zod).check??(e.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:n,continue:!t.abort})}):(i=n._zod).check??(i.check=()=>{})}),cm=T("$ZodCheckRegex",(n,t)=>{Wi.init(n,t),n._zod.check=e=>{t.pattern.lastIndex=0,!t.pattern.test(e.value)&&e.issues.push({origin:"string",code:"invalid_format",format:"regex",input:e.value,pattern:t.pattern.toString(),inst:n,continue:!t.abort})}}),lm=T("$ZodCheckLowerCase",(n,t)=>{t.pattern??(t.pattern=em),Wi.init(n,t)}),hm=T("$ZodCheckUpperCase",(n,t)=>{t.pattern??(t.pattern=nm),Wi.init(n,t)}),um=T("$ZodCheckIncludes",(n,t)=>{Jt.init(n,t);const e=$n(t.includes),i=new RegExp(typeof t.position=="number"?`^.{${t.position}}${e}`:e);t.pattern=i,n._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(i)}),n._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:n,continue:!t.abort})}}),dm=T("$ZodCheckStartsWith",(n,t)=>{Jt.init(n,t);const e=new RegExp(`^${$n(t.prefix)}.*`);t.pattern??(t.pattern=e),n._zod.onattach.push(i=>{const r=i._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(e)}),n._zod.check=i=>{i.value.startsWith(t.prefix)||i.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:i.value,inst:n,continue:!t.abort})}}),fm=T("$ZodCheckEndsWith",(n,t)=>{Jt.init(n,t);const e=new RegExp(`.*${$n(t.suffix)}$`);t.pattern??(t.pattern=e),n._zod.onattach.push(i=>{const r=i._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(e)}),n._zod.check=i=>{i.value.endsWith(t.suffix)||i.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:i.value,inst:n,continue:!t.abort})}}),mm=T("$ZodCheckOverwrite",(n,t)=>{Jt.init(n,t),n._zod.check=e=>{e.value=t.tx(e.value)}});class gm{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const i=t.split(`
`).filter(a=>a),r=Math.min(...i.map(a=>a.length-a.trimStart().length)),s=i.map(a=>a.slice(r)).map(a=>" ".repeat(this.indent*2)+a);for(const a of s)this.content.push(a)}compile(){const t=Function,e=this?.args,r=[...(this?.content??[""]).map(s=>`  ${s}`)];return new t(...e,r.join(`
`))}}const pm={major:4,minor:0,patch:5},ot=T("$ZodType",(n,t)=>{var e;n??(n={}),n._zod.def=t,n._zod.bag=n._zod.bag||{},n._zod.version=pm;const i=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&i.unshift(n);for(const r of i)for(const s of r._zod.onattach)s(n);if(i.length===0)(e=n._zod).deferred??(e.deferred=[]),n._zod.deferred?.push(()=>{n._zod.run=n._zod.parse});else{const r=(s,a,o)=>{let c=Fn(s),l;for(const h of a){if(h._zod.def.when){if(!h._zod.def.when(s))continue}else if(c)continue;const d=s.issues.length,f=h._zod.check(s);if(f instanceof Promise&&o?.async===!1)throw new Un;if(l||f instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await f,s.issues.length!==d&&(c||(c=Fn(s,d)))});else{if(s.issues.length===d)continue;c||(c=Fn(s,d))}}return l?l.then(()=>s):s};n._zod.run=(s,a)=>{const o=n._zod.parse(s,a);if(o instanceof Promise){if(a.async===!1)throw new Un;return o.then(c=>r(c,i,a))}return r(o,i,a)}}n["~standard"]={validate:r=>{try{const s=Mf(n,r);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return If(n,r).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),hs=T("$ZodString",(n,t)=>{ot.init(n,t),n._zod.pattern=[...n?._zod.bag?.patterns??[]].pop()??Vf(n._zod.bag),n._zod.parse=(e,i)=>{if(t.coerce)try{e.value=String(e.value)}catch{}return typeof e.value=="string"||e.issues.push({expected:"string",code:"invalid_type",input:e.value,inst:n}),e}}),pt=T("$ZodStringFormat",(n,t)=>{Wi.init(n,t),hs.init(n,t)}),ym=T("$ZodGUID",(n,t)=>{t.pattern??(t.pattern=Bf),pt.init(n,t)}),bm=T("$ZodUUID",(n,t)=>{if(t.version){const i={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(i===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Io(i))}else t.pattern??(t.pattern=Io());pt.init(n,t)}),wm=T("$ZodEmail",(n,t)=>{t.pattern??(t.pattern=Lf),pt.init(n,t)}),_m=T("$ZodURL",(n,t)=>{pt.init(n,t),n._zod.check=e=>{try{const i=e.value,r=new URL(i),s=r.href;t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||e.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Hf.source,input:e.value,inst:n,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||e.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:e.value,inst:n,continue:!t.abort})),!i.endsWith("/")&&s.endsWith("/")?e.value=s.slice(0,-1):e.value=s;return}catch{e.issues.push({code:"invalid_format",format:"url",input:e.value,inst:n,continue:!t.abort})}}}),Sm=T("$ZodEmoji",(n,t)=>{t.pattern??(t.pattern=Uf()),pt.init(n,t)}),Tm=T("$ZodNanoID",(n,t)=>{t.pattern??(t.pattern=Rf),pt.init(n,t)}),vm=T("$ZodCUID",(n,t)=>{t.pattern??(t.pattern=xf),pt.init(n,t)}),Am=T("$ZodCUID2",(n,t)=>{t.pattern??(t.pattern=Cf),pt.init(n,t)}),Em=T("$ZodULID",(n,t)=>{t.pattern??(t.pattern=Pf),pt.init(n,t)}),km=T("$ZodXID",(n,t)=>{t.pattern??(t.pattern=Df),pt.init(n,t)}),Mm=T("$ZodKSUID",(n,t)=>{t.pattern??(t.pattern=Nf),pt.init(n,t)}),Im=T("$ZodISODateTime",(n,t)=>{t.pattern??(t.pattern=Xf(t)),pt.init(n,t)}),xm=T("$ZodISODate",(n,t)=>{t.pattern??(t.pattern=Zf),pt.init(n,t)}),Cm=T("$ZodISOTime",(n,t)=>{t.pattern??(t.pattern=Yf(t)),pt.init(n,t)}),Pm=T("$ZodISODuration",(n,t)=>{t.pattern??(t.pattern=Of),pt.init(n,t)}),Dm=T("$ZodIPv4",(n,t)=>{t.pattern??(t.pattern=Wf),pt.init(n,t),n._zod.onattach.push(e=>{const i=e._zod.bag;i.format="ipv4"})}),Nm=T("$ZodIPv6",(n,t)=>{t.pattern??(t.pattern=$f),pt.init(n,t),n._zod.onattach.push(e=>{const i=e._zod.bag;i.format="ipv6"}),n._zod.check=e=>{try{new URL(`http://[${e.value}]`)}catch{e.issues.push({code:"invalid_format",format:"ipv6",input:e.value,inst:n,continue:!t.abort})}}}),Rm=T("$ZodCIDRv4",(n,t)=>{t.pattern??(t.pattern=Ff),pt.init(n,t)}),Om=T("$ZodCIDRv6",(n,t)=>{t.pattern??(t.pattern=qf),pt.init(n,t),n._zod.check=e=>{const[i,r]=e.value.split("/");try{if(!r)throw new Error;const s=Number(r);if(`${s}`!==r)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${i}]`)}catch{e.issues.push({code:"invalid_format",format:"cidrv6",input:e.value,inst:n,continue:!t.abort})}}});function Oo(n){if(n==="")return!0;if(n.length%4!==0)return!1;try{return atob(n),!0}catch{return!1}}const Bm=T("$ZodBase64",(n,t)=>{t.pattern??(t.pattern=jf),pt.init(n,t),n._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),n._zod.check=e=>{Oo(e.value)||e.issues.push({code:"invalid_format",format:"base64",input:e.value,inst:n,continue:!t.abort})}});function Lm(n){if(!xo.test(n))return!1;const t=n.replace(/[-_]/g,i=>i==="-"?"+":"/"),e=t.padEnd(Math.ceil(t.length/4)*4,"=");return Oo(e)}const zm=T("$ZodBase64URL",(n,t)=>{t.pattern??(t.pattern=xo),pt.init(n,t),n._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),n._zod.check=e=>{Lm(e.value)||e.issues.push({code:"invalid_format",format:"base64url",input:e.value,inst:n,continue:!t.abort})}}),Um=T("$ZodE164",(n,t)=>{t.pattern??(t.pattern=Gf),pt.init(n,t)});function Wm(n,t=null){try{const e=n.split(".");if(e.length!==3)return!1;const[i]=e;if(!i)return!1;const r=JSON.parse(atob(i));return!("typ"in r&&r?.typ!=="JWT"||!r.alg||t&&(!("alg"in r)||r.alg!==t))}catch{return!1}}const $m=T("$ZodJWT",(n,t)=>{pt.init(n,t),n._zod.check=e=>{Wm(e.value,t.alg)||e.issues.push({code:"invalid_format",format:"jwt",input:e.value,inst:n,continue:!t.abort})}}),Bo=T("$ZodNumber",(n,t)=>{ot.init(n,t),n._zod.pattern=n._zod.bag.pattern??Qf,n._zod.parse=(e,i)=>{if(t.coerce)try{e.value=Number(e.value)}catch{}const r=e.value;if(typeof r=="number"&&!Number.isNaN(r)&&Number.isFinite(r))return e;const s=typeof r=="number"?Number.isNaN(r)?"NaN":Number.isFinite(r)?void 0:"Infinity":void 0;return e.issues.push({expected:"number",code:"invalid_type",input:r,inst:n,...s?{received:s}:{}}),e}}),Fm=T("$ZodNumber",(n,t)=>{rm.init(n,t),Bo.init(n,t)}),qm=T("$ZodBoolean",(n,t)=>{ot.init(n,t),n._zod.pattern=tm,n._zod.parse=(e,i)=>{if(t.coerce)try{e.value=!!e.value}catch{}const r=e.value;return typeof r=="boolean"||e.issues.push({expected:"boolean",code:"invalid_type",input:r,inst:n}),e}}),jm=T("$ZodBigInt",(n,t)=>{ot.init(n,t),n._zod.pattern=Kf,n._zod.parse=(e,i)=>{if(t.coerce)try{e.value=BigInt(e.value)}catch{}return typeof e.value=="bigint"||e.issues.push({expected:"bigint",code:"invalid_type",input:e.value,inst:n}),e}}),Hm=T("$ZodUnknown",(n,t)=>{ot.init(n,t),n._zod.parse=e=>e}),Gm=T("$ZodNever",(n,t)=>{ot.init(n,t),n._zod.parse=(e,i)=>(e.issues.push({expected:"never",code:"invalid_type",input:e.value,inst:n}),e)});function Lo(n,t,e){n.issues.length&&t.issues.push(...Be(e,n.issues)),t.value[e]=n.value}const Zm=T("$ZodArray",(n,t)=>{ot.init(n,t),n._zod.parse=(e,i)=>{const r=e.value;if(!Array.isArray(r))return e.issues.push({expected:"array",code:"invalid_type",input:r,inst:n}),e;e.value=Array(r.length);const s=[];for(let a=0;a<r.length;a++){const o=r[a],c=t.element._zod.run({value:o,issues:[]},i);c instanceof Promise?s.push(c.then(l=>Lo(l,e,a))):Lo(c,e,a)}return s.length?Promise.all(s).then(()=>e):e}});function $i(n,t,e){n.issues.length&&t.issues.push(...Be(e,n.issues)),t.value[e]=n.value}function zo(n,t,e,i){n.issues.length?i[e]===void 0?e in i?t.value[e]=void 0:t.value[e]=n.value:t.issues.push(...Be(e,n.issues)):n.value===void 0?e in i&&(t.value[e]=void 0):t.value[e]=n.value}const Ym=T("$ZodObject",(n,t)=>{ot.init(n,t);const e=ss(()=>{const d=Object.keys(t.shape);for(const g of d)if(!(t.shape[g]instanceof ot))throw new Error(`Invalid element at key "${g}": expected a Zod schema`);const f=ff(t.shape);return{shape:t.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(f)}});it(n._zod,"propValues",()=>{const d=t.shape,f={};for(const g in d){const p=d[g]._zod;if(p.values){f[g]??(f[g]=new Set);for(const b of p.values)f[g].add(b)}}return f});const i=d=>{const f=new gm(["shape","payload","ctx"]),g=e.value,p=v=>{const A=Wn(v);return`shape[${A}]._zod.run({ value: input[${A}], issues: [] }, ctx)`};f.write("const input = payload.value;");const b=Object.create(null);let S=0;for(const v of g.keys)b[v]=`key_${S++}`;f.write("const newResult = {}");for(const v of g.keys)if(g.optionalKeys.has(v)){const A=b[v];f.write(`const ${A} = ${p(v)};`);const E=Wn(v);f.write(`
        if (${A}.issues.length) {
          if (input[${E}] === undefined) {
            if (${E} in input) {
              newResult[${E}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${A}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${E}, ...iss.path] : [${E}],
              }))
            );
          }
        } else if (${A}.value === undefined) {
          if (${E} in input) newResult[${E}] = undefined;
        } else {
          newResult[${E}] = ${A}.value;
        }
        `)}else{const A=b[v];f.write(`const ${A} = ${p(v)};`),f.write(`
          if (${A}.issues.length) payload.issues = payload.issues.concat(${A}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Wn(v)}, ...iss.path] : [${Wn(v)}]
          })));`),f.write(`newResult[${Wn(v)}] = ${A}.value`)}f.write("payload.value = newResult;"),f.write("return payload;");const w=f.compile();return(v,A)=>w(d,v,A)};let r;const s=Li,a=!So.jitless,c=a&&uf.value,l=t.catchall;let h;n._zod.parse=(d,f)=>{h??(h=e.value);const g=d.value;if(!s(g))return d.issues.push({expected:"object",code:"invalid_type",input:g,inst:n}),d;const p=[];if(a&&c&&f?.async===!1&&f.jitless!==!0)r||(r=i(t.shape)),d=r(d,f);else{d.value={};const A=h.shape;for(const E of h.keys){const C=A[E],x=C._zod.run({value:g[E],issues:[]},f),O=C._zod.optin==="optional"&&C._zod.optout==="optional";x instanceof Promise?p.push(x.then(N=>O?zo(N,d,E,g):$i(N,d,E))):O?zo(x,d,E,g):$i(x,d,E)}}if(!l)return p.length?Promise.all(p).then(()=>d):d;const b=[],S=h.keySet,w=l._zod,v=w.def.type;for(const A of Object.keys(g)){if(S.has(A))continue;if(v==="never"){b.push(A);continue}const E=w.run({value:g[A],issues:[]},f);E instanceof Promise?p.push(E.then(C=>$i(C,d,A))):$i(E,d,A)}return b.length&&d.issues.push({code:"unrecognized_keys",keys:b,input:g,inst:n}),p.length?Promise.all(p).then(()=>d):d}});function Uo(n,t,e,i){for(const r of n)if(r.issues.length===0)return t.value=r.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:e,errors:n.map(r=>r.issues.map(s=>Le(s,i,Oe())))}),t}const Wo=T("$ZodUnion",(n,t)=>{ot.init(n,t),it(n._zod,"optin",()=>t.options.some(e=>e._zod.optin==="optional")?"optional":void 0),it(n._zod,"optout",()=>t.options.some(e=>e._zod.optout==="optional")?"optional":void 0),it(n._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),it(n._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${e.map(i=>os(i.source)).join("|")})$`)}}),n._zod.parse=(e,i)=>{let r=!1;const s=[];for(const a of t.options){const o=a._zod.run({value:e.value,issues:[]},i);if(o instanceof Promise)s.push(o),r=!0;else{if(o.issues.length===0)return o;s.push(o)}}return r?Promise.all(s).then(a=>Uo(a,e,n,i)):Uo(s,e,n,i)}}),Xm=T("$ZodDiscriminatedUnion",(n,t)=>{Wo.init(n,t);const e=n._zod.parse;it(n._zod,"propValues",()=>{const r={};for(const s of t.options){const a=s._zod.propValues;if(!a||Object.keys(a).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(s)}"`);for(const[o,c]of Object.entries(a)){r[o]||(r[o]=new Set);for(const l of c)r[o].add(l)}}return r});const i=ss(()=>{const r=t.options,s=new Map;for(const a of r){const o=a._zod.propValues?.[t.discriminator];if(!o||o.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(a)}"`);for(const c of o){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,a)}}return s});n._zod.parse=(r,s)=>{const a=r.value;if(!Li(a))return r.issues.push({code:"invalid_type",expected:"object",input:a,inst:n}),r;const o=i.value.get(a?.[t.discriminator]);return o?o._zod.run(r,s):t.unionFallback?e(r,s):(r.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:a,path:[t.discriminator],inst:n}),r)}}),Vm=T("$ZodIntersection",(n,t)=>{ot.init(n,t),n._zod.parse=(e,i)=>{const r=e.value,s=t.left._zod.run({value:r,issues:[]},i),a=t.right._zod.run({value:r,issues:[]},i);return s instanceof Promise||a instanceof Promise?Promise.all([s,a]).then(([c,l])=>$o(e,c,l)):$o(e,s,a)}});function us(n,t){if(n===t)return{valid:!0,data:n};if(n instanceof Date&&t instanceof Date&&+n==+t)return{valid:!0,data:n};if(zi(n)&&zi(t)){const e=Object.keys(t),i=Object.keys(n).filter(s=>e.indexOf(s)!==-1),r={...n,...t};for(const s of i){const a=us(n[s],t[s]);if(!a.valid)return{valid:!1,mergeErrorPath:[s,...a.mergeErrorPath]};r[s]=a.data}return{valid:!0,data:r}}if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return{valid:!1,mergeErrorPath:[]};const e=[];for(let i=0;i<n.length;i++){const r=n[i],s=t[i],a=us(r,s);if(!a.valid)return{valid:!1,mergeErrorPath:[i,...a.mergeErrorPath]};e.push(a.data)}return{valid:!0,data:e}}return{valid:!1,mergeErrorPath:[]}}function $o(n,t,e){if(t.issues.length&&n.issues.push(...t.issues),e.issues.length&&n.issues.push(...e.issues),Fn(n))return n;const i=us(t.value,e.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return n.value=i.data,n}const Km=T("$ZodTuple",(n,t)=>{ot.init(n,t);const e=t.items,i=e.length-[...e].reverse().findIndex(r=>r._zod.optin!=="optional");n._zod.parse=(r,s)=>{const a=r.value;if(!Array.isArray(a))return r.issues.push({input:a,inst:n,expected:"tuple",code:"invalid_type"}),r;r.value=[];const o=[];if(!t.rest){const l=a.length>e.length,h=a.length<i-1;if(l||h)return r.issues.push({input:a,inst:n,origin:"array",...l?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length}}),r}let c=-1;for(const l of e){if(c++,c>=a.length&&c>=i)continue;const h=l._zod.run({value:a[c],issues:[]},s);h instanceof Promise?o.push(h.then(d=>Fi(d,r,c))):Fi(h,r,c)}if(t.rest){const l=a.slice(e.length);for(const h of l){c++;const d=t.rest._zod.run({value:h,issues:[]},s);d instanceof Promise?o.push(d.then(f=>Fi(f,r,c))):Fi(d,r,c)}}return o.length?Promise.all(o).then(()=>r):r}});function Fi(n,t,e){n.issues.length&&t.issues.push(...Be(e,n.issues)),t.value[e]=n.value}const Jm=T("$ZodRecord",(n,t)=>{ot.init(n,t),n._zod.parse=(e,i)=>{const r=e.value;if(!zi(r))return e.issues.push({expected:"record",code:"invalid_type",input:r,inst:n}),e;const s=[];if(t.keyType._zod.values){const a=t.keyType._zod.values;e.value={};for(const c of a)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const l=t.valueType._zod.run({value:r[c],issues:[]},i);l instanceof Promise?s.push(l.then(h=>{h.issues.length&&e.issues.push(...Be(c,h.issues)),e.value[c]=h.value})):(l.issues.length&&e.issues.push(...Be(c,l.issues)),e.value[c]=l.value)}let o;for(const c in r)a.has(c)||(o=o??[],o.push(c));o&&o.length>0&&e.issues.push({code:"unrecognized_keys",input:r,inst:n,keys:o})}else{e.value={};for(const a of Reflect.ownKeys(r)){if(a==="__proto__")continue;const o=t.keyType._zod.run({value:a,issues:[]},i);if(o instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(o.issues.length){e.issues.push({origin:"record",code:"invalid_key",issues:o.issues.map(l=>Le(l,i,Oe())),input:a,path:[a],inst:n}),e.value[o.value]=o.value;continue}const c=t.valueType._zod.run({value:r[a],issues:[]},i);c instanceof Promise?s.push(c.then(l=>{l.issues.length&&e.issues.push(...Be(a,l.issues)),e.value[o.value]=l.value})):(c.issues.length&&e.issues.push(...Be(a,c.issues)),e.value[o.value]=c.value)}}return s.length?Promise.all(s).then(()=>e):e}}),Qm=T("$ZodEnum",(n,t)=>{ot.init(n,t);const e=cf(t.entries);n._zod.values=new Set(e),n._zod.pattern=new RegExp(`^(${e.filter(i=>df.has(typeof i)).map(i=>typeof i=="string"?$n(i):i.toString()).join("|")})$`),n._zod.parse=(i,r)=>{const s=i.value;return n._zod.values.has(s)||i.issues.push({code:"invalid_value",values:e,input:s,inst:n}),i}}),tg=T("$ZodLiteral",(n,t)=>{ot.init(n,t),n._zod.values=new Set(t.values),n._zod.pattern=new RegExp(`^(${t.values.map(e=>typeof e=="string"?$n(e):e?e.toString():String(e)).join("|")})$`),n._zod.parse=(e,i)=>{const r=e.value;return n._zod.values.has(r)||e.issues.push({code:"invalid_value",values:t.values,input:r,inst:n}),e}}),eg=T("$ZodTransform",(n,t)=>{ot.init(n,t),n._zod.parse=(e,i)=>{const r=t.transform(e.value,e);if(i.async)return(r instanceof Promise?r:Promise.resolve(r)).then(a=>(e.value=a,e));if(r instanceof Promise)throw new Un;return e.value=r,e}}),ng=T("$ZodOptional",(n,t)=>{ot.init(n,t),n._zod.optin="optional",n._zod.optout="optional",it(n._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),it(n._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${os(e.source)})?$`):void 0}),n._zod.parse=(e,i)=>t.innerType._zod.optin==="optional"?t.innerType._zod.run(e,i):e.value===void 0?e:t.innerType._zod.run(e,i)}),ig=T("$ZodNullable",(n,t)=>{ot.init(n,t),it(n._zod,"optin",()=>t.innerType._zod.optin),it(n._zod,"optout",()=>t.innerType._zod.optout),it(n._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${os(e.source)}|null)$`):void 0}),it(n._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),n._zod.parse=(e,i)=>e.value===null?e:t.innerType._zod.run(e,i)}),rg=T("$ZodDefault",(n,t)=>{ot.init(n,t),n._zod.optin="optional",it(n._zod,"values",()=>t.innerType._zod.values),n._zod.parse=(e,i)=>{if(e.value===void 0)return e.value=t.defaultValue,e;const r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(s=>Fo(s,t)):Fo(r,t)}});function Fo(n,t){return n.value===void 0&&(n.value=t.defaultValue),n}const sg=T("$ZodPrefault",(n,t)=>{ot.init(n,t),n._zod.optin="optional",it(n._zod,"values",()=>t.innerType._zod.values),n._zod.parse=(e,i)=>(e.value===void 0&&(e.value=t.defaultValue),t.innerType._zod.run(e,i))}),ag=T("$ZodNonOptional",(n,t)=>{ot.init(n,t),it(n._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(i=>i!==void 0)):void 0}),n._zod.parse=(e,i)=>{const r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(s=>qo(s,n)):qo(r,n)}});function qo(n,t){return!n.issues.length&&n.value===void 0&&n.issues.push({code:"invalid_type",expected:"nonoptional",input:n.value,inst:t}),n}const og=T("$ZodCatch",(n,t)=>{ot.init(n,t),n._zod.optin="optional",it(n._zod,"optout",()=>t.innerType._zod.optout),it(n._zod,"values",()=>t.innerType._zod.values),n._zod.parse=(e,i)=>{const r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(s=>(e.value=s.value,s.issues.length&&(e.value=t.catchValue({...e,error:{issues:s.issues.map(a=>Le(a,i,Oe()))},input:e.value}),e.issues=[]),e)):(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(s=>Le(s,i,Oe()))},input:e.value}),e.issues=[]),e)}}),cg=T("$ZodPipe",(n,t)=>{ot.init(n,t),it(n._zod,"values",()=>t.in._zod.values),it(n._zod,"optin",()=>t.in._zod.optin),it(n._zod,"optout",()=>t.out._zod.optout),it(n._zod,"propValues",()=>t.in._zod.propValues),n._zod.parse=(e,i)=>{const r=t.in._zod.run(e,i);return r instanceof Promise?r.then(s=>jo(s,t,i)):jo(r,t,i)}});function jo(n,t,e){return Fn(n)?n:t.out._zod.run({value:n.value,issues:n.issues},e)}const lg=T("$ZodReadonly",(n,t)=>{ot.init(n,t),it(n._zod,"propValues",()=>t.innerType._zod.propValues),it(n._zod,"values",()=>t.innerType._zod.values),it(n._zod,"optin",()=>t.innerType._zod.optin),it(n._zod,"optout",()=>t.innerType._zod.optout),n._zod.parse=(e,i)=>{const r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(Ho):Ho(r)}});function Ho(n){return n.value=Object.freeze(n.value),n}const hg=T("$ZodLazy",(n,t)=>{ot.init(n,t),it(n._zod,"innerType",()=>t.getter()),it(n._zod,"pattern",()=>n._zod.innerType._zod.pattern),it(n._zod,"propValues",()=>n._zod.innerType._zod.propValues),it(n._zod,"optin",()=>n._zod.innerType._zod.optin),it(n._zod,"optout",()=>n._zod.innerType._zod.optout),n._zod.parse=(e,i)=>n._zod.innerType._zod.run(e,i)}),ug=T("$ZodCustom",(n,t)=>{Jt.init(n,t),ot.init(n,t),n._zod.parse=(e,i)=>e,n._zod.check=e=>{const i=e.value,r=t.fn(i);if(r instanceof Promise)return r.then(s=>Go(s,e,i,n));Go(r,e,i,n)}});function Go(n,t,e,i){if(!n){const r={code:"custom",input:e,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(r.params=i._zod.def.params),t.issues.push(qn(r))}}class dg{constructor(){this._map=new Map,this._idmap=new Map}add(t,...e){const i=e[0];if(this._map.set(t,i),i&&typeof i=="object"&&"id"in i){if(this._idmap.has(i.id))throw new Error(`ID ${i.id} already exists in the registry`);this._idmap.set(i.id,t)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(t){const e=this._map.get(t);return e&&typeof e=="object"&&"id"in e&&this._idmap.delete(e.id),this._map.delete(t),this}get(t){const e=t._zod.parent;if(e){const i={...this.get(e)??{}};return delete i.id,{...i,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function fg(){return new dg}const qi=fg();function mg(n,t){return new n({type:"string",...z(t)})}function gg(n,t){return new n({type:"string",format:"email",check:"string_format",abort:!1,...z(t)})}function Zo(n,t){return new n({type:"string",format:"guid",check:"string_format",abort:!1,...z(t)})}function Yo(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,...z(t)})}function pg(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...z(t)})}function yg(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...z(t)})}function bg(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...z(t)})}function wg(n,t){return new n({type:"string",format:"url",check:"string_format",abort:!1,...z(t)})}function _g(n,t){return new n({type:"string",format:"emoji",check:"string_format",abort:!1,...z(t)})}function Sg(n,t){return new n({type:"string",format:"nanoid",check:"string_format",abort:!1,...z(t)})}function Tg(n,t){return new n({type:"string",format:"cuid",check:"string_format",abort:!1,...z(t)})}function vg(n,t){return new n({type:"string",format:"cuid2",check:"string_format",abort:!1,...z(t)})}function Ag(n,t){return new n({type:"string",format:"ulid",check:"string_format",abort:!1,...z(t)})}function Eg(n,t){return new n({type:"string",format:"xid",check:"string_format",abort:!1,...z(t)})}function kg(n,t){return new n({type:"string",format:"ksuid",check:"string_format",abort:!1,...z(t)})}function Mg(n,t){return new n({type:"string",format:"ipv4",check:"string_format",abort:!1,...z(t)})}function Ig(n,t){return new n({type:"string",format:"ipv6",check:"string_format",abort:!1,...z(t)})}function xg(n,t){return new n({type:"string",format:"cidrv4",check:"string_format",abort:!1,...z(t)})}function Cg(n,t){return new n({type:"string",format:"cidrv6",check:"string_format",abort:!1,...z(t)})}function Pg(n,t){return new n({type:"string",format:"base64",check:"string_format",abort:!1,...z(t)})}function Dg(n,t){return new n({type:"string",format:"base64url",check:"string_format",abort:!1,...z(t)})}function Ng(n,t){return new n({type:"string",format:"e164",check:"string_format",abort:!1,...z(t)})}function Xo(n,t){return new n({type:"string",format:"jwt",check:"string_format",abort:!1,...z(t)})}function Rg(n,t){return new n({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...z(t)})}function Og(n,t){return new n({type:"string",format:"date",check:"string_format",...z(t)})}function Bg(n,t){return new n({type:"string",format:"time",check:"string_format",precision:null,...z(t)})}function Lg(n,t){return new n({type:"string",format:"duration",check:"string_format",...z(t)})}function zg(n,t){return new n({type:"number",checks:[],...z(t)})}function Ug(n,t){return new n({type:"number",check:"number_format",abort:!1,format:"safeint",...z(t)})}function Wg(n,t){return new n({type:"boolean",...z(t)})}function $g(n,t){return new n({type:"bigint",...z(t)})}function Fg(n){return new n({type:"unknown"})}function qg(n,t){return new n({type:"never",...z(t)})}function ji(n,t){return new No({check:"less_than",...z(t),value:n,inclusive:!1})}function hn(n,t){return new No({check:"less_than",...z(t),value:n,inclusive:!0})}function Hi(n,t){return new Ro({check:"greater_than",...z(t),value:n,inclusive:!1})}function ze(n,t){return new Ro({check:"greater_than",...z(t),value:n,inclusive:!0})}function ds(n,t){return new im({check:"multiple_of",...z(t),value:n})}function Vo(n,t){return new sm({check:"max_length",...z(t),maximum:n})}function Gi(n,t){return new am({check:"min_length",...z(t),minimum:n})}function Ko(n,t){return new om({check:"length_equals",...z(t),length:n})}function jg(n,t){return new cm({check:"string_format",format:"regex",...z(t),pattern:n})}function Hg(n){return new lm({check:"string_format",format:"lowercase",...z(n)})}function Gg(n){return new hm({check:"string_format",format:"uppercase",...z(n)})}function Zg(n,t){return new um({check:"string_format",format:"includes",...z(t),includes:n})}function Yg(n,t){return new dm({check:"string_format",format:"starts_with",...z(t),prefix:n})}function Xg(n,t){return new fm({check:"string_format",format:"ends_with",...z(t),suffix:n})}function jn(n){return new mm({check:"overwrite",tx:n})}function Vg(n){return jn(t=>t.normalize(n))}function Kg(){return jn(n=>n.trim())}function Jg(){return jn(n=>n.toLowerCase())}function Qg(){return jn(n=>n.toUpperCase())}function tp(n,t,e){return new n({type:"array",element:t,...z(e)})}function ep(n,t,e){return new n({type:"custom",check:"custom",fn:t,...z(e)})}const np=T("ZodISODateTime",(n,t)=>{Im.init(n,t),St.init(n,t)});function ip(n){return Rg(np,n)}const rp=T("ZodISODate",(n,t)=>{xm.init(n,t),St.init(n,t)});function sp(n){return Og(rp,n)}const ap=T("ZodISOTime",(n,t)=>{Cm.init(n,t),St.init(n,t)});function op(n){return Bg(ap,n)}const cp=T("ZodISODuration",(n,t)=>{Pm.init(n,t),St.init(n,t)});function lp(n){return Lg(cp,n)}const Zi=T("ZodError",(n,t)=>{Ao.init(n,t),n.name="ZodError",Object.defineProperties(n,{format:{value:e=>Tf(n,e)},flatten:{value:e=>Sf(n,e)},addIssue:{value:e=>n.issues.push(e)},addIssues:{value:e=>n.issues.push(...e)},isEmpty:{get(){return n.issues.length===0}}})},{Parent:Error}),hp=Ef(Zi),up=kf(Zi),dp=ko(Zi),fp=Mo(Zi),mt=T("ZodType",(n,t)=>(ot.init(n,t),n.def=t,Object.defineProperty(n,"_def",{value:t}),n.check=(...e)=>n.clone({...t,checks:[...t.checks??[],...e.map(i=>typeof i=="function"?{_zod:{check:i,def:{check:"custom"},onattach:[]}}:i)]}),n.clone=(e,i)=>Ye(n,e,i),n.brand=()=>n,n.register=((e,i)=>(e.add(n,i),n)),n.parse=(e,i)=>hp(n,e,i,{callee:n.parse}),n.safeParse=(e,i)=>dp(n,e,i),n.parseAsync=async(e,i)=>up(n,e,i,{callee:n.parseAsync}),n.safeParseAsync=async(e,i)=>fp(n,e,i),n.spa=n.safeParseAsync,n.refine=(e,i)=>n.check(o0(e,i)),n.superRefine=e=>n.check(c0(e)),n.overwrite=e=>n.check(jn(e)),n.optional=()=>lc(n),n.nullable=()=>hc(n),n.nullish=()=>lc(hc(n)),n.nonoptional=e=>Jp(n,e),n.array=()=>Yi(n),n.or=e=>Xe([n,e]),n.and=e=>qp(n,e),n.transform=e=>ys(n,oc(e)),n.default=e=>Xp(n,e),n.prefault=e=>Kp(n,e),n.catch=e=>t0(n,e),n.pipe=e=>ys(n,e),n.readonly=()=>i0(n),n.describe=e=>{const i=n.clone();return qi.add(i,{description:e}),i},Object.defineProperty(n,"description",{get(){return qi.get(n)?.description},configurable:!0}),n.meta=(...e)=>{if(e.length===0)return qi.get(n);const i=n.clone();return qi.add(i,e[0]),i},n.isOptional=()=>n.safeParse(void 0).success,n.isNullable=()=>n.safeParse(null).success,n)),Jo=T("_ZodString",(n,t)=>{hs.init(n,t),mt.init(n,t);const e=n._zod.bag;n.format=e.format??null,n.minLength=e.minimum??null,n.maxLength=e.maximum??null,n.regex=(...i)=>n.check(jg(...i)),n.includes=(...i)=>n.check(Zg(...i)),n.startsWith=(...i)=>n.check(Yg(...i)),n.endsWith=(...i)=>n.check(Xg(...i)),n.min=(...i)=>n.check(Gi(...i)),n.max=(...i)=>n.check(Vo(...i)),n.length=(...i)=>n.check(Ko(...i)),n.nonempty=(...i)=>n.check(Gi(1,...i)),n.lowercase=i=>n.check(Hg(i)),n.uppercase=i=>n.check(Gg(i)),n.trim=()=>n.check(Kg()),n.normalize=(...i)=>n.check(Vg(...i)),n.toLowerCase=()=>n.check(Jg()),n.toUpperCase=()=>n.check(Qg())}),mp=T("ZodString",(n,t)=>{hs.init(n,t),Jo.init(n,t),n.email=e=>n.check(gg(gp,e)),n.url=e=>n.check(wg(yp,e)),n.jwt=e=>n.check(Xo(tc,e)),n.emoji=e=>n.check(_g(bp,e)),n.guid=e=>n.check(Zo(Qo,e)),n.uuid=e=>n.check(Yo(Hn,e)),n.uuidv4=e=>n.check(pg(Hn,e)),n.uuidv6=e=>n.check(yg(Hn,e)),n.uuidv7=e=>n.check(bg(Hn,e)),n.nanoid=e=>n.check(Sg(wp,e)),n.guid=e=>n.check(Zo(Qo,e)),n.cuid=e=>n.check(Tg(_p,e)),n.cuid2=e=>n.check(vg(Sp,e)),n.ulid=e=>n.check(Ag(Tp,e)),n.base64=e=>n.check(Pg(xp,e)),n.base64url=e=>n.check(Dg(Cp,e)),n.xid=e=>n.check(Eg(vp,e)),n.ksuid=e=>n.check(kg(Ap,e)),n.ipv4=e=>n.check(Mg(Ep,e)),n.ipv6=e=>n.check(Ig(kp,e)),n.cidrv4=e=>n.check(xg(Mp,e)),n.cidrv6=e=>n.check(Cg(Ip,e)),n.e164=e=>n.check(Ng(Pp,e)),n.datetime=e=>n.check(ip(e)),n.date=e=>n.check(sp(e)),n.time=e=>n.check(op(e)),n.duration=e=>n.check(lp(e))});function H(n){return mg(mp,n)}const St=T("ZodStringFormat",(n,t)=>{pt.init(n,t),Jo.init(n,t)}),gp=T("ZodEmail",(n,t)=>{wm.init(n,t),St.init(n,t)}),Qo=T("ZodGUID",(n,t)=>{ym.init(n,t),St.init(n,t)}),Hn=T("ZodUUID",(n,t)=>{bm.init(n,t),St.init(n,t)});function pp(n){return Yo(Hn,n)}const yp=T("ZodURL",(n,t)=>{_m.init(n,t),St.init(n,t)}),bp=T("ZodEmoji",(n,t)=>{Sm.init(n,t),St.init(n,t)}),wp=T("ZodNanoID",(n,t)=>{Tm.init(n,t),St.init(n,t)}),_p=T("ZodCUID",(n,t)=>{vm.init(n,t),St.init(n,t)}),Sp=T("ZodCUID2",(n,t)=>{Am.init(n,t),St.init(n,t)}),Tp=T("ZodULID",(n,t)=>{Em.init(n,t),St.init(n,t)}),vp=T("ZodXID",(n,t)=>{km.init(n,t),St.init(n,t)}),Ap=T("ZodKSUID",(n,t)=>{Mm.init(n,t),St.init(n,t)}),Ep=T("ZodIPv4",(n,t)=>{Dm.init(n,t),St.init(n,t)}),kp=T("ZodIPv6",(n,t)=>{Nm.init(n,t),St.init(n,t)}),Mp=T("ZodCIDRv4",(n,t)=>{Rm.init(n,t),St.init(n,t)}),Ip=T("ZodCIDRv6",(n,t)=>{Om.init(n,t),St.init(n,t)}),xp=T("ZodBase64",(n,t)=>{Bm.init(n,t),St.init(n,t)}),Cp=T("ZodBase64URL",(n,t)=>{zm.init(n,t),St.init(n,t)}),Pp=T("ZodE164",(n,t)=>{Um.init(n,t),St.init(n,t)}),tc=T("ZodJWT",(n,t)=>{$m.init(n,t),St.init(n,t)});function Dp(n){return Xo(tc,n)}const ec=T("ZodNumber",(n,t)=>{Bo.init(n,t),mt.init(n,t),n.gt=(i,r)=>n.check(Hi(i,r)),n.gte=(i,r)=>n.check(ze(i,r)),n.min=(i,r)=>n.check(ze(i,r)),n.lt=(i,r)=>n.check(ji(i,r)),n.lte=(i,r)=>n.check(hn(i,r)),n.max=(i,r)=>n.check(hn(i,r)),n.int=i=>n.check(nc(i)),n.safe=i=>n.check(nc(i)),n.positive=i=>n.check(Hi(0,i)),n.nonnegative=i=>n.check(ze(0,i)),n.negative=i=>n.check(ji(0,i)),n.nonpositive=i=>n.check(hn(0,i)),n.multipleOf=(i,r)=>n.check(ds(i,r)),n.step=(i,r)=>n.check(ds(i,r)),n.finite=()=>n;const e=n._zod.bag;n.minValue=Math.max(e.minimum??Number.NEGATIVE_INFINITY,e.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,n.maxValue=Math.min(e.maximum??Number.POSITIVE_INFINITY,e.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,n.isInt=(e.format??"").includes("int")||Number.isSafeInteger(e.multipleOf??.5),n.isFinite=!0,n.format=e.format??null});function j(n){return zg(ec,n)}const Np=T("ZodNumberFormat",(n,t)=>{Fm.init(n,t),ec.init(n,t)});function nc(n){return Ug(Np,n)}const Rp=T("ZodBoolean",(n,t)=>{qm.init(n,t),mt.init(n,t)});function zt(n){return Wg(Rp,n)}const Op=T("ZodBigInt",(n,t)=>{jm.init(n,t),mt.init(n,t),n.gte=(i,r)=>n.check(ze(i,r)),n.min=(i,r)=>n.check(ze(i,r)),n.gt=(i,r)=>n.check(Hi(i,r)),n.gte=(i,r)=>n.check(ze(i,r)),n.min=(i,r)=>n.check(ze(i,r)),n.lt=(i,r)=>n.check(ji(i,r)),n.lte=(i,r)=>n.check(hn(i,r)),n.max=(i,r)=>n.check(hn(i,r)),n.positive=i=>n.check(Hi(BigInt(0),i)),n.negative=i=>n.check(ji(BigInt(0),i)),n.nonpositive=i=>n.check(hn(BigInt(0),i)),n.nonnegative=i=>n.check(ze(BigInt(0),i)),n.multipleOf=(i,r)=>n.check(ds(i,r));const e=n._zod.bag;n.minValue=e.minimum??null,n.maxValue=e.maximum??null,n.format=e.format??null});function Bp(n){return $g(Op,n)}const Lp=T("ZodUnknown",(n,t)=>{Hm.init(n,t),mt.init(n,t)});function ic(){return Fg(Lp)}const zp=T("ZodNever",(n,t)=>{Gm.init(n,t),mt.init(n,t)});function rc(n){return qg(zp,n)}const Up=T("ZodArray",(n,t)=>{Zm.init(n,t),mt.init(n,t),n.element=t.element,n.min=(e,i)=>n.check(Gi(e,i)),n.nonempty=e=>n.check(Gi(1,e)),n.max=(e,i)=>n.check(Vo(e,i)),n.length=(e,i)=>n.check(Ko(e,i)),n.unwrap=()=>n.element});function Yi(n,t){return tp(Up,n,t)}const Wp=T("ZodObject",(n,t)=>{Ym.init(n,t),mt.init(n,t),it(n,"shape",()=>t.shape),n.keyof=()=>Ut(Object.keys(n._zod.def.shape)),n.catchall=e=>n.clone({...n._zod.def,catchall:e}),n.passthrough=()=>n.clone({...n._zod.def,catchall:ic()}),n.loose=()=>n.clone({...n._zod.def,catchall:ic()}),n.strict=()=>n.clone({...n._zod.def,catchall:rc()}),n.strip=()=>n.clone({...n._zod.def,catchall:void 0}),n.extend=e=>yf(n,e),n.merge=e=>bf(n,e),n.pick=e=>gf(n,e),n.omit=e=>pf(n,e),n.partial=(...e)=>wf(cc,n,e[0]),n.required=(...e)=>_f(uc,n,e[0])});function B(n,t){const e={type:"object",get shape(){return cs(this,"shape",{...n}),this.shape},...z(t)};return new Wp(e)}const sc=T("ZodUnion",(n,t)=>{Wo.init(n,t),mt.init(n,t),n.options=t.options});function Xe(n,t){return new sc({type:"union",options:n,...z(t)})}const $p=T("ZodDiscriminatedUnion",(n,t)=>{sc.init(n,t),Xm.init(n,t)});function fs(n,t,e){return new $p({type:"union",options:t,discriminator:n,...z(e)})}const Fp=T("ZodIntersection",(n,t)=>{Vm.init(n,t),mt.init(n,t)});function qp(n,t){return new Fp({type:"intersection",left:n,right:t})}const jp=T("ZodTuple",(n,t)=>{Km.init(n,t),mt.init(n,t),n.rest=e=>n.clone({...n._zod.def,rest:e})});function ms(n,t,e){const i=t instanceof ot,r=i?e:t,s=i?t:null;return new jp({type:"tuple",items:n,rest:s,...z(r)})}const ac=T("ZodRecord",(n,t)=>{Jm.init(n,t),mt.init(n,t),n.keyType=t.keyType,n.valueType=t.valueType});function Gn(n,t,e){return new ac({type:"record",keyType:n,valueType:t,...z(e)})}function gs(n,t,e){return new ac({type:"record",keyType:Xe([n,rc()]),valueType:t,...z(e)})}const ps=T("ZodEnum",(n,t)=>{Qm.init(n,t),mt.init(n,t),n.enum=t.entries,n.options=Object.values(t.entries);const e=new Set(Object.keys(t.entries));n.extract=(i,r)=>{const s={};for(const a of i)if(e.has(a))s[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new ps({...t,checks:[],...z(r),entries:s})},n.exclude=(i,r)=>{const s={...t.entries};for(const a of i)if(e.has(a))delete s[a];else throw new Error(`Key ${a} not found in enum`);return new ps({...t,checks:[],...z(r),entries:s})}});function Ut(n,t){const e=Array.isArray(n)?Object.fromEntries(n.map(i=>[i,i])):n;return new ps({type:"enum",entries:e,...z(t)})}const Hp=T("ZodLiteral",(n,t)=>{tg.init(n,t),mt.init(n,t),n.values=new Set(t.values),Object.defineProperty(n,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function $(n,t){return new Hp({type:"literal",values:Array.isArray(n)?n:[n],...z(t)})}const Gp=T("ZodTransform",(n,t)=>{eg.init(n,t),mt.init(n,t),n._zod.parse=(e,i)=>{e.addIssue=s=>{if(typeof s=="string")e.issues.push(qn(s,e.value,t));else{const a=s;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=e.value),a.inst??(a.inst=n),a.continue??(a.continue=!0),e.issues.push(qn(a))}};const r=t.transform(e.value,e);return r instanceof Promise?r.then(s=>(e.value=s,e)):(e.value=r,e)}});function oc(n){return new Gp({type:"transform",transform:n})}const cc=T("ZodOptional",(n,t)=>{ng.init(n,t),mt.init(n,t),n.unwrap=()=>n._zod.def.innerType});function lc(n){return new cc({type:"optional",innerType:n})}const Zp=T("ZodNullable",(n,t)=>{ig.init(n,t),mt.init(n,t),n.unwrap=()=>n._zod.def.innerType});function hc(n){return new Zp({type:"nullable",innerType:n})}const Yp=T("ZodDefault",(n,t)=>{rg.init(n,t),mt.init(n,t),n.unwrap=()=>n._zod.def.innerType,n.removeDefault=n.unwrap});function Xp(n,t){return new Yp({type:"default",innerType:n,get defaultValue(){return typeof t=="function"?t():t}})}const Vp=T("ZodPrefault",(n,t)=>{sg.init(n,t),mt.init(n,t),n.unwrap=()=>n._zod.def.innerType});function Kp(n,t){return new Vp({type:"prefault",innerType:n,get defaultValue(){return typeof t=="function"?t():t}})}const uc=T("ZodNonOptional",(n,t)=>{ag.init(n,t),mt.init(n,t),n.unwrap=()=>n._zod.def.innerType});function Jp(n,t){return new uc({type:"nonoptional",innerType:n,...z(t)})}const Qp=T("ZodCatch",(n,t)=>{og.init(n,t),mt.init(n,t),n.unwrap=()=>n._zod.def.innerType,n.removeCatch=n.unwrap});function t0(n,t){return new Qp({type:"catch",innerType:n,catchValue:typeof t=="function"?t:()=>t})}const e0=T("ZodPipe",(n,t)=>{cg.init(n,t),mt.init(n,t),n.in=t.in,n.out=t.out});function ys(n,t){return new e0({type:"pipe",in:n,out:t})}const n0=T("ZodReadonly",(n,t)=>{lg.init(n,t),mt.init(n,t)});function i0(n){return new n0({type:"readonly",innerType:n})}const r0=T("ZodLazy",(n,t)=>{hg.init(n,t),mt.init(n,t),n.unwrap=()=>n._zod.def.getter()});function dc(n){return new r0({type:"lazy",getter:n})}const s0=T("ZodCustom",(n,t)=>{ug.init(n,t),mt.init(n,t)});function a0(n){const t=new Jt({check:"custom"});return t._zod.check=n,t}function o0(n,t={}){return ep(s0,n,t)}function c0(n){const t=a0(e=>(e.addIssue=i=>{if(typeof i=="string")e.issues.push(qn(i,e.value,t._zod.def));else{const r=i;r.fatal&&(r.continue=!1),r.code??(r.code="custom"),r.input??(r.input=e.value),r.inst??(r.inst=t),r.continue??(r.continue=!t._zod.def.abort),e.issues.push(qn(r))}},n(e.value,e)));return t}function l0(n,t){return ys(oc(n),t)}const Xi={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var fc={};function me(n,t){const e=n;try{if(typeof{url:self.location.href}<"u"&&Xi){const i=Xi[e]??Xi[n];if(i!==void 0)return String(i)}}catch{}try{if(typeof process<"u"&&fc){const i=fc[n];if(i!==void 0)return i}}catch{}}const ue={get GAME_ENV(){try{if(typeof{url:self.location.href}<"u"&&Xi)return"production"}catch{}return me("GAME_ENV")??"dev"},get TURNSTILE_SECRET_KEY(){return me("TURNSTILE_SECRET_KEY")},get STRIPE_PUBLISHABLE_KEY(){return me("STRIPE_PUBLISHABLE_KEY")},get DOMAIN(){return me("DOMAIN")},get SUBDOMAIN(){return me("SUBDOMAIN")},get OTEL_EXPORTER_OTLP_ENDPOINT(){return me("OTEL_EXPORTER_OTLP_ENDPOINT")},get OTEL_AUTH_HEADER(){return me("OTEL_AUTH_HEADER")},get GIT_COMMIT(){return me("GIT_COMMIT")},get API_KEY(){return me("API_KEY")},get ADMIN_TOKEN(){return me("ADMIN_TOKEN")}};var h0={grad:.9,turn:360,rad:360/(2*Math.PI)},Te=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},Ot=function(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*n)/e+0},ce=function(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),n>e?e:n>t?n:t},mc=function(n){return(n=isFinite(n)?n%360:0)>0?n:n+360},gc=function(n){return{r:ce(n.r,0,255),g:ce(n.g,0,255),b:ce(n.b,0,255),a:ce(n.a)}},bs=function(n){return{r:Ot(n.r),g:Ot(n.g),b:Ot(n.b),a:Ot(n.a,3)}},u0=/^#([0-9a-f]{3,8})$/i,Vi=function(n){var t=n.toString(16);return t.length<2?"0"+t:t},pc=function(n){var t=n.r,e=n.g,i=n.b,r=n.a,s=Math.max(t,e,i),a=s-Math.min(t,e,i),o=a?s===t?(e-i)/a:s===e?2+(i-t)/a:4+(t-e)/a:0;return{h:60*(o<0?o+6:o),s:s?a/s*100:0,v:s/255*100,a:r}},yc=function(n){var t=n.h,e=n.s,i=n.v,r=n.a;t=t/360*6,e/=100,i/=100;var s=Math.floor(t),a=i*(1-e),o=i*(1-(t-s)*e),c=i*(1-(1-t+s)*e),l=s%6;return{r:255*[i,o,a,a,c,i][l],g:255*[c,i,i,o,a,a][l],b:255*[a,a,c,i,i,o][l],a:r}},bc=function(n){return{h:mc(n.h),s:ce(n.s,0,100),l:ce(n.l,0,100),a:ce(n.a)}},wc=function(n){return{h:Ot(n.h),s:Ot(n.s),l:Ot(n.l),a:Ot(n.a,3)}},_c=function(n){return yc((e=(t=n).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Zn=function(n){return{h:(t=pc(n)).h,s:(r=(200-(e=t.s))*(i=t.v)/100)>0&&r<200?e*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,e,i,r},d0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,f0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,g0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ws={string:[[function(n){var t=u0.exec(n);return t?(n=t[1]).length<=4?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?Ot(parseInt(n[3]+n[3],16)/255,2):1}:n.length===6||n.length===8?{r:parseInt(n.substr(0,2),16),g:parseInt(n.substr(2,2),16),b:parseInt(n.substr(4,2),16),a:n.length===8?Ot(parseInt(n.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(n){var t=m0.exec(n)||g0.exec(n);return t?t[2]!==t[4]||t[4]!==t[6]?null:gc({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(n){var t=d0.exec(n)||f0.exec(n);if(!t)return null;var e,i,r=bc({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(h0[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return _c(r)},"hsl"]],object:[[function(n){var t=n.r,e=n.g,i=n.b,r=n.a,s=r===void 0?1:r;return Te(t)&&Te(e)&&Te(i)?gc({r:Number(t),g:Number(e),b:Number(i),a:Number(s)}):null},"rgb"],[function(n){var t=n.h,e=n.s,i=n.l,r=n.a,s=r===void 0?1:r;if(!Te(t)||!Te(e)||!Te(i))return null;var a=bc({h:Number(t),s:Number(e),l:Number(i),a:Number(s)});return _c(a)},"hsl"],[function(n){var t=n.h,e=n.s,i=n.v,r=n.a,s=r===void 0?1:r;if(!Te(t)||!Te(e)||!Te(i))return null;var a=(function(o){return{h:mc(o.h),s:ce(o.s,0,100),v:ce(o.v,0,100),a:ce(o.a)}})({h:Number(t),s:Number(e),v:Number(i),a:Number(s)});return yc(a)},"hsv"]]},Sc=function(n,t){for(var e=0;e<t.length;e++){var i=t[e][0](n);if(i)return[i,t[e][1]]}return[null,void 0]},p0=function(n){return typeof n=="string"?Sc(n.trim(),ws.string):typeof n=="object"&&n!==null?Sc(n,ws.object):[null,void 0]},_s=function(n,t){var e=Zn(n);return{h:e.h,s:ce(e.s+100*t,0,100),l:e.l,a:e.a}},Ss=function(n){return(299*n.r+587*n.g+114*n.b)/1e3/255},Tc=function(n,t){var e=Zn(n);return{h:e.h,s:e.s,l:ce(e.l+100*t,0,100),a:e.a}},Ts=(function(){function n(t){this.parsed=p0(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return n.prototype.isValid=function(){return this.parsed!==null},n.prototype.brightness=function(){return Ot(Ss(this.rgba),2)},n.prototype.isDark=function(){return Ss(this.rgba)<.5},n.prototype.isLight=function(){return Ss(this.rgba)>=.5},n.prototype.toHex=function(){return t=bs(this.rgba),e=t.r,i=t.g,r=t.b,a=(s=t.a)<1?Vi(Ot(255*s)):"","#"+Vi(e)+Vi(i)+Vi(r)+a;var t,e,i,r,s,a},n.prototype.toRgb=function(){return bs(this.rgba)},n.prototype.toRgbString=function(){return t=bs(this.rgba),e=t.r,i=t.g,r=t.b,(s=t.a)<1?"rgba("+e+", "+i+", "+r+", "+s+")":"rgb("+e+", "+i+", "+r+")";var t,e,i,r,s},n.prototype.toHsl=function(){return wc(Zn(this.rgba))},n.prototype.toHslString=function(){return t=wc(Zn(this.rgba)),e=t.h,i=t.s,r=t.l,(s=t.a)<1?"hsla("+e+", "+i+"%, "+r+"%, "+s+")":"hsl("+e+", "+i+"%, "+r+"%)";var t,e,i,r,s},n.prototype.toHsv=function(){return t=pc(this.rgba),{h:Ot(t.h),s:Ot(t.s),v:Ot(t.v),a:Ot(t.a,3)};var t},n.prototype.invert=function(){return u({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},n.prototype.saturate=function(t){return t===void 0&&(t=.1),u(_s(this.rgba,t))},n.prototype.desaturate=function(t){return t===void 0&&(t=.1),u(_s(this.rgba,-t))},n.prototype.grayscale=function(){return u(_s(this.rgba,-1))},n.prototype.lighten=function(t){return t===void 0&&(t=.1),u(Tc(this.rgba,t))},n.prototype.darken=function(t){return t===void 0&&(t=.1),u(Tc(this.rgba,-t))},n.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},n.prototype.alpha=function(t){return typeof t=="number"?u({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Ot(this.rgba.a,3);var e},n.prototype.hue=function(t){var e=Zn(this.rgba);return typeof t=="number"?u({h:t,s:e.s,l:e.l,a:e.a}):Ot(e.h)},n.prototype.isEqual=function(t){return this.toHex()===u(t).toHex()},n})(),u=function(n){return n instanceof Ts?n:new Ts(n)},vc=[],Ki=function(n){n.forEach(function(t){vc.indexOf(t)<0&&(t(Ts,ws),vc.push(t))})};function Ac(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function y0(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var e=function i(){var r=!1;try{r=this instanceof i}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),e}var Ji={exports:{}},b0=Ji.exports,Ec;function w0(){return Ec||(Ec=1,(function(n){(function(t,e,i){function r(c){var l=this,h=o();l.next=function(){var d=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=d|0)},l.c=1,l.s0=h(" "),l.s1=h(" "),l.s2=h(" "),l.s0-=h(c),l.s0<0&&(l.s0+=1),l.s1-=h(c),l.s1<0&&(l.s1+=1),l.s2-=h(c),l.s2<0&&(l.s2+=1),h=null}function s(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function a(c,l){var h=new r(c),d=l&&l.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&s(d,h),f.state=function(){return s(h,{})}),f}function o(){var c=4022871197,l=function(h){h=String(h);for(var d=0;d<h.length;d++){c+=h.charCodeAt(d);var f=.02519603282416938*c;c=f>>>0,f-=c,f*=c,c=f>>>0,f-=c,c+=f*4294967296}return(c>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=a:this.alea=a})(b0,n)})(Ji)),Ji.exports}var Qi={exports:{}},_0=Qi.exports,kc;function S0(){return kc||(kc=1,(function(n){(function(t,e,i){function r(o){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var d=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^d^d>>>8},o===(o|0)?c.x=o:l+=o;for(var h=0;h<l.length+64;h++)c.x^=l.charCodeAt(h)|0,c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c}function a(o,c){var l=new r(o),h=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,p=(f+g)/(1<<21);while(p===0);return p},d.int32=l.next,d.quick=d,h&&(typeof h=="object"&&s(h,l),d.state=function(){return s(l,{})}),d}e&&e.exports?e.exports=a:this.xor128=a})(_0,n)})(Qi)),Qi.exports}var tr={exports:{}},T0=tr.exports,Mc;function v0(){return Mc||(Mc=1,(function(n){(function(t,e,i){function r(o){var c=this,l="";c.next=function(){var d=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(d^d<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,o===(o|0)?c.x=o:l+=o;for(var h=0;h<l.length+64;h++)c.x^=l.charCodeAt(h)|0,h==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c.v=o.v,c.d=o.d,c}function a(o,c){var l=new r(o),h=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,p=(f+g)/(1<<21);while(p===0);return p},d.int32=l.next,d.quick=d,h&&(typeof h=="object"&&s(h,l),d.state=function(){return s(l,{})}),d}e&&e.exports?e.exports=a:this.xorwow=a})(T0,n)})(tr)),tr.exports}var er={exports:{}},A0=er.exports,Ic;function E0(){return Ic||(Ic=1,(function(n){(function(t,e,i){function r(o){var c=this;c.next=function(){var h=c.x,d=c.i,f,g;return f=h[d],f^=f>>>7,g=f^f<<24,f=h[d+1&7],g^=f^f>>>10,f=h[d+3&7],g^=f^f>>>3,f=h[d+4&7],g^=f^f<<7,f=h[d+7&7],f=f^f<<13,g^=f^f<<9,h[d]=g,c.i=d+1&7,g};function l(h,d){var f,g=[];if(d===(d|0))g[0]=d;else for(d=""+d,f=0;f<d.length;++f)g[f&7]=g[f&7]<<15^d.charCodeAt(f)+g[f+1&7]<<13;for(;g.length<8;)g.push(0);for(f=0;f<8&&g[f]===0;++f);for(f==8?g[7]=-1:g[f],h.x=g,h.i=0,f=256;f>0;--f)h.next()}l(c,o)}function s(o,c){return c.x=o.x.slice(),c.i=o.i,c}function a(o,c){o==null&&(o=+new Date);var l=new r(o),h=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,p=(f+g)/(1<<21);while(p===0);return p},d.int32=l.next,d.quick=d,h&&(h.x&&s(h,l),d.state=function(){return s(l,{})}),d}e&&e.exports?e.exports=a:this.xorshift7=a})(A0,n)})(er)),er.exports}var nr={exports:{}},k0=nr.exports,xc;function M0(){return xc||(xc=1,(function(n){(function(t,e,i){function r(o){var c=this;c.next=function(){var h=c.w,d=c.X,f=c.i,g,p;return c.w=h=h+1640531527|0,p=d[f+34&127],g=d[f=f+1&127],p^=p<<13,g^=g<<17,p^=p>>>15,g^=g>>>12,p=d[f]=p^g,c.i=f,p+(h^h>>>16)|0};function l(h,d){var f,g,p,b,S,w=[],v=128;for(d===(d|0)?(g=d,d=null):(d=d+"\0",g=0,v=Math.max(v,d.length)),p=0,b=-32;b<v;++b)d&&(g^=d.charCodeAt((b+32)%d.length)),b===0&&(S=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,b>=0&&(S=S+1640531527|0,f=w[b&127]^=g+S,p=f==0?p+1:0);for(p>=128&&(w[(d&&d.length||0)&127]=-1),p=127,b=512;b>0;--b)g=w[p+34&127],f=w[p=p+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,w[p]=g^f;h.w=S,h.X=w,h.i=p}l(c,o)}function s(o,c){return c.i=o.i,c.w=o.w,c.X=o.X.slice(),c}function a(o,c){o==null&&(o=+new Date);var l=new r(o),h=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,p=(f+g)/(1<<21);while(p===0);return p},d.int32=l.next,d.quick=d,h&&(h.X&&s(h,l),d.state=function(){return s(l,{})}),d}e&&e.exports?e.exports=a:this.xor4096=a})(k0,n)})(nr)),nr.exports}var ir={exports:{}},I0=ir.exports,Cc;function x0(){return Cc||(Cc=1,(function(n){(function(t,e,i){function r(o){var c=this,l="";c.next=function(){var d=c.b,f=c.c,g=c.d,p=c.a;return d=d<<25^d>>>7^f,f=f-g|0,g=g<<24^g>>>8^p,p=p-d|0,c.b=d=d<<20^d>>>12^f,c.c=f=f-g|0,c.d=g<<16^f>>>16^p,c.a=p-d|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,o===Math.floor(o)?(c.a=o/4294967296|0,c.b=o|0):l+=o;for(var h=0;h<l.length+20;h++)c.b^=l.charCodeAt(h)|0,c.next()}function s(o,c){return c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c}function a(o,c){var l=new r(o),h=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,p=(f+g)/(1<<21);while(p===0);return p},d.int32=l.next,d.quick=d,h&&(typeof h=="object"&&s(h,l),d.state=function(){return s(l,{})}),d}e&&e.exports?e.exports=a:this.tychei=a})(I0,n)})(ir)),ir.exports}var rr={exports:{}},C0={},P0=Object.freeze({__proto__:null,default:C0}),D0=y0(P0),N0=rr.exports,Pc;function R0(){return Pc||(Pc=1,(function(n){(function(t,e,i){var r=256,s=6,a=52,o="random",c=i.pow(r,s),l=i.pow(2,a),h=l*2,d=r-1,f;function g(E,C,x){var O=[];C=C==!0?{entropy:!0}:C||{};var N=w(S(C.entropy?[E,A(e)]:E??v(),3),O),I=new p(O),q=function(){for(var U=I.g(s),K=c,D=0;U<l;)U=(U+D)*r,K*=r,D=I.g(1);for(;U>=h;)U/=2,K/=2,D>>>=1;return(U+D)/K};return q.int32=function(){return I.g(4)|0},q.quick=function(){return I.g(4)/4294967296},q.double=q,w(A(I.S),e),(C.pass||x||function(U,K,D,X){return X&&(X.S&&b(X,I),U.state=function(){return b(I,{})}),D?(i[o]=U,K):U})(q,N,"global"in C?C.global:this==i,C.state)}function p(E){var C,x=E.length,O=this,N=0,I=O.i=O.j=0,q=O.S=[];for(x||(E=[x++]);N<r;)q[N]=N++;for(N=0;N<r;N++)q[N]=q[I=d&I+E[N%x]+(C=q[N])],q[I]=C;(O.g=function(U){for(var K,D=0,X=O.i,ct=O.j,et=O.S;U--;)K=et[X=d&X+1],D=D*r+et[d&(et[X]=et[ct=d&ct+K])+(et[ct]=K)];return O.i=X,O.j=ct,D})(r)}function b(E,C){return C.i=E.i,C.j=E.j,C.S=E.S.slice(),C}function S(E,C){var x=[],O=typeof E,N;if(C&&O=="object")for(N in E)try{x.push(S(E[N],C-1))}catch{}return x.length?x:O=="string"?E:E+"\0"}function w(E,C){for(var x=E+"",O,N=0;N<x.length;)C[d&N]=d&(O^=C[d&N]*19)+x.charCodeAt(N++);return A(C)}function v(){try{var E;return f&&(E=f.randomBytes)?E=E(r):(E=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(E)),A(E)}catch{var C=t.navigator,x=C&&C.plugins;return[+new Date,t,x,t.screen,A(e)]}}function A(E){return String.fromCharCode.apply(0,E)}if(w(i.random(),e),n.exports){n.exports=g;try{f=D0}catch{}}else i["seed"+o]=g})(typeof self<"u"?self:N0,[],Math)})(rr)),rr.exports}var vs,Dc;function O0(){if(Dc)return vs;Dc=1;var n=w0(),t=S0(),e=v0(),i=E0(),r=M0(),s=x0(),a=R0();return a.alea=n,a.xor128=t,a.xorwow=e,a.xorshift7=i,a.xor4096=r,a.tychei=s,vs=a,vs}var B0=O0(),L0=Ac(B0);const zr=class zr{constructor(t){this.rng=L0(String(t))}next(){return this.rng()}nextInt(t,e){return Math.floor(this.rng()*(e-t))+t}nextFloat(t,e){return this.rng()*(e-t)+t}nextID(){return Math.floor(this.rng()*zr.POW36_8).toString(36).padStart(8,"0")}randElement(t){if(t.length===0)throw new Error("array must not be empty");return t[this.nextInt(0,t.length)]}randFromSet(t){const e=t.size;if(e===0)throw new Error("set must not be empty");const i=this.nextInt(0,e);let r=0;for(const s of t){if(r===i)return s;r++}throw new Error("Unexpected error selecting element from set")}chance(t){return this.nextInt(0,t)===0}shuffleArray(t){const e=[...t];for(let i=e.length-1;i>0;i--){const r=this.nextInt(0,i+1);[e[i],e[r]]=[e[r],e[i]]}return e}};zr.POW36_8=Math.pow(36,8);let gt=zr;var As=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},Yn=function(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*n)/e+0},de=function(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),n>e?e:n>t?n:t},Es=function(n){var t=n/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},ks=function(n){return 255*(n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n)},Ms=96.422,Is=100,xs=82.521,z0=function(n){var t,e,i={x:.9555766*(t=n).x+-.0230393*t.y+.0631636*t.z,y:-.0282895*t.x+1.0099416*t.y+.0210077*t.z,z:.0122982*t.x+-.020483*t.y+1.3299098*t.z};return e={r:ks(.032404542*i.x-.015371385*i.y-.004985314*i.z),g:ks(-.00969266*i.x+.018760108*i.y+41556e-8*i.z),b:ks(556434e-9*i.x-.002040259*i.y+.010572252*i.z),a:n.a},{r:de(e.r,0,255),g:de(e.g,0,255),b:de(e.b,0,255),a:de(e.a)}},U0=function(n){var t=Es(n.r),e=Es(n.g),i=Es(n.b);return(function(r){return{x:de(r.x,0,Ms),y:de(r.y,0,Is),z:de(r.z,0,xs),a:de(r.a)}})((function(r){return{x:1.0478112*r.x+.0228866*r.y+-.050127*r.z,y:.0295424*r.x+.9904844*r.y+-.0170491*r.z,z:-.0092345*r.x+.0150436*r.y+.7521316*r.z,a:r.a}})({x:100*(.4124564*t+.3575761*e+.1804375*i),y:100*(.2126729*t+.7151522*e+.072175*i),z:100*(.0193339*t+.119192*e+.9503041*i),a:n.a}))},Xn=216/24389,un=24389/27,W0=function(n){var t=n.l,e=n.a,i=n.b,r=n.alpha,s=r===void 0?1:r;if(!As(t)||!As(e)||!As(i))return null;var a=(function(o){return{l:de(o.l,0,400),a:o.a,b:o.b,alpha:de(o.alpha)}})({l:Number(t),a:Number(e),b:Number(i),alpha:Number(s)});return $0(a)},$0=function(n){var t=(n.l+16)/116,e=n.a/500+t,i=t-n.b/200;return z0({x:(Math.pow(e,3)>Xn?Math.pow(e,3):(116*e-16)/un)*Ms,y:(n.l>8?Math.pow((n.l+16)/116,3):n.l/un)*Is,z:(Math.pow(i,3)>Xn?Math.pow(i,3):(116*i-16)/un)*xs,a:n.alpha})};function Nc(n,t){n.prototype.toLab=function(){return i=U0(this.rgba),s=i.y/Is,a=i.z/xs,r=(r=i.x/Ms)>Xn?Math.cbrt(r):(un*r+16)/116,e={l:116*(s=s>Xn?Math.cbrt(s):(un*s+16)/116)-16,a:500*(r-s),b:200*(s-(a=a>Xn?Math.cbrt(a):(un*a+16)/116)),alpha:i.a},{l:Yn(e.l,2),a:Yn(e.a,2),b:Yn(e.b,2),alpha:Yn(e.alpha,3)};var e,i,r,s,a},n.prototype.delta=function(e){e===void 0&&(e="#FFF");var i=e instanceof n?e:new n(e),r=(function(s,a){var o=s.l,c=s.a,l=s.b,h=a.l,d=a.a,f=a.b,g=180/Math.PI,p=Math.PI/180,b=Math.pow(Math.pow(c,2)+Math.pow(l,2),.5),S=Math.pow(Math.pow(d,2)+Math.pow(f,2),.5),w=(o+h)/2,v=Math.pow((b+S)/2,7),A=.5*(1-Math.pow(v/(v+Math.pow(25,7)),.5)),E=c*(1+A),C=d*(1+A),x=Math.pow(Math.pow(E,2)+Math.pow(l,2),.5),O=Math.pow(Math.pow(C,2)+Math.pow(f,2),.5),N=(x+O)/2,I=E===0&&l===0?0:Math.atan2(l,E)*g,q=C===0&&f===0?0:Math.atan2(f,C)*g;I<0&&(I+=360),q<0&&(q+=360);var U=q-I,K=Math.abs(q-I);K>180&&q<=I?U+=360:K>180&&q>I&&(U-=360);var D=I+q;K<=180?D/=2:D=(I+q<360?D+360:D-360)/2;var X=1-.17*Math.cos(p*(D-30))+.24*Math.cos(2*p*D)+.32*Math.cos(p*(3*D+6))-.2*Math.cos(p*(4*D-63)),ct=h-o,et=O-x,st=2*Math.sin(p*U/2)*Math.pow(x*O,.5),Mt=1+.015*Math.pow(w-50,2)/Math.pow(20+Math.pow(w-50,2),.5),Y=1+.045*N,Q=1+.015*N*X,V=30*Math.exp(-1*Math.pow((D-275)/25,2)),Et=-2*Math.pow(v/(v+Math.pow(25,7)),.5)*Math.sin(2*p*V);return Math.pow(Math.pow(ct/1/Mt,2)+Math.pow(et/1/Y,2)+Math.pow(st/1/Q,2)+Et*et*st/(1*Y*1*Q),.5)})(this.toLab(),i.toLab())/100;return de(Yn(r,3))},t.object.push([W0,"lab"])}var F0={grad:.9,turn:360,rad:360/(2*Math.PI)},Cs=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},dn=function(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*n)/e+0},ve=function(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),n>e?e:n>t?n:t},Ps=function(n){var t=n/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},Ds=function(n){return 255*(n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n)},Ns=96.422,Rs=100,Os=82.521,q0=function(n){var t,e,i={x:.9555766*(t=n).x+-.0230393*t.y+.0631636*t.z,y:-.0282895*t.x+1.0099416*t.y+.0210077*t.z,z:.0122982*t.x+-.020483*t.y+1.3299098*t.z};return e={r:Ds(.032404542*i.x-.015371385*i.y-.004985314*i.z),g:Ds(-.00969266*i.x+.018760108*i.y+41556e-8*i.z),b:Ds(556434e-9*i.x-.002040259*i.y+.010572252*i.z),a:n.a},{r:ve(e.r,0,255),g:ve(e.g,0,255),b:ve(e.b,0,255),a:ve(e.a)}},j0=function(n){var t=Ps(n.r),e=Ps(n.g),i=Ps(n.b);return(function(r){return{x:ve(r.x,0,Ns),y:ve(r.y,0,Rs),z:ve(r.z,0,Os),a:ve(r.a)}})((function(r){return{x:1.0478112*r.x+.0228866*r.y+-.050127*r.z,y:.0295424*r.x+.9904844*r.y+-.0170491*r.z,z:-.0092345*r.x+.0150436*r.y+.7521316*r.z,a:r.a}})({x:100*(.4124564*t+.3575761*e+.1804375*i),y:100*(.2126729*t+.7151522*e+.072175*i),z:100*(.0193339*t+.119192*e+.9503041*i),a:n.a}))},Vn=216/24389,fn=24389/27,Rc=function(n){return{l:ve(n.l,0,100),c:n.c,h:(t=n.h,(t=isFinite(t)?t%360:0)>0?t:t+360),a:n.a};var t},Oc=function(n){return{l:dn(n.l,2),c:dn(n.c,2),h:dn(n.h,2),a:dn(n.a,3)}},H0=function(n){var t=n.l,e=n.c,i=n.h,r=n.a,s=r===void 0?1:r;if(!Cs(t)||!Cs(e)||!Cs(i))return null;var a=Rc({l:Number(t),c:Number(e),h:Number(i),a:Number(s)});return Lc(a)},Bc=function(n){var t=(function(s){var a=j0(s),o=a.x/Ns,c=a.y/Rs,l=a.z/Os;return o=o>Vn?Math.cbrt(o):(fn*o+16)/116,{l:116*(c=c>Vn?Math.cbrt(c):(fn*c+16)/116)-16,a:500*(o-c),b:200*(c-(l=l>Vn?Math.cbrt(l):(fn*l+16)/116)),alpha:a.a}})(n),e=dn(t.a,3),i=dn(t.b,3),r=Math.atan2(i,e)/Math.PI*180;return{l:t.l,c:Math.sqrt(e*e+i*i),h:r<0?r+360:r,a:t.alpha}},Lc=function(n){return t={l:n.l,a:n.c*Math.cos(n.h*Math.PI/180),b:n.c*Math.sin(n.h*Math.PI/180),alpha:n.a},i=t.a/500+(e=(t.l+16)/116),r=e-t.b/200,q0({x:(Math.pow(i,3)>Vn?Math.pow(i,3):(116*i-16)/fn)*Ns,y:(t.l>8?Math.pow((t.l+16)/116,3):t.l/fn)*Rs,z:(Math.pow(r,3)>Vn?Math.pow(r,3):(116*r-16)/fn)*Os,a:t.alpha});var t,e,i,r},G0=/^lch\(\s*([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)\s+([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Z0=function(n){var t=G0.exec(n);if(!t)return null;var e,i,r=Rc({l:Number(t[1]),c:Number(t[2]),h:(e=t[3],i=t[4],i===void 0&&(i="deg"),Number(e)*(F0[i]||1)),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Lc(r)};function zc(n,t){n.prototype.toLch=function(){return Oc(Bc(this.rgba))},n.prototype.toLchString=function(){return e=Oc(Bc(this.rgba)),i=e.l,r=e.c,s=e.h,(a=e.a)<1?"lch("+i+"% "+r+" "+s+" / "+a+")":"lch("+i+"% "+r+" "+s+")";var e,i,r,s,a},t.string.push([Z0,"lch"]),t.object.push([H0,"lch"])}function yt(n,t){let e=n.length;Array.isArray(n[0])||(n=[n]),Array.isArray(t[0])||(t=t.map(a=>[a]));let i=t[0].length,r=t[0].map((a,o)=>t.map(c=>c[o])),s=n.map(a=>r.map(o=>{let c=0;if(!Array.isArray(a)){for(let l of o)c+=a*l;return c}for(let l=0;l<a.length;l++)c+=a[l]*(o[l]||0);return c}));return e===1&&(s=s[0]),i===1?s.map(a=>a[0]):s}function Kn(n){return Ue(n)==="string"}function Ue(n){return(Object.prototype.toString.call(n).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function sr(n,{precision:t,unit:e}){return We(n)?"none":Uc(n,t)+(e??"")}function We(n){return Number.isNaN(n)||n instanceof Number&&n?.none}function kt(n){return We(n)?0:n}function Uc(n,t){if(n===0)return 0;let e=~~n,i=0;e&&t&&(i=~~Math.log10(Math.abs(e))+1);const r=10**(t-i);return Math.floor(n*r+.5)/r}const Y0={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Wc(n){if(!n)return;n=n.trim();const t=/^([a-z]+)\((.+?)\)$/i,e=/^-?[\d.]+$/,i=/%|deg|g?rad|turn$/,r=/\/?\s*(none|[-\w.]+(?:%|deg|g?rad|turn)?)/g;let s=n.match(t);if(s){let a=[];return s[2].replace(r,(o,c)=>{let l=c.match(i),h=c;if(l){let d=l[0],f=h.slice(0,-d.length);d==="%"?(h=new Number(f/100),h.type="<percentage>"):(h=new Number(f*Y0[d]),h.type="<angle>",h.unit=d)}else e.test(h)?(h=new Number(h),h.type="<number>"):h==="none"&&(h=new Number(NaN),h.none=!0);o.startsWith("/")&&(h=h instanceof Number?h:new Number(h),h.alpha=!0),typeof h=="object"&&h instanceof Number&&(h.raw=c),a.push(h)}),{name:s[1].toLowerCase(),rawName:s[1],rawArgs:s[2],args:a}}}function $c(n){return n[n.length-1]}function Jn(n,t,e){return isNaN(n)?t:isNaN(t)?n:n+(t-n)*e}function Fc(n,t,e){return(e-n)/(t-n)}function Bs(n,t,e){return Jn(t[0],t[1],Fc(n[0],n[1],e))}function qc(n){return n.map(t=>t.split("|").map(e=>{e=e.trim();let i=e.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(i){let r=new String(i[1]);return r.range=[+i[2],+i[3]],r}return e}))}function jc(n,t,e){return Math.max(Math.min(e,t),n)}function ar(n,t){return Math.sign(n)===Math.sign(t)?n:-n}function ge(n,t){return ar(Math.abs(n)**t,n)}function Ls(n,t){return t===0?0:n/t}function Hc(n,t,e=0,i=n.length){for(;e<i;){const r=e+i>>1;n[r]<t?e=r+1:i=r}return e}var X0=Object.freeze({__proto__:null,bisectLeft:Hc,clamp:jc,copySign:ar,interpolate:Jn,interpolateInv:Fc,isNone:We,isString:Kn,last:$c,mapRange:Bs,multiplyMatrices:yt,parseCoordGrammar:qc,parseFunction:Wc,serializeNumber:sr,skipNone:kt,spow:ge,toPrecision:Uc,type:Ue,zdiv:Ls});class V0{add(t,e,i){if(typeof arguments[0]!="string"){for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1]);return}(Array.isArray(t)?t:[t]).forEach(function(r){this[r]=this[r]||[],e&&this[r][i?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(i){i.call(e&&e.context?e.context:e,e)})}}const $e=new V0;var ie={gamut_mapping:"css",precision:5,deltaE:"76",verbose:"production".toLowerCase()!=="test",warn:function(t){this.verbose&&globalThis?.console?.warn?.(t)}};const Vt={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function zs(n){return Array.isArray(n)?n:Vt[n]}function or(n,t,e,i={}){if(n=zs(n),t=zs(t),!n||!t)throw new TypeError(`Missing white point to convert ${n?"":"from"}${!n&&!t?"/":""}${t?"":"to"}`);if(n===t)return e;let r={W1:n,W2:t,XYZ:e,options:i};if($e.run("chromatic-adaptation-start",r),r.M||(r.W1===Vt.D65&&r.W2===Vt.D50?r.M=[[1.0479297925449969,.022946870601609652,-.05019226628920524],[.02962780877005599,.9904344267538799,-.017073799063418826],[-.009243040646204504,.015055191490298152,.7518742814281371]]:r.W1===Vt.D50&&r.W2===Vt.D65&&(r.M=[[.955473421488075,-.02309845494876471,.06325924320057072],[-.0283697093338637,1.0099953980813041,.021041441191917323],[.012314014864481998,-.020507649298898964,1.330365926242124]])),$e.run("chromatic-adaptation-end",r),r.M)return yt(r.M,r.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}const K0=new Set(["<number>","<percentage>","<angle>"]);function Gc(n,t,e,i){return Object.entries(n.coords).map(([s,a],o)=>{let c=t.coordGrammar[o],l=i[o],h=l?.type,d;if(l.none?d=c.find(p=>K0.has(p)):d=c.find(p=>p==h),!d){let p=a.name||s;throw new TypeError(`${h??l.raw} not allowed for ${p} in ${e}()`)}let f=d.range;h==="<percentage>"&&(f||=[0,1]);let g=a.range||a.refRange;return f&&g&&(i[o]=Bs(f,g,i[o])),d})}function Zc(n,{meta:t}={}){let e={str:String(n)?.trim()};if($e.run("parse-start",e),e.color)return e.color;if(e.parsed=Wc(e.str),e.parsed){let i=e.parsed.name;if(i==="color"){let r=e.parsed.args.shift(),s=r.startsWith("--")?r.substring(2):`--${r}`,a=[r,s],o=e.parsed.rawArgs.indexOf("/")>0?e.parsed.args.pop():1;for(let h of R.all){let d=h.getFormat("color");if(d&&(a.includes(d.id)||d.ids?.filter(f=>a.includes(f)).length)){const f=Object.keys(h.coords).map((p,b)=>e.parsed.args[b]||0);let g;return d.coordGrammar&&(g=Gc(h,d,"color",f)),t&&Object.assign(t,{formatId:"color",types:g}),d.id.startsWith("--")&&!r.startsWith("--")&&ie.warn(`${h.name} is a non-standard space and not currently supported in the CSS spec. Use prefixed color(${d.id}) instead of color(${r}).`),r.startsWith("--")&&!d.id.startsWith("--")&&ie.warn(`${h.name} is a standard space and supported in the CSS spec. Use color(${d.id}) instead of prefixed color(${r}).`),{spaceId:h.id,coords:f,alpha:o}}}let c="",l=r in R.registry?r:s;if(l in R.registry){let h=R.registry[l].formats?.color?.id;h&&(c=`Did you mean color(${h})?`)}throw new TypeError(`Cannot parse color(${r}). `+(c||"Missing a plugin?"))}else for(let r of R.all){let s=r.getFormat(i);if(s&&s.type==="function"){let a=1;(s.lastAlpha||$c(e.parsed.args).alpha)&&(a=e.parsed.args.pop());let o=e.parsed.args,c;return s.coordGrammar&&(c=Gc(r,s,i,o)),t&&Object.assign(t,{formatId:s.name,types:c}),{spaceId:r.id,coords:o,alpha:a}}}}else for(let i of R.all)for(let r in i.formats){let s=i.formats[r];if(s.type!=="custom"||s.test&&!s.test(e.str))continue;let a=s.parse(e.str);if(a)return a.alpha??=1,t&&(t.formatId=r),a}throw new TypeError(`Could not parse ${n} as a color. Missing a plugin?`)}function Z(n){if(Array.isArray(n))return n.map(Z);if(!n)throw new TypeError("Empty color reference");Kn(n)&&(n=Zc(n));let t=n.space||n.spaceId;return t instanceof R||(n.space=R.get(t)),n.alpha===void 0&&(n.alpha=1),n}const J0=75e-6;class R{constructor(t){this.id=t.id,this.name=t.name,this.base=t.base?R.get(t.base):null,this.aliases=t.aliases,this.base&&(this.fromBase=t.fromBase,this.toBase=t.toBase);let e=t.coords??this.base.coords;for(let r in e)"name"in e[r]||(e[r].name=r);this.coords=e;let i=t.white??this.base.white??"D65";this.white=zs(i),this.formats=t.formats??{};for(let r in this.formats){let s=this.formats[r];s.type||="function",s.name||=r}this.formats.color?.id||(this.formats.color={...this.formats.color??{},id:t.cssId||this.id}),t.gamutSpace?this.gamutSpace=t.gamutSpace==="self"?this:R.get(t.gamutSpace):this.isPolar?this.gamutSpace=this.base:this.gamutSpace=this,this.gamutSpace.isUnbounded&&(this.inGamut=(r,s)=>!0),this.referred=t.referred,Object.defineProperty(this,"path",{value:Q0(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),$e.run("colorspace-init-end",this)}inGamut(t,{epsilon:e=J0}={}){if(!this.equals(this.gamutSpace))return t=this.to(this.gamutSpace,t),this.gamutSpace.inGamut(t,{epsilon:e});let i=Object.values(this.coords);return t.every((r,s)=>{let a=i[s];if(a.type!=="angle"&&a.range){if(Number.isNaN(r))return!0;let[o,c]=a.range;return(o===void 0||r>=o-e)&&(c===void 0||r<=c+e)}return!0})}get isUnbounded(){return Object.values(this.coords).every(t=>!("range"in t))}get cssId(){return this.formats?.color?.id||this.id}get isPolar(){for(let t in this.coords)if(this.coords[t].type==="angle")return!0;return!1}getFormat(t){if(typeof t=="object")return t=Yc(t,this),t;let e;return t==="default"?e=Object.values(this.formats)[0]:e=this.formats[t],e?(e=Yc(e,this),e):null}equals(t){return t?this===t||this.id===t||this.id===t.id:!1}to(t,e){if(arguments.length===1){const o=Z(t);[t,e]=[o.space,o.coords]}if(t=R.get(t),this.equals(t))return e;e=e.map(o=>Number.isNaN(o)?0:o);let i=this.path,r=t.path,s,a;for(let o=0;o<i.length&&i[o].equals(r[o]);o++)s=i[o],a=o;if(!s)throw new Error(`Cannot convert between color spaces ${this} and ${t}: no connection space was found`);for(let o=i.length-1;o>a;o--)e=i[o].toBase(e);for(let o=a+1;o<r.length;o++)e=r[o].fromBase(e);return e}from(t,e){if(arguments.length===1){const i=Z(t);[t,e]=[i.space,i.coords]}return t=R.get(t),t.to(this,e)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let t=[];for(let e in this.coords){let i=this.coords[e],r=i.range||i.refRange;t.push(r?.min??0)}return t}static registry={};static get all(){return[...new Set(Object.values(R.registry))]}static register(t,e){if(arguments.length===1&&(e=arguments[0],t=e.id),e=this.get(e),this.registry[t]&&this.registry[t]!==e)throw new Error(`Duplicate color space registration: '${t}'`);if(this.registry[t]=e,arguments.length===1&&e.aliases)for(let i of e.aliases)this.register(i,e);return e}static get(t,...e){if(!t||t instanceof R)return t;if(Ue(t)==="string"){let r=R.registry[t.toLowerCase()];if(!r)throw new TypeError(`No color space found with id = "${t}"`);return r}if(e.length)return R.get(...e);throw new TypeError(`${t} is not a valid color space`)}static resolveCoord(t,e){let i=Ue(t),r,s;if(i==="string"?t.includes(".")?[r,s]=t.split("."):[r,s]=[,t]:Array.isArray(t)?[r,s]=t:(r=t.space,s=t.coordId),r=R.get(r),r||(r=e),!r)throw new TypeError(`Cannot resolve coordinate reference ${t}: No color space specified and relative references are not allowed here`);if(i=Ue(s),i==="number"||i==="string"&&s>=0){let c=Object.entries(r.coords)[s];if(c)return{space:r,id:c[0],index:s,...c[1]}}r=R.get(r);let a=s.toLowerCase(),o=0;for(let c in r.coords){let l=r.coords[c];if(c.toLowerCase()===a||l.name?.toLowerCase()===a)return{space:r,id:c,index:o,...l};o++}throw new TypeError(`No "${s}" coordinate found in ${r.name}. Its coordinates are: ${Object.keys(r.coords).join(", ")}`)}static DEFAULT_FORMAT={type:"functions",name:"color"}}function Q0(n){let t=[n];for(let e=n;e=e.base;)t.push(e);return t}function Yc(n,{coords:t}={}){if(n.coords&&!n.coordGrammar){n.type||="function",n.name||="color",n.coordGrammar=qc(n.coords);let e=Object.entries(t).map(([i,r],s)=>{let a=n.coordGrammar[s][0],o=r.range||r.refRange,c=a.range,l="";return a=="<percentage>"?(c=[0,100],l="%"):a=="<angle>"&&(l="deg"),{fromRange:o,toRange:c,suffix:l}});n.serializeCoords=(i,r)=>i.map((s,a)=>{let{fromRange:o,toRange:c,suffix:l}=e[a];return o&&c&&(s=Bs(o,c,s)),s=sr(s,{precision:r,unit:l}),s})}return n}var Wt=new R({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class Qt extends R{constructor(t){t.coords||(t.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),t.base||(t.base=Wt),t.toXYZ_M&&t.fromXYZ_M&&(t.toBase??=e=>{let i=yt(t.toXYZ_M,e);return this.white!==this.base.white&&(i=or(this.white,this.base.white,i)),i},t.fromBase??=e=>(e=or(this.base.white,this.white,e),yt(t.fromXYZ_M,e))),t.referred??="display",super(t)}}function Qn(n,t){return n=Z(n),!t||n.space.equals(t)?n.coords.slice():(t=R.get(t),t.from(n))}function re(n,t){n=Z(n);let{space:e,index:i}=R.resolveCoord(t,n.space);return Qn(n,e)[i]}function Us(n,t,e){return n=Z(n),t=R.get(t),n.coords=t.to(n.space,e),n}Us.returns="color";function Ae(n,t,e){if(n=Z(n),arguments.length===2&&Ue(arguments[1])==="object"){let i=arguments[1];for(let r in i)Ae(n,r,i[r])}else{typeof e=="function"&&(e=e(re(n,t)));let{space:i,index:r}=R.resolveCoord(t,n.space),s=Qn(n,i);s[r]=e,Us(n,i,s)}return n}Ae.returns="color";var Ws=new R({id:"xyz-d50",name:"XYZ D50",white:"D50",base:Wt,fromBase:n=>or(Wt.white,"D50",n),toBase:n=>or("D50",Wt.white,n)});const t1=216/24389,Xc=24/116,cr=24389/27;let $s=Vt.D50;var se=new R({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:$s,base:Ws,fromBase(n){let e=n.map((i,r)=>i/$s[r]).map(i=>i>t1?Math.cbrt(i):(cr*i+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(n){let t=[];return t[1]=(n[0]+16)/116,t[0]=n[1]/500+t[1],t[2]=t[1]-n[2]/200,[t[0]>Xc?Math.pow(t[0],3):(116*t[0]-16)/cr,n[0]>8?Math.pow((n[0]+16)/116,3):n[0]/cr,t[2]>Xc?Math.pow(t[2],3):(116*t[2]-16)/cr].map((i,r)=>i*$s[r])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function pe(n){return(n%360+360)%360}function e1(n,t){if(n==="raw")return t;let[e,i]=t.map(pe),r=i-e;return n==="increasing"?r<0&&(i+=360):n==="decreasing"?r>0&&(e+=360):n==="longer"?-180<r&&r<180&&(r>0?e+=360:i+=360):n==="shorter"&&(r>180?e+=360:r<-180&&(i+=360)),[e,i]}var ti=new R({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:se,fromBase(n){let[t,e,i]=n,r;const s=.02;return Math.abs(e)<s&&Math.abs(i)<s?r=NaN:r=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),pe(r)]},toBase(n){let[t,e,i]=n;return e<0&&(e=0),isNaN(i)&&(i=0),[t,e*Math.cos(i*Math.PI/180),e*Math.sin(i*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const Vc=25**7,lr=Math.PI,Kc=180/lr,mn=lr/180;function Jc(n){const t=n*n;return t*t*t*n}function Qc(n,t,{kL:e=1,kC:i=1,kH:r=1}={}){[n,t]=Z([n,t]);let[s,a,o]=se.from(n),c=ti.from(se,[s,a,o])[1],[l,h,d]=se.from(t),f=ti.from(se,[l,h,d])[1];c<0&&(c=0),f<0&&(f=0);let g=(c+f)/2,p=Jc(g),b=.5*(1-Math.sqrt(p/(p+Vc))),S=(1+b)*a,w=(1+b)*h,v=Math.sqrt(S**2+o**2),A=Math.sqrt(w**2+d**2),E=S===0&&o===0?0:Math.atan2(o,S),C=w===0&&d===0?0:Math.atan2(d,w);E<0&&(E+=2*lr),C<0&&(C+=2*lr),E*=Kc,C*=Kc;let x=l-s,O=A-v,N=C-E,I=E+C,q=Math.abs(N),U;v*A===0?U=0:q<=180?U=N:N>180?U=N-360:N<-180?U=N+360:ie.warn("the unthinkable has happened");let K=2*Math.sqrt(A*v)*Math.sin(U*mn/2),D=(s+l)/2,X=(v+A)/2,ct=Jc(X),et;v*A===0?et=I:q<=180?et=I/2:I<360?et=(I+360)/2:et=(I-360)/2;let st=(D-50)**2,Mt=1+.015*st/Math.sqrt(20+st),Y=1+.045*X,Q=1;Q-=.17*Math.cos((et-30)*mn),Q+=.24*Math.cos(2*et*mn),Q+=.32*Math.cos((3*et+6)*mn),Q-=.2*Math.cos((4*et-63)*mn);let V=1+.015*X*Q,Et=30*Math.exp(-1*((et-275)/25)**2),nt=2*Math.sqrt(ct/(ct+Vc)),jt=-1*Math.sin(2*Et*mn)*nt,W=(x/(e*Mt))**2;return W+=(O/(i*Y))**2,W+=(K/(r*V))**2,W+=jt*(O/(i*Y))*(K/(r*V)),Math.sqrt(W)}const n1=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],i1=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],r1=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],s1=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]];var gn=new R({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"Lightness"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:Wt,fromBase(n){let e=yt(n1,n).map(i=>Math.cbrt(i));return yt(r1,e)},toBase(n){let e=yt(s1,n).map(i=>i**3);return yt(i1,e)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function Fs(n,t){[n,t]=Z([n,t]);let[e,i,r]=gn.from(n),[s,a,o]=gn.from(t),c=e-s,l=i-a,h=r-o;return Math.sqrt(c**2+l**2+h**2)}const a1=75e-6;function Ve(n,t,{epsilon:e=a1}={}){n=Z(n),t||(t=n.space),t=R.get(t);let i=n.coords;return t!==n.space&&(i=t.from(n)),t.inGamut(i,{epsilon:e})}function pn(n){return{space:n.space,coords:n.coords.slice(),alpha:n.alpha}}function tl(n,t,e="lab"){e=R.get(e);let i=e.from(n),r=e.from(t);return Math.sqrt(i.reduce((s,a,o)=>{let c=r[o];return isNaN(a)||isNaN(c)?s:s+(c-a)**2},0))}function o1(n,t){return tl(n,t,"lab")}const el=Math.PI/180;function c1(n,t,{l:e=2,c:i=1}={}){[n,t]=Z([n,t]);let[r,s,a]=se.from(n),[,o,c]=ti.from(se,[r,s,a]),[l,h,d]=se.from(t),f=ti.from(se,[l,h,d])[1];o<0&&(o=0),f<0&&(f=0);let g=r-l,p=o-f,b=s-h,S=a-d,w=b**2+S**2-p**2,v=.511;r>=16&&(v=.040975*r/(1+.01765*r));let A=.0638*o/(1+.0131*o)+.638,E;Number.isNaN(c)&&(c=0),c>=164&&c<=345?E=.56+Math.abs(.2*Math.cos((c+168)*el)):E=.36+Math.abs(.4*Math.cos((c+35)*el));let C=Math.pow(o,4),x=Math.sqrt(C/(C+1900)),O=A*(x*E+1-x),N=(g/(e*v))**2;return N+=(p/(i*A))**2,N+=w/O**2,Math.sqrt(N)}const nl=203;var qs=new R({id:"xyz-abs-d65",cssId:"--xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:Wt,fromBase(n){return n.map(t=>Math.max(t*nl,0))},toBase(n){return n.map(t=>Math.max(t/nl,0))}});const hr=1.15,ur=.66,il=2610/2**14,l1=2**14/2610,rl=3424/2**12,sl=2413/2**7,al=2392/2**7,h1=1.7*2523/2**5,ol=2**5/(1.7*2523),dr=-.56,js=16295499532821565e-27,u1=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],d1=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],f1=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],m1=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var cl=new R({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:qs,fromBase(n){let[t,e,i]=n,r=hr*t-(hr-1)*i,s=ur*e-(ur-1)*t,o=yt(u1,[r,s,i]).map(function(f){let g=rl+sl*(f/1e4)**il,p=1+al*(f/1e4)**il;return(g/p)**h1}),[c,l,h]=yt(f1,o);return[(1+dr)*c/(1+dr*c)-js,l,h]},toBase(n){let[t,e,i]=n,r=(t+js)/(1+dr-dr*(t+js)),a=yt(m1,[r,e,i]).map(function(f){let g=rl-f**ol,p=al*f**ol-sl;return 1e4*(g/p)**l1}),[o,c,l]=yt(d1,a),h=(o+(hr-1)*l)/hr,d=(c+(ur-1)*h)/ur;return[h,d,l]},formats:{color:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),Hs=new R({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:cl,fromBase(n){let[t,e,i]=n,r;const s=2e-4;return Math.abs(e)<s&&Math.abs(i)<s?r=NaN:r=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),pe(r)]},toBase(n){return[n[0],n[1]*Math.cos(n[2]*Math.PI/180),n[1]*Math.sin(n[2]*Math.PI/180)]}});function g1(n,t){[n,t]=Z([n,t]);let[e,i,r]=Hs.from(n),[s,a,o]=Hs.from(t),c=e-s,l=i-a;Number.isNaN(r)&&Number.isNaN(o)?(r=0,o=0):Number.isNaN(r)?r=o:Number.isNaN(o)&&(o=r);let h=r-o,d=2*Math.sqrt(i*a)*Math.sin(h/2*(Math.PI/180));return Math.sqrt(c**2+l**2+d**2)}const ll=3424/4096,hl=2413/128,ul=2392/128,dl=2610/16384,p1=2523/32,y1=16384/2610,fl=32/2523,b1=[[.3592832590121217,.6976051147779502,-.035891593232029],[-.1920808463704993,1.100476797037432,.0753748658519118],[.0070797844607479,.0748396662186362,.8433265453898765]],w1=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],_1=[[.9999999999999998,.0086090370379328,.111029625003026],[.9999999999999998,-.0086090370379328,-.1110296250030259],[.9999999999999998,.5600313357106791,-.3206271749873188]],S1=[[2.0701522183894223,-1.3263473389671563,.2066510476294053],[.3647385209748072,.6805660249472273,-.0453045459220347],[-.0497472075358123,-.0492609666966131,1.1880659249923042]];var Gs=new R({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:qs,fromBase(n){let t=yt(b1,n);return T1(t)},toBase(n){let t=v1(n);return yt(S1,t)}});function T1(n){let t=n.map(function(e){let i=ll+hl*(e/1e4)**dl,r=1+ul*(e/1e4)**dl;return(i/r)**p1});return yt(w1,t)}function v1(n){return yt(_1,n).map(function(i){let r=Math.max(i**fl-ll,0),s=hl-ul*i**fl;return 1e4*(r/s)**y1})}function A1(n,t){[n,t]=Z([n,t]);let[e,i,r]=Gs.from(n),[s,a,o]=Gs.from(t);return 720*Math.sqrt((e-s)**2+.25*(i-a)**2+(r-o)**2)}const E1=Vt.D65,ml=.42,gl=1/ml,Zs=2*Math.PI,pl=[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],k1=[[1.8620678550872327,-1.0112546305316843,.14918677544445175],[.38752654323613717,.6214474419314753,-.008973985167612518],[-.015841498849333856,-.03412293802851557,1.0499644368778496]],M1=[[460,451,288],[460,-891,-261],[460,-220,-6300]],I1={dark:[.8,.525,.8],dim:[.9,.59,.9],average:[1,.69,1]},Ke={h:[20.14,90,164.25,237.53,380.14],e:[.8,.7,1,1.2,.8],H:[0,100,200,300,400]},x1=180/Math.PI,yl=Math.PI/180;function bl(n,t){return n.map(i=>{const r=ge(t*Math.abs(i)*.01,ml);return 400*ar(r,i)/(r+27.13)})}function C1(n,t){const e=100/t*27.13**gl;return n.map(i=>{const r=Math.abs(i);return ar(e*ge(r/(400-r),gl),i)})}function P1(n){let t=pe(n);t<=Ke.h[0]&&(t+=360);const e=Hc(Ke.h,t)-1,[i,r]=Ke.h.slice(e,e+2),[s,a]=Ke.e.slice(e,e+2),o=Ke.H[e],c=(t-i)/s;return o+100*c/(c+(r-t)/a)}function D1(n){let t=(n%400+400)%400;const e=Math.floor(.01*t);t=t%100;const[i,r]=Ke.h.slice(e,e+2),[s,a]=Ke.e.slice(e,e+2);return pe((t*(a*i-s*r)-100*i*a)/(t*(a-s)-100*a))}function wl(n,t,e,i,r){const s={};s.discounting=r,s.refWhite=n,s.surround=i;const a=n.map(b=>b*100);s.la=t,s.yb=e;const o=a[1],c=yt(pl,a);i=I1[s.surround];const l=i[0];s.c=i[1],s.nc=i[2];const d=(1/(5*s.la+1))**4;s.fl=d*s.la+.1*(1-d)*(1-d)*Math.cbrt(5*s.la),s.flRoot=s.fl**.25,s.n=s.yb/o,s.z=1.48+Math.sqrt(s.n),s.nbb=.725*s.n**-.2,s.ncb=s.nbb;const f=Math.max(Math.min(l*(1-1/3.6*Math.exp((-s.la-42)/92)),1),0);s.dRgb=c.map(b=>Jn(1,o/b,f)),s.dRgbInv=s.dRgb.map(b=>1/b);const g=c.map((b,S)=>b*s.dRgb[S]),p=bl(g,s.fl);return s.aW=s.nbb*(2*p[0]+p[1]+.05*p[2]),s}const _l=wl(E1,64/Math.PI*.2,20,"average",!1);function Ys(n,t){if(!(n.J!==void 0^n.Q!==void 0))throw new Error("Conversion requires one and only one: 'J' or 'Q'");if(!(n.C!==void 0^n.M!==void 0^n.s!==void 0))throw new Error("Conversion requires one and only one: 'C', 'M' or 's'");if(!(n.h!==void 0^n.H!==void 0))throw new Error("Conversion requires one and only one: 'h' or 'H'");if(n.J===0||n.Q===0)return[0,0,0];let e=0;n.h!==void 0?e=pe(n.h)*yl:e=D1(n.H)*yl;const i=Math.cos(e),r=Math.sin(e);let s=0;n.J!==void 0?s=ge(n.J,1/2)*.1:n.Q!==void 0&&(s=.25*t.c*n.Q/((t.aW+4)*t.flRoot));let a=0;n.C!==void 0?a=n.C/s:n.M!==void 0?a=n.M/t.flRoot/s:n.s!==void 0&&(a=4e-4*n.s**2*(t.aW+4)/t.c);const o=ge(a*Math.pow(1.64-Math.pow(.29,t.n),-.73),10/9),c=.25*(Math.cos(e+2)+3.8),l=t.aW*ge(s,2/t.c/t.z),h=5e4/13*t.nc*t.ncb*c,d=l/t.nbb,f=23*(d+.305)*Ls(o,23*h+o*(11*i+108*r)),g=f*i,p=f*r,b=C1(yt(M1,[d,g,p]).map(S=>S*1/1403),t.fl);return yt(k1,b.map((S,w)=>S*t.dRgbInv[w])).map(S=>S/100)}function Sl(n,t){const e=n.map(A=>A*100),i=bl(yt(pl,e).map((A,E)=>A*t.dRgb[E]),t.fl),r=i[0]+(-12*i[1]+i[2])/11,s=(i[0]+i[1]-2*i[2])/9,a=(Math.atan2(s,r)%Zs+Zs)%Zs,o=.25*(Math.cos(a+2)+3.8),c=5e4/13*t.nc*t.ncb*Ls(o*Math.sqrt(r**2+s**2),i[0]+i[1]+1.05*i[2]+.305),l=ge(c,.9)*Math.pow(1.64-Math.pow(.29,t.n),.73),h=t.nbb*(2*i[0]+i[1]+.05*i[2]),d=ge(h/t.aW,.5*t.c*t.z),f=100*ge(d,2),g=4/t.c*d*(t.aW+4)*t.flRoot,p=l*d,b=p*t.flRoot,S=pe(a*x1),w=P1(S),v=50*ge(t.c*l/(t.aW+4),1/2);return{J:f,C:p,h:S,s:v,Q:g,M:b,H:w}}var N1=new R({id:"cam16-jmh",cssId:"--cam16-jmh",name:"CAM16-JMh",coords:{j:{refRange:[0,100],name:"J"},m:{refRange:[0,105],name:"Colorfulness"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:Wt,fromBase(n){const t=Sl(n,_l);return[t.J,t.M,t.h]},toBase(n){return Ys({J:n[0],M:n[1],h:n[2]},_l)}});const R1=Vt.D65,O1=216/24389,Tl=24389/27;function B1(n){return 116*(n>O1?Math.cbrt(n):(Tl*n+16)/116)-16}function Xs(n){return n>8?Math.pow((n+16)/116,3):n/Tl}function L1(n,t){let[e,i,r]=n,s=[],a=0;if(r===0)return[0,0,0];let o=Xs(r);r>0?a=.00379058511492914*r**2+.608983189401032*r+.9155088574762233:a=9514440756550361e-21*r**2+.08693057439788597*r-21.928975842194614;const c=2e-12,l=15;let h=0,d=1/0;for(;h<=l;){s=Ys({J:a,C:i,h:e},t);const f=Math.abs(s[1]-o);if(f<d){if(f<=c)return s;d=f}a=a-(s[1]-o)*a/(2*s[1]),h+=1}return Ys({J:a,C:i,h:e},t)}function z1(n,t){const e=B1(n[1]);if(e===0)return[0,0,0];const i=Sl(n,Vs);return[pe(i.h),i.C,e]}const Vs=wl(R1,200/Math.PI*Xs(50),Xs(50)*100,"average",!1);var ei=new R({id:"hct",name:"HCT",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},c:{refRange:[0,145],name:"Colorfulness"},t:{refRange:[0,100],name:"Tone"}},base:Wt,fromBase(n){return z1(n)},toBase(n){return L1(n,Vs)},formats:{color:{id:"--hct",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const U1=Math.PI/180,vl=[1,.007,.0228];function Al(n){n[1]<0&&(n=ei.fromBase(ei.toBase(n)));const t=Math.log(Math.max(1+vl[2]*n[1]*Vs.flRoot,1))/vl[2],e=n[0]*U1,i=t*Math.cos(e),r=t*Math.sin(e);return[n[2],i,r]}function W1(n,t){[n,t]=Z([n,t]);let[e,i,r]=Al(ei.from(n)),[s,a,o]=Al(ei.from(t));return Math.sqrt((e-s)**2+(i-a)**2+(r-o)**2)}var yn={deltaE76:o1,deltaECMC:c1,deltaE2000:Qc,deltaEJz:g1,deltaEITP:A1,deltaEOK:Fs,deltaEHCT:W1};function $1(n){const t=n?Math.floor(Math.log10(Math.abs(n))):0;return Math.max(parseFloat(`1e${t-2}`),1e-6)}const El={hct:{method:"hct.c",jnd:2,deltaEMethod:"hct",blackWhiteClamp:{}},"hct-tonal":{method:"hct.c",jnd:0,deltaEMethod:"hct",blackWhiteClamp:{channel:"hct.t",min:0,max:100}}};function Fe(n,{method:t=ie.gamut_mapping,space:e=void 0,deltaEMethod:i="",jnd:r=2,blackWhiteClamp:s={}}={}){if(n=Z(n),Kn(arguments[1])?e=arguments[1]:e||(e=n.space),e=R.get(e),Ve(n,e,{epsilon:0}))return n;let a;if(t==="css")a=F1(n,{space:e});else{if(t!=="clip"&&!Ve(n,e)){Object.prototype.hasOwnProperty.call(El,t)&&({method:t,jnd:r,deltaEMethod:i,blackWhiteClamp:s}=El[t]);let o=Qc;if(i!==""){for(let l in yn)if("deltae"+i.toLowerCase()===l.toLowerCase()){o=yn[l];break}}let c=Fe(bt(n,e),{method:"clip",space:e});if(o(n,c)>r){if(Object.keys(s).length===3){let v=R.resolveCoord(s.channel),A=re(bt(n,v.space),v.id);if(We(A)&&(A=0),A>=s.max)return bt({space:"xyz-d65",coords:Vt.D65},n.space);if(A<=s.min)return bt({space:"xyz-d65",coords:[0,0,0]},n.space)}let l=R.resolveCoord(t),h=l.space,d=l.id,f=bt(n,h);f.coords.forEach((v,A)=>{We(v)&&(f.coords[A]=0)});let p=(l.range||l.refRange)[0],b=$1(r),S=p,w=re(f,d);for(;w-S>b;){let v=pn(f);v=Fe(v,{space:e,method:"clip"}),o(f,v)-r<b?S=re(f,d):w=re(f,d),Ae(f,d,(S+w)/2)}a=bt(f,e)}else a=c}else a=bt(n,e);if(t==="clip"||!Ve(a,e,{epsilon:0})){let o=Object.values(e.coords).map(c=>c.range||[]);a.coords=a.coords.map((c,l)=>{let[h,d]=o[l];return h!==void 0&&(c=Math.max(h,c)),d!==void 0&&(c=Math.min(c,d)),c})}}return e!==n.space&&(a=bt(a,n.space)),n.coords=a.coords,n}Fe.returns="color";const kl={WHITE:{space:gn,coords:[1,0,0]},BLACK:{space:gn,coords:[0,0,0]}};function F1(n,{space:t}={}){n=Z(n),t||(t=n.space),t=R.get(t);const r=R.get("oklch");if(t.isUnbounded)return bt(n,t);const s=bt(n,r);let a=s.coords[0];if(a>=1){const p=bt(kl.WHITE,t);return p.alpha=n.alpha,bt(p,t)}if(a<=0){const p=bt(kl.BLACK,t);return p.alpha=n.alpha,bt(p,t)}if(Ve(s,t,{epsilon:0}))return bt(s,t);function o(p){const b=bt(p,t),S=Object.values(t.coords);return b.coords=b.coords.map((w,v)=>{if("range"in S[v]){const[A,E]=S[v].range;return jc(A,w,E)}return w}),b}let c=0,l=s.coords[1],h=!0,d=pn(s),f=o(d),g=Fs(f,d);if(g<.02)return f;for(;l-c>1e-4;){const p=(c+l)/2;if(d.coords[1]=p,h&&Ve(d,t,{epsilon:0}))c=p;else if(f=o(d),g=Fs(f,d),g<.02){if(.02-g<1e-4)break;h=!1,c=p}else l=p}return f}function bt(n,t,{inGamut:e}={}){n=Z(n),t=R.get(t);let i=t.from(n),r={space:t,coords:i,alpha:n.alpha};return e&&(r=Fe(r,e===!0?void 0:e)),r}bt.returns="color";function ni(n,{precision:t=ie.precision,format:e="default",inGamut:i=!0,...r}={}){let s;n=Z(n);let a=e;e=n.space.getFormat(e)??n.space.getFormat("default")??R.DEFAULT_FORMAT;let o=n.coords.slice();if(i||=e.toGamut,i&&!Ve(n)&&(o=Fe(pn(n),i===!0?void 0:i).coords),e.type==="custom")if(r.precision=t,e.serialize)s=e.serialize(o,n.alpha,r);else throw new TypeError(`format ${a} can only be used to parse colors, not for serialization`);else{let c=e.name||"color";e.serializeCoords?o=e.serializeCoords(o,t):t!==null&&(o=o.map(f=>sr(f,{precision:t})));let l=[...o];if(c==="color"){let f=e.id||e.ids?.[0]||n.space.id;l.unshift(f)}let h=n.alpha;t!==null&&(h=sr(h,{precision:t}));let d=n.alpha>=1||e.noAlpha?"":`${e.commas?",":" /"} ${h}`;s=`${c}(${l.join(e.commas?", ":" ")}${d})`}return s}const q1=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],j1=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var fr=new Qt({id:"rec2020-linear",cssId:"--rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:q1,fromXYZ_M:j1});const mr=1.09929682680944,Ml=.018053968510807;var Il=new Qt({id:"rec2020",name:"REC.2020",base:fr,toBase(n){return n.map(function(t){return t<Ml*4.5?t/4.5:Math.pow((t+mr-1)/mr,1/.45)})},fromBase(n){return n.map(function(t){return t>=Ml?mr*Math.pow(t,.45)-(mr-1):4.5*t})}});const H1=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],G1=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var xl=new Qt({id:"p3-linear",cssId:"--display-p3-linear",name:"Linear P3",white:"D65",toXYZ_M:H1,fromXYZ_M:G1});const Z1=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Nt=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var Cl=new Qt({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:Z1,fromXYZ_M:Nt}),Pl={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let Dl=Array(3).fill("<percentage> | <number>[0, 255]"),Nl=Array(3).fill("<number>[0, 255]");var bn=new Qt({id:"srgb",name:"sRGB",base:Cl,fromBase:n=>n.map(t=>{let e=t<0?-1:1,i=t*e;return i>.0031308?e*(1.055*i**(1/2.4)-.055):12.92*t}),toBase:n=>n.map(t=>{let e=t<0?-1:1,i=t*e;return i<=.04045?t/12.92:e*((i+.055)/1.055)**2.4}),formats:{rgb:{coords:Dl},rgb_number:{name:"rgb",commas:!0,coords:Nl,noAlpha:!0},color:{},rgba:{coords:Dl,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:Nl},hex:{type:"custom",toGamut:!0,test:n=>/^#([a-f0-9]{3,4}){1,2}$/i.test(n),parse(n){n.length<=5&&(n=n.replace(/[a-f0-9]/gi,"$&$&"));let t=[];return n.replace(/[a-f0-9]{2}/gi,e=>{t.push(parseInt(e,16)/255)}),{spaceId:"srgb",coords:t.slice(0,3),alpha:t.slice(3)[0]}},serialize:(n,t,{collapse:e=!0}={})=>{t<1&&n.push(t),n=n.map(s=>Math.round(s*255));let i=e&&n.every(s=>s%17===0);return"#"+n.map(s=>i?(s/17).toString(16):s.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:n=>/^[a-z]+$/i.test(n),parse(n){n=n.toLowerCase();let t={spaceId:"srgb",coords:null,alpha:1};if(n==="transparent"?(t.coords=Pl.black,t.alpha=0):t.coords=Pl[n],t.coords)return t}}}}),Rl=new Qt({id:"p3",cssId:"display-p3",name:"P3",base:xl,fromBase:bn.fromBase,toBase:bn.toBase});ie.display_space=bn;let Y1;if(typeof CSS<"u"&&CSS.supports)for(let n of[se,Il,Rl]){let t=n.getMinCoords(),i=ni({space:n,coords:t,alpha:1});if(CSS.supports("color",i)){ie.display_space=n;break}}function X1(n,{space:t=ie.display_space,...e}={}){let i=ni(n,e);if(typeof CSS>"u"||CSS.supports("color",i)||!ie.display_space)i=new String(i),i.color=n;else{let r=n;if((n.coords.some(We)||We(n.alpha))&&!(Y1??=CSS.supports("color","hsl(none 50% 50%)"))&&(r=pn(n),r.coords=r.coords.map(kt),r.alpha=kt(r.alpha),i=ni(r,e),CSS.supports("color",i)))return i=new String(i),i.color=r,i;r=bt(r,t),i=new String(ni(r,e)),i.color=r}return i}function V1(n,t){return n=Z(n),t=Z(t),n.space===t.space&&n.alpha===t.alpha&&n.coords.every((e,i)=>e===t.coords[i])}function qe(n){return re(n,[Wt,"y"])}function Ol(n,t){Ae(n,[Wt,"y"],t)}function K1(n){Object.defineProperty(n.prototype,"luminance",{get(){return qe(this)},set(t){Ol(this,t)}})}var J1=Object.freeze({__proto__:null,getLuminance:qe,register:K1,setLuminance:Ol});function Q1(n,t){n=Z(n),t=Z(t);let e=Math.max(qe(n),0),i=Math.max(qe(t),0);return i>e&&([e,i]=[i,e]),(e+.05)/(i+.05)}const ty=.56,ey=.57,ny=.62,iy=.65,Bl=.022,ry=1.414,sy=.1,ay=5e-4,oy=1.14,Ll=.027,cy=1.14;function zl(n){return n>=Bl?n:n+(Bl-n)**ry}function wn(n){let t=n<0?-1:1,e=Math.abs(n);return t*Math.pow(e,2.4)}function ly(n,t){t=Z(t),n=Z(n);let e,i,r,s,a,o;t=bt(t,"srgb"),[s,a,o]=t.coords;let c=wn(s)*.2126729+wn(a)*.7151522+wn(o)*.072175;n=bt(n,"srgb"),[s,a,o]=n.coords;let l=wn(s)*.2126729+wn(a)*.7151522+wn(o)*.072175,h=zl(c),d=zl(l),f=d>h;return Math.abs(d-h)<ay?i=0:f?(e=d**ty-h**ey,i=e*oy):(e=d**iy-h**ny,i=e*cy),Math.abs(i)<sy?r=0:i>0?r=i-Ll:r=i+Ll,r*100}function hy(n,t){n=Z(n),t=Z(t);let e=Math.max(qe(n),0),i=Math.max(qe(t),0);i>e&&([e,i]=[i,e]);let r=e+i;return r===0?0:(e-i)/r}const uy=5e4;function dy(n,t){n=Z(n),t=Z(t);let e=Math.max(qe(n),0),i=Math.max(qe(t),0);return i>e&&([e,i]=[i,e]),i===0?uy:(e-i)/i}function fy(n,t){n=Z(n),t=Z(t);let e=re(n,[se,"l"]),i=re(t,[se,"l"]);return Math.abs(e-i)}const my=216/24389,Ul=24/116,gr=24389/27;let Ks=Vt.D65;var Js=new R({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Ks,base:Wt,fromBase(n){let e=n.map((i,r)=>i/Ks[r]).map(i=>i>my?Math.cbrt(i):(gr*i+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(n){let t=[];return t[1]=(n[0]+16)/116,t[0]=n[1]/500+t[1],t[2]=t[1]-n[2]/200,[t[0]>Ul?Math.pow(t[0],3):(116*t[0]-16)/gr,n[0]>8?Math.pow((n[0]+16)/116,3):n[0]/gr,t[2]>Ul?Math.pow(t[2],3):(116*t[2]-16)/gr].map((i,r)=>i*Ks[r])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});const Qs=Math.pow(5,.5)*.5+.5;function gy(n,t){n=Z(n),t=Z(t);let e=re(n,[Js,"l"]),i=re(t,[Js,"l"]),r=Math.abs(Math.pow(e,Qs)-Math.pow(i,Qs)),s=Math.pow(r,1/Qs)*Math.SQRT2-40;return s<7.5?0:s}var pr=Object.freeze({__proto__:null,contrastAPCA:ly,contrastDeltaPhi:gy,contrastLstar:fy,contrastMichelson:hy,contrastWCAG21:Q1,contrastWeber:dy});function py(n,t,e={}){Kn(e)&&(e={algorithm:e});let{algorithm:i,...r}=e;if(!i){let s=Object.keys(pr).map(a=>a.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${s}`)}n=Z(n),t=Z(t);for(let s in pr)if("contrast"+i.toLowerCase()===s.toLowerCase())return pr[s](n,t,r);throw new TypeError(`Unknown contrast algorithm: ${i}`)}function yr(n){let[t,e,i]=Qn(n,Wt),r=t+15*e+3*i;return[4*t/r,9*e/r]}function Wl(n){let[t,e,i]=Qn(n,Wt),r=t+e+i;return[t/r,e/r]}function yy(n){Object.defineProperty(n.prototype,"uv",{get(){return yr(this)}}),Object.defineProperty(n.prototype,"xy",{get(){return Wl(this)}})}var by=Object.freeze({__proto__:null,register:yy,uv:yr,xy:Wl});function ii(n,t,e={}){Kn(e)&&(e={method:e});let{method:i=ie.deltaE,...r}=e;for(let s in yn)if("deltae"+i.toLowerCase()===s.toLowerCase())return yn[s](n,t,r);throw new TypeError(`Unknown deltaE method: ${i}`)}function wy(n,t=.25){let i=[R.get("oklch","lch"),"l"];return Ae(n,i,r=>r*(1+t))}function _y(n,t=.25){let i=[R.get("oklch","lch"),"l"];return Ae(n,i,r=>r*(1-t))}var Sy=Object.freeze({__proto__:null,darken:_y,lighten:wy});function $l(n,t,e=.5,i={}){return[n,t]=[Z(n),Z(t)],Ue(e)==="object"&&([e,i]=[.5,e]),ri(n,t,i)(e)}function Fl(n,t,e={}){let i;ta(n)&&([i,e]=[n,t],[n,t]=i.rangeArgs.colors);let{maxDeltaE:r,deltaEMethod:s,steps:a=2,maxSteps:o=1e3,...c}=e;i||([n,t]=[Z(n),Z(t)],i=ri(n,t,c));let l=ii(n,t),h=r>0?Math.max(a,Math.ceil(l/r)+1):a,d=[];if(o!==void 0&&(h=Math.min(h,o)),h===1)d=[{p:.5,color:i(.5)}];else{let f=1/(h-1);d=Array.from({length:h},(g,p)=>{let b=p*f;return{p:b,color:i(b)}})}if(r>0){let f=d.reduce((g,p,b)=>{if(b===0)return 0;let S=ii(p.color,d[b-1].color,s);return Math.max(g,S)},0);for(;f>r;){f=0;for(let g=1;g<d.length&&d.length<o;g++){let p=d[g-1],b=d[g],S=(b.p+p.p)/2,w=i(S);f=Math.max(f,ii(w,p.color),ii(w,b.color)),d.splice(g,0,{p:S,color:i(S)}),g++}}}return d=d.map(f=>f.color),d}function ri(n,t,e={}){if(ta(n)){let[c,l]=[n,t];return ri(...c.rangeArgs.colors,{...c.rangeArgs.options,...l})}let{space:i,outputSpace:r,progression:s,premultiplied:a}=e;n=Z(n),t=Z(t),n=pn(n),t=pn(t);let o={colors:[n,t],options:e};if(i?i=R.get(i):i=R.registry[ie.interpolationSpace]||n.space,r=r?R.get(r):i,n=bt(n,i),t=bt(t,i),n=Fe(n),t=Fe(t),i.coords.h&&i.coords.h.type==="angle"){let c=e.hue=e.hue||"shorter",l=[i,"h"],[h,d]=[re(n,l),re(t,l)];isNaN(h)&&!isNaN(d)?h=d:isNaN(d)&&!isNaN(h)&&(d=h),[h,d]=e1(c,[h,d]),Ae(n,l,h),Ae(t,l,d)}return a&&(n.coords=n.coords.map(c=>c*n.alpha),t.coords=t.coords.map(c=>c*t.alpha)),Object.assign(c=>{c=s?s(c):c;let l=n.coords.map((f,g)=>{let p=t.coords[g];return Jn(f,p,c)}),h=Jn(n.alpha,t.alpha,c),d={space:i,coords:l,alpha:h};return a&&(d.coords=d.coords.map(f=>f/h)),r!==i&&(d=bt(d,r)),d},{rangeArgs:o})}function ta(n){return Ue(n)==="function"&&!!n.rangeArgs}ie.interpolationSpace="lab";function Ty(n){n.defineFunction("mix",$l,{returns:"color"}),n.defineFunction("range",ri,{returns:"function<color>"}),n.defineFunction("steps",Fl,{returns:"array<color>"})}var vy=Object.freeze({__proto__:null,isRange:ta,mix:$l,range:ri,register:Ty,steps:Fl}),ql=new R({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:bn,fromBase:n=>{let t=Math.max(...n),e=Math.min(...n),[i,r,s]=n,[a,o,c]=[NaN,0,(e+t)/2],l=t-e;if(l!==0){switch(o=c===0||c===1?0:(t-c)/Math.min(c,1-c),t){case i:a=(r-s)/l+(r<s?6:0);break;case r:a=(s-i)/l+2;break;case s:a=(i-r)/l+4}a=a*60}return o<0&&(a+=180,o=Math.abs(o)),a>=360&&(a-=360),[a,o*100,c*100]},toBase:n=>{let[t,e,i]=n;t=t%360,t<0&&(t+=360),e/=100,i/=100;function r(s){let a=(s+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(a-3,9-a,1))}return[r(0),r(8),r(4)]},formats:{hsl:{coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),jl=new R({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:ql,fromBase(n){let[t,e,i]=n;e/=100,i/=100;let r=i+e*Math.min(i,1-i);return[t,r===0?0:200*(1-i/r),100*r]},toBase(n){let[t,e,i]=n;e/=100,i/=100;let r=i*(1-e/2);return[t,r===0||r===1?0:(i-r)/Math.min(r,1-r)*100,r*100]},formats:{color:{id:"--hsv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),Ay=new R({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:jl,fromBase(n){let[t,e,i]=n;return[t,i*(100-e)/100,100-i]},toBase(n){let[t,e,i]=n;e/=100,i/=100;let r=e+i;if(r>=1){let o=e/r;return[t,0,o*100]}let s=1-i,a=s===0?0:1-e/s;return[t,a*100,s*100]},formats:{hwb:{coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const Ey=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],ky=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var Hl=new Qt({id:"a98rgb-linear",cssId:"--a98-rgb-linear",name:"Linear AdobeÂ® 98 RGB compatible",white:"D65",toXYZ_M:Ey,fromXYZ_M:ky}),My=new Qt({id:"a98rgb",cssId:"a98-rgb",name:"AdobeÂ® 98 RGB compatible",base:Hl,toBase:n=>n.map(t=>Math.pow(Math.abs(t),563/256)*Math.sign(t)),fromBase:n=>n.map(t=>Math.pow(Math.abs(t),256/563)*Math.sign(t))});const Iy=[[.7977666449006423,.13518129740053308,.0313477341283922],[.2880748288194013,.711835234241873,8993693872564e-17],[0,0,.8251046025104602]],xy=[[1.3457868816471583,-.25557208737979464,-.05110186497554526],[-.5446307051249019,1.5082477428451468,.02052744743642139],[0,0,1.2119675456389452]];var Gl=new Qt({id:"prophoto-linear",cssId:"--prophoto-rgb-linear",name:"Linear ProPhoto",white:"D50",base:Ws,toXYZ_M:Iy,fromXYZ_M:xy});const Cy=1/512,Py=16/512;var Dy=new Qt({id:"prophoto",cssId:"prophoto-rgb",name:"ProPhoto",base:Gl,toBase(n){return n.map(t=>t<Py?t/16:t**1.8)},fromBase(n){return n.map(t=>t>=Cy?t**(1/1.8):16*t)}}),Ny=new R({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:gn,fromBase(n){let[t,e,i]=n,r;const s=2e-4;return Math.abs(e)<s&&Math.abs(i)<s?r=NaN:r=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),pe(r)]},toBase(n){let[t,e,i]=n,r,s;return isNaN(i)?(r=0,s=0):(r=e*Math.cos(i*Math.PI/180),s=e*Math.sin(i*Math.PI/180)),[t,r,s]},formats:{oklch:{coords:["<percentage> | <number>","<number> | <percentage>[0,1]","<number> | <angle>"]}}});let Zl=Vt.D65;const Ry=216/24389,Yl=24389/27,[Xl,Vl]=yr({space:Wt,coords:Zl});var Kl=new R({id:"luv",name:"Luv",coords:{l:{refRange:[0,100],name:"Lightness"},u:{refRange:[-215,215]},v:{refRange:[-215,215]}},white:Zl,base:Wt,fromBase(n){let t=[kt(n[0]),kt(n[1]),kt(n[2])],e=t[1],[i,r]=yr({space:Wt,coords:t});if(!Number.isFinite(i)||!Number.isFinite(r))return[0,0,0];let s=e<=Ry?Yl*e:116*Math.cbrt(e)-16;return[s,13*s*(i-Xl),13*s*(r-Vl)]},toBase(n){let[t,e,i]=n;if(t===0||We(t))return[0,0,0];e=kt(e),i=kt(i);let r=e/(13*t)+Xl,s=i/(13*t)+Vl,a=t<=8?t/Yl:Math.pow((t+16)/116,3);return[a*(9*r/(4*s)),a,a*((12-3*r-20*s)/(4*s))]},formats:{color:{id:"--luv",coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),ea=new R({id:"lchuv",name:"LChuv",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,220],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:Kl,fromBase(n){let[t,e,i]=n,r;const s=.02;return Math.abs(e)<s&&Math.abs(i)<s?r=NaN:r=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),pe(r)]},toBase(n){let[t,e,i]=n;return e<0&&(e=0),isNaN(i)&&(i=0),[t,e*Math.cos(i*Math.PI/180),e*Math.sin(i*Math.PI/180)]},formats:{color:{id:"--lchuv",coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const Oy=216/24389,By=24389/27,Jl=Nt[0][0],Ql=Nt[0][1],na=Nt[0][2],th=Nt[1][0],eh=Nt[1][1],ia=Nt[1][2],nh=Nt[2][0],ih=Nt[2][1],ra=Nt[2][2];function _n(n,t,e){const i=t/(Math.sin(e)-n*Math.cos(e));return i<0?1/0:i}function br(n){const t=Math.pow(n+16,3)/1560896,e=t>Oy?t:n/By,i=e*(284517*Jl-94839*na),r=e*(838422*na+769860*Ql+731718*Jl),s=e*(632260*na-126452*Ql),a=e*(284517*th-94839*ia),o=e*(838422*ia+769860*eh+731718*th),c=e*(632260*ia-126452*eh),l=e*(284517*nh-94839*ra),h=e*(838422*ra+769860*ih+731718*nh),d=e*(632260*ra-126452*ih);return{r0s:i/s,r0i:r*n/s,r1s:i/(s+126452),r1i:(r-769860)*n/(s+126452),g0s:a/c,g0i:o*n/c,g1s:a/(c+126452),g1i:(o-769860)*n/(c+126452),b0s:l/d,b0i:h*n/d,b1s:l/(d+126452),b1i:(h-769860)*n/(d+126452)}}function rh(n,t){const e=t/360*Math.PI*2,i=_n(n.r0s,n.r0i,e),r=_n(n.r1s,n.r1i,e),s=_n(n.g0s,n.g0i,e),a=_n(n.g1s,n.g1i,e),o=_n(n.b0s,n.b0i,e),c=_n(n.b1s,n.b1i,e);return Math.min(i,r,s,a,o,c)}var Ly=new R({id:"hsluv",name:"HSLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:ea,gamutSpace:bn,fromBase(n){let[t,e,i]=[kt(n[0]),kt(n[1]),kt(n[2])],r;if(t>99.9999999)r=0,t=100;else if(t<1e-8)r=0,t=0;else{let s=br(t),a=rh(s,i);r=e/a*100}return[i,r,t]},toBase(n){let[t,e,i]=[kt(n[0]),kt(n[1]),kt(n[2])],r;if(i>99.9999999)i=100,r=0;else if(i<1e-8)i=0,r=0;else{let s=br(i);r=rh(s,t)/100*e}return[i,r,t]},formats:{color:{id:"--hsluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});Nt[0][0],Nt[0][1],Nt[0][2],Nt[1][0],Nt[1][1],Nt[1][2],Nt[2][0],Nt[2][1],Nt[2][2];function Sn(n,t){return Math.abs(t)/Math.sqrt(Math.pow(n,2)+1)}function sh(n){let t=Sn(n.r0s,n.r0i),e=Sn(n.r1s,n.r1i),i=Sn(n.g0s,n.g0i),r=Sn(n.g1s,n.g1i),s=Sn(n.b0s,n.b0i),a=Sn(n.b1s,n.b1i);return Math.min(t,e,i,r,s,a)}var zy=new R({id:"hpluv",name:"HPLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:ea,gamutSpace:"self",fromBase(n){let[t,e,i]=[kt(n[0]),kt(n[1]),kt(n[2])],r;if(t>99.9999999)r=0,t=100;else if(t<1e-8)r=0,t=0;else{let s=br(t),a=sh(s);r=e/a*100}return[i,r,t]},toBase(n){let[t,e,i]=[kt(n[0]),kt(n[1]),kt(n[2])],r;if(i>99.9999999)i=100,r=0;else if(i<1e-8)i=0,r=0;else{let s=br(i);r=sh(s)/100*e}return[i,r,t]},formats:{color:{id:"--hpluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const ah=203,oh=2610/2**14,Uy=2**14/2610,Wy=2523/2**5,ch=2**5/2523,lh=3424/2**12,hh=2413/2**7,uh=2392/2**7;var $y=new Qt({id:"rec2100pq",cssId:"rec2100-pq",name:"REC.2100-PQ",base:fr,toBase(n){return n.map(function(t){return(Math.max(t**ch-lh,0)/(hh-uh*t**ch))**Uy*1e4/ah})},fromBase(n){return n.map(function(t){let e=Math.max(t*ah/1e4,0),i=lh+hh*e**oh,r=1+uh*e**oh;return(i/r)**Wy})}});const dh=.17883277,fh=.28466892,mh=.55991073,sa=3.7743;var Fy=new Qt({id:"rec2100hlg",cssId:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:fr,toBase(n){return n.map(function(t){return t<=.5?t**2/3*sa:(Math.exp((t-mh)/dh)+fh)/12*sa})},fromBase(n){return n.map(function(t){return t/=sa,t<=1/12?Math.sqrt(3*t):dh*Math.log(12*t-fh)+mh})}});const gh={};$e.add("chromatic-adaptation-start",n=>{n.options.method&&(n.M=ph(n.W1,n.W2,n.options.method))}),$e.add("chromatic-adaptation-end",n=>{n.M||(n.M=ph(n.W1,n.W2,n.options.method))});function wr({id:n,toCone_M:t,fromCone_M:e}){gh[n]=arguments[0]}function ph(n,t,e="Bradford"){let i=gh[e],[r,s,a]=yt(i.toCone_M,n),[o,c,l]=yt(i.toCone_M,t),h=[[o/r,0,0],[0,c/s,0],[0,0,l/a]],d=yt(h,i.toCone_M);return yt(i.fromCone_M,d)}wr({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599363874558397,-1.1293816185800916,.21989740959619328],[.3611914362417676,.6388124632850422,-6370596838649899e-21],[0,0,1.0890636230968613]]}),wr({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929054667121,-.14705425642099013,.15996265166373122],[.4323052697233945,.5183602715367774,.049291228212855594],[-.00852866457517732,.04004282165408486,.96848669578755]]}),wr({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238208355142,-.27886900021828726,.18274517938277307],[.4543690419753592,.4735331543074117,.07209780371722911],[-.009627608738429355,-.00569803121611342,1.0153256399545427]]}),wr({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.0112546305316845,.14918677544445172],[.3875265432361372,.6214474419314753,-.008973985167612521],[-.01584149884933386,-.03412293802851557,1.0499644368778496]]}),Object.assign(Vt,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),Vt.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767];const qy=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],jy=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]];var yh=new Qt({id:"acescg",cssId:"--acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:Vt.ACES,toXYZ_M:qy,fromXYZ_M:jy});const _r=2**-16,aa=-.35828683,Sr=(Math.log2(65504)+9.72)/17.52;var Hy=new Qt({id:"acescc",cssId:"--acescc",name:"ACEScc",coords:{r:{range:[aa,Sr],name:"Red"},g:{range:[aa,Sr],name:"Green"},b:{range:[aa,Sr],name:"Blue"}},referred:"scene",base:yh,toBase(n){const t=-.3013698630136986;return n.map(function(e){return e<=t?(2**(e*17.52-9.72)-_r)*2:e<Sr?2**(e*17.52-9.72):65504})},fromBase(n){return n.map(function(t){return t<=0?(Math.log2(_r)+9.72)/17.52:t<_r?(Math.log2(_r+t*.5)+9.72)/17.52:(Math.log2(t)+9.72)/17.52})}}),bh=Object.freeze({__proto__:null,A98RGB:My,A98RGB_Linear:Hl,ACEScc:Hy,ACEScg:yh,CAM16_JMh:N1,HCT:ei,HPLuv:zy,HSL:ql,HSLuv:Ly,HSV:jl,HWB:Ay,ICTCP:Gs,JzCzHz:Hs,Jzazbz:cl,LCH:ti,LCHuv:ea,Lab:se,Lab_D65:Js,Luv:Kl,OKLCH:Ny,OKLab:gn,P3:Rl,P3_Linear:xl,ProPhoto:Dy,ProPhoto_Linear:Gl,REC_2020:Il,REC_2020_Linear:fr,REC_2100_HLG:Fy,REC_2100_PQ:$y,XYZ_ABS_D65:qs,XYZ_D50:Ws,XYZ_D65:Wt,sRGB:bn,sRGB_Linear:Cl});class lt{constructor(...t){let e;t.length===1&&(e=Z(t[0]));let i,r,s;e?(i=e.space||e.spaceId,r=e.coords,s=e.alpha):[i,r,s]=t,Object.defineProperty(this,"space",{value:R.get(i),writable:!1,enumerable:!0,configurable:!0}),this.coords=r?r.slice():[0,0,0],this.alpha=s>1||s===void 0?1:s<0?0:s;for(let a=0;a<this.coords.length;a++)this.coords[a]==="NaN"&&(this.coords[a]=NaN);for(let a in this.space.coords)Object.defineProperty(this,a,{get:()=>this.get(a),set:o=>this.set(a,o)})}get spaceId(){return this.space.id}clone(){return new lt(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...t){let e=X1(this,...t);return e.color=new lt(e.color),e}static get(t,...e){return t instanceof lt?t:new lt(t,...e)}static defineFunction(t,e,i=e){let{instance:r=!0,returns:s}=i,a=function(...o){let c=e(...o);if(s==="color")c=lt.get(c);else if(s==="function<color>"){let l=c;c=function(...h){let d=l(...h);return lt.get(d)},Object.assign(c,l)}else s==="array<color>"&&(c=c.map(l=>lt.get(l)));return c};t in lt||(lt[t]=a),r&&(lt.prototype[t]=function(...o){return a(this,...o)})}static defineFunctions(t){for(let e in t)lt.defineFunction(e,t[e],t[e])}static extend(t){if(t.register)t.register(lt);else for(let e in t)lt.defineFunction(e,t[e])}}lt.defineFunctions({get:re,getAll:Qn,set:Ae,setAll:Us,to:bt,equals:V1,inGamut:Ve,toGamut:Fe,distance:tl,toString:ni}),Object.assign(lt,{util:X0,hooks:$e,WHITES:Vt,Space:R,spaces:R.registry,parse:Zc,defaults:ie});for(let n of Object.keys(bh))R.register(bh[n]);for(let n in R.registry)oa(n,R.registry[n]);$e.add("colorspace-init-end",n=>{oa(n.id,n),n.aliases?.forEach(t=>{oa(t,n)})});function oa(n,t){let e=n.replace(/-/g,"_");Object.defineProperty(lt.prototype,e,{get(){let i=this.getAll(n);return typeof Proxy>"u"?i:new Proxy(i,{has:(r,s)=>{try{return R.resolveCoord([t,s]),!0}catch{}return Reflect.has(r,s)},get:(r,s,a)=>{if(s&&typeof s!="symbol"&&!(s in r)){let{index:o}=R.resolveCoord([t,s]);if(o>=0)return r[o]}return Reflect.get(r,s,a)},set:(r,s,a,o)=>{if(s&&typeof s!="symbol"&&!(s in r)||s>=0){let{index:c}=R.resolveCoord([t,s]);if(c>=0)return r[c]=a,this.setAll(n,r),!0}return Reflect.set(r,s,a,o)}})},set(i){this.setAll(n,i)},configurable:!0,enumerable:!0})}lt.extend(yn),lt.extend({deltaE:ii}),Object.assign(lt,{deltaEMethods:yn}),lt.extend(Sy),lt.extend({contrast:py}),lt.extend(by),lt.extend(J1),lt.extend(vy),lt.extend(pr),Ki([zc]),Ki([Nc]);const Gy=u("rgb(235,51,51)"),Zy=u("rgb(41,98,255)"),Yy=u("rgb(43,212,189)"),Xy=u("rgb(146,52,234)"),Vy=u("rgb(231,176,8)"),Ky=u("rgb(249,116,21)"),Jy=u("rgb(65,190,82)"),Qy=u("rgb(209,205,199)"),wh=Je(Gy),_h=Je(Zy),tb=Je(Yy),eb=Je(Xy),nb=Je(Vy),ib=Je(Ky),rb=Je(Jy),sb=[Qy];function Je(n){const t=n.toLch(),e=64,i=137.508;return Array.from({length:e},(r,s)=>{if(s===0)return n;const a=s*i%24-12,o=(t.h+a+360)%360,c=1+.1*Math.sin(s*.7),l=Math.max(10,Math.min(130,t.c*c)),h=18*Math.sin(s*i*(Math.PI/180)),d=Math.max(25,Math.min(80,t.l+h));return u({l:d,c:l,h:o})})}const Sh=[u("rgb(210,210,100)"),u("rgb(180,210,120)"),u("rgb(170,190,100)"),u("rgb(80,200,120)"),u("rgb(130,200,130)"),u("rgb(140,180,140)"),u("rgb(160,190,160)"),u("rgb(160,180,140)"),u("rgb(100,160,80)"),u("rgb(100,140,110)"),u("rgb(100,180,160)"),u("rgb(130,180,170)"),u("rgb(170,190,180)"),u("rgb(100,130,150)"),u("rgb(120,160,200)"),u("rgb(140,150,180)"),u("rgb(100,210,210)"),u("rgb(140,180,220)"),u("rgb(130,170,190)"),u("rgb(100,180,230)"),u("rgb(80,130,190)"),u("rgb(120,120,190)"),u("rgb(150,110,190)"),u("rgb(160,120,160)"),u("rgb(170,140,190)"),u("rgb(180,130,180)"),u("rgb(190,140,150)"),u("rgb(180,100,230)"),u("rgb(180,160,180)"),u("rgb(170,150,170)"),u("rgb(150,130,150)"),u("rgb(230,180,180)"),u("rgb(210,160,200)"),u("rgb(230,130,180)"),u("rgb(210,100,160)"),u("rgb(190,100,130)"),u("rgb(220,120,120)"),u("rgb(200,130,110)"),u("rgb(230,140,140)"),u("rgb(230,100,100)"),u("rgb(230,150,100)"),u("rgb(210,140,80)"),u("rgb(230,180,80)"),u("rgb(200,160,110)"),u("rgb(190,150,130)"),u("rgb(190,180,160)"),u("rgb(180,170,140)"),u("rgb(200,200,140)"),u("rgb(190,170,100)")],Th=[u("rgb(163,230,53)"),u("rgb(132,204,22)"),u("rgb(16,185,129)"),u("rgb(52,211,153)"),u("rgb(45,212,191)"),u("rgb(74,222,128)"),u("rgb(110,231,183)"),u("rgb(134,239,172)"),u("rgb(151,255,187)"),u("rgb(186,255,201)"),u("rgb(230,250,210)"),u("rgb(34,197,94)"),u("rgb(67,190,84)"),u("rgb(82,183,136)"),u("rgb(48,178,180)"),u("rgb(230,255,250)"),u("rgb(220,240,250)"),u("rgb(233,213,255)"),u("rgb(204,204,255)"),u("rgb(220,220,255)"),u("rgb(202,225,255)"),u("rgb(147,197,253)"),u("rgb(125,211,252)"),u("rgb(99,202,253)"),u("rgb(56,189,248)"),u("rgb(96,165,250)"),u("rgb(59,130,246)"),u("rgb(79,70,229)"),u("rgb(124,58,237)"),u("rgb(147,51,234)"),u("rgb(179,136,255)"),u("rgb(167,139,250)"),u("rgb(217,70,239)"),u("rgb(168,85,247)"),u("rgb(190,92,251)"),u("rgb(192,132,252)"),u("rgb(240,171,252)"),u("rgb(244,114,182)"),u("rgb(236,72,153)"),u("rgb(220,38,38)"),u("rgb(239,68,68)"),u("rgb(235,75,75)"),u("rgb(245,101,101)"),u("rgb(248,113,113)"),u("rgb(251,113,133)"),u("rgb(253,164,175)"),u("rgb(252,165,165)"),u("rgb(255,204,229)"),u("rgb(250,215,225)"),u("rgb(251,235,245)"),u("rgb(240,240,200)"),u("rgb(250,250,210)"),u("rgb(255,240,200)"),u("rgb(255,223,186)"),u("rgb(252,211,77)"),u("rgb(251,191,36)"),u("rgb(234,179,8)"),u("rgb(202,138,4)"),u("rgb(245,158,11)"),u("rgb(251,146,60)"),u("rgb(249,115,22)"),u("rgb(234,88,12)"),u("rgb(133,77,14)")],vh=[u("rgb(150,160,140)"),u("rgb(160,160,150)"),u("rgb(170,170,140)"),u("rgb(170,170,120)"),u("rgb(150,160,120)"),u("rgb(150,170,130)"),u("rgb(150,170,150)"),u("rgb(130,170,130)"),u("rgb(140,160,140)"),u("rgb(120,150,100)"),u("rgb(120,140,120)"),u("rgb(100,170,130)"),u("rgb(120,160,150)"),u("rgb(130,160,150)"),u("rgb(120,170,170)"),u("rgb(120,160,190)"),u("rgb(130,150,170)"),u("rgb(130,150,160)"),u("rgb(140,150,160)"),u("rgb(140,160,170)"),u("rgb(150,160,160)"),u("rgb(100,120,160)"),u("rgb(120,130,140)"),u("rgb(130,130,160)"),u("rgb(140,130,140)"),u("rgb(140,120,160)"),u("rgb(150,130,150)"),u("rgb(150,140,160)"),u("rgb(160,130,160)"),u("rgb(170,150,170)"),u("rgb(160,120,190)"),u("rgb(160,120,130)"),u("rgb(170,120,140)"),u("rgb(170,130,120)"),u("rgb(170,130,130)"),u("rgb(180,140,140)"),u("rgb(190,130,160)"),u("rgb(190,120,120)"),u("rgb(190,140,120)"),u("rgb(190,160,100)"),u("rgb(170,140,100)"),u("rgb(160,140,130)"),u("rgb(170,150,130)"),u("rgb(160,150,120)"),u("rgb(160,150,140)"),u("rgb(160,140,150)"),u("rgb(160,150,160)"),u("rgb(150,140,150)"),u("rgb(180,160,160)")],Ah=[u("rgb(35,0,0)"),u("rgb(45,0,0)"),u("rgb(55,0,0)"),u("rgb(65,0,0)"),u("rgb(75,0,0)"),u("rgb(85,0,0)"),u("rgb(95,0,0)"),u("rgb(105,0,0)"),u("rgb(115,0,0)"),u("rgb(125,0,0)"),u("rgb(135,0,0)"),u("rgb(145,0,0)"),u("rgb(155,0,0)"),u("rgb(165,0,0)"),u("rgb(175,0,0)"),u("rgb(185,0,0)"),u("rgb(195,0,5)"),u("rgb(205,0,10)"),u("rgb(215,0,15)"),u("rgb(225,0,20)"),u("rgb(235,0,25)"),u("rgb(245,0,30)"),u("rgb(255,0,35)"),u("rgb(255,10,45)"),u("rgb(255,20,55)"),u("rgb(255,30,65)"),u("rgb(255,40,75)"),u("rgb(255,50,85)"),u("rgb(255,60,95)"),u("rgb(255,70,105)"),u("rgb(255,80,115)"),u("rgb(255,90,125)"),u("rgb(255,100,135)"),u("rgb(255,110,145)"),u("rgb(255,120,155)"),u("rgb(255,130,165)"),u("rgb(255,140,175)"),u("rgb(255,150,185)"),u("rgb(255,160,195)"),u("rgb(255,170,205)"),u("rgb(255,180,215)"),u("rgb(255,190,225)"),u("rgb(255,200,235)"),u("rgb(0,45,0)"),u("rgb(0,55,0)"),u("rgb(0,65,0)"),u("rgb(0,75,0)"),u("rgb(0,85,0)"),u("rgb(0,95,0)"),u("rgb(0,105,0)"),u("rgb(0,115,0)"),u("rgb(0,125,0)"),u("rgb(0,135,0)"),u("rgb(0,145,0)"),u("rgb(0,155,0)"),u("rgb(0,165,0)"),u("rgb(0,175,0)"),u("rgb(0,185,0)"),u("rgb(0,195,5)"),u("rgb(0,205,10)"),u("rgb(0,215,15)"),u("rgb(0,225,20)"),u("rgb(0,235,25)"),u("rgb(0,245,30)"),u("rgb(0,255,35)"),u("rgb(10,255,45)"),u("rgb(20,255,55)"),u("rgb(30,255,65)"),u("rgb(40,255,75)"),u("rgb(50,255,85)"),u("rgb(60,255,95)"),u("rgb(70,255,105)"),u("rgb(80,255,115)"),u("rgb(90,255,125)"),u("rgb(100,255,135)"),u("rgb(110,255,145)"),u("rgb(120,255,155)"),u("rgb(130,255,165)"),u("rgb(140,255,175)"),u("rgb(150,255,185)"),u("rgb(160,255,195)"),u("rgb(170,255,205)"),u("rgb(180,255,215)"),u("rgb(190,255,225)"),u("rgb(200,255,235)"),u("rgb(0,0,35)"),u("rgb(0,0,45)"),u("rgb(0,0,55)"),u("rgb(0,0,65)"),u("rgb(0,0,75)"),u("rgb(0,0,85)"),u("rgb(0,0,95)"),u("rgb(0,0,105)"),u("rgb(0,0,115)"),u("rgb(0,0,125)"),u("rgb(0,0,135)"),u("rgb(0,0,145)"),u("rgb(0,0,155)"),u("rgb(0,0,165)"),u("rgb(0,0,175)"),u("rgb(0,0,185)"),u("rgb(5,0,195)"),u("rgb(10,0,205)"),u("rgb(15,0,215)"),u("rgb(20,0,225)"),u("rgb(25,0,235)"),u("rgb(30,0,245)"),u("rgb(35,0,255)"),u("rgb(45,10,255)"),u("rgb(55,20,255)"),u("rgb(65,30,255)"),u("rgb(75,40,255)"),u("rgb(85,50,255)"),u("rgb(95,60,255)"),u("rgb(105,70,255)"),u("rgb(115,80,255)"),u("rgb(125,90,255)"),u("rgb(135,100,255)"),u("rgb(145,110,255)"),u("rgb(155,120,255)"),u("rgb(165,130,255)"),u("rgb(175,140,255)"),u("rgb(185,150,255)"),u("rgb(195,160,255)"),u("rgb(205,170,255)"),u("rgb(215,180,255)"),u("rgb(225,190,255)"),u("rgb(235,200,255)"),u("rgb(35,0,35)"),u("rgb(45,0,45)"),u("rgb(55,0,55)"),u("rgb(65,0,65)"),u("rgb(75,0,75)"),u("rgb(85,0,85)"),u("rgb(95,0,95)"),u("rgb(105,0,105)"),u("rgb(115,0,115)"),u("rgb(125,0,125)"),u("rgb(135,0,135)"),u("rgb(145,0,145)"),u("rgb(155,0,155)"),u("rgb(165,0,165)"),u("rgb(175,0,175)"),u("rgb(185,0,185)"),u("rgb(195,5,195)"),u("rgb(205,10,205)"),u("rgb(215,15,215)"),u("rgb(225,20,225)"),u("rgb(235,25,235)"),u("rgb(245,30,245)"),u("rgb(255,35,255)"),u("rgb(255,45,255)"),u("rgb(255,55,255)"),u("rgb(255,65,255)"),u("rgb(255,75,255)"),u("rgb(255,85,255)"),u("rgb(255,95,255)"),u("rgb(255,105,255)"),u("rgb(255,115,255)"),u("rgb(255,125,255)"),u("rgb(255,135,255)"),u("rgb(255,145,255)"),u("rgb(255,155,255)"),u("rgb(255,165,255)"),u("rgb(255,175,255)"),u("rgb(255,185,255)"),u("rgb(255,195,255)"),u("rgb(255,205,255)"),u("rgb(255,215,255)"),u("rgb(0,35,35)"),u("rgb(0,45,45)"),u("rgb(0,55,55)"),u("rgb(0,65,65)"),u("rgb(0,75,75)"),u("rgb(0,85,85)"),u("rgb(0,95,95)"),u("rgb(0,105,105)"),u("rgb(0,115,115)"),u("rgb(0,125,125)"),u("rgb(0,135,135)"),u("rgb(0,145,145)"),u("rgb(0,155,155)"),u("rgb(0,165,165)"),u("rgb(0,175,175)"),u("rgb(0,185,185)"),u("rgb(5,195,195)"),u("rgb(10,205,205)"),u("rgb(15,215,215)"),u("rgb(20,225,225)"),u("rgb(25,235,235)"),u("rgb(30,245,245)"),u("rgb(35,255,255)"),u("rgb(45,255,255)"),u("rgb(55,255,255)"),u("rgb(65,255,255)"),u("rgb(75,255,255)"),u("rgb(85,255,255)"),u("rgb(95,255,255)"),u("rgb(105,255,255)"),u("rgb(115,255,255)"),u("rgb(125,255,255)"),u("rgb(135,255,255)"),u("rgb(145,255,255)"),u("rgb(155,255,255)"),u("rgb(165,255,255)"),u("rgb(175,255,255)"),u("rgb(185,255,255)"),u("rgb(195,255,255)"),u("rgb(205,255,255)"),u("rgb(215,255,255)"),u("rgb(35,35,0)"),u("rgb(45,45,0)"),u("rgb(55,55,0)"),u("rgb(65,65,0)"),u("rgb(75,75,0)"),u("rgb(85,85,0)"),u("rgb(95,95,0)"),u("rgb(105,105,0)"),u("rgb(115,115,0)"),u("rgb(125,125,0)"),u("rgb(135,135,0)"),u("rgb(145,145,0)"),u("rgb(155,155,0)"),u("rgb(165,165,0)"),u("rgb(175,175,0)"),u("rgb(185,185,0)"),u("rgb(195,195,5)"),u("rgb(205,205,10)"),u("rgb(215,215,15)"),u("rgb(225,225,20)"),u("rgb(235,235,25)"),u("rgb(245,245,30)"),u("rgb(255,255,35)"),u("rgb(255,255,45)"),u("rgb(255,255,55)"),u("rgb(255,255,65)"),u("rgb(255,255,75)"),u("rgb(255,255,85)"),u("rgb(255,255,95)"),u("rgb(255,255,105)"),u("rgb(255,255,115)"),u("rgb(255,255,125)"),u("rgb(255,255,135)"),u("rgb(255,255,145)"),u("rgb(255,255,155)"),u("rgb(255,255,165)"),u("rgb(255,255,175)"),u("rgb(255,255,185)"),u("rgb(255,255,195)"),u("rgb(255,255,205)"),u("rgb(255,255,215)"),u("rgb(215,255,200)"),u("rgb(225,255,175)"),u("rgb(240,250,160)"),u("rgb(245,245,175)"),u("rgb(150,200,255)"),u("rgb(160,215,255)"),u("rgb(170,225,255)"),u("rgb(180,235,250)"),u("rgb(190,245,240)"),u("rgb(210,255,245)"),u("rgb(220,255,255)"),u("rgb(230,250,255)"),u("rgb(240,240,255)"),u("rgb(250,230,255)"),u("rgb(170,190,255)"),u("rgb(180,180,255)"),u("rgb(200,170,255)"),u("rgb(190,140,195)"),u("rgb(195,145,200)"),u("rgb(200,150,205)"),u("rgb(205,155,210)"),u("rgb(210,160,215)"),u("rgb(215,165,220)"),u("rgb(220,170,225)"),u("rgb(225,175,230)"),u("rgb(230,180,235)"),u("rgb(235,185,240)"),u("rgb(240,190,245)"),u("rgb(245,195,250)"),u("rgb(250,200,255)"),u("rgb(255,205,255)"),u("rgb(255,210,255)"),u("rgb(255,210,250)"),u("rgb(255,205,245)"),u("rgb(255,215,245)"),u("rgb(220,160,255)"),u("rgb(235,150,255)"),u("rgb(245,160,240)"),u("rgb(255,170,225)"),u("rgb(255,185,215)"),u("rgb(255,195,235)"),u("rgb(255,200,220)"),u("rgb(255,210,230)"),u("rgb(255,220,235)"),u("rgb(255,220,250)"),u("rgb(255,225,255)"),u("rgb(255,230,245)"),u("rgb(255,235,235)"),u("rgb(255,215,195)"),u("rgb(255,225,180)"),u("rgb(255,230,190)"),u("rgb(255,235,200)"),u("rgb(255,245,210)"),u("rgb(255,240,220)")];Ki([zc]),Ki([Nc]);class Tr{constructor(t,e){this.assigned=new Map,this.teamPlayerColors=new Map,this.availableColors=[...t],this.fallbackColors=[...t,...e]}getTeamColorVariations(t){switch(t){case ft.Blue:return _h;case ft.Red:return wh;case ft.Teal:return tb;case ft.Purple:return eb;case ft.Yellow:return nb;case ft.Orange:return ib;case ft.Green:return rb;case ft.Bot:return sb;case ft.Humans:return _h;case ft.Nations:return wh;default:return[this.assignColor(t)]}}assignColor(t){if(this.assigned.has(t))return this.assigned.get(t);this.availableColors.length===0&&(this.availableColors=[...this.fallbackColors]);let e=0;if(this.assigned.size===0||this.assigned.size>50)e=new gt(It(t)).nextInt(0,this.availableColors.length);else{const r=Array.from(this.assigned.values());e=ab(this.availableColors,r)??0}const i=this.availableColors.splice(e,1)[0];return this.assigned.set(t,i),i}assignTeamColor(t){const i=this.getTeamColorVariations(t)[0].toRgb();return i.r=Math.round(i.r),i.g=Math.round(i.g),i.b=Math.round(i.b),u(i)}assignTeamPlayerColor(t,e){if(this.teamPlayerColors.has(e))return this.teamPlayerColors.get(e);const i=this.getTeamColorVariations(t),s=It(e)%i.length,a=i[s];return this.teamPlayerColors.set(e,a),a}}function ab(n,t){if(t.length===0)throw new Error("No assigned colors");const e=t.map(Eh);let i=0,r=0;for(let s=0;s<n.length;s++){const a=n[s],o=ob(Eh(a),e);o>i&&(i=o,r=s)}return r}function ob(n,t){return t.reduce((e,i)=>Math.min(e,cb(n,i)),1/0)}function cb(n,t){return n.deltaE(t,"2000")}function Eh(n){const t=n.toLab();return new lt("lab",[t.l,t.a,t.b])}class kh{constructor(){this.rand=new gt(123),this.humanColorAllocator=new Tr(Th,Ah),this.botColorAllocator=new Tr(vh,vh),this.teamColorAllocator=new Tr(Th,Ah),this.nationColorAllocator=new Tr(Sh,Sh),this.background=u("rgb(60,60,60)"),this.shore=u("rgb(204,203,158)"),this.falloutColors=[u("rgb(120,255,71)"),u("rgb(130,255,85)"),u("rgb(110,245,65)"),u("rgb(125,255,75)"),u("rgb(115,250,68)")],this.water=u("rgb(70,132,180)"),this.shorelineWater=u("rgb(100,143,255)"),this._selfColor=u("rgb(0,255,0)"),this._allyColor=u("rgb(255,255,0)"),this._neutralColor=u("rgb(128,128,128)"),this._enemyColor=u("rgb(255,0,0)"),this._spawnHighlightColor=u("rgb(255,213,79)"),this._spawnHighlightSelfColor=u("rgb(255,255,255)"),this._spawnHighlightTeamColor=u("rgb(0,255,0)"),this._spawnHighlightEnemyColor=u("rgb(255,0,0)")}teamColor(t){return this.teamColorAllocator.assignTeamColor(t)}territoryColor(t){const e=t.team();return e!==null?this.teamColorAllocator.assignTeamPlayerColor(e,t.id()):t.type()===P.Human?this.humanColorAllocator.assignColor(t.id()):t.type()===P.Bot?this.botColorAllocator.assignColor(t.id()):this.nationColorAllocator.assignColor(t.id())}structureColors(t){const e=t.alpha(.5882352941176471).toLab(),i=this.borderColor(t).toLab();let r=this.contrast(e,i);const s=10,a=50,o=.5;let c=0;const l=5;for(;r<o;){if(c>a){console.warn(`Infinite loop detected during structure color calculation. 
          Light color: ${u(e).toRgbString()}, 
          Dark color: ${u(i).toRgbString()}, 
          Contrast: ${r}`);break}else c>s?e.l=this.clamp(e.l+l):i.l=this.clamp(i.l-l);r=this.contrast(e,i),c++}return{light:u(e),dark:u(i)}}contrast(t,e){return u(t).delta(u(e))}clamp(t,e=0,i=100){return Math.min(Math.max(e,t),i)}borderColor(t){return t.darken(.125)}defendedBorderColors(t){return{light:t.darken(.2),dark:t.darken(.4)}}focusedBorderColor(){return u("rgb(230,230,230)")}textColor(t){return t.type()===P.Human?"#000000":"#4D4D4D"}terrainColor(t,e){const i=t.magnitude(e);if(t.isShore(e))return this.shore;switch(t.terrainType(e)){case _t.Ocean:case _t.Lake:{const r=this.water.rgba;return t.isShoreline(e)&&t.isWater(e)?this.shorelineWater:u({r:Math.max(r.r-10+(11-Math.min(i,10)),0),g:Math.max(r.g-10+(11-Math.min(i,10)),0),b:Math.max(r.b-10+(11-Math.min(i,10)),0)})}case _t.Plains:return u({r:190,g:220-2*i,b:138});case _t.Highland:return u({r:200+2*i,g:183+2*i,b:138+2*i});case _t.Mountain:return u({r:230+i/2,g:230+i/2,b:230+i/2})}}backgroundColor(){return this.background}falloutColor(){return this.rand.randElement(this.falloutColors)}font(){return"Overpass, sans-serif"}selfColor(){return this._selfColor}allyColor(){return this._allyColor}neutralColor(){return this._neutralColor}enemyColor(){return this._enemyColor}spawnHighlightColor(){return this._spawnHighlightColor}spawnHighlightSelfColor(){return this._spawnHighlightSelfColor}spawnHighlightTeamColor(){return this._spawnHighlightTeamColor}spawnHighlightEnemyColor(){return this._spawnHighlightEnemyColor}}class lb extends kh{constructor(){super(...arguments),this.darkShore=u("rgb(134,133,88)"),this.darkWater=u("rgb(14,11,30)"),this.darkShorelineWater=u("rgb(50,50,50)")}terrainColor(t,e){const i=t.magnitude(e);if(t.isShore(e))return this.darkShore;switch(t.terrainType(e)){case _t.Ocean:case _t.Lake:{const r=this.darkWater.rgba;return t.isShoreline(e)&&t.isWater(e)?this.darkShorelineWater:t.magnitude(e)<10?u({r:Math.max(r.r+9-i,0),g:Math.max(r.g+9-i,0),b:Math.max(r.b+9-i,0)}):this.darkWater}case _t.Plains:return u({r:140,g:170-2*i,b:88});case _t.Highland:return u({r:150+2*i,g:133+2*i,b:88+2*i});case _t.Mountain:return u({r:180+i/2,g:180+i/2,b:180+i/2})}}}const hb=15e4,ub=Math.LN2/5e4,db=B({keys:B({alg:$("EdDSA"),crv:$("Ed25519"),kty:$("OKP"),x:H()}).array().min(1)});class ca{turnstileSecretKey(){return ue.TURNSTILE_SECRET_KEY??""}allowedFlares(){}stripePublishableKey(){return ue.STRIPE_PUBLISHABLE_KEY??""}domain(){return ue.DOMAIN??""}subdomain(){return ue.SUBDOMAIN??""}jwtIssuer(){const t=this.jwtAudience();return t==="localhost"?"http://localhost:8787":`https://api.${t}`}async jwkPublicKey(){if(this.publicKey)return this.publicKey;const t=this.jwtIssuer()+"/.well-known/jwks.json";console.log(`Fetching JWKS from ${t}`);const e=await fetch(t),i=db.safeParse(await e.json());if(!i.success){const r=Af(i.error);throw console.error("Error parsing JWKS",r),new Error("Invalid JWKS")}return this.publicKey=i.data.keys[0],this.publicKey}otelEnabled(){return this.env()!==Re.Dev&&!!this.otelEndpoint()&&!!this.otelAuthHeader()}otelEndpoint(){return ue.OTEL_EXPORTER_OTLP_ENDPOINT??""}otelAuthHeader(){return ue.OTEL_AUTH_HEADER??""}gitCommit(){return ue.GIT_COMMIT??""}apiKey(){return ue.API_KEY??""}adminHeader(){return"x-admin-key"}adminToken(){const t=ue.ADMIN_TOKEN;if(!t)throw new Error("ADMIN_TOKEN not set");return t}turnIntervalMs(){return 100}gameCreationRate(){return 60*1e3}workerIndex(t){return It(t)%this.numWorkers()}workerPath(t){return`w${this.workerIndex(t)}`}workerPort(t){return this.workerPortByIndex(this.workerIndex(t))}workerPortByIndex(t){return 3001+t}}class Mh{constructor(t,e,i,r){this._serverConfig=t,this._gameConfig=e,this._userSettings=i,this._isReplay=r,this.pastelTheme=new kh,this.pastelThemeDark=new lb}stripePublishableKey(){return ue.STRIPE_PUBLISHABLE_KEY??""}isReplay(){return this._isReplay}traitorDefenseDebuff(){return .5}traitorSpeedDebuff(){return .8}traitorDuration(){return 300}spawnImmunityDuration(){return this._gameConfig.spawnImmunityDuration??50}gameConfig(){return this._gameConfig}serverConfig(){return this._serverConfig}userSettings(){if(this._userSettings===null)throw new Error("userSettings is null");return this._userSettings}cityTroopIncrease(){return 25e4}falloutDefenseModifier(t){return 5-t*2}SAMCooldown(){return 75}SiloCooldown(){return 75}defensePostRange(){return 30}defensePostDefenseBonus(){return 5}defensePostSpeedBonus(){return 3}playerTeams(){return this._gameConfig.playerTeams??0}spawnNations(){return!this._gameConfig.disableNations}isUnitDisabled(t){return this._gameConfig.disabledUnits?.includes(t)??!1}bots(){return this._gameConfig.bots}instantBuild(){return this._gameConfig.instantBuild}disableNavMesh(){return this._gameConfig.disableNavMesh??!1}isRandomSpawn(){return this._gameConfig.randomSpawn}infiniteGold(){return this._gameConfig.infiniteGold}donateGold(){return this._gameConfig.donateGold}infiniteTroops(){return this._gameConfig.infiniteTroops}donateTroops(){return this._gameConfig.donateTroops}goldMultiplier(){return this._gameConfig.goldMultiplier??1}startingGold(t){return t.playerType===P.Bot?0n:BigInt(this._gameConfig.startingGold??0)}trainSpawnRate(t){return(t+10)*18}trainGold(t){const e=this.goldMultiplier();let i;switch(t){case"ally":i=35000n;break;case"team":case"other":i=25000n;break;case"self":i=10000n;break}return BigInt(Math.floor(Number(i)*e))}trainStationMinRange(){return 15}trainStationMaxRange(){return 100}railroadMaxSize(){return 120}tradeShipGold(t,e){const i=this.tradeShipShortRangeDebuff(),r=1e5/(1+Math.exp(-.03*(t-i)))+100*t,s=e-1,a=1+2*(s/(s+5)),o=this.goldMultiplier();return BigInt(Math.floor(r*a*o))}tradeShipSpawnRate(t,e,i){const r=Math.sqrt(this.tradeShipBaseSpawn(t,i)*this.tradeShipPortMultiplier(e));return Math.floor(25/r)}tradeShipBaseSpawn(t,e){if(e<3)return 1;const i=Math.LN2/10;return 1-uo(t,i,55)}tradeShipPortMultiplier(t){return 1/(1+.1*t)}unitInfo(t){switch(t){case m.TransportShip:return{cost:()=>0n,territoryBound:!1};case m.Warship:return{cost:this.costWrapper(e=>Math.min(1e6,(e+1)*25e4),m.Warship),territoryBound:!1,maxHealth:1e3};case m.Shell:return{cost:()=>0n,territoryBound:!1,damage:250};case m.SAMMissile:return{cost:()=>0n,territoryBound:!1};case m.Port:return{cost:this.costWrapper(e=>Math.min(1e6,Math.pow(2,e)*125e3),m.Port,m.Factory),territoryBound:!0,constructionDuration:this.instantBuild()?0:20,upgradable:!0,canBuildTrainStation:!0};case m.AtomBomb:return{cost:this.costWrapper(()=>75e4,m.AtomBomb),territoryBound:!1};case m.HydrogenBomb:return{cost:this.costWrapper(()=>5e6,m.HydrogenBomb),territoryBound:!1};case m.MIRV:return{cost:(e,i)=>i.type()===P.Human&&this.infiniteGold()?0n:25000000n+e.stats().numMirvsLaunched()*15000000n,territoryBound:!1};case m.MIRVWarhead:return{cost:()=>0n,territoryBound:!1};case m.TradeShip:return{cost:()=>0n,territoryBound:!1};case m.MissileSilo:return{cost:this.costWrapper(()=>1e6,m.MissileSilo),territoryBound:!0,constructionDuration:this.instantBuild()?0:100,upgradable:!0};case m.DefensePost:return{cost:this.costWrapper(e=>Math.min(25e4,(e+1)*5e4),m.DefensePost),territoryBound:!0,constructionDuration:this.instantBuild()?0:50};case m.SAMLauncher:return{cost:this.costWrapper(e=>Math.min(3e6,(e+1)*15e5),m.SAMLauncher),territoryBound:!0,constructionDuration:this.instantBuild()?0:300,upgradable:!0};case m.City:return{cost:this.costWrapper(e=>Math.min(1e6,Math.pow(2,e)*125e3),m.City),territoryBound:!0,constructionDuration:this.instantBuild()?0:20,upgradable:!0,canBuildTrainStation:!0};case m.Factory:return{cost:this.costWrapper(e=>Math.min(1e6,Math.pow(2,e)*125e3),m.Factory,m.Port),territoryBound:!0,constructionDuration:this.instantBuild()?0:20,canBuildTrainStation:!0,experimental:!0,upgradable:!0};case m.Train:return{cost:()=>0n,territoryBound:!1,experimental:!0};default:dt(t)}}costWrapper(t,...e){return(i,r)=>{if(r.type()===P.Human&&this.infiniteGold())return 0n;const s=e.reduce((a,o)=>a+Math.min(r.unitsOwned(o),r.unitsConstructed(o)),0);return BigInt(t(s))}}defaultDonationAmount(t){return Math.floor(t.troops()/3)}donateCooldown(){return 100}embargoAllCooldown(){return 100}deletionMarkDuration(){return 300}deleteUnitCooldown(){return 300}emojiMessageDuration(){return 50}emojiMessageCooldown(){return 50}targetDuration(){return 100}targetCooldown(){return 150}allianceRequestDuration(){return 200}allianceRequestCooldown(){return 300}allianceDuration(){return 300*10}temporaryEmbargoDuration(){return 300*10}minDistanceBetweenPlayers(){return 30}percentageTilesOwnedToWin(){return this._gameConfig.gameMode===Ct.Team?95:80}boatMaxNumber(){return 3}numSpawnPhaseTurns(){return this._gameConfig.gameType===Ln.Singleplayer?100:300}numBots(){return this.bots()}theme(){return this.userSettings()?.darkMode()?this.pastelThemeDark:this.pastelTheme}attackLogic(t,e,i,r,s){let a=0,o=0;const c=t.terrainType(s);switch(c){case _t.Plains:a=80,o=16.5;break;case _t.Highland:a=100,o=20;break;case _t.Mountain:a=120,o=25;break;default:throw new Error(`terrain type ${c} not supported`)}if(r.isPlayer()){for(const l of t.nearbyUnits(s,t.config().defensePostRange(),m.DefensePost))if(l.unit.owner()===r){a*=this.defensePostDefenseBonus(),o*=this.defensePostSpeedBonus();break}}if(t.hasFallout(s)){const l=t.numTilesWithFallout()/t.numLandTiles();a*=this.falloutDefenseModifier(l),o*=this.falloutDefenseModifier(l)}if(i.isPlayer()&&r.isPlayer()&&(r.isDisconnected()&&i.isOnSameTeam(r)&&(a=0),i.type()===P.Human&&r.type()===P.Bot&&(a*=.8),i.type()===P.Nation&&r.type()===P.Bot&&(a*=.8)),r.isPlayer()){const l=1-uo(r.numTilesOwned(),ub,hb),h=.7+.3*l,d=.7+.3*l;let f=1;i.numTilesOwned()>1e5&&(f=Math.sqrt(1e5/i.numTilesOwned())**.7);let g=1;return i.numTilesOwned()>1e5&&(g=(1e5/i.numTilesOwned())**.6),{attackerTroopLoss:Pe(r.troops()/e,.6,2)*a*.8*d*f*(r.isTraitor()?this.traitorDefenseDebuff():1),defenderTroopLoss:r.troops()/r.numTilesOwned(),tilesPerTickUsed:Pe(r.troops()/(5*e),.2,1.5)*o*h*g*(r.isTraitor()?this.traitorSpeedDebuff():1)}}else return{attackerTroopLoss:i.type()===P.Bot?a/10:a/5,defenderTroopLoss:0,tilesPerTickUsed:Pe(2e3*Math.max(10,o)/e,5,100)}}attackTilesPerTick(t,e,i,r){return i.isPlayer()?Pe(5*t/i.troops()*2,.01,.5)*r*3:r*2}boatAttackAmount(t,e){return Math.floor(t.troops()/5)}warshipShellLifetime(){return 20}radiusPortSpawn(){return 20}tradeShipShortRangeDebuff(){return 300}proximityBonusPortsNb(t){return Pe(t/3,4,t)}attackAmount(t,e){return t.type()===P.Bot?t.troops()/20:t.troops()/5}startManpower(t){if(t.playerType===P.Bot)return 1e4;if(t.playerType===P.Nation)switch(this._gameConfig.difficulty){case _.Easy:return 12500;case _.Medium:return 25e3;case _.Hard:return 28125;case _.Impossible:return 31250;default:dt(this._gameConfig.difficulty)}return this.infiniteTroops()?1e6:25e3}maxTroops(t){const e=t.type()===P.Human&&this.infiniteTroops()?1e9:2*(Math.pow(t.numTilesOwned(),.6)*1e3+5e4)+t.units(m.City).map(i=>i.level()).reduce((i,r)=>i+r,0)*this.cityTroopIncrease();if(t.type()===P.Bot)return e/3;if(t.type()===P.Human)return e;switch(this._gameConfig.difficulty){case _.Easy:return e*.5;case _.Medium:return e*1;case _.Hard:return e*1.125;case _.Impossible:return e*1.25;default:dt(this._gameConfig.difficulty)}}troopIncreaseRate(t){const e=this.maxTroops(t);let i=10+Math.pow(t.troops(),.73)/4;const r=1-t.troops()/e;if(i*=r,t.type()===P.Bot&&(i*=.6),t.type()===P.Nation)switch(this._gameConfig.difficulty){case _.Easy:i*=.9;break;case _.Medium:i*=1;break;case _.Hard:i*=1.025;break;case _.Impossible:i*=1.05;break;default:dt(this._gameConfig.difficulty)}return Math.min(t.troops()+i,e)-t.troops()}goldAdditionRate(t){const e=this.goldMultiplier();let i;return t.type()===P.Bot?i=50n:i=100n,BigInt(Math.floor(Number(i)*e))}nukeMagnitudes(t){switch(t){case m.MIRVWarhead:return{inner:12,outer:18};case m.AtomBomb:return{inner:12,outer:30};case m.HydrogenBomb:return{inner:80,outer:100}}throw new Error(`Unknown nuke type: ${t}`)}nukeAllianceBreakThreshold(){return 100}defaultNukeSpeed(){return 6}defaultNukeTargetableRange(){return 150}defaultSamRange(){return 70}samRange(t){return this.maxSamRange()-480/(t+5)}maxSamRange(){return 150}defaultSamMissileSpeed(){return 12}nukeDeathFactor(t,e,i,r){if(t!==m.MIRVWarhead)return 5*e/Math.max(1,i);const s=.03*r,a=Math.max(0,e-s),o=500,c=a/r;return o*(1-Math.exp(-2*c))}structureMinDist(){return 15}shellLifetime(){return 50}warshipPatrolRange(){return 100}warshipTargettingRange(){return 130}warshipShellAttackRate(){return 20}defensePostShellAttackRate(){return 100}safeFromPiratesCooldownMax(){return 20}defensePostTargettingRange(){return 75}allianceExtensionPromptOffset(){return 300}}class fb extends ca{turnstileSiteKey(){return"1x00000000000000000000AA"}turnstileSecretKey(){return"1x0000000000000000000000000000000AA"}adminToken(){return"WARNING_DEV_ADMIN_KEY_DO_NOT_USE_IN_PRODUCTION"}apiKey(){return"WARNING_DEV_API_KEY_DO_NOT_USE_IN_PRODUCTION"}env(){return Re.Dev}gameCreationRate(){return 5*1e3}numWorkers(){return 2}jwtAudience(){return"localhost"}gitCommit(){return"DEV"}domain(){return"localhost"}subdomain(){return""}}class mb extends Mh{constructor(t,e,i,r){super(t,e,i,r)}}const gb=new class extends ca{env(){return Re.Preprod}numWorkers(){return 2}turnstileSiteKey(){return"0x4AAAAAAB7QetxHwRCKw-aP"}jwtAudience(){return"openfront.dev"}allowedFlares(){}},pb=new class extends ca{numWorkers(){return 20}env(){return Re.Prod}jwtAudience(){return"openfront.io"}turnstileSiteKey(){return"0x4AAAAAACFLkaecN39lS8sk"}};let vr=null;async function yb(n,t,e=!1){const i=await bb();switch(i.env()){case Re.Dev:return new mb(i,n,t,e);case Re.Preprod:case Re.Prod:return console.log("using prod config"),new Mh(i,n,t,e);default:throw Error(`unsupported server configuration: ${ue.GAME_ENV}`)}}async function bb(){if(vr)return vr;const n=await fetch("/api/env");if(!n.ok)throw new Error(`Failed to fetch server config: ${n.status} ${n.statusText}`);const t=await n.json();return console.log("Server config loaded:",t),vr=wb(t.game_env),vr}function wb(n){switch(n){case"dev":return console.log("using dev server config"),new fb;case"staging":return console.log("using preprod server config"),gb;case"prod":return console.log("using prod server config"),pb;default:throw Error(`unsupported server configuration: ${n}`)}}class la{constructor(t,e){this.from=t,this.toID=e}init(t,e){if(!t.hasPlayer(this.toID)){console.warn(`[AllianceExtensionExecution] Player ${this.toID} not found`);return}const i=t.player(this.toID);if(!this.from.isAlive()||!i.isAlive()){console.info(`[AllianceExtensionExecution] Player ${this.from.id()} or ${this.toID} is not alive`);return}const r=this.from.allianceWith(i);if(!r){console.warn(`[AllianceExtensionExecution] No alliance to extend between ${this.from.id()} and ${this.toID}`);return}const s=r.onlyOneAgreedToExtend();r.addExtensionRequest(this.from),r.bothAgreedToExtend()?(r.extend(),t.displayMessage("events_display.alliance_renewed",at.ALLIANCE_ACCEPTED,this.from.id(),void 0,{name:i.displayName()}),t.displayMessage("events_display.alliance_renewed",at.ALLIANCE_ACCEPTED,this.toID,void 0,{name:this.from.displayName()})):r.onlyOneAgreedToExtend()&&!s&&t.displayMessage("events_display.wants_to_renew_alliance",at.RENEW_ALLIANCE,this.toID,void 0,{name:this.from.displayName()})}tick(t){}isActive(){return!1}activeDuringSpawnPhase(){return!1}}class Ih{constructor(t,e){this.requestor=t,this.recipientID=e,this.req=null,this.active=!0}init(t,e){if(this.mg=t,!t.hasPlayer(this.recipientID)){console.warn(`AllianceRequestExecution recipient ${this.recipientID} not found`);return}const i=t.player(this.recipientID);if(!this.requestor.canSendAllianceRequest(i))console.warn("cannot send alliance request"),this.active=!1;else{const r=i.outgoingAllianceRequests().find(s=>s.recipient()===this.requestor);r?(this.active=!1,r.accept()):this.req=this.requestor.createAllianceRequest(i)}}tick(t){if(this.req?.status()==="accepted"||this.req?.status()==="rejected"){this.active=!1;return}this.mg.ticks()-(this.req?.createdAt()??0)>this.mg.config().allianceRequestDuration()&&(this.req?.reject(),this.active=!1)}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class _b{constructor(t,e,i){this.requestorID=t,this.recipient=e,this.accept=i,this.active=!0,this.requestor=null}cancelNukesBetweenAlliedPlayers(t,e,i){const r=new Map,s=[e,i];for(const a of s)for(const o of a.units(m.AtomBomb,m.HydrogenBomb)){if(!o.isActive()||o.reachedTarget())continue;const c=o.targetTile();if(!c)continue;const l=t.owner(c);!l.isPlayer()||l!==(a===e?i:e)||(o.delete(!1),r.set(a,(r.get(a)??0)+1))}for(const[a,o]of r){const c=a===e?i:e;t.displayMessage("events_display.alliance_nukes_destroyed_outgoing",at.ALLIANCE_ACCEPTED,a.id(),void 0,{name:c.displayName(),count:o}),t.displayMessage("events_display.alliance_nukes_destroyed_incoming",at.ALLIANCE_ACCEPTED,c.id(),void 0,{name:a.displayName(),count:o})}}init(t,e){if(!t.hasPlayer(this.requestorID)){console.warn(`AllianceRequestReplyExecution requester ${this.requestorID} not found`),this.active=!1;return}if(this.requestor=t.player(this.requestorID),this.requestor.isFriendly(this.recipient))console.warn("already allied");else{const i=this.requestor.outgoingAllianceRequests().find(r=>r.recipient()===this.recipient);i===void 0?console.warn("no alliance request found"):this.accept?(i.accept(),this.requestor.updateRelation(this.recipient,100),this.recipient.updateRelation(this.requestor,100),this.cancelNukesBetweenAlliedPlayers(t,this.requestor,this.recipient)):i.reject()}this.active=!1}tick(t){}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class Sb{constructor(t,e){this.requestor=t,this.recipientID=e,this.active=!0,this.recipient=null,this.mg=null}init(t,e){if(!t.hasPlayer(this.recipientID)){console.warn(`BreakAllianceExecution: recipient ${this.recipientID} not found`),this.active=!1;return}this.recipient=t.player(this.recipientID),this.mg=t}tick(t){if(this.mg===null||this.requestor===null||this.recipient===null)throw new Error("Not initialized");const e=this.requestor.allianceWith(this.recipient);if(e===null)console.warn("cant break alliance, not allied");else{this.requestor.breakAlliance(e),this.recipient.updateRelation(this.requestor,-100);const i=this.requestor.neighbors().filter(r=>r.isPlayer()&&!r.isOnSameTeam(this.recipient));for(const r of i)r.updateRelation(this.requestor,-40)}this.active=!1}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}function si(n){return Qe(n/10)}function Qe(n,t){return n=Number(n),n=Math.max(n,0),n>=1e7?(Math.floor(n/1e5)/10).toFixed(1)+"M":n>=1e6?(Math.floor(n/1e4)/100).toFixed(2)+"M":n>=1e5?Math.floor(n/1e3)+"K":n>=1e4?(Math.floor(n/100)/10).toFixed(1)+"K":n>=1e3?(Math.floor(n/10)/100).toFixed(2)+"K":Math.floor(n).toString()}class Tb{constructor(t=1024){this.len=0,this.pri=new Float32Array(t),this.tiles=new Array(t)}clear(){this.len=0}size(){return this.len}enqueue(t,e){this.len===this.pri.length&&this.grow();let i=this.len++;for(;i>0;){const r=i-1>>1;if(e>=this.pri[r])break;this.pri[i]=this.pri[r],this.tiles[i]=this.tiles[r],i=r}this.pri[i]=e,this.tiles[i]=t}dequeue(){if(this.len===0)throw new Error("heap empty");const t=this.tiles[0],e=this.pri[0],i=this.pri[--this.len],r=this.tiles[this.len];let s=0;for(;;){const a=(s<<1)+1;if(a>=this.len)break;const o=a+1,c=o<this.len&&this.pri[o]<this.pri[a]?o:a;if(i<=this.pri[c])break;this.pri[s]=this.pri[c],this.tiles[s]=this.tiles[c],s=c}return this.pri[s]=i,this.tiles[s]=r,[t,e]}grow(){const t=this.pri.length<<1,e=new Float32Array(t);e.set(this.pri),this.pri=e,this.tiles.length=t}}const vb=25;class Ar{constructor(t=null,e,i,r=null,s=!0){this.startTroops=t,this._owner=e,this._targetID=i,this.sourceTile=r,this.removeTroops=s,this.active=!0,this.toConquer=new Tb,this.random=new gt(123),this.attack=null}targetID(){return this._targetID}activeDuringSpawnPhase(){return!1}init(t,e){if(this.active){if(this.mg=t,this._targetID!==null&&!t.hasPlayer(this._targetID)){console.warn(`target ${this._targetID} not found`),this.active=!1;return}if(this.target=this._targetID===this.mg.terraNullius().id()?t.terraNullius():t.player(this._targetID),this._owner===this.target){console.error(`Player ${this._owner} cannot attack itself`),this.active=!1;return}if(this.target.isPlayer()){const i=this.target;if(this._owner.isFriendly(i)){console.warn(`${this._owner.displayName()} cannot attack ${i.displayName()} because they are friendly (allied or same team)`),this.active=!1;return}}if(this.target&&this.target.isPlayer()){const i=this.target;i.type()!==P.Bot&&this._owner.type()!==P.Bot&&(i.addEmbargo(this._owner,!0),this.rejectIncomingAllianceRequests(i))}if(this.target.isPlayer()&&!this._owner.canAttackPlayer(this.target)){this.active=!1;return}this.startTroops??=this.mg.config().attackAmount(this._owner,this.target),this.removeTroops&&(this.startTroops=Math.min(this._owner.troops(),this.startTroops),this._owner.removeTroops(this.startTroops)),this.attack=this._owner.createAttack(this.target,this.startTroops,this.sourceTile,new Set),this.sourceTile!==null?this.addNeighbors(this.sourceTile):this.refreshToConquer(),this.mg.stats().attack(this._owner,this.target,this.startTroops);for(const i of this._owner.incomingAttacks())if(i.attacker()===this.target)if(i.troops()>this.attack.troops()){i.setTroops(i.troops()-this.attack.troops()),this.attack.delete(),this.active=!1;return}else this.attack.setTroops(this.attack.troops()-i.troops()),i.delete();for(const i of this._owner.outgoingAttacks())i!==this.attack&&i.target()===this.attack.target()&&this.attack.sourceTile()===null&&(this.attack.setTroops(this.attack.troops()+i.troops()),i.delete());if(this.target.isPlayer()){const i=this.mg.config().gameConfig().difficulty;let r;switch(i){case _.Easy:r=-60;break;case _.Medium:r=-70;break;case _.Hard:r=-80;break;case _.Impossible:r=-100;break;default:dt(i)}this.target.updateRelation(this._owner,r)}}}refreshToConquer(){if(this.attack===null)throw new Error("Attack not initialized");this.toConquer.clear(),this.attack.clearBorder();for(const t of this._owner.borderTiles())this.addNeighbors(t)}retreat(t=0){if(this.attack===null)throw new Error("Attack not initialized");const e=this.attack.troops()*(t/100);e&&this.mg.displayMessage("events_display.attack_cancelled_retreat",at.ATTACK_CANCELLED,this._owner.id(),void 0,{troops:si(e)}),this.removeTroops===!1&&this.sourceTile===null&&this.attack.setTroops(this.attack.troops()-(this.startTroops??0));const i=this.attack.troops()-e;this._owner.addTroops(i),this.attack.delete(),this.active=!1,this.attack.retreated()&&this.mg.stats().attackCancel(this._owner,this.target,i)}tick(t){if(this.attack===null)throw new Error("Attack not initialized");let e=this.attack.troops();const i=this.target.isPlayer(),r=i?this.target:null;if(this.attack.retreated()){i?this.retreat(vb):this.retreat(),this.active=!1;return}if(this.attack.retreating())return;if(!this.attack.isActive()){this.active=!1;return}if(r&&this._owner.isFriendly(r)){this.retreat();return}let s=this.mg.config().attackTilesPerTick(e,this._owner,this.target,this.attack.borderSize()+this.random.nextInt(0,5));for(;s>0;){if(e<1){this.attack.delete(),this.active=!1;return}if(this.toConquer.size()===0){this.refreshToConquer(),this.retreat();return}const[a]=this.toConquer.dequeue();this.attack.removeBorderTile(a);let o=!1;for(const d of this.mg.neighbors(a))if(this.mg.owner(d)===this._owner){o=!0;break}if(this.mg.owner(a)!==this.target||!o)continue;this.addNeighbors(a);const{attackerTroopLoss:c,defenderTroopLoss:l,tilesPerTickUsed:h}=this.mg.config().attackLogic(this.mg,e,this._owner,this.target,a);s-=h,e-=c,this.attack.setTroops(e),r&&r.removeTroops(l),this._owner.conquer(a),this.handleDeadDefender()}}rejectIncomingAllianceRequests(t){const e=this._owner.incomingAllianceRequests().find(i=>i.requestor()===t);e!==void 0&&e.reject()}addNeighbors(t){if(this.attack===null)throw new Error("Attack not initialized");const e=this.mg.ticks();for(const i of this.mg.neighbors(t)){if(this.mg.isWater(i)||this.mg.owner(i)!==this.target)continue;this.attack.addBorderTile(i);let r=0;for(const o of this.mg.neighbors(i))this.mg.owner(o)===this._owner&&r++;let s=0;switch(this.mg.terrainType(i)){case _t.Plains:s=1;break;case _t.Highland:s=1.5;break;case _t.Mountain:s=2;break}const a=(this.random.nextInt(0,7)+10)*(1-r*.5+s/2)+e;this.toConquer.enqueue(i,a)}}handleDeadDefender(){if(this.target.isPlayer()&&this.target.numTilesOwned()<100){this.mg.conquerPlayer(this._owner,this.target);for(let t=0;t<10;t++)for(const e of this.target.tiles())if(this.mg.neighbors(e).some(r=>this.mg.owner(r)===this._owner))this._owner.conquer(e);else for(const r of this.mg.neighbors(e)){const s=this.mg.owner(r);if(s.isPlayer()&&s!==this.target&&!s.isFriendly(this.target)){this.mg.player(s.id()).conquer(e);break}}}}owner(){return this._owner}isActive(){return this.active}}class Ab{constructor(t,e){this.player=t,this.unitID=e,this.active=!0}init(t,e){}tick(t){const e=this.player.units().find(i=>i.id()===this.unitID&&i.type()===m.TransportShip);if(!e){console.warn(`Didn't find outgoing boat with id ${this.unitID}`),this.active=!1;return}e.orderBoatRetreat(),this.active=!1}owner(){return this.player}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class xh{constructor(t,e){this.player=t,this.unitId=e,this.active=!0,this.unit=null}activeDuringSpawnPhase(){return!1}init(t,e){if(!this.active)return;this.mg=t;const i=this.player.units().find(s=>s.id()===this.unitId);if(!i){console.warn(`SECURITY: unit ${this.unitId} not found or not owned by player ${this.player.displayName()}`),this.active=!1;return}if(!i.isActive()){console.warn(`SECURITY: unit ${this.unitId} is not active`),this.active=!1;return}this.unit=i;const r=t.owner(i.tile());if(!r.isPlayer()||r.id()!==this.player.id()){console.warn(`SECURITY: unit ${this.unitId} is not on player's territory`),this.active=!1;return}if(!t.isLand(i.tile())){console.warn(`SECURITY: unit ${this.unitId} is not on land`),this.active=!1;return}if(t.inSpawnPhase()){console.warn("SECURITY: cannot delete units during spawn phase"),this.active=!1;return}if(!this.player.canDeleteUnit()){console.warn("SECURITY: delete unit cooldown not expired"),this.active=!1;return}this.player.recordDeleteUnit(),i.markForDeletion()}tick(t){if(!(!this.active||!this.unit)){if(!this.unit.isActive()){this.active=!1;return}this.unit.isOverdueDeletion()&&(this.unit.delete(!1),this.mg.displayMessage("events_display.unit_voluntarily_deleted",at.UNIT_DESTROYED,this.player.id()),this.active=!1)}}isActive(){return this.active}}const ae=[];function Tn(){return globalThis.__DEBUG_SPAN_ENABLED__===!0}const G={isEnabled:Tn,enable(){globalThis.__DEBUG_SPAN_ENABLED__=!0},disable(){globalThis.__DEBUG_SPAN_ENABLED__=!1},start(n){if(!Tn())return;const t={name:n,timeStart:performance.now(),data:{},children:[]};ae[ae.length-1]?.children.push(t),ae.push(t)},end(n){if(!Tn())return;if(ae.length===0){const e=n?`"${n}"`:"";throw new Error(`DebugSpan.end(${e}): no open span`)}if(n){for(;ae.length>0;){const e=ae.pop();if(e.timeEnd=performance.now(),e.duration=e.timeEnd-e.timeStart,ae.length===0&&G.storeSpan(e),e.name===n)break}return}const t=ae.pop();t.timeEnd=performance.now(),t.duration=t.timeEnd-t.timeStart,ae.length===0&&G.storeSpan(t)},storeSpan(n){if(!Tn())return;globalThis.__DEBUG_SPANS__=globalThis.__DEBUG_SPANS__??[],globalThis.__DEBUG_SPANS__.push(n);const t=i=>Object.fromEntries(Object.entries(i.data).filter(([r])=>typeof r=="string"&&r.startsWith("$"))),e={timings:{total:n.duration},data:t(n)};if(n.children.length>0){const i=s=>s.children.flatMap(a=>[a,...i(a)]),r=i(n);for(const s of r){e.timings[s.name]=s.duration;const a=t(s);for(const o of Object.keys(a))e.data[o]=a[o]}}try{performance.measure(n.name,{start:n.timeStart,end:n.timeEnd,detail:e})}catch(i){console.error("DebugSpan.storeSpan: performance.measure failed",i),console.error("Span:",n)}for(;globalThis.__DEBUG_SPANS__.length>100;)globalThis.__DEBUG_SPANS__.shift()},wrap(n,t){this.start(n);try{return t()}finally{this.end(n)}},set(n,t,e=!0){if(!Tn())return;if(ae.length===0)throw new Error(`DebugSpan.set("${n}"): no open span`);const i=e?ae[0]:ae[ae.length-1];i.data[n]=t(i.data[n])},getLastSpan(n){if(Tn()){if(globalThis.__DEBUG_SPANS__=globalThis.__DEBUG_SPANS__??[],n){for(let t=globalThis.__DEBUG_SPANS__.length-1||0;t>=0;t--){const e=globalThis.__DEBUG_SPANS__[t];if(e.name===n)return e}return}return globalThis.__DEBUG_SPANS__[globalThis.__DEBUG_SPANS__.length-1]}}};class ha{constructor(t){this.capacity=t,this.size=0,this.heap=new Int32Array(t),this.priorities=new Float32Array(t)}push(t,e){if(this.size>=this.capacity){console.error(`MinHeap capacity exceeded (${this.capacity}). Resizing, but this indicates a bug. Please investigate.`),this.capacity*=2;const r=new Int32Array(this.capacity),s=new Float32Array(this.capacity);r.set(this.heap),s.set(this.priorities),this.heap=r,this.priorities=s}let i=this.size++;for(this.heap[i]=t,this.priorities[i]=e;i>0;){const r=i-1>>1;if(this.priorities[r]<=this.priorities[i])break;const s=this.heap[r],a=this.priorities[r];this.heap[r]=this.heap[i],this.priorities[r]=this.priorities[i],this.heap[i]=s,this.priorities[i]=a,i=r}}pop(){const t=this.heap[0];if(this.size--,this.size>0){this.heap[0]=this.heap[this.size],this.priorities[0]=this.priorities[this.size];let e=0;for(;;){const i=(e<<1)+1,r=i+1;let s=e;if(i<this.size&&this.priorities[i]<this.priorities[s]&&(s=i),r<this.size&&this.priorities[r]<this.priorities[s]&&(s=r),s===e)break;const a=this.heap[s],o=this.priorities[s];this.heap[s]=this.heap[e],this.priorities[s]=this.priorities[e],this.heap[e]=a,this.priorities[e]=o,e=s}}return t}isEmpty(){return this.size===0}clear(){this.size=0}}class Ch{constructor(t){this.stamp=0,this.maxBucket=t+1,this.buckets=new Array(this.maxBucket),this.bucketSizes=new Int32Array(this.maxBucket),this.bucketStamp=new Uint32Array(this.maxBucket),this.minBucket=this.maxBucket,this.size=0}push(t,e){const i=Math.min(e|0,this.maxBucket-1);this.buckets[i]||(this.buckets[i]=new Int32Array(64));const r=this.bucketStamp[i]===this.stamp?this.bucketSizes[i]:0;if(r>=this.buckets[i].length){const s=new Int32Array(this.buckets[i].length*2);s.set(this.buckets[i]),this.buckets[i]=s}this.buckets[i][r]=t,this.bucketSizes[i]=r+1,this.bucketStamp[i]=this.stamp,this.size++,i<this.minBucket&&(this.minBucket=i)}pop(){for(;this.minBucket<this.maxBucket;){if(this.bucketStamp[this.minBucket]===this.stamp){const t=this.bucketSizes[this.minBucket];if(t>0)return this.bucketSizes[this.minBucket]--,this.size--,this.buckets[this.minBucket][t-1]}this.minBucket++}return-1}isEmpty(){return this.size===0}clear(){this.stamp++,this.stamp>4294967295&&(this.bucketStamp.fill(0),this.stamp=1),this.minBucket=this.maxBucket,this.size=0}}class Ph{constructor(t){this.stamp=1,this.adapter=t.adapter,this.maxIterations=t.maxIterations??5e5,this.neighborBuffer=new Int32Array(this.adapter.maxNeighbors()),this.closedStamp=new Uint32Array(this.adapter.numNodes()),this.gScoreStamp=new Uint32Array(this.adapter.numNodes()),this.gScore=new Uint32Array(this.adapter.numNodes()),this.cameFrom=new Int32Array(this.adapter.numNodes()),this.queue=new Ch(this.adapter.maxPriority())}findPath(t,e){this.stamp++,this.stamp>4294967295&&(this.closedStamp.fill(0),this.gScoreStamp.fill(0),this.stamp=1);const i=this.stamp,r=this.adapter,s=this.closedStamp,a=this.gScoreStamp,o=this.gScore,c=this.cameFrom,l=this.queue,h=this.neighborBuffer;l.clear();const d=Array.isArray(t)?t:[t];for(const g of d)o[g]=0,a[g]=i,c[g]=-1,l.push(g,r.heuristic(g,e));let f=this.maxIterations;for(;!l.isEmpty();){if(--f<=0)return null;const g=l.pop();if(s[g]===i)continue;if(s[g]=i,g===e)return this.buildPath(e);const p=o[g],b=c[g],S=r.neighbors(g,h);for(let w=0;w<S;w++){const v=h[w];if(s[v]===i)continue;const A=p+r.cost(g,v,b===-1?void 0:b);(a[v]!==i||A<o[v])&&(c[v]=g,o[v]=A,a[v]=i,l.push(v,A+r.heuristic(v,e)))}}return null}buildPath(t){const e=[];let i=t;for(;i!==-1;)e.push(i),i=this.cameFrom[i];return e.reverse(),e}}class Eb{constructor(t){const e=new kb(t);this.aStar=new Ph({adapter:e})}findPath(t,e){return G.wrap("AStar.Rail:findPath",()=>this.aStar.findPath(t,e))}}class kb{constructor(t){this.waterPenalty=5,this.heuristicWeight=2,this.directionChangePenalty=3,this.gameMap=t,this.width=t.width(),this.height=t.height(),this._numNodes=this.width*this.height}numNodes(){return this._numNodes}maxNeighbors(){return 4}maxPriority(){const t=1+this.waterPenalty+this.directionChangePenalty;return this.heuristicWeight*(this.width+this.height)*t}neighbors(t,e){let i=0;const r=t%this.width,s=this.gameMap.isShoreline(t);if(t>=this.width){const a=t-this.width;this.isTraversable(a,s)&&(e[i++]=a)}if(t<this._numNodes-this.width){const a=t+this.width;this.isTraversable(a,s)&&(e[i++]=a)}if(r!==0){const a=t-1;this.isTraversable(a,s)&&(e[i++]=a)}if(r!==this.width-1){const a=t+1;this.isTraversable(a,s)&&(e[i++]=a)}return i}isTraversable(t,e){return this.gameMap.isWater(t)?e||this.gameMap.isShoreline(t):!0}cost(t,e,i){let s=this.gameMap.isWater(e)||this.gameMap.isShoreline(e)?1+this.waterPenalty:1;if(i!==void 0){const a=t-i,o=e-t;a!==o&&(s+=this.directionChangePenalty)}return s}heuristic(t,e){const i=t%this.width,r=t/this.width|0,s=e%this.width,a=e/this.width|0;return this.heuristicWeight*(Math.abs(i-s)+Math.abs(r-a))}}const Mb=7,Er=31,kr=100,Ee=1*kr;function Mr(n){return n<3?10*kr:n<=10?0:1*kr}class Ib{constructor(t,e){this.stamp=1,this.terrain=t.terrain,this.width=t.width(),this.numNodes=t.width()*t.height(),this.heuristicWeight=e?.heuristicWeight??5,this.maxIterations=e?.maxIterations??1e6,this.closedStamp=new Uint32Array(this.numNodes),this.gScoreStamp=new Uint32Array(this.numNodes),this.gScore=new Uint32Array(this.numNodes),this.cameFrom=new Int32Array(this.numNodes),this.queue=new ha(this.numNodes)}findPath(t,e){this.stamp++,this.stamp>4294967295&&(this.closedStamp.fill(0),this.gScoreStamp.fill(0),this.stamp=1);const i=this.stamp,r=this.width,s=this.numNodes,a=this.terrain,o=this.closedStamp,c=this.gScoreStamp,l=this.gScore,h=this.cameFrom,d=this.queue,f=this.heuristicWeight,g=1<<Mb,p=e%r,b=e/r|0;d.clear();const S=Array.isArray(t)?t:[t],w=S[0],v=w%r,A=w/r|0,E=p-v,C=b-A,x=Math.max(1,Math.abs(E)+Math.abs(C)),O=(I,q)=>{const U=I-p,K=q-b,D=Math.abs(E*K-C*U);return Math.floor(D*(kr-1)/x/x)};for(const I of S){l[I]=0,c[I]=i,h[I]=-1;const q=I%r,U=I/r|0,K=f*Ee*(Math.abs(q-p)+Math.abs(U-b));d.push(I,K)}let N=this.maxIterations;for(;!d.isEmpty();){if(--N<=0)return null;const I=d.pop();if(o[I]===i)continue;if(o[I]=i,I===e)return this.buildPath(e);const q=l[I],U=I%r,K=I/r|0;if(I>=r){const D=I-r,X=a[D];if(o[D]!==i&&(D===e||(X&g)===0)){const ct=X&Er,et=Ee+Mr(ct),st=q+et;if(c[D]!==i||st<l[D]){h[D]=I,l[D]=st,c[D]=i;const Mt=K-1,Y=f*Ee*(Math.abs(U-p)+Math.abs(Mt-b)),Q=st+Y+O(U,Mt);d.push(D,Q)}}}if(I<s-r){const D=I+r,X=a[D];if(o[D]!==i&&(D===e||(X&g)===0)){const ct=X&Er,et=Ee+Mr(ct),st=q+et;if(c[D]!==i||st<l[D]){h[D]=I,l[D]=st,c[D]=i;const Mt=K+1,Y=f*Ee*(Math.abs(U-p)+Math.abs(Mt-b)),Q=st+Y+O(U,Mt);d.push(D,Q)}}}if(U!==0){const D=I-1,X=a[D];if(o[D]!==i&&(D===e||(X&g)===0)){const ct=X&Er,et=Ee+Mr(ct),st=q+et;if(c[D]!==i||st<l[D]){h[D]=I,l[D]=st,c[D]=i;const Mt=U-1,Y=f*Ee*(Math.abs(Mt-p)+Math.abs(K-b)),Q=st+Y+O(Mt,K);d.push(D,Q)}}}if(U!==r-1){const D=I+1,X=a[D];if(o[D]!==i&&(D===e||(X&g)===0)){const ct=X&Er,et=Ee+Mr(ct),st=q+et;if(c[D]!==i||st<l[D]){h[D]=I,l[D]=st,c[D]=i;const Mt=U+1,Y=f*Ee*(Math.abs(Mt-p)+Math.abs(K-b)),Q=st+Y+O(Mt,K);d.push(D,Q)}}}}return null}buildPath(t){const e=[];let i=t;for(;i!==-1;)e.push(i),i=this.cameFrom[i];return e.reverse(),e}}class xb{constructor(t){this.game=t,this.seed=t.ticks()}findPath(t,e){if(Array.isArray(t))throw new Error("AirPathFinder does not support multiple start points");const i=new gt(this.seed),r=[t];let s=t;for(;s!==e;){const a=this.computeNext(s,e,i);if(a===s)break;s=a,r.push(s)}return r}computeNext(t,e,i){const r=this.game.x(t),s=this.game.y(t),a=this.game.x(e),o=this.game.y(e);if(r===a&&s===o)return e;let c=r,l=s;const h=Math.floor(1+Math.abs(o-s)/(Math.abs(a-r)+1));return r===a?l+=s<o?1:-1:s===o||i.chance(h)?c+=r<a?1:-1:l+=s<o?1:-1,this.game.ref(c,l)}}class Cb{constructor(t,e,i,r){this.p0=t,this.p1=e,this.p2=i,this.p3=r}getPointAt(t){const e=1-t,i=e*e,r=i*e,s=t*t,a=s*t,o=r*this.p0.x+3*i*t*this.p1.x+3*e*s*this.p2.x+a*this.p3.x,c=r*this.p0.y+3*i*t*this.p1.y+3*e*s*this.p2.y+a*this.p3.y;return{x:o,y:c}}}class Pb extends Cb{constructor(t,e,i,r,s){super(t,e,i,r),this.totalDistance=0,this.cachedPoints=[],this.currentIndex=0,this.computeAllPoints(s,.002)}getAllPoints(){return this.cachedPoints}increment(t){for(this.totalDistance+=t;this.currentIndex<this.cachedPoints.length-1&&this.getDistanceUpToIndex(this.currentIndex+1)<this.totalDistance;)this.currentIndex++;return this.currentIndex>=this.cachedPoints.length-1?null:this.cachedPoints[this.currentIndex]}getCurrentIndex(){return this.currentIndex}computeAllPoints(t,e){this.cachedPoints=[],this.totalDistance=0,this.currentIndex=0;let i=0,r=this.getPointAt(i);this.cachedPoints.push(r);let s=0;for(;i<1;){i=Math.min(i+e,1);const o=this.getPointAt(i),c=o.x-r.x,l=o.y-r.y,h=Math.sqrt(c*c+l*l);s+=h,s>=t&&(this.cachedPoints.push(o),s=0),r=o}const a=this.getPointAt(1);(this.cachedPoints.length===0||a.x!==this.cachedPoints[this.cachedPoints.length-1].x||a.y!==this.cachedPoints[this.cachedPoints.length-1].y)&&this.cachedPoints.push(a)}getDistanceUpToIndex(t){let e=0;for(let i=1;i<=t;i++){const r=this.cachedPoints[i-1],s=this.cachedPoints[i],a=s.x-r.x,o=s.y-r.y;e+=Math.sqrt(a*a+o*o)}return e}}var tt=(n=>(n[n.NEXT=0]="NEXT",n[n.PENDING=1]="PENDING",n[n.COMPLETE=2]="COMPLETE",n[n.NOT_FOUND=3]="NOT_FOUND",n))(tt||{});const Db=50;class Nb{constructor(t,e){this.gameMap=t,this.options=e,this.curve=null,this.lastTo=null}createCurve(t,e){const i=this.options?.increment??3,r=this.options?.distanceBasedHeight??!0,s=this.options?.directionUp??!0,a={x:this.gameMap.x(t),y:this.gameMap.y(t)},o={x:this.gameMap.x(e),y:this.gameMap.y(e)},c=o.x-a.x,l=o.y-a.y,h=Math.sqrt(c*c+l*l),d=r?Math.max(h/3,Db):0,f=s?-1:1,g=this.gameMap.height(),p={x:a.x+c/4,y:Pe(a.y+l/4+f*d,0,g-1)},b={x:a.x+c*3/4,y:Pe(a.y+l*3/4+f*d,0,g-1)};return new Pb(a,p,b,o,i)}findPath(t,e){if(Array.isArray(t))throw new Error("ParabolaUniversalPathFinder does not support multiple start points");return this.createCurve(t,e).getAllPoints().map(r=>this.gameMap.ref(Math.floor(r.x),Math.floor(r.y)))}next(t,e,i){this.lastTo!==e&&(this.curve=this.createCurve(t,e),this.lastTo=e);const r=this.curve.increment(i??1);if(!r)return{status:tt.COMPLETE,node:e};const s=this.gameMap.ref(Math.floor(r.x),Math.floor(r.y));return{status:tt.NEXT,node:s}}invalidate(){this.curve=null,this.lastTo=null}currentIndex(){return this.curve?.getCurrentIndex()??0}}class Rb{constructor(t){this.manager=t.railNetwork().stationManager();const e=new Ob(t,this.manager);this.aStar=new Ph({adapter:e})}findPath(t,e){const i=e.getCluster(),s=(Array.isArray(t)?t:[t]).filter(c=>c.getCluster()===i);if(s.length===0)return null;const a=s.map(c=>c.id),o=this.aStar.findPath(a,e.id);return o?o.map(c=>this.manager.getById(c)):null}}class Ob{constructor(t,e){this.game=t,this.manager=e}numNodes(){return this.manager.count()}maxNeighbors(){return 32}maxPriority(){return this.game.map().width()+this.game.map().height()}neighbors(t,e){const i=this.manager.getById(t);if(!i)return 0;let r=0;for(const s of i.neighbors())e[r++]=s.id;return r}cost(){return 1}heuristic(t,e){const i=this.manager.getById(t),r=this.manager.getById(e);if(!i||!r)return 0;const s=this.game.x(i.tile()),a=this.game.y(i.tile()),o=this.game.x(r.tile()),c=this.game.y(r.tile());return Math.abs(s-o)+Math.abs(a-c)}}class Bb{constructor(t,e={equals:(i,r)=>i===r}){this.finder=t,this.config=e,this.path=null,this.pathIndex=0,this.lastTo=null}next(t,e,i){if(this.config.preCheck){const a=this.config.preCheck(t,e);if(a)return a}if(this.config.equals(t,e))return{status:tt.COMPLETE,node:e};if(i!==void 0&&i>0&&this.config.distance&&this.config.distance(t,e)<=i)return{status:tt.COMPLETE,node:t};if((this.lastTo===null||!this.config.equals(this.lastTo,e))&&(this.path=null,this.pathIndex=0,this.lastTo=e),this.path===null){try{this.path=this.finder.findPath(t,e)}catch(a){return console.error("PathFinder threw an error during findPath",a),{status:tt.NOT_FOUND}}if(this.path===null)return{status:tt.NOT_FOUND};this.pathIndex=0,this.path.length>0&&this.config.equals(this.path[0],t)&&(this.pathIndex=1)}const r=this.path[this.pathIndex-1];if(this.pathIndex>0&&!this.config.equals(t,r))return this.invalidate(),this.lastTo=e,this.next(t,e,i);if(this.pathIndex>=this.path.length)return{status:tt.COMPLETE,node:e};const s=this.path[this.pathIndex];return this.pathIndex++,{status:tt.NEXT,node:s}}invalidate(){this.path=null,this.pathIndex=0,this.lastTo=null}findPath(t,e){return this.config.preCheck&&(Array.isArray(t)?t:[t]).every(s=>this.config.preCheck(s,e)?.status===tt.NOT_FOUND)?null:this.finder.findPath(t,e)}}class tn{constructor(t){this.core=t,this.wrappers=[]}static create(t){return new tn(t)}wrap(t){return this.wrappers.push(t),this}build(){const t=this.wrappers.reduce((i,r)=>r(i),this.core),e=t.findPath;return t.findPath=function(i,r){return G.wrap("findPath",()=>e.call(this,i,r))},t}buildWithStepper(t){return new Bb(this.build(),t)}}class Lb{constructor(t,e){this.inner=t,this.getComponent=e}findPath(t,e){const i=this.getComponent(e),s=(Array.isArray(t)?t:[t]).filter(o=>this.getComponent(o)===i);if(s.length===0)return null;const a=s.length===1?s[0]:s;return this.inner.findPath(a,e)}}class ua{constructor(t,e,i){this.inner=t,this.map=e,this.miniMap=i}findPath(t,e){const r=(Array.isArray(t)?t:[t]).map(g=>this.miniMap.ref(Math.floor(this.map.x(g)/2),Math.floor(this.map.y(g)/2))),s=r.length===1?r[0]:r,a=this.miniMap.ref(Math.floor(this.map.x(e)/2),Math.floor(this.map.y(e)/2)),o=this.inner.findPath(s,a);if(!o||o.length===0)return null;const c=o.map(g=>new Dt(this.miniMap.x(g),this.miniMap.y(g))),l=this.upscalePath(c);let h;if(Array.isArray(t)){if(l.length>0){const g=l[0];let p=1/0;for(const b of t){const S=this.map.x(b),w=this.map.y(b),v=Math.abs(S-g.x)+Math.abs(w-g.y);v<p&&(p=v,h=new Dt(S,w))}}}else h=new Dt(this.map.x(t),this.map.y(t));const d=new Dt(this.map.x(e),this.map.y(e));return this.fixExtremes(l,d,h).map(g=>this.map.ref(g.x,g.y))}upscalePath(t,e=2){const i=t.map(s=>new Dt(s.x*e,s.y*e)),r=[];for(let s=0;s<i.length-1;s++){const a=i[s],o=i[s+1];r.push(a);const c=o.x-a.x,l=o.y-a.y,d=Math.max(Math.abs(c),Math.abs(l));for(let f=1;f<d;f++)r.push(new Dt(Math.round(a.x+c*f/d),Math.round(a.y+l*f/d)))}return i.length>0&&r.push(i[i.length-1]),r}fixExtremes(t,e,i){if(i!==void 0){const s=this.findCell(t,i);s===-1?t.unshift(i):s!==0&&(t=t.slice(s))}const r=this.findCell(t,e);return r===-1?t.push(e):r!==t.length-1&&(t=t.slice(0,r+1)),t}findCell(t,e){for(let i=0;i<t.length;i++)if(t[i].x===e.x&&t[i].y===e.y)return i;return-1}}class Dh{constructor(t,e){this.inner=t,this.map=e}findPath(t,e){const i=Array.isArray(t)?t:[t],r=new Map,s=[];for(const h of i){const d=this.coerceToWater(h);d.water!==null&&(s.push(d.water),r.set(d.water,d.original))}if(s.length===0)return null;const a=this.coerceToWater(e);if(a.water===null)return null;const o=s.length===1?s[0]:s,c=this.inner.findPath(o,a.water);if(!c||c.length===0)return null;const l=r.get(c[0]);return l!=null&&c.unshift(l),a.original!==null&&c[c.length-1]!==a.original&&c.push(a.original),c}coerceToWater(t){if(this.map.isWater(t))return{water:t,original:null};let e=null,i=-1;for(const r of this.map.neighbors(t)){if(!this.map.isWater(r))continue;const s=this.countWaterNeighbors(r);s>i&&(i=s,e=r)}return e!==null?{water:e,original:t}:{water:null,original:t}}countWaterNeighbors(t){let e=0;for(const i of this.map.neighbors(t))this.map.isWater(i)&&e++;return e}}const zb=7,Ir=31,xr=100,ke=1*xr;function Cr(n){return n<3?3*xr:n<=10?0:1*xr}class ai{constructor(t,e,i){this.stamp=1,this.terrain=t.terrain,this.mapWidth=t.width(),this.heuristicWeight=i?.heuristicWeight??3,this.maxIterations=i?.maxIterations??1e5,this.closedStamp=new Uint32Array(e),this.gScoreStamp=new Uint32Array(e),this.gScore=new Uint32Array(e),this.cameFrom=new Int32Array(e),this.queue=new ha(e*4)}findPath(t,e){const i=Array.isArray(t)?t:[t],r=e%this.mapWidth,s=e/this.mapWidth|0;let a=r,o=r,c=s,l=s;for(const h of i){const d=h%this.mapWidth,f=h/this.mapWidth|0;a=Math.min(a,d),o=Math.max(o,d),c=Math.min(c,f),l=Math.max(l,f)}return this.searchBounded(i,e,{minX:a,maxX:o,minY:c,maxY:l})}searchBounded(t,e,i){this.stamp++,this.stamp>4294967295&&(this.closedStamp.fill(0),this.gScoreStamp.fill(0),this.stamp=1);const r=this.stamp,s=this.mapWidth,a=this.terrain,o=this.closedStamp,c=this.gScoreStamp,l=this.gScore,h=this.cameFrom,d=this.queue,f=this.heuristicWeight,g=1<<zb,{minX:p,maxX:b,minY:S,maxY:w}=i,v=b-p+1,A=e%s,E=e/s|0,C=w-S+1,x=v*C;if(x>this.closedStamp.length)return null;const O=(Y,Q=!1)=>{let V=Y%s,Et=Y/s|0;return Q&&(V=Math.max(p,Math.min(b,V)),Et=Math.max(S,Math.min(w,Et))),(Et-S)*v+(V-p)},N=Y=>{const Q=Y%v;return((Y/v|0)+S)*s+(Q+p)},I=O(e,!0);if(I<0||I>=x)return null;d.clear();const q=Array.isArray(t)?t:[t],U=q[0],K=U%s,D=U/s|0,X=A-K,ct=E-D,et=Math.max(1,Math.abs(X)+Math.abs(ct)),st=(Y,Q)=>{const V=Y-A,Et=Q-E,nt=Math.abs(X*Et-ct*V);return Math.floor(nt*(xr-1)/et/et)};for(const Y of q){const Q=O(Y,!0);if(Q<0||Q>=x)continue;l[Q]=0,c[Q]=r,h[Q]=-1;const V=Y%s,Et=Y/s|0,nt=f*ke*(Math.abs(V-A)+Math.abs(Et-E));d.push(Q,nt)}let Mt=this.maxIterations;for(;!d.isEmpty();){if(--Mt<=0)return null;const Y=d.pop();if(o[Y]===r)continue;if(o[Y]=r,Y===I)return this.buildPath(I,N,x);const Q=l[Y],V=N(Y),Et=V%s,nt=V/s|0;if(nt>S){const jt=V-s,W=Y-v,qt=a[jt];if(o[W]!==r&&(jt===e||(qt&g)===0)){const Kt=nt-1,be=Math.abs(Et-A)+Math.abs(Kt-E),fe=qt&Ir,we=ke+Cr(fe),Bt=Q+we;if(c[W]!==r||Bt<l[W]){h[W]=Y,l[W]=Bt,c[W]=r;const ee=f*ke*be,le=Bt+ee+st(Et,Kt);d.push(W,le)}}}if(nt<w){const jt=V+s,W=Y+v,qt=a[jt];if(o[W]!==r&&(jt===e||(qt&g)===0)){const Kt=nt+1,be=Math.abs(Et-A)+Math.abs(Kt-E),fe=qt&Ir,we=ke+Cr(fe),Bt=Q+we;if(c[W]!==r||Bt<l[W]){h[W]=Y,l[W]=Bt,c[W]=r;const ee=f*ke*be,le=Bt+ee+st(Et,Kt);d.push(W,le)}}}if(Et>p){const jt=V-1,W=Y-1,qt=a[jt];if(o[W]!==r&&(jt===e||(qt&g)===0)){const Kt=Et-1,be=Math.abs(Kt-A)+Math.abs(nt-E),fe=qt&Ir,we=ke+Cr(fe),Bt=Q+we;if(c[W]!==r||Bt<l[W]){h[W]=Y,l[W]=Bt,c[W]=r;const ee=f*ke*be,le=Bt+ee+st(Kt,nt);d.push(W,le)}}}if(Et<b){const jt=V+1,W=Y+1,qt=a[jt];if(o[W]!==r&&(jt===e||(qt&g)===0)){const Kt=Et+1,be=Math.abs(Kt-A)+Math.abs(nt-E),fe=qt&Ir,we=ke+Cr(fe),Bt=Q+we;if(c[W]!==r||Bt<l[W]){h[W]=Y,l[W]=Bt,c[W]=r;const ee=f*ke*be,le=Bt+ee+st(Kt,nt);d.push(W,le)}}}}return null}buildPath(t,e,i){const r=[];let s=t,a=0;for(;s!==-1&&a<i;)r.push(e(s)),s=this.cameFrom[s],a++;return r.reverse(),r}}const Ub=50,Wb=1e4,$b=2,Fb=3,da=31;class qb{constructor(t,e,i=r=>e.isWater(r)){this.inner=t,this.map=e,this.mapWidth=e.width(),this.localAStar=new ai(e,Wb),this.terrain=e.terrain,this.isTraversable=i}findPath(t,e){const i=this.inner.findPath(t,e);return G.wrap("smoothingTransformer",()=>i?this.smooth(i):null)}smooth(t){if(t.length<=2)return t;let e=G.wrap("smoother:los",()=>this.losSmooth(t,$b));return e=G.wrap("smoother:refine",()=>this.refineEndpoints(e)),e=G.wrap("smoother:los2",()=>this.losSmooth(e,Fb)),e}losSmooth(t,e){const i=[t[0]];let r=0;for(;r<t.length-1;){let s=r+1,a=t.length-1,o=s;for(;s<=a;){const c=s+a>>>1;this.canSee(t[r],t[c],e)?(o=c,s=c+1):a=c-1}if(o>r+1){const c=this.tracePath(t[r],t[o]);if(c)for(let l=1;l<c.length-1;l++)i.push(c[l])}r=o,r<t.length-1&&i.push(t[r])}return i.push(t[t.length-1]),i}refineEndpoints(t){if(t.length<=2)return t;const e=Ub;let i=t;const r=this.findTileAtDistance(t,0,e,!0);if(r>1){const a=this.refineSegment(t[0],t[r]);a&&a.length>0&&(i=[...a.slice(0,-1),...i.slice(r)])}const s=this.findTileAtDistance(i,i.length-1,e,!1);if(s<i.length-2){const a=this.refineSegment(i[i.length-1],i[s]);a&&a.length>0&&(a.reverse(),i=[...i.slice(0,s),...a])}return i}findTileAtDistance(t,e,i,r){let s=0,a=e;if(r)for(;a<t.length-1&&s<i;)s+=this.manhattanDist(t[a],t[a+1]),a++;else for(;a>0&&s<i;)s+=this.manhattanDist(t[a],t[a-1]),a--;return a}refineSegment(t,e){const i=this.map.x(t),r=this.map.y(t),s=this.map.x(e),a=this.map.y(e),o=10,c={minX:Math.max(0,Math.min(i,s)-o),maxX:Math.min(this.map.width()-1,Math.max(i,s)+o),minY:Math.max(0,Math.min(r,a)-o),maxY:Math.min(this.map.height()-1,Math.max(r,a)+o)};return this.localAStar.searchBounded(t,e,c)}canSee(t,e,i){const r=t%this.mapWidth,s=t/this.mapWidth|0,a=e%this.mapWidth,o=e/this.mapWidth|0,c=Math.abs(a-r),l=Math.abs(o-s),h=r<a?1:-1,d=s<o?1:-1;let f=c-l,g=r,p=s;const b=1e5;let S=0;for(;;){if(S++>b)return!1;const w=p*this.mapWidth+g;if(!this.isTraversable(w)||(this.terrain[w]&da)<i)return!1;if(g===a&&p===o)return!0;const A=2*f,E=A>-l,C=A<c;if(E&&C){g+=h,f-=l;const x=p*this.mapWidth+g,O=this.terrain[x]&da;if(!this.isTraversable(x)||O<i){g-=h,f+=l,p+=d,f+=c;const N=p*this.mapWidth+g,I=this.terrain[N]&da;if(!this.isTraversable(N)||I<i)return!1;g+=h,f-=l}else p+=d,f+=c}else E&&(g+=h,f-=l),C&&(p+=d,f+=c)}}tracePath(t,e){const i=t%this.mapWidth,r=t/this.mapWidth|0,s=e%this.mapWidth,a=e/this.mapWidth|0,o=[],c=Math.abs(s-i),l=Math.abs(a-r),h=i<s?1:-1,d=r<a?1:-1;let f=c-l,g=i,p=r;const b=1e5;let S=0;for(;;){if(S++>b)return null;const w=p*this.mapWidth+g;if(!this.isTraversable(w))return null;if(o.push(w),g===s&&p===a)break;const v=2*f,A=v>-l,E=v<c;if(A&&E){g+=h,f-=l;const C=p*this.mapWidth+g;if(this.isTraversable(C))o.push(C),p+=d,f+=c;else{g-=h,f+=l,p+=d,f+=c;const x=p*this.mapWidth+g;if(!this.isTraversable(x))return null;o.push(x),g+=h,f-=l}}else A&&(g+=h,f-=l),E&&(p+=d,f+=c)}return o}manhattanDist(t,e){const i=t%this.mapWidth,r=t/this.mapWidth|0,s=e%this.mapWidth,a=e/this.mapWidth|0;return Math.abs(i-s)+Math.abs(r-a)}}class fa{static Parabola(t,e){return new Nb(t,e)}}class ye{static Water(t){const e=t.miniWaterHPA(),i=t.miniWaterGraph();if(!e||!i||i.nodeCount<100)return ye.WaterSimple(t);const r=t.miniMap(),s=a=>i.getComponentId(a);return tn.create(e).wrap(a=>new Lb(a,s)).wrap(a=>new qb(a,r)).wrap(a=>new Dh(a,r)).wrap(a=>new ua(a,t.map(),r)).buildWithStepper(ma(t))}static WaterSimple(t){const e=t.miniMap(),i=new Ib(e);return tn.create(i).wrap(r=>new Dh(r,e)).wrap(r=>new ua(r,t.map(),e)).buildWithStepper(ma(t))}static Rail(t){const e=t.miniMap(),i=new Eb(e);return tn.create(i).wrap(r=>new ua(r,t.map(),e)).buildWithStepper(ma(t))}static Stations(t){const e=new Rb(t);return tn.create(e).buildWithStepper({equals:(i,r)=>i.id===r.id,distance:(i,r)=>t.manhattanDist(i.tile(),r.tile())})}static Air(t){const e=new xb(t);return tn.create(e).buildWithStepper({equals:(i,r)=>i===r})}}function ma(n){return{equals:(t,e)=>t===e,distance:(t,e)=>n.manhattanDist(t,e),preCheck:(t,e)=>typeof t!="number"||typeof e!="number"||!n.isValidRef(t)||!n.isValidRef(e)?{status:tt.NOT_FOUND}:null}}const ga=1e4;class pa{constructor(t){this.game=t,this.boundedAStar=null}getBoundedAStar(){return this.boundedAStar??=new ai(this.game.map(),ga),this.boundedAStar}bfsNearest(t,e,i){const r=this.game.map(),s=[];for(const a of r.bfs(t,(o,c)=>r.manhattanDist(t,c)<=e))i(a)&&s.push(a);return s.length===0?null:(s.sort((a,o)=>r.manhattanDist(t,a)-r.manhattanDist(t,o)),s[0])}closestShore(t,e,i=50){const r=this.game,s=t.smallID(),a=o=>!r.isShore(o)||!r.isLand(o)?!1:r.ownerID(o)===s;return this.bfsNearest(e,i,a)}closestShoreByWater(t,e){return G.wrap("SpatialQuery.closestShoreByWater",()=>{if(!t.isPlayer())return null;const i=this.game,r=t;if(!i.isWater(e)&&!i.isShore(e))return null;const s=i.getWaterComponent(e);if(s===null)return null;const a=l=>!i.isShore(l)||!i.isLand(l)?!1:i.getWaterComponent(l)===s,o=Array.from(r.borderTiles()).filter(a);if(o.length===0)return null;const c=ye.Water(i).findPath(o,e);return!c||c.length===0?null:G.wrap("SpatialQuery.refineStartTile",()=>this.refineStartTile(c,o,i))})}refineStartTile(t,e,i){if(t.length<=50)return t[0];const c=t[0],l=i.map(),h=e.filter(N=>l.manhattanDist(N,c)<=20);if(h.length<=1)return c;let d=l.x(h[0]),f=d,g=l.y(h[0]),p=g;for(let N=1;N<h.length;N++){const I=l.x(h[N]),q=l.y(h[N]);d=Math.min(d,I),f=Math.max(f,I),g=Math.min(g,q),p=Math.max(p,q)}let b=50,S=Math.min(200,t.length-1),w=b;for(let N=0;N<5&&b<=S;N++){const I=b+S>>1,q=t[I],U=l.x(q),K=l.y(q),D=Math.min(d,U)-10,X=Math.max(f,U)+10,ct=Math.min(g,K)-10,et=Math.max(p,K)+10;(X-D+1)*(et-ct+1)<=ga?(w=I,b=I+1):S=I-1}const v=t[w],A=l.x(v),E=l.y(v),C={minX:Math.max(0,Math.min(d,A)-10),maxX:Math.min(l.width()-1,Math.max(f,A)+10),minY:Math.max(0,Math.min(g,E)-10),maxY:Math.min(l.height()-1,Math.max(p,E)+10)};if((C.maxX-C.minX+1)*(C.maxY-C.minY+1)>ga)return c;const O=this.getBoundedAStar().searchBounded(h,v,C);return G.set("$candidates",()=>h),G.set("$refinedPath",()=>O),G.set("$originalBestTile",()=>c),G.set("$newBestTile",()=>O?.[0]??c),O?.[0]??c}}function Pr(n,t,e){if(t.unitCount(m.TransportShip)>=n.config().boatMaxNumber())return!1;const i=Nh(n,e);if(i===null)return!1;const r=n.owner(e);return r===t||r.isPlayer()&&!t.canAttackPlayer(r)?!1:new pa(n).closestShoreByWater(t,i)??!1}function Nh(n,t){return new pa(n).closestShore(n.owner(t),t)}function jb(n,t,e){return new pa(n).closestShoreByWater(t,e)}const Tt=n=>es.indexOf(n),Hb=["ðŸ‘","ðŸ¤","ðŸŽ¯"].map(Tt),Gb=["ðŸ¥±","ðŸ¤¦â€â™‚ï¸"].map(Tt),Zb=["ðŸ¥º","ðŸ’€"].map(Tt),Yb=["ðŸ•Šï¸","ðŸ‘Ž"].map(Tt),Xb=["ðŸ˜ˆ"].map(Tt),Vb=["ðŸ˜¡"].map(Tt),Rh=["â›µ"].map(Tt),Oh=["â˜¢ï¸","ðŸ’¥"].map(Tt),Kb=["ðŸ–•","ðŸ˜¡","ðŸ¤¡","ðŸ˜ž","ðŸ˜­"].map(Tt),oi=["â¤ï¸","ðŸ˜Š","ðŸ¥°"].map(Tt),ci=["â“","ðŸ¤¡"].map(Tt),Jb=["ðŸ‘‘","ðŸ¥‡","ðŸ’ª"].map(Tt),Qb=["ðŸ¤","ðŸ˜‡","ðŸ’ª"].map(Tt),t5=["ðŸ¤¡","ðŸ¤¦â€â™‚ï¸"].map(Tt),e5=["ðŸ€"].map(Tt),Bh=["ðŸ’€","ðŸ†˜","ðŸ˜±","ðŸ¥º","ðŸ˜­","ðŸ˜ž","ðŸ«¡","ðŸ‘‹"].map(Tt),Lh=["ðŸ‘"].map(Tt),n5=["ðŸ™","ðŸ¥º"].map(Tt),i5=["ðŸ¥±"].map(Tt),r5=["ðŸ¤"].map(Tt),s5=["ðŸ‘"].map(Tt),zh=["â“","ðŸ¥±"].map(Tt),a5=["ðŸ‘‹"].map(Tt);class o5{constructor(t,e,i){this.random=t,this.game=e,this.player=i,this.lastEmojiSent=new Map,this.gameOver=!1}maybeSendCasualEmoji(){this.gameOver||(this.checkOverwhelmedByAttacks(),this.checkVerySmallAttack(),this.congratulateWinner(),this.brag(),this.charmAllies(),this.annoyTraitors(),this.findRat(),this.greetNearbyPlayers())}checkOverwhelmedByAttacks(){if(!this.random.chance(16))return;const t=this.player.incomingAttacks();if(t.length===0)return;const e=t.reduce((r,s)=>r+s.troops(),0),i=this.player.troops();e>=i*3&&this.sendEmoji(xt,Bh)}checkVerySmallAttack(){if(!this.random.chance(8))return;const t=this.player.incomingAttacks();if(t.length===0)return;const e=this.player.troops();if(!(e<=0))for(const i of t){const r=i.attacker();r.type()===P.Human&&i.troops()<e*.1&&this.maybeSendEmoji(r,this.random.chance(2)?ci:i5)}}congratulateWinner(){const t=this.game.getWinner();if(t===null)return;if(this.gameOver=!0,this.game.config().gameConfig().gameMode===Ct.Team){if(t===this.player.team())return;this.sendEmoji(xt,Lh)}else{if(typeof t=="string"||this.game.players().filter(r=>r.type()===P.Nation).sort((r,s)=>s.numTilesOwned()-r.numTilesOwned())[0]!==this.player)return;this.sendEmoji(t,Lh)}}brag(){if(!this.random.chance(300))return;const t=this.game.players().sort((e,i)=>i.numTilesOwned()-e.numTilesOwned());t.length===0||t[0]!==this.player||this.sendEmoji(xt,Jb)}charmAllies(){if(!this.random.chance(250))return;const t=this.player.allies().filter(r=>r.type()===P.Human);if(t.length===0)return;const e=this.random.randElement(t),i=this.random.chance(3)?oi:Qb;this.sendEmoji(e,i)}annoyTraitors(){if(!this.random.chance(40))return;const t=this.game.players().filter(i=>i.type()===P.Human&&!i.isFriendly(this.player)&&i.isTraitor());if(t.length===0)return;const e=this.random.randElement(t);this.sendEmoji(e,t5)}findRat(){if(this.game.ticks()<6e3||!this.random.chance(1e4))return;const e=this.game.numLandTiles()*.01,i=this.game.players().filter(s=>s.type()===P.Human&&s.numTilesOwned()<e&&s.numTilesOwned()>0);if(i.length===0)return;const r=this.random.randElement(i);this.sendEmoji(r,e5)}greetNearbyPlayers(){if(this.game.ticks()>600||!this.random.chance(250))return;const t=this.player.neighbors().filter(i=>i.isPlayer()&&i.type()===P.Human);if(t.length===0)return;const e=this.random.randElement(t);this.sendEmoji(e,a5)}maybeSendEmoji(t,e){if(this.shouldSendEmoji(t))return this.sendEmoji(t,e)}maybeSendAttackEmoji(t){if(this.shouldSendEmoji(t)){if(this.player.relation(t)>=Pt.Neutral){if(!this.random.chance(2))return;this.sendEmoji(t,Xb);return}this.random.chance(4)&&this.sendEmoji(t,Vb)}}sendEmoji(t,e){this.shouldSendEmoji(t,!1)&&this.player.canSendEmoji(t)&&this.game.addExecution(new je(this.player,t===xt?xt:t.id(),this.random.randElement(e)))}shouldSendEmoji(t,e=!0){if(t===xt)return!0;if(this.player.type()===P.Bot||t.type()!==P.Human)return!1;if(e){const i=this.lastEmojiSent.get(t)??-300;if(this.game.ticks()-i<=300)return!1;this.lastEmojiSent.set(t,this.game.ticks())}return!0}}function c5(n,t,e,i,r){i===xt||i.type()!==P.Nation||i.canSendEmoji(e)&&(r==="ðŸ–•"&&(i.updateRelation(e,-100),n.addExecution(new je(i,e.id(),t.randElement(Kb)))),r==="ðŸ¤¡"&&(i.updateRelation(e,-10),n.addExecution(new je(i,e.id(),t.randElement(ci)))),["ðŸ•Šï¸","ðŸ³ï¸","â¤ï¸","ðŸ¥°","ðŸ‘"].includes(r)&&(n.config().gameConfig().difficulty===_.Easy&&i.updateRelation(e,15),n.addExecution(new je(i,e.id(),e.relation(i)>=Pt.Neutral?t.randElement(oi):t.randElement(ci)))))}function l5(n,t,e){t.chance(8)&&e.canSendEmoji(xt)&&n.addExecution(new je(e,xt,t.randElement(Bh)))}class je{constructor(t,e,i){this.requestor=t,this.recipientID=e,this.emoji=i,this.active=!0}init(t,e){if(this.mg=t,this.random=new gt(t.ticks()),this.recipientID!==xt&&!t.hasPlayer(this.recipientID)){console.warn(`EmojiExecution: recipient ${this.recipientID} not found`),this.active=!1;return}this.recipient=this.recipientID===xt?xt:t.player(this.recipientID)}tick(t){const e=es[this.emoji];e===void 0?console.warn(`cannot send emoji ${this.emoji} from ${this.requestor} to ${this.recipient}`):this.requestor.canSendEmoji(this.recipient)?(this.requestor.sendEmoji(this.recipient,e),c5(this.mg,this.random,this.requestor,this.recipient,e)):console.warn(`cannot send emoji from ${this.requestor} to ${this.recipient}`),this.active=!1}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class Uh{constructor(t,e,i){this.sender=t,this.recipientID=e,this.troops=i,this.active=!0}init(t,e){if(this.mg=t,this.random=new gt(t.ticks()),!t.hasPlayer(this.recipientID)){console.warn(`DonateTroopExecution recipient ${this.recipientID} not found`),this.active=!1;return}this.recipient=t.player(this.recipientID),this.troops??=t.config().defaultDonationAmount(this.sender);const i=t.config().maxTroops(this.recipient)-this.recipient.troops();this.troops=Math.min(this.troops,i)}tick(t){if(this.troops===null)throw new Error("not initialized");const e=this.getMinTroopsForRelationUpdate();this.sender.canDonateTroops(this.recipient)&&this.sender.donateTroops(this.recipient,this.troops)?(this.troops>=e&&this.recipient.updateRelation(this.sender,50),this.recipient.type()===P.Nation&&this.recipient.canSendEmoji(this.sender)&&this.mg.addExecution(new je(this.recipient,this.sender.id(),this.random.randElement(this.troops>=e?oi:zh)))):console.warn(`cannot send troops from ${this.sender} to ${this.recipient}`),this.active=!1}getMinTroopsForRelationUpdate(){const{difficulty:t}=this.mg.config().gameConfig(),e=this.mg.config().maxTroops(this.recipient);switch(t){case _.Easy:return this.random.nextInt(e/13,e/11);case _.Medium:return this.random.nextInt(e/11,e/9);case _.Hard:return this.random.nextInt(e/9,e/7);case _.Impossible:return this.random.nextInt(e/7,e/5);default:dt(t)}}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}const h5=25;class ya{constructor(t,e,i){this.attacker=t,this.ref=e,this.troops=i,this.active=!0,this.ticksPerMove=1,this.originalOwner=this.attacker}activeDuringSpawnPhase(){return!1}init(t,e){if(!t.isValidRef(this.ref)){console.warn(`TransportShipExecution: ref ${this.ref} not valid`),this.active=!1;return}if(this.lastMove=e,this.mg=t,this.target=t.owner(this.ref),this.pathFinder=ye.Water(t),this.attacker.unitCount(m.TransportShip)>=t.config().boatMaxNumber()){t.displayMessage("events_display.no_boats_available",at.ATTACK_FAILED,this.attacker.id(),void 0,{max:t.config().boatMaxNumber()}),this.active=!1;return}if(this.target.isPlayer()&&!this.attacker.canAttackPlayer(this.target)){this.active=!1;return}if(this.troops??=this.mg.config().boatAttackAmount(this.attacker,this.target),this.troops=Math.min(this.troops,this.attacker.troops()),this.dst=Nh(this.mg,this.ref),this.dst===null){console.warn(`${this.attacker} cannot send ship to ${this.target}, cannot find target tile`),this.active=!1;return}const i=this.attacker.canBuild(m.TransportShip,this.dst);if(i===!1){console.warn(`${this.attacker} cannot send ship to ${this.target}, cannot find start tile`),this.active=!1;return}this.src=i,this.boat=this.attacker.buildUnit(m.TransportShip,this.src,{troops:this.troops,targetTile:this.dst}),this.target.id()!==t.terraNullius().id()&&t.displayIncomingUnit(this.boat.id(),`Naval invasion incoming from ${this.attacker.displayName()} (${si(this.boat.troops())})`,at.NAVAL_INVASION_INBOUND,this.target.id()),this.mg.stats().boatSendTroops(this.attacker,this.target,this.boat.troops())}tick(t){if(this.dst===null){this.active=!1;return}if(!this.active)return;if(!this.boat.isActive()){this.active=!1;return}if(t-this.lastMove<this.ticksPerMove)return;this.lastMove=t;const e=this.boat.owner();if(this.originalOwner.isDisconnected()&&e!==this.originalOwner&&e.isOnSameTeam(this.originalOwner)&&(this.attacker=e,this.originalOwner=e),this.boat.retreating()){if(this.mg.owner(this.src)!==this.attacker){const r=this.attacker.bestTransportShipSpawn(this.dst);r===!1?this.src=null:this.src=r}if(this.src===null){console.warn("TransportShipExecution: retreating but no src found for new attacker"),this.attacker.addTroops(this.boat.troops()),this.boat.delete(!1),this.active=!1;return}else this.dst=this.src,this.boat.targetTile()!==this.dst&&this.boat.setTargetTile(this.dst)}const i=this.pathFinder.next(this.boat.tile(),this.dst);switch(i.status){case tt.COMPLETE:if(this.mg.owner(this.dst)===this.attacker){const r=this.boat.troops()*(h5/100),s=this.boat.troops()-r;this.attacker.addTroops(s),this.boat.delete(!1),this.active=!1,this.mg.stats().boatArriveTroops(this.attacker,this.target,s),r&&this.mg.displayMessage("events_display.attack_cancelled_retreat",at.ATTACK_CANCELLED,this.attacker.id(),void 0,{troops:si(r)});return}this.attacker.conquer(this.dst),this.target.isPlayer()&&this.attacker.isFriendly(this.target)?this.attacker.addTroops(this.boat.troops()):this.mg.addExecution(new Ar(this.boat.troops(),this.attacker,this.target.id(),this.dst,!1)),this.boat.delete(!1),this.active=!1,this.mg.stats().boatArriveTroops(this.attacker,this.target,this.boat.troops());return;case tt.NEXT:this.boat.move(i.node);break;case tt.PENDING:break;case tt.NOT_FOUND:{const r=this.mg.map(),s=this.boat.tile();console.warn(`TransportShip path not found: boat@(${r.x(s)},${r.y(s)}) -> dst@(${r.x(this.dst)},${r.y(this.dst)}), attacker=${this.attacker.id()}, target=${this.target.id()}`),this.attacker.addTroops(this.boat.troops()),this.boat.delete(!1),this.active=!1;return}}}owner(){return this.attacker}isActive(){return this.active}}const At=class At{constructor(t,e,i,r){if(this.numLandTiles_=r,this._numTilesWithFallout=0,i.length!==t*e)throw new Error(`Terrain data length ${i.length} doesn't match dimensions ${t}x${e}`);this.width_=t,this.height_=e,this.terrain=i,this.state=new Uint16Array(t*e);let s=0;this.refToX=new Array(t*e),this.refToY=new Array(t*e),this.yToRef=new Array(e);for(let a=0;a<e;a++){this.yToRef[a]=s;for(let o=0;o<t;o++)this.refToX[s]=o,this.refToY[s]=a,s++}}numTilesWithFallout(){return this._numTilesWithFallout}ref(t,e){if(!this.isValidCoord(t,e))throw new Error(`Invalid coordinates: ${t},${e}`);return this.yToRef[e]+t}isValidRef(t){return t>=0&&t<this.refToX.length}x(t){return this.refToX[t]}y(t){return this.refToY[t]}cell(t){return new Dt(this.x(t),this.y(t))}width(){return this.width_}height(){return this.height_}numLandTiles(){return this.numLandTiles_}isValidCoord(t,e){return t>=0&&t<this.width_&&e>=0&&e<this.height_}isLand(t){return!!(this.terrain[t]&1<<At.IS_LAND_BIT)}isOceanShore(t){return this.isLand(t)&&this.neighbors(t).some(e=>this.isOcean(e))}isOcean(t){return!!(this.terrain[t]&1<<At.OCEAN_BIT)}isShoreline(t){return!!(this.terrain[t]&1<<At.SHORELINE_BIT)}magnitude(t){return this.terrain[t]&At.MAGNITUDE_MASK}ownerID(t){return this.state[t]&At.PLAYER_ID_MASK}hasOwner(t){return this.ownerID(t)!==0}setOwnerID(t,e){if(e>At.PLAYER_ID_MASK)throw new Error(`Player ID ${e} exceeds maximum value ${At.PLAYER_ID_MASK}`);this.state[t]=this.state[t]&~At.PLAYER_ID_MASK|e}hasFallout(t){return!!(this.state[t]&1<<At.FALLOUT_BIT)}setFallout(t,e){const i=this.hasFallout(t);e?i||(this._numTilesWithFallout++,this.state[t]|=1<<At.FALLOUT_BIT):i&&(this._numTilesWithFallout--,this.state[t]&=~(1<<At.FALLOUT_BIT))}isOnEdgeOfMap(t){const e=this.x(t),i=this.y(t);return e===0||e===this.width()-1||i===0||i===this.height()-1}isBorder(t){return this.neighbors(t).some(e=>this.ownerID(e)!==this.ownerID(t))}hasDefenseBonus(t){return!!(this.state[t]&1<<At.DEFENSE_BONUS_BIT)}setDefenseBonus(t,e){e?this.state[t]|=1<<At.DEFENSE_BONUS_BIT:this.state[t]&=~(1<<At.DEFENSE_BONUS_BIT)}isWater(t){return!this.isLand(t)}isLake(t){return!this.isLand(t)&&!this.isOcean(t)}isShore(t){return this.isLand(t)&&this.isShoreline(t)}cost(t){return this.magnitude(t)<10?2:1}terrainType(t){if(this.isLand(t)){const e=this.magnitude(t);return e<10?_t.Plains:e<20?_t.Highland:_t.Mountain}return this.isOcean(t)?_t.Ocean:_t.Lake}neighbors(t){const e=[],i=this.width_,r=this.refToX[t];return t>=i&&e.push(t-i),t<(this.height_-1)*i&&e.push(t+i),r!==0&&e.push(t-1),r!==i-1&&e.push(t+1),e}forEachTile(t){for(let e=0;e<this.width_*this.height_;e++)t(e)}manhattanDist(t,e){return Math.abs(this.x(t)-this.x(e))+Math.abs(this.y(t)-this.y(e))}euclideanDistSquared(t,e){const i=this.x(t)-this.x(e),r=this.y(t)-this.y(e);return i*i+r*r}circleSearch(t,e,i){const r={x:this.x(t),y:this.y(t)},s=new Set,a=Math.max(0,r.x-e),o=Math.min(this.width_-1,r.x+e),c=Math.max(0,r.y-e),l=Math.min(this.height_-1,r.y+e);for(let h=a;h<=o;++h)for(let d=c;d<=l;d++){const f=this.yToRef[d]+h,g=this.euclideanDistSquared(t,f);g>e*e||(!i||i(f,g))&&s.add(f)}return s}bfs(t,e){const i=new Set,r=[];for(e(this,t)&&(i.add(t),r.push(t));r.length>0;){const s=r.pop();if(s!==void 0)for(const a of this.neighbors(s))!i.has(a)&&e(this,a)&&(i.add(a),r.push(a))}return i}toTileUpdate(t){return BigInt(t)<<16n|BigInt(this.state[t])}updateTile(t){const e=Number(t>>16n),i=Number(t&0xffffn),r=this.hasFallout(e);this.state[e]=i;const s=this.hasFallout(e);return r&&!s&&this._numTilesWithFallout--,!r&&s&&this._numTilesWithFallout++,e}};At.IS_LAND_BIT=7,At.SHORELINE_BIT=6,At.OCEAN_BIT=5,At.MAGNITUDE_MASK=31,At.PLAYER_ID_MASK=4095,At.FALLOUT_BIT=13,At.DEFENSE_BONUS_BIT=14;let ba=At;function wa(n,t,e=!1){const i=t*t;return e?(r,s)=>{const a=r.x(n)-.5,o=r.y(n)-.5,c=r.x(s)-a,l=r.y(s)-o;return c*c+l*l<=i}:(r,s)=>r.euclideanDistSquared(n,s)<=i}function Wh(n,t,e=!1){return e?(i,r)=>{const s=i.x(n)-.5,a=i.y(n)-.5,o=Math.abs(i.x(r)-s),c=Math.abs(i.y(r)-a);return o+c<=t}:(i,r)=>i.manhattanDist(n,r)<=t}function u5(n,t){return(e,i)=>n(e,i)&&t(e,i)}function d5(n){const{gm:t,targetTile:e,magnitude:i}=n,r=i.inner*i.inner,s=new Map;return t.circleSearch(e,i.outer,(a,o)=>{const c=t.ownerID(a);if(c>0){const l=o<=r?1:.5,h=s.get(c)??0;s.set(c,h+l)}return!0}),s}function f5(n){const{game:t,targetTile:e,magnitude:i,threshold:r}=n,s=new Set,a=d5({gm:t,targetTile:e,magnitude:i});for(const[o,c]of a)c>r&&s.add(o);return t.nearbyUnits(e,i.outer,[...is]).forEach(({unit:o})=>s.add(o.owner().smallID())),s}function m5(n,t){return Array.from(n.bfs(t,wa(t,4,!0))).filter(e=>!n.hasOwner(e)&&n.isLand(e))}function _a(n,t,e){let i=1/0,r=null;for(const s of t){const a=n.manhattanDist(s,e);a<i&&(i=a,r=s)}return[r,i]}function en(n,t,e){const i=Array.from(t).sort((l,h)=>n.x(l)-n.x(h)),r=Array.from(e).sort((l,h)=>n.x(l)-n.x(h));if(i.length===0||r.length===0)return null;let s=0,a=0,o=1/0,c={x:i[0],y:r[0]};for(;s<i.length&&a<r.length;){const l=i[s],h=r[a],d=Math.abs(n.x(l)-n.x(h))+Math.abs(n.y(l)-n.y(h));d<o&&(o=d,c={x:l,y:h}),s===i.length-1?a++:a===r.length-1||n.x(l)<n.x(h)?s++:a++}return c}function g5(n,t){const e=t.borderTiles();if(e.size===0)return null;let i=1/0,r=-1/0,s=1/0,a=-1/0;for(const f of e){const g=n.x(f),p=n.y(f);g<i&&(i=g),g>r&&(r=g),p<s&&(s=p),p>a&&(a=p)}const o=Math.floor((i+r)/2),c=Math.floor((s+a)/2),l=n.ref(o,c);if(n.owner(l)===t)return l;let h=null,d=1/0;for(const f of e){const g=n.x(f)-o,p=n.y(f)-c,b=g*g+p*p;b<d&&(d=b,h=f)}return h}class $h{constructor(t,e,i,r,s,a,o,c){this.random=t,this.game=e,this.player=i,this.triggerRatio=r,this.reserveRatio=s,this.expandRatio=a,this.allianceBehavior=o,this.emojiBehavior=c,this.botAttackTroopsSent=0}maybeAttack(){if(this.player===null||this.allianceBehavior===void 0)throw new Error("not initialized");const t=Array.from(this.player.borderTiles()).flatMap(a=>this.game.neighbors(a)).filter(a=>this.game.isLand(a)&&this.game.ownerID(a)!==this.player?.smallID()),e=[...new Set(t.map(a=>this.game.playerBySmallID(this.game.ownerID(a))).filter(a=>a.isPlayer()))].sort((a,o)=>a.troops()-o.troops()),i=e.filter(a=>this.player?.isFriendly(a)===!0),r=e.filter(a=>this.player?.isFriendly(a)===!1);if(t.some(a=>!this.game.hasOwner(a)&&!this.game.hasFallout(a))){this.sendAttack(this.game.terraNullius());return}if(r.length===0)this.random.chance(5)&&this.attackWithRandomBoat();else{if(this.random.chance(10)){this.attackWithRandomBoat(r);return}this.allianceBehavior.maybeSendAllianceRequests(r)}this.attackBestTarget(i,r)}attackWithRandomBoat(t=[]){if(this.player===null)throw new Error("not initialized");if(this.player.unitCount(m.TransportShip)>=this.game.config().boatMaxNumber())return;const e=Array.from(this.player.borderTiles()).filter(s=>this.game.isOceanShore(s));if(e.length===0)return;const i=this.random.randElement(e);let r=this.findRandomBoatTarget(i,t,!0);r===null&&(r=this.findRandomBoatTarget(i,t,!1),r===null)||this.game.addExecution(new ya(this.player,r,this.player.troops()/5))}findRandomBoatTarget(t,e,i=!1){if(this.player===null)throw new Error("not initialized");const r=this.game.x(t),s=this.game.y(t),a=new Set;for(let o=0;o<500;o++){const c=this.random.nextInt(r-150,r+150),l=this.random.nextInt(s-150,s+150);if(!this.game.isValidCoord(c,l))continue;const h=this.game.ref(c,l);if(!this.game.isLand(h))continue;const d=this.game.owner(h);if(d===this.player||d.isPlayer()&&a.has(d.id())||d.isPlayer()&&e.includes(d)||d.isPlayer()&&d.troops()>this.player.troops())continue;let f=!1;if(i?f=!d.isPlayer()||d.type()===P.Bot:f=!d.isPlayer()||!d.isFriendly(this.player),!!f){if(Pr(this.game,this.player,h)===!1){d.isPlayer()&&a.add(d.id());continue}return h}}return null}attackBestTarget(t,e){if(!this.hasReserveRatioTroops()||!this.hasTriggerRatioTroops()&&!this.random.chance(10))return;const i=this.getAttackStrategies(t,e);for(const r of i)if(r())return}getAttackStrategies(t,e){const{difficulty:i}=this.game.config().gameConfig(),r=()=>{const w=this.findIncomingAttackPlayer();return w?(this.sendAttack(w,!0),!0):!1},s=()=>this.attackBots(),a=()=>this.assistAllies(),o=()=>{const w=this.findTraitor(e);return w?(this.sendAttack(w),!0):!1},c=()=>{const w=e.find(v=>v.isDisconnected()&&v.troops()<this.player.troops()*3);return w?(this.sendAttack(w),!0):!1},l=()=>this.maybeBetrayAndAttack(t,e),h=()=>this.isBorderingNukedTerritory()?(this.sendAttack(this.game.terraNullius()),!0):!1,d=()=>{const w=this.findVictim(e);return w?(this.sendAttack(w),!0):!1},f=()=>{for(const w of this.player.allRelationsSorted()){if(w.relation!==Pt.Hostile)continue;const v=w.player;if(!this.player.isFriendly(v)&&!(v.troops()>this.player.troops()*3))return this.sendAttack(v),!0}return!1},g=()=>{const w=this.findVeryWeakEnemy(e);return w?(this.sendAttack(w),!0):!1},p=()=>{if(e.length>0){const w=e[0];if(w.troops()<this.player.troops())return this.sendAttack(w),!0}return!1},b=()=>{if(e.length===0){const w=this.findNearestIslandEnemy();if(w)return this.sendAttack(w),!0}return!1},S=()=>this.donateTroops();switch(i){case _.Easy:return[h,s,r,a,l,f,p];case _.Medium:return[s,h,r,a,l,f,c,o,p,b,S];case _.Hard:return[s,r,a,l,h,o,c,f,g,d,p,b,S];case _.Impossible:return[r,s,g,a,o,c,l,d,h,f,p,b,S];default:dt(i)}}hasReserveRatioTroops(){const t=this.game.config().maxTroops(this.player);return this.player.troops()/t>=this.reserveRatio}hasTriggerRatioTroops(){const t=this.game.config().maxTroops(this.player);return this.player.troops()/t>=this.triggerRatio}findIncomingAttackPlayer(){let t=this.player.incomingAttacks();this.player.type()!==P.Bot&&(t=t.filter(r=>r.attacker().type()!==P.Bot));let e=0,i;for(const r of t)r.troops()<=e||(e=r.troops(),i=r.attacker());return i!==void 0?i:null}attackBots(){const t=this.player.neighbors().filter(s=>s.isPlayer()&&this.player.isFriendly(s)===!1&&s.type()===P.Bot);if(t.length===0)return!1;this.botAttackTroopsSent=0;const e=s=>s.troops()/s.numTilesOwned(),r=t.slice().sort((s,a)=>e(s)-e(a)).slice(0,this.getBotAttackMaxParallelism());for(const s of r)this.sendAttack(s);return this.botAttackTroopsSent>0}getBotAttackMaxParallelism(){const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return 1;case _.Medium:return this.random.chance(2)?1:2;case _.Hard:return 3;case _.Impossible:return 100;default:dt(t)}}assistAllies(){if(this.emojiBehavior===void 0)throw new Error("not initialized");for(const t of this.player.allies())if(t.targets().length!==0){if(this.player.relation(t)<Pt.Friendly){this.emojiBehavior.sendEmoji(t,Gb);continue}for(const e of t.targets()){if(e===this.player){this.emojiBehavior.sendEmoji(t,Zb);continue}if(this.player.isFriendly(e)){this.emojiBehavior.sendEmoji(t,Yb);continue}return this.player.updateRelation(t,-20),this.sendAttack(e),this.emojiBehavior.sendEmoji(t,Hb),!0}}return!1}findTraitor(t){return t.find(e=>e.isTraitor()&&e.troops()<this.player.troops()*1.2)??null}maybeBetrayAndAttack(t,e){if(this.allianceBehavior===void 0)throw new Error("not initialized");if(t.length>0){for(const i of t)if(this.allianceBehavior.maybeBetray(i,t.length+e.length))return this.sendAttack(i,!0),!0}return!1}isBorderingNukedTerritory(){for(const t of this.player.borderTiles())for(const e of this.game.neighbors(t))if(this.game.isLand(e)&&!this.game.hasOwner(e)&&this.game.hasFallout(e))return!0;return!1}findVictim(t){return t.find(e=>e.troops()>this.player.troops()*1.2?!1:e.incomingAttacks().reduce((r,s)=>r+s.troops(),0)>e.troops()*.5)??null}findVeryWeakEnemy(t){const e=t.filter(i=>{const r=this.game.config().maxTroops(i);return i.troops()<r*.15&&i.troops()<this.player.troops()*1.2});return e.length>0?e[0]:null}findNearestIslandEnemy(){if(this.player.unitCount(m.TransportShip)>=this.game.config().boatMaxNumber()||!Array.from(this.player.borderTiles()).some(s=>this.game.isOceanShore(s)))return null;const e=this.game.players().filter(s=>s===this.player||this.player.isFriendly(s)?!1:s.troops()<this.player.troops());if(e.length===0)return null;const i=this.getPlayerCenter(this.player),r=e.map(s=>{const a=this.getPlayerCenter(s),o=this.game.ref(i.x,i.y),c=this.game.ref(a.x,a.y),l=this.game.manhattanDist(o,c);return{player:s,distance:l}}).sort((s,a)=>s.distance-a.distance);for(const s of r){const a=en(this.game,Array.from(this.player.borderTiles()).filter(o=>this.game.isOceanShore(o)),Array.from(s.player.borderTiles()).filter(o=>this.game.isOceanShore(o)));if(a!==null&&Pr(this.game,this.player,a.y))return s.player}return null}getPlayerCenter(t){return t.largestClusterBoundingBox?lo(t.largestClusterBoundingBox):Vd(this.game,t.borderTiles())}attackRandomTarget(){if(!this.hasTriggerRatioTroops())return;const t=this.findIncomingAttackPlayer();if(t){this.sendAttack(t,!0);return}const e=this.getNeighborTraitorToAttack();if(e!==null&&this.random.chance(3)){this.sendAttack(e);return}const i=this.player.neighbors();for(const r of this.random.shuffleArray(i))if(r.isPlayer()&&!this.player.isFriendly(r)&&!((r.type()===P.Nation||r.type()===P.Human)&&this.random.chance(2))){this.sendAttack(r);return}}getNeighborTraitorToAttack(){const t=this.player.neighbors().filter(e=>e.isPlayer()&&this.player.isFriendly(e)===!1&&e.isTraitor());return t.length>0?this.random.randElement(t):null}forceSendAttack(t){this.game.addExecution(new Ar(this.player.troops()/2,this.player,t.isPlayer()?t.id():this.game.terraNullius().id()))}sendAttack(t,e=!1){!e&&!this.shouldAttack(t)||(this.player.sharesBorderWith(t)?this.sendLandAttack(t):t.isPlayer()&&this.sendBoatAttack(t))}shouldAttack(t){if(t.isPlayer()===!1||t.type()!==P.Human||t.isTraitor()||this.player.type()===P.Bot||this.game.config().gameConfig().playerTeams===On)return!0;const{difficulty:e}=this.game.config().gameConfig();return!(e===_.Easy&&this.random.chance(2)||e===_.Medium&&this.random.chance(4))}sendLandAttack(t){const e=this.game.config().maxTroops(this.player),i=t.isPlayer()?this.reserveRatio:this.expandRatio,r=e*i;let s;if(t.isPlayer()&&t.type()===P.Bot&&this.player.type()!==P.Bot?s=this.calculateBotAttackTroops(t,this.player.troops()-r-this.botAttackTroopsSent):s=this.player.troops()-r,!(s<1)){if(t.isPlayer()&&this.player.type()===P.Nation){if(this.emojiBehavior===void 0)throw new Error("not initialized");this.emojiBehavior.maybeSendAttackEmoji(t)}this.game.addExecution(new Ar(s,this.player,t.isPlayer()?t.id():this.game.terraNullius().id()))}}sendBoatAttack(t){const e=en(this.game,Array.from(this.player.borderTiles()).filter(r=>this.game.isOceanShore(r)),Array.from(t.borderTiles()).filter(r=>this.game.isOceanShore(r)));if(e===null||!Pr(this.game,this.player,e.y))return;let i;if(t.type()===P.Bot?i=this.calculateBotAttackTroops(t,this.player.troops()/5):i=this.player.troops()/5,!(i<1)){if(t.isPlayer()&&this.player.type()===P.Nation){if(this.emojiBehavior===void 0)throw new Error("not initialized");this.emojiBehavior.maybeSendAttackEmoji(t)}this.game.addExecution(new ya(this.player,e.y,i))}}calculateBotAttackTroops(t,e){const{difficulty:i}=this.game.config().gameConfig();if(i===_.Easy)return this.botAttackTroopsSent+=e,e;let r=t.troops()*4;return r>e&&(e<t.troops()*2?r=0:r=e),this.botAttackTroopsSent+=r,r}donateTroops(){if(this.game.config().gameConfig().gameMode!==Ct.Team||this.game.config().donateTroops()===!1||this.game.getWinner()!==null)return!1;const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return!1;case _.Medium:if(!this.random.chance(4))return!1;break;case _.Hard:if(!this.random.chance(2))return!1;break;case _.Impossible:break;default:dt(t)}const e=this.game.players().filter(c=>this.player.isOnSameTeam(c)).filter(c=>c.incomingAttacks().length>0||c.outgoingAttacks().length>0);if(e.length===0)return!1;const i=e.map(c=>{const l=this.game.config().maxTroops(c),h=c.troops()/Math.max(l,1);return{teammate:c,troopPercentage:h}}).sort((c,l)=>c.troopPercentage-l.troopPercentage);let r=null;for(const c of i)if(this.player.canDonateTroops(c.teammate)){r=c.teammate;break}if(r===null)return!1;const a=this.game.config().maxTroops(this.player)*this.reserveRatio,o=this.player.troops()-a;return o<1?!1:(this.game.addExecution(new Uh(this.player,r.id(),o)),!0)}}class p5{constructor(t){this.bot=t,this.active=!0,this.neighborsTerraNullius=!0,this.attackBehavior=null,this.random=new gt(It(t.id())),this.attackRate=this.random.nextInt(40,80),this.attackTick=this.random.nextInt(0,this.attackRate),this.triggerRatio=this.random.nextInt(50,60)/100,this.reserveRatio=this.random.nextInt(30,40)/100,this.expandRatio=this.random.nextInt(10,20)/100}activeDuringSpawnPhase(){return!1}init(t){this.mg=t}tick(t){if(t%this.attackRate===this.attackTick){if(!this.bot.isAlive()){this.active=!1;return}if(this.attackBehavior===null){this.attackBehavior=new $h(this.random,this.mg,this.bot,this.triggerRatio,this.reserveRatio,this.expandRatio),this.attackBehavior.sendAttack(this.mg.terraNullius());return}this.acceptAllAllianceRequests(),this.deleteAllStructures(),this.maybeAttack()}}acceptAllAllianceRequests(){for(const t of this.bot.incomingAllianceRequests())t.accept();for(const t of this.bot.alliances()){if(!t.onlyOneAgreedToExtend())continue;const e=t.other(this.bot);this.mg.addExecution(new la(this.bot,e.id()))}}deleteAllStructures(){for(const t of this.bot.units())bo(t.type())&&this.bot.canDeleteUnit()&&this.mg.addExecution(new xh(this.bot,t.id()))}maybeAttack(){if(this.attackBehavior===null)throw new Error("not initialized");const t=this.attackBehavior.getNeighborTraitorToAttack();if(t!==null){const e=this.bot.isFriendly(t)?6:3;if(this.random.chance(e)){const i=this.bot.allianceWith(t);i!==null&&this.bot.breakAlliance(i),this.attackBehavior.sendAttack(t);return}}if(this.neighborsTerraNullius){if(this.bot.neighbors().some(e=>!e.isPlayer())){this.attackBehavior.sendAttack(this.mg.terraNullius());return}this.neighborsTerraNullius=!1}this.attackBehavior.attackRandomTarget()}isActive(){return this.active}}const Fh=new WeakMap;class y5{constructor(t){this.player=t,this.ticksPerClusterCalc=20,this.lastCalc=0,this.active=!0}activeDuringSpawnPhase(){return!1}init(t,e){this.mg=t,this.config=t.config(),this.lastCalc=e+It(this.player.name())%this.ticksPerClusterCalc}tick(t){this.player.decayRelations();for(const a of this.player.units()){if(!a.info().territoryBound)continue;const o=this.mg.owner(a.tile());if(!o?.isPlayer()){a.delete();continue}if(o===this.player)continue;const c=this.mg.player(o.id());a.type()===m.DefensePost?(a.decreaseLevel(c),a.isActive()&&c.captureUnit(a)):c.captureUnit(a)}if(!this.player.isAlive()){const a=this.player.gold();this.player.removeGold(a),this.player.units().forEach(o=>{o.type()!==m.AtomBomb&&o.type()!==m.HydrogenBomb&&o.type()!==m.MIRVWarhead&&o.type()!==m.MIRV&&o.delete()}),this.active=!1,this.mg.stats().playerKilled(this.player,t);return}const e=this.config.troopIncreaseRate(this.player);this.player.addTroops(e);const i=this.config.goldAdditionRate(this.player);this.player.addGold(i),this.mg.stats().goldWork(this.player,i);const r=Array.from(this.player.alliances());for(const a of r)a.expiresAt()<=this.mg.ticks()&&a.expire();const s=this.player.getEmbargoes();for(const a of s)a.isTemporary&&this.mg.ticks()-a.createdAt>this.mg.config().temporaryEmbargoDuration()&&this.player.stopEmbargo(a.target);if(t-this.lastCalc>this.ticksPerClusterCalc&&this.player.lastTileChange()>this.lastCalc){this.lastCalc=t;const a=performance.now();this.removeClusters();const o=performance.now();o-a>1e3&&console.log(`player ${this.player.name()}, took ${o-a}ms`)}}removeClusters(){const t=this.calculateClusters();if(t.length===0){this.player.largestClusterBoundingBox=null;return}let e=0,i=t[0].size;for(let o=1;o<t.length;o++){const c=t[o].size;c>i&&(i=c,e=o)}const r=t[e];if(r===void 0)throw new Error("No clusters");const s=Ze(this.mg,r);this.player.largestClusterBoundingBox=s;const a=this.surroundedBySamePlayer(r,s);a&&!a.isFriendly(this.player)&&this.removeCluster(r);for(let o=0;o<t.length;o++){if(o===e)continue;const c=t[o];this.isSurrounded(c)&&this.removeCluster(c)}}surroundedBySamePlayer(t,e){const i=new Set;for(const a of t){let o=!1;if(this.mg.isOceanShore(a)||this.mg.isOnEdgeOfMap(a)||(this.mg.forEachNeighbor(a,c=>{if(!this.mg.hasOwner(c)){o=!0;return}const l=this.mg.ownerID(c);l!==this.player.smallID()&&i.add(l)}),o)||i.size!==1)return!1}if(i.size!==1)return!1;const r=this.mg.playerBySmallID(Array.from(i)[0]),s=Ze(this.mg,r.borderTiles());return ho(s,e)?r:!1}isSurrounded(t){let e=!1,i=1/0,r=1/0,s=-1/0,a=-1/0;for(const l of t){if(this.mg.isShore(l)||this.mg.isOnEdgeOfMap(l))return!1;this.mg.forEachNeighbor(l,h=>{if(this.mg.owner(h).isPlayer()&&this.mg.ownerID(h)!==this.player.smallID()){e=!0;const f=this.mg.x(h),g=this.mg.y(h);i=Math.min(i,f),r=Math.min(r,g),s=Math.max(s,f),a=Math.max(a,g)}})}if(!e)return!1;const o=Ze(this.mg,t),c={min:new Dt(i,r),max:new Dt(s,a)};return ho(c,o)}removeCluster(t){for(const s of t)if(this.mg?.ownerID(s)!==this.player?.smallID())return;const e=this.getCapturingPlayer(t);if(e===null)return;const i=t.values().next().value;if(!i)return;const r=this.floodFillWithGen(this.bumpGeneration(),this.traversalState().visited,[i],(s,a)=>this.mg.forEachNeighbor(s,a),s=>this.mg.ownerID(s)===this.player.smallID());this.player.numTilesOwned()===r.size&&this.mg.conquerPlayer(e,this.player);for(const s of r)e.conquer(s)}getCapturingPlayer(t){const e=new Map;for(const s of t)this.mg.forEachNeighbor(s,a=>{const o=this.mg.owner(a);o.isPlayer()&&o!==this.player&&!o.isFriendly(this.player)&&e.set(o,(e.get(o)??0)+1)});if(e.size===0)return null;let i=null,r=0;for(const[s]of e)for(const a of s.outgoingAttacks())a.target()===this.player&&a.troops()>r&&(r=a.troops(),i=s);return i!==null?i:Xd(e)}calculateClusters(){const t=this.player.borderTiles();if(t.size===0)return[];const e=this.traversalState(),i=this.bumpGeneration(),r=e.visited,s=[];for(const a of t){if(r[a]===i)continue;const o=this.floodFillWithGen(i,r,[a],(c,l)=>this.mg.forEachNeighborWithDiag(c,l),c=>t.has(c));s.push(o)}return s}owner(){if(this.player===null)throw new Error("Not initialized");return this.player}isActive(){return this.active}traversalState(){const t=this.mg.width()*this.mg.height();let e=Fh.get(this.mg);return(!e||e.visited.length<t)&&(e={visited:new Uint32Array(t),gen:0},Fh.set(this.mg,e)),e}bumpGeneration(){const t=this.traversalState();return t.gen++,t.gen===4294967295&&(t.visited.fill(0),t.gen=1),t.gen}floodFillWithGen(t,e,i,r,s){const a=new Set,o=[];for(const c of i)e[c]!==t&&s(c)&&(e[c]=t,a.add(c),o.push(c));for(;o.length>0;){const c=o.pop();r(c,l=>{e[l]!==t&&s(l)&&(e[l]=t,a.add(l),o.push(l))})}return a}}const Ur=class Ur{constructor(t,e,i){this.playerInfo=e,this.tile=i,this.active=!0,this.random=new gt(It(e.id)+It(t))}init(t,e){this.mg=t}tick(t){if(this.active=!1,!this.mg.inSpawnPhase()){this.active=!1;return}let e=null;if(this.mg.hasPlayer(this.playerInfo.id)?e=this.mg.player(this.playerInfo.id):e=this.mg.addPlayer(this.playerInfo),!(this.mg.config().isRandomSpawn()&&e.hasSpawned())){if(this.tile??=this.randomSpawnLand(),this.tile===void 0){console.warn(`SpawnExecution: cannot spawn ${this.playerInfo.name}`);return}e.tiles().forEach(i=>e.relinquish(i)),m5(this.mg,this.tile).forEach(i=>{e.conquer(i)}),e.hasSpawned()||(this.mg.addExecution(new y5(e)),e.type()===P.Bot&&this.mg.addExecution(new p5(e))),e.setSpawnTile(this.tile)}}isActive(){return this.active}activeDuringSpawnPhase(){return!0}randomSpawnLand(){let t=0;for(;t<Ur.MAX_SPAWN_TRIES;){t++;const e=this.randTile();if(!(!this.mg.isLand(e)||this.mg.hasOwner(e)||this.mg.isBorder(e)||this.mg.allPlayers().filter(r=>r.id()!==this.playerInfo.id).some(r=>{const s=r.spawnTile();return s===void 0?!1:this.mg.manhattanDist(s,e)<this.mg.config().minDistanceBetweenPlayers()})))return e}}randTile(){const t=this.random.nextInt(0,this.mg.width()),e=this.random.nextInt(0,this.mg.height());return this.mg.ref(t,e)}};Ur.MAX_SPAWN_TRIES=1e3;let nn=Ur;class b5{constructor(t,e){this.gs=t,this.gameID=e,this.bots=[],this.random=new gt(It(e))}spawnBots(t){for(let e=0;e<t;e++){const i=this.randomBotName(),r=this.spawnBot(i);this.bots.push(r)}return this.bots}spawnBot(t){return new nn(this.gameID,new Bi(t,P.Bot,null,this.random.nextID()))}randomBotName(){const t=this.random.nextInt(0,so.length),e=this.random.nextInt(0,ao.length);return`${so[t]} ${ao[e]}`}}var rt=(n=>(n[n.Tile=0]="Tile",n[n.Unit=1]="Unit",n[n.Player=2]="Player",n[n.DisplayEvent=3]="DisplayEvent",n[n.DisplayChatEvent=4]="DisplayChatEvent",n[n.AllianceRequest=5]="AllianceRequest",n[n.AllianceRequestReply=6]="AllianceRequestReply",n[n.BrokeAlliance=7]="BrokeAlliance",n[n.AllianceExpired=8]="AllianceExpired",n[n.AllianceExtension=9]="AllianceExtension",n[n.TargetPlayer=10]="TargetPlayer",n[n.Emoji=11]="Emoji",n[n.Win=12]="Win",n[n.Hash=13]="Hash",n[n.UnitIncoming=14]="UnitIncoming",n[n.BonusEvent=15]="BonusEvent",n[n.RailroadDestructionEvent=16]="RailroadDestructionEvent",n[n.RailroadConstructionEvent=17]="RailroadConstructionEvent",n[n.RailroadSnapEvent=18]="RailroadSnapEvent",n[n.ConquestEvent=19]="ConquestEvent",n[n.EmbargoEvent=20]="EmbargoEvent",n[n.GamePaused=21]="GamePaused",n))(rt||{});class qh{onStop(t,e,i){const r=e.unit.owner(),s=i.owner(),a=t.config().trainGold(T5(s,r));s!==r&&(r.addGold(a,e.tile()),t.stats().trainExternalTrade(s,a)),s.addGold(a,e.tile()),t.stats().trainSelfTrade(s,a)}}class w5{onStop(t,e,i){}}function _5(n){return{[m.City]:new qh,[m.Port]:new qh,[m.Factory]:new w5}}class S5{constructor(t,e){this.mg=t,this.unit=e,this.id=-1,this.stopHandlers={},this.railroads=new Set,this.railroadByNeighbor=new Map,this.stopHandlers=_5(new gt(t.ticks()))}tradeAvailable(t){const e=this.unit.owner();return t===e||e.canTrade(t)}clearRailroads(){this.railroads.clear(),this.railroadByNeighbor.clear()}addRailroad(t){this.railroads.add(t);const e=t.from===this?t.to:t.from;this.railroadByNeighbor.set(e,t)}removeRailroad(t){this.railroads.delete(t);const e=t.from===this?t.to:t.from;this.railroadByNeighbor.delete(e)}removeNeighboringRails(t){const e=[...this.railroads].find(i=>i.from===t||i.to===t);e&&(this.mg.addUpdate({type:rt.RailroadDestructionEvent,id:e.id}),this.removeRailroad(e))}neighbors(){const t=[];for(const e of this.railroads)e.from!==this?t.push(e.from):t.push(e.to);return t}tile(){return this.unit.tile()}isActive(){return this.unit.isActive()}getRailroads(){return this.railroads}getRailroadTo(t){return this.railroadByNeighbor.get(t)??null}setCluster(t){this.cluster=t}getCluster(){return this.cluster}onTrainStop(t){const e=this.unit.type(),i=this.stopHandlers[e];i&&i.onStop(this.mg,this,t)}}class Sa{constructor(){this.stations=new Set,this.tradeStations=new Set}isTradeStation(t){const e=t.unit.type();return e===m.City||e===m.Port}has(t){return this.stations.has(t)}addStation(t){this.stations.add(t),this.isTradeStation(t)&&this.tradeStations.add(t),t.setCluster(this)}removeStation(t){this.stations.delete(t),this.tradeStations.delete(t)}addStations(t){for(const e of t)this.addStation(e)}merge(t){for(const e of t.stations)this.addStation(e)}hasAnyTradeDestination(t){for(const e of this.tradeStations)if(e.tradeAvailable(t))return!0;return!1}randomTradeDestination(t,e){let i=null,r=0;for(const s of this.tradeStations)s.tradeAvailable(t)&&(r++,e.nextInt(0,r)===0&&(i=s));return i}availableForTrade(t){const e=new Set;for(const i of this.tradeStations)i.tradeAvailable(t)&&e.add(i);return e}size(){return this.stations.size}clear(){this.stations.clear(),this.tradeStations.clear()}}function T5(n,t){return n===t?"self":n.isOnSameTeam(t)?"team":n.isAlliedWith(t)?"ally":"other"}class Ta{constructor(t,e,i,r){this.from=t,this.to=e,this.tiles=i,this.id=r}delete(t){t.addUpdate({type:rt.RailroadDestructionEvent,id:this.id}),this.from.removeRailroad(this),this.to.removeRailroad(this)}getClosestTileIndex(t,e){if(this.tiles.length===0)return-1;const i=t.x(e),r=t.y(e);let s=0,a=1/0;for(let o=0;o<this.tiles.length;o++){const c=this.tiles[o],l=t.x(c)-i,h=t.y(c)-r,d=l*l+h*h;d<a&&(a=d,s=o)}return s}}function jh(n,t){const e=n.getRailroadTo(t);if(!e)return null;const i=e.to===t;return new v5(e,i)}class v5{constructor(t,e){this.railroad=t,this.forward=e,this.tiles=[],this.tiles=this.forward?this.railroad.tiles:[...this.railroad.tiles].reverse()}getTiles(){return this.tiles}getStart(){return this.forward?this.railroad.from:this.railroad.to}getEnd(){return this.forward?this.railroad.to:this.railroad.from}}class A5{constructor(t,e,i,r,s){this.railNetwork=t,this.player=e,this.source=i,this.destination=r,this.numCars=s,this.active=!0,this.mg=null,this.train=null,this.cars=[],this.hasCargo=!1,this.currentTile=0,this.spacing=2,this.usedTiles=[],this.stations=[],this.currentRailroad=null,this.speed=2}owner(){return this.player}init(t,e){this.mg=t;const i=this.railNetwork.findStationsPath(this.source,this.destination);if(!i||i.length<=1){this.active=!1;return}this.stations=i;const r=jh(this.stations[0],this.stations[1]);if(r)this.currentRailroad=r;else{this.active=!1;return}const s=this.player.canBuild(m.Train,this.stations[0].tile());if(s===!1){console.warn("cannot build train"),this.active=!1;return}this.train=this.createTrainUnits(s)}tick(t){if(this.train===null)throw new Error("Not initialized");if(!this.train.isActive()||!this.activeSourceOrDestination()){this.deleteTrain();return}const e=this.getNextTile();e?this.updateCarsPositions(e):(this.targetReached(),this.deleteTrain())}loadCargo(){if(!(this.hasCargo||this.train===null)){this.hasCargo=!0;for(let t=1;t<this.cars.length;t++)this.cars[t].setLoaded(!0)}}targetReached(){this.train!==null&&(this.train.setReachedTarget(),this.cars.forEach(t=>{t.setReachedTarget()}))}createTrainUnits(t){const e=this.player.buildUnit(m.Train,t,{targetUnit:this.destination.unit,trainType:zn.Engine});this.cars.push(this.player.buildUnit(m.Train,t,{targetUnit:this.destination.unit,trainType:zn.TailEngine}));for(let i=0;i<this.numCars;i++)this.cars.push(this.player.buildUnit(m.Train,t,{trainType:zn.Carriage,loaded:this.hasCargo}));return e}deleteTrain(){this.active=!1,this.train?.isActive()&&this.train.delete(!1);for(const t of this.cars)t.isActive()&&t.delete(!1)}activeSourceOrDestination(){return this.stations.length>1&&this.stations[1].isActive()&&this.stations[0].isActive()}saveTraversedTiles(t,e){if(!this.currentRailroad)return;let i=t;for(let r=0;r<e&&i<this.currentRailroad.getTiles().length;r++)this.saveTile(this.currentRailroad.getTiles()[i]),i=i+1}saveTile(t){this.usedTiles.push(t),this.usedTiles.length>this.cars.length*this.spacing+3&&this.usedTiles.shift()}updateCarsPositions(t){if(this.cars.length>0)for(let e=this.cars.length-1;e>=0;--e){const i=(e+1)*this.spacing+2;this.usedTiles.length>i&&this.cars[e].move(this.usedTiles[i])}this.train!==null&&this.train.move(t)}nextStation(){if(this.stations.length>2){this.stations.shift();const t=jh(this.stations[0],this.stations[1]);if(t)return this.currentRailroad=t,!0}return!1}canTradeWithDestination(){return this.stations.length>1&&this.stations[1].tradeAvailable(this.player)}getNextTile(){if(this.currentRailroad===null||!this.canTradeWithDestination())return null;this.saveTraversedTiles(this.currentTile,this.speed),this.currentTile=this.currentTile+this.speed;const t=this.currentTile-this.currentRailroad.getTiles().length;if(t>=0){if(this.stationReached(),!this.nextStation())return null;this.currentTile=t,this.saveTraversedTiles(0,t)}return this.currentRailroad.getTiles()[this.currentTile]}stationReached(){if(this.mg===null||this.player===null)throw new Error("Not initialized");this.stations[1].onTrainStop(this)}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class Dr{constructor(t,e){this.unit=t,this.spawnTrains=e,this.active=!0,this.station=null,this.numCars=5,this.lastSpawnTick=0,this.ticksCooldown=10,this.unit.setTrainStation(!0)}isActive(){return this.active}init(t,e){this.mg=t,this.spawnTrains&&(this.random=new gt(t.ticks()))}tick(t){if(this.mg===void 0)throw new Error("Not initialized");if(!(!this.isActive()||this.unit===void 0)){if(this.station===null&&(this.station=new S5(this.mg,this.unit),this.mg.railNetwork().connectStation(this.station)),!this.station.isActive()){this.active=!1;return}this.spawnTrains&&this.spawnTrain(this.station,t)}}shouldSpawnTrain(){const t=this.mg.config().trainSpawnRate(this.unit.owner().unitCount(m.Factory));for(let e=0;e<this.unit.level();e++)if(this.random.chance(t))return!0;return!1}spawnTrain(t,e){if(this.mg===void 0)throw new Error("Not initialized");if(!this.spawnTrains)return;if(this.random===void 0)throw new Error("Not initialized");if(e<this.lastSpawnTick+this.ticksCooldown)return;const i=t.getCluster();if(i===null)return;const r=this.unit.owner();if(!i.hasAnyTradeDestination(r)||!this.shouldSpawnTrain())return;const s=i.randomTradeDestination(r,this.random);s!==null&&s!==t&&(this.mg.addExecution(new A5(this.mg.railNetwork(),r,t,s,this.numCars)),this.lastSpawnTick=e)}activeDuringSpawnPhase(){return!1}}class E5{constructor(t){this.city=t,this.active=!0,this.stationCreated=!1}init(t,e){this.mg=t}tick(t){if(this.stationCreated||(this.createStation(),this.stationCreated=!0),!this.city.isActive()){this.active=!1;return}}isActive(){return this.active}activeDuringSpawnPhase(){return!1}createStation(){this.mg.hasUnitNearby(this.city.tile(),this.mg.config().trainStationMaxRange(),m.Factory)&&this.mg.addExecution(new Dr(this.city))}}class Hh{constructor(t,e,i,r){this.spawn=t,this._owner=e,this.ownerUnit=i,this.target=r,this.active=!0,this.destroyAtTick=-1}init(t,e){this.pathFinder=ye.Air(t),this.mg=t,this.random=new gt(t.ticks())}tick(t){if(this.shell??=this._owner.buildUnit(m.Shell,this.spawn,{}),!this.shell.isActive()){this.active=!1;return}if(!this.target.isActive()||this.target.owner()===this.shell.owner()||this.destroyAtTick!==-1&&this.mg.ticks()>=this.destroyAtTick){this.shell.delete(!1),this.active=!1;return}this.destroyAtTick===-1&&!this.ownerUnit.isActive()&&(this.destroyAtTick=this.mg.ticks()+this.mg.config().shellLifetime());for(let e=0;e<3;e++){const i=this.pathFinder.next(this.shell.tile(),this.target.tile());if(i.status===tt.COMPLETE){this.active=!1,this.target.modifyHealth(-this.effectOnTarget(),this._owner),this.shell.setReachedTarget(),this.shell.delete(!1);return}else i.status===tt.NEXT&&this.shell.move(i.node)}}effectOnTarget(){const{damage:t}=this.mg.config().unitInfo(m.Shell),e=t??250,r=(this.random.nextInt(1,6)-1)*25+200;return Math.round(e/250*r)}getEffectOnTargetForTesting(){return this.effectOnTarget()}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class k5{constructor(t){this.post=t,this.active=!0,this.target=null,this.lastShellAttack=0,this.alreadySentShell=new Set}init(t,e){this.mg=t}shoot(){if(this.target===null)return;const t=this.mg.config().defensePostShellAttackRate();if(this.mg.ticks()-this.lastShellAttack>t&&(this.lastShellAttack=this.mg.ticks(),this.mg.addExecution(new Hh(this.post.tile(),this.post.owner(),this.post,this.target)),!this.target.hasHealth())){this.alreadySentShell.add(this.target),this.target=null;return}}tick(t){if(!this.post.isActive()){this.active=!1;return}this.post.isUnderConstruction()||this.target!==null&&!this.target.isActive()&&(this.target=null)}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class M5{constructor(t){this.factory=t,this.active=!0,this.stationCreated=!1}init(t,e){this.game=t}tick(t){if(this.stationCreated||(this.createStation(),this.stationCreated=!0),!this.factory.isActive()){this.active=!1;return}}isActive(){return this.active}activeDuringSpawnPhase(){return!1}createStation(){const t=this.game.nearbyUnits(this.factory.tile(),this.game.config().trainStationMaxRange(),[m.City,m.Port,m.Factory]);this.game.addExecution(new Dr(this.factory,!0));for(const{unit:e}of t)e.hasTrainStation()||this.game.addExecution(new Dr(e))}}const I5=16;class va{constructor(t,e,i,r,s=-1,a=0,o=!0){this.nukeType=t,this.player=e,this.dst=i,this.src=r,this.speed=s,this.waitTicks=a,this.rocketDirectionUp=o,this.active=!0,this.nuke=null}init(t,e){this.mg=t,this.speed===-1&&(this.speed=this.mg.config().defaultNukeSpeed()),this.pathFinder=fa.Parabola(t,{increment:this.speed,distanceBasedHeight:this.nukeType!==m.MIRVWarhead,directionUp:this.rocketDirectionUp})}target(){return this.mg.owner(this.dst)}tilesToDestroy(){if(this.tilesToDestroyCache!==void 0)return this.tilesToDestroyCache;if(this.nuke===null)throw new Error("Not initialized");const t=this.mg.config().nukeMagnitudes(this.nuke.type()),e=new gt(this.mg.ticks()),i=t.inner*t.inner,r=t.outer*t.outer;return this.tilesToDestroyCache=this.mg.bfs(this.dst,(s,a)=>{const o=this.mg?.euclideanDistSquared(this.dst,a)??0;return o<=r&&(o<=i||e.chance(2))}),this.tilesToDestroyCache}maybeBreakAlliances(){if(this.nuke===null)throw new Error("Not initialized");if(this.nuke.type()===m.MIRVWarhead)return;const t=this.mg.config().nukeMagnitudes(this.nuke.type()),e=f5({game:this.mg,targetTile:this.dst,magnitude:t,allySmallIds:new Set(this.player.allies().map(i=>i.smallID())),threshold:this.mg.config().nukeAllianceBreakThreshold()});for(const i of this.player.incomingAllianceRequests())e.has(i.requestor().smallID())&&i.reject();for(const i of e){const r=this.mg.playerBySmallID(i);if(!r.isPlayer())continue;const s=r.incomingAllianceRequests().find(o=>o.requestor()===this.player);if(s){s.reject();continue}const a=this.player.allianceWith(r);a!==null&&this.player.breakAlliance(a),r!==this.player&&r.updateRelation(this.player,-100)}}tick(t){if(this.nuke===null){const i=this.player.canBuild(this.nukeType,this.dst);if(i===!1){console.warn("cannot build Nuke"),this.active=!1;return}if(this.src=i,this.nuke=this.player.buildUnit(this.nukeType,i,{targetTile:this.dst,trajectory:this.getTrajectory(this.dst)}),this.nuke.type()!==m.MIRVWarhead&&this.maybeBreakAlliances(),this.mg.hasOwner(this.dst)){const s=this.mg.owner(this.dst);s.isPlayer()&&(this.nukeType===m.AtomBomb?this.mg.displayIncomingUnit(this.nuke.id(),`${this.player.name()} - atom bomb inbound`,at.NUKE_INBOUND,s.id()):this.nukeType===m.HydrogenBomb&&this.mg.displayIncomingUnit(this.nuke.id(),`${this.player.name()} - hydrogen bomb inbound`,at.HYDROGEN_BOMB_INBOUND,s.id())),this.mg.stats().bombLaunch(this.player,s,this.nukeType)}const r=this.player.units(m.MissileSilo).find(s=>s.tile()===i);r&&r.launch();return}if(!this.nuke.isActive()){console.log("Nuke destroyed before reaching target"),this.active=!1;return}if(this.waitTicks>0){this.waitTicks--;return}const e=this.pathFinder.next(this.src,this.dst,this.speed);if(e.status===tt.COMPLETE){this.detonate();return}else e.status===tt.NEXT&&(this.updateNukeTargetable(),this.nuke.move(e.node),this.nuke.setTrajectoryIndex(this.pathFinder.currentIndex()))}getNuke(){return this.nuke}getTrajectory(t){const e=[],i=this.mg.config().defaultNukeTargetableRange()**2,r=this.pathFinder.findPath(this.src,t)??[];for(const s of r)e.push({tile:s,targetable:this.isTargetable(t,s,i)});return e}isTargetable(t,e,i){return this.mg.euclideanDistSquared(e,t)<i||this.src!==void 0&&this.src!==null&&this.mg.euclideanDistSquared(this.src,e)<i}updateNukeTargetable(){if(this.nuke===null||this.nuke.targetTile()===void 0)return;const t=this.mg.config().defaultNukeTargetableRange()**2,e=this.nuke.targetTile();this.nuke.setTargetable(this.isTargetable(e,this.nuke.tile(),t))}detonate(){if(this.nuke===null)throw new Error("Not initialized");const t=this.mg.config().nukeMagnitudes(this.nuke.type()),e=this.tilesToDestroy(),i=this.target().isPlayer()?this.mg.config().maxTroops(this.target()):1;for(const s of e){const a=this.mg.owner(s);a.isPlayer()&&(a.relinquish(s),a.removeTroops(this.mg.config().nukeDeathFactor(this.nukeType,a.troops(),a.numTilesOwned(),i)),a.outgoingAttacks().forEach(o=>{const c=this.mg?.config().nukeDeathFactor(this.nukeType,o.troops(),a.numTilesOwned(),i)??0;o.setTroops(o.troops()-c)}),a.units(m.TransportShip).forEach(o=>{const c=this.mg?.config().nukeDeathFactor(this.nukeType,o.troops(),a.numTilesOwned(),i)??0;o.setTroops(o.troops()-c)})),this.mg.isLand(s)&&this.mg.setFallout(s,!0)}const r=t.outer*t.outer;for(const s of this.mg.units())s.type()!==m.AtomBomb&&s.type()!==m.HydrogenBomb&&s.type()!==m.MIRVWarhead&&s.type()!==m.MIRV&&s.type()!==m.SAMMissile&&this.mg.euclideanDistSquared(this.dst,s.tile())<r&&s.delete(!0,this.player);this.redrawBuildings(t.outer+I5),this.active=!1,this.nuke.setReachedTarget(),this.nuke.delete(!1),this.mg.stats().bombLand(this.player,this.target(),this.nuke.type())}redrawBuildings(t){const e=t*t;for(const i of this.mg.units())bo(i.type())&&this.mg.euclideanDistSquared(this.dst,i.tile())<e&&i.touch()}owner(){return this.player}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class Gh{constructor(t,e){this.player=t,this.dst=e,this.active=!0,this.nuke=null,this.range=1500,this.rangeSquared=this.range*this.range,this.minimumSpread=55,this.warheadCount=350,this.speed=-1}init(t,e){if(this.random=new gt(t.ticks()+It(this.player.id())),this.mg=t,this.targetPlayer=this.mg.owner(this.dst),this.speed=this.mg.config().defaultNukeSpeed(),this.pathFinder=fa.Parabola(t,{increment:this.speed}),this.targetPlayer.isPlayer()){const i=this.player.allianceWith(this.targetPlayer);i!==null&&this.player.breakAlliance(i),this.targetPlayer!==this.player&&this.targetPlayer.updateRelation(this.player,-100)}}tick(t){if(this.nuke===null){const i=this.player.canBuild(m.MIRV,this.dst);if(i===!1){console.warn("cannot build MIRV"),this.active=!1;return}this.spawnTile=i,this.nuke=this.player.buildUnit(m.MIRV,i,{targetTile:this.dst}),this.mg.stats().bombLaunch(this.player,this.targetPlayer,m.MIRV);const r=Math.floor((this.mg.x(this.dst)+this.mg.x(this.mg.x(this.nuke.tile())))/2),s=Math.max(0,this.mg.y(this.dst)-500)+50;this.separateDst=this.mg.ref(r,s),this.mg.displayIncomingUnit(this.nuke.id(),`âš ï¸âš ï¸âš ï¸ ${this.player.name()} - MIRV INBOUND âš ï¸âš ï¸âš ï¸`,at.MIRV_INBOUND,this.targetPlayer.id())}const e=this.pathFinder.next(this.spawnTile,this.separateDst,this.speed);if(e.status===tt.COMPLETE){this.separate(),this.active=!1,this.mg.stats().bombLand(this.player,this.targetPlayer,m.MIRV);return}else e.status===tt.NEXT&&this.nuke.move(e.node)}separate(){if(this.nuke===null)throw new Error("uninitialized");this.baseX=this.mg.x(this.dst),this.baseY=this.mg.y(this.dst);const t=this.selectDestinations();for(const[e,i]of t.entries())this.mg.addExecution(new va(m.MIRVWarhead,this.player,i,this.nuke.tile(),15+Math.floor(e/this.warheadCount*5),this.random.nextInt(0,15)));this.nuke.delete(!1)}selectDestinations(){const t=[this.dst];for(let e=0;e<1e3;e++){const i=this.tryGenerateTarget(t);if(i&&t.push(i),t.length>=this.warheadCount)break}return t.sort((e,i)=>this.mg.manhattanDist(i,this.dst)-this.mg.manhattanDist(e,this.dst))}tryGenerateTarget(t){for(let e=0;e<100;e++){const i=this.random.next(),r=i*15485863%1,s=Math.round(i*this.range*2-this.range+this.baseX),a=Math.round(r*this.range*2-this.range+this.baseY);if(!this.mg.isValidCoord(s,a))continue;const o=this.mg.ref(s,a);if(this.mg.isLand(o)&&!((s-this.baseX)**2+(a-this.baseY)**2>this.rangeSquared)&&this.mg.owner(o)===this.targetPlayer&&!this.isOverlapping(s,a,t))return o}}isOverlapping(t,e,i){for(const r of i){const s=this.mg.x(r),a=this.mg.y(r);if(Math.abs(t-s)+Math.abs(e-a)<this.minimumSpread)return!0}return!1}owner(){return this.player}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class x5{constructor(t){this.active=!0,this.silo=t}init(t,e){this.mg=t}tick(t){if(this.silo.isUnderConstruction())return;const e=this.silo.missileTimerQueue()[0];if(e===void 0)return;this.mg.config().SiloCooldown()-(this.mg.ticks()-e)<=0&&this.silo.reloadMissile()}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class C5{constructor(t,e,i){this.origOwner=t,this.srcPort=e,this._dstPort=i,this.active=!0,this.wasCaptured=!1,this.tilesTraveled=0}init(t,e){this.mg=t,this.pathFinder=ye.Water(t)}tick(t){if(this.tradeShip===void 0){const a=this.origOwner.canBuild(m.TradeShip,this.srcPort.tile());if(a===!1){console.warn("cannot build trade ship"),this.active=!1;return}this.tradeShip=this.origOwner.buildUnit(m.TradeShip,a,{targetUnit:this._dstPort,lastSetSafeFromPirates:t}),this.mg.stats().boatSendTrade(this.origOwner,this._dstPort.owner())}if(!this.tradeShip.isActive()){this.active=!1;return}const e=this.tradeShip.owner(),i=this._dstPort.owner();if(this.wasCaptured!==!0&&this.origOwner!==e&&(this.wasCaptured=!0),i.id()===this.srcPort.owner().id()){this.tradeShip.delete(!1),this.active=!1;return}if(!this.wasCaptured&&(!this._dstPort.isActive()||!e.canTrade(i))){this.tradeShip.delete(!1),this.active=!1;return}if(this.wasCaptured&&(e!==i||!this._dstPort.isActive())){const a=this.tradeShip.owner().units(m.Port).sort(oo(this.mg,this.tradeShip));if(a.length===0){this.tradeShip.delete(!1),this.active=!1;return}else this._dstPort=a[0],this.tradeShip.setTargetUnit(this._dstPort)}const r=this.tradeShip.tile();if(r===this.dstPort()){this.complete();return}const s=this.pathFinder.next(r,this._dstPort.tile());switch(s.status){case tt.PENDING:this.tradeShip.move(r);break;case tt.NEXT:this.mg.isWater(s.node)&&this.mg.isShoreline(s.node)&&this.tradeShip.setSafeFromPirates(),this.tradeShip.move(s.node),this.tilesTraveled++;break;case tt.COMPLETE:this.complete();break;case tt.NOT_FOUND:console.warn("captured trade ship cannot find route"),this.tradeShip.isActive()&&this.tradeShip.delete(!1),this.active=!1;break}}complete(){this.active=!1,this.tradeShip.delete(!1);const t=this.mg.config().tradeShipGold(this.tilesTraveled,this.tradeShip.owner().unitCount(m.Port));this.wasCaptured?(this.tradeShip.owner().addGold(t,this._dstPort.tile()),this.mg.displayMessage("events_display.received_gold_from_captured_ship",at.CAPTURED_ENEMY_UNIT,this.tradeShip.owner().id(),t,{gold:Qe(t),name:this.origOwner.displayName()}),this.mg.stats().boatCapturedTrade(this.tradeShip.owner(),this.origOwner,t)):(this.srcPort.owner().addGold(t),this._dstPort.owner().addGold(t,this._dstPort.tile()),this.mg.displayMessage("events_display.received_gold_from_trade",at.RECEIVED_GOLD_FROM_TRADE,this._dstPort.owner().id(),t,{gold:Qe(t),name:this.srcPort.owner().displayName()}),this.mg.displayMessage("events_display.received_gold_from_trade",at.RECEIVED_GOLD_FROM_TRADE,this.srcPort.owner().id(),t,{gold:Qe(t),name:this._dstPort.owner().displayName()}),this.mg.stats().boatArriveTrade(this.srcPort.owner(),this._dstPort.owner(),t))}isActive(){return this.active}activeDuringSpawnPhase(){return!1}dstPort(){return this._dstPort.tile()}}class P5{constructor(t){this.active=!0,this.port=t}init(t,e){this.mg=t,this.random=new gt(t.ticks()),this.checkOffset=t.ticks()%10}tick(t){if(this.mg===null||this.random===null||this.checkOffset===null)throw new Error("Not initialized");if(!this.port.isActive()){this.active=!1;return}if(this.port.isUnderConstruction()||(this.port.hasTrainStation()||this.createStation(),(this.mg.ticks()+this.checkOffset)%10!==0)||!this.shouldSpawnTradeShip())return;const e=this.tradingPorts();if(e.length===0)return;const i=this.random.randElement(e);this.mg.addExecution(new C5(this.port.owner(),this.port,i))}isActive(){return this.active}activeDuringSpawnPhase(){return!1}shouldSpawnTradeShip(){const t=this.mg.unitCount(m.TradeShip),e=this.port.owner().unitCount(m.Port),i=this.port.owner().unitCount(m.TradeShip),r=this.mg.config().tradeShipSpawnRate(t,e,i);for(let s=0;s<this.port.level();s++)if(this.random.chance(r))return!0;return!1}createStation(){this.mg.hasUnitNearby(this.port.tile(),this.mg.config().trainStationMaxRange(),m.Factory)&&this.mg.addExecution(new Dr(this.port))}tradingPorts(){const t=this.mg.players().filter(i=>i!==this.port.owner()&&i.canTrade(this.port.owner())).flatMap(i=>i.units(m.Port)).sort((i,r)=>this.mg.manhattanDist(this.port.tile(),i.tile())-this.mg.manhattanDist(this.port.tile(),r.tile())),e=[];for(const[i,r]of t.entries()){const s=new Array(r.level()).fill(r);e.push(...s);const a=this.mg.manhattanDist(this.port.tile(),r.tile())<this.mg.config().tradeShipShortRangeDebuff(),o=i<this.mg.config().proximityBonusPortsNb(t.length);!a&&o&&e.push(...s),!a&&this.port.owner().isFriendly(r.owner())&&e.push(...s)}return e}}class D5{constructor(t,e,i,r,s){this.spawn=t,this._owner=e,this.ownerUnit=i,this.target=r,this.targetTile=s,this.active=!0,this.speed=0}init(t,e){this.pathFinder=ye.Air(t),this.mg=t,this.speed=this.mg.config().defaultSamMissileSpeed()}tick(t){if(this.SAMMissile??=this._owner.buildUnit(m.SAMMissile,this.spawn,{}),!this.SAMMissile.isActive()){this.active=!1;return}const e=[m.AtomBomb,m.HydrogenBomb];if(!this.target.isActive()||!this.ownerUnit.isActive()||this.target.owner()===this.SAMMissile.owner()||!e.includes(this.target.type())){this.SAMMissile.delete(!1),this.active=!1;return}for(let i=0;i<this.speed;i++){const r=this.pathFinder.next(this.SAMMissile.tile(),this.targetTile);if(r.status===tt.COMPLETE){this.mg.displayMessage("events_display.missile_intercepted",at.SAM_HIT,this._owner.id(),void 0,{unit:this.target.type()}),this.active=!1,this.target.delete(!0,this._owner),this.SAMMissile.delete(!1),this.mg.stats().bombIntercept(this._owner,this.target.type(),1);return}else r.status===tt.NEXT&&this.SAMMissile.move(r.node)}}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class N5{constructor(t,e){this.mg=t,this.sam=e,this.precomputedNukes=new Map,this.missileSpeed=this.mg.config().defaultSamMissileSpeed()}updateUnreachableNukes(t){const e=new Set(t.map(i=>i.unit.id()));for(const i of this.precomputedNukes.keys())e.has(i)||this.precomputedNukes.delete(i)}isInRange(t){const e=this.sam.tile(),i=this.mg.config().samRange(this.sam.level()),r=i*i;return this.mg.euclideanDistSquared(e,t)<=r}tickToReach(t,e){return Math.ceil(this.mg.manhattanDist(t,e)/this.missileSpeed)}computeInterceptionTile(t){const e=t.trajectory(),i=this.sam.tile(),r=t.trajectoryIndex(),s=e.length-r;for(let a=r;a<e.length;a++){const o=e[a];if(o.targetable&&this.isInRange(o.tile)){const c=a-r,l=this.tickToReach(i,o.tile),h=c-l;if(l<s&&h>=0)return{tick:h,tile:o.tile}}}}getSingleTarget(t){const e=this.mg.config().maxSamRange()*2,i=this.mg.nearbyUnits(this.sam.tile(),e,[m.AtomBomb,m.HydrogenBomb],({unit:s})=>rs(s)&&s.owner()!==this.sam.owner()&&!this.sam.owner().isFriendly(s.owner()));this.updateUnreachableNukes(i);const r=[];for(const s of i){const a=s.unit.id(),o=this.precomputedNukes.get(a);if(o!==void 0){if(o===null)continue;if(o.tick===t){r.push({tile:o.tile,unit:s.unit}),this.precomputedNukes.delete(a);continue}if(o.tick>t)continue;this.precomputedNukes.delete(a)}const c=this.computeInterceptionTile(s.unit);c!==void 0?c.tick<=1?r.push({unit:s.unit,tile:c.tile}):this.precomputedNukes.set(a,{tick:c.tick+t,tile:c.tile}):this.precomputedNukes.set(a,null)}return r.sort((s,a)=>s.unit.type()===m.HydrogenBomb&&a.unit.type()!==m.HydrogenBomb?-1:s.unit.type()!==m.HydrogenBomb&&a.unit.type()===m.HydrogenBomb?1:0)[0]??null}}class R5{constructor(t,e,i=null){this.player=t,this.tile=e,this.sam=i,this.active=!0,this.MIRVWarheadSearchRadius=400,this.MIRVWarheadProtectionRadius=50,i!==null&&(this.tile=i.tile())}init(t,e){this.mg=t}tick(t){if(this.mg===null||this.player===null)throw new Error("Not initialized");if(this.sam===null){if(this.tile===null)throw new Error("tile is null");const s=this.player.canBuild(m.SAMLauncher,this.tile);if(s===!1){console.warn("cannot build SAM Launcher"),this.active=!1;return}this.sam=this.player.buildUnit(m.SAMLauncher,s,{})}if(this.targetingSystem??=new N5(this.mg,this.sam),this.sam.isUnderConstruction())return;if(this.sam.isInCooldown()){const s=this.sam.missileTimerQueue()[0];if(s===void 0)return;this.mg.config().SAMCooldown()-(this.mg.ticks()-s)<=0&&this.sam.reloadMissile();return}if(!this.sam.isActive()){this.active=!1;return}this.player!==this.sam.owner()&&(this.player=this.sam.owner()),this.pseudoRandom??=new gt(this.sam.id());const e=this.mg.nearbyUnits(this.sam.tile(),this.MIRVWarheadSearchRadius,m.MIRVWarhead,({unit:s})=>{if(!rs(s)||s.owner()===this.player||this.player.isFriendly(s.owner()))return!1;const a=s.targetTile();return this.sam!==null&&a!==void 0&&this.mg.manhattanDist(a,this.sam.tile())<this.MIRVWarheadProtectionRadius});let i=null;if(e.length===0&&(i=this.targetingSystem.getSingleTarget(t),i!==null&&console.log("Target acquired")),i&&!i.unit.targetedBySAM()||e.length>0){if(this.sam.launch(),(e.length>0?m.MIRVWarhead:i?.unit.type())===void 0)throw new Error("Unknown unit type");if(e.length>0){const a=this.sam.owner();this.mg.displayMessage("events_display.mirv_warheads_intercepted",at.SAM_HIT,a.id(),void 0,{count:e.length}),e.forEach(({unit:o})=>{o.delete()}),this.mg.stats().bombIntercept(a,m.MIRVWarhead,e.length)}else if(i!==null)i.unit.setTargetedBySAM(!0),this.mg.addExecution(new D5(this.sam.tile(),this.sam.owner(),this.sam,i.unit,i.tile));else throw new Error("target is null")}}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class O5{constructor(t){this.input=t,this.lastShellAttack=0,this.alreadySentShell=new Set}init(t,e){if(this.mg=t,this.pathfinder=ye.Water(t),this.random=new gt(t.ticks()),rs(this.input))this.warship=this.input;else{const i=this.input.owner.canBuild(m.Warship,this.input.patrolTile);if(i===!1){console.warn(`Failed to spawn warship for ${this.input.owner.name()} at ${this.input.patrolTile}`);return}this.warship=this.input.owner.buildUnit(m.Warship,i,this.input)}}tick(t){if(this.warship.health()<=0){this.warship.delete();return}if(this.warship.owner().unitCount(m.Port)>0&&this.warship.modifyHealth(1),this.warship.setTargetUnit(this.findTargetUnit()),this.warship.targetUnit()?.type()===m.TradeShip){this.huntDownTradeShip();return}if(this.patrol(),this.warship.targetUnit()!==void 0){this.shootTarget();return}}findTargetUnit(){const t=this.warship.owner().unitCount(m.Port)>0,e=this.mg.config().warshipPatrolRange()**2,i=this.mg.nearbyUnits(this.warship.tile(),this.mg.config().warshipTargettingRange(),[m.TransportShip,m.Warship,m.TradeShip]),r=[];for(const{unit:s,distSquared:a}of i)s.owner()===this.warship.owner()||s===this.warship||!this.warship.owner().canAttackPlayer(s.owner(),!0)||this.alreadySentShell.has(s)||s.type()===m.TradeShip&&(!t||s.isSafeFromPirates()||s.targetUnit()?.owner()===this.warship.owner()||s.targetUnit()?.owner().isFriendly(this.warship.owner())||this.mg.euclideanDistSquared(this.warship.patrolTile(),s.tile())>e)||r.push({unit:s,distSquared:a});return r.sort((s,a)=>{const{unit:o,distSquared:c}=s,{unit:l,distSquared:h}=a;return o.type()===m.TransportShip&&l.type()!==m.TransportShip?-1:o.type()!==m.TransportShip&&l.type()===m.TransportShip?1:o.type()===m.Warship&&l.type()!==m.Warship?-1:o.type()!==m.Warship&&l.type()===m.Warship?1:c-h})[0]?.unit}shootTarget(){const t=this.mg.config().warshipShellAttackRate();if(this.mg.ticks()-this.lastShellAttack>t&&(this.warship.targetUnit()?.type()!==m.TransportShip&&(this.lastShellAttack=this.mg.ticks()),this.mg.addExecution(new Hh(this.warship.tile(),this.warship.owner(),this.warship,this.warship.targetUnit())),!this.warship.targetUnit().hasHealth())){this.alreadySentShell.add(this.warship.targetUnit()),this.warship.setTargetUnit(void 0);return}}huntDownTradeShip(){for(let t=0;t<2;t++){const e=this.pathfinder.next(this.warship.tile(),this.warship.targetUnit().tile(),5);switch(e.status){case tt.COMPLETE:this.warship.owner().captureUnit(this.warship.targetUnit()),this.warship.setTargetUnit(void 0),this.warship.move(this.warship.tile());return;case tt.NEXT:this.warship.move(e.node);break;case tt.PENDING:this.warship.touch();break;case tt.NOT_FOUND:{console.log("path not found to target");break}}}}patrol(){if(this.warship.targetTile()===void 0&&(this.warship.setTargetTile(this.randomTile()),this.warship.targetTile()===void 0))return;const t=this.pathfinder.next(this.warship.tile(),this.warship.targetTile());switch(t.status){case tt.COMPLETE:this.warship.setTargetTile(void 0),this.warship.move(t.node);break;case tt.NEXT:this.warship.move(t.node);break;case tt.PENDING:this.warship.touch();return;case tt.NOT_FOUND:{console.log("path not found to target");break}}}isActive(){return this.warship?.isActive()}activeDuringSpawnPhase(){return!1}randomTile(t=!1){let e=this.mg.config().warshipPatrolRange();const i=500;let r=0,s=0;const a=this.mg.getWaterComponent(this.warship.tile());for(;s<3;){const o=this.mg.x(this.warship.patrolTile())+this.random.nextInt(-e/2,e/2),c=this.mg.y(this.warship.patrolTile())+this.random.nextInt(-e/2,e/2);if(!this.mg.isValidCoord(o,c))continue;const l=this.mg.ref(o,c);if(!this.mg.isOcean(l)||!t&&this.mg.isShoreline(l)){r++,r===i&&(s++,r=0,e=e+Math.floor(e/2));continue}if(a!==null&&!this.mg.hasWaterComponent(l,a)){r++,r===i&&(s++,r=0,e=e+Math.floor(e/2));continue}return l}if(console.warn(`Failed to find random tile for warship for ${this.warship.owner().name()}`),!t)return this.randomTile(!0)}}class li{constructor(t,e,i,r){this.player=t,this.constructionType=e,this.tile=i,this.rocketDirectionUp=r,this.structure=null,this.active=!0}init(t,e){if(this.mg=t,this.mg.config().isUnitDisabled(this.constructionType)){console.warn(`cannot build construction ${this.constructionType} because it is disabled`),this.active=!1;return}if(!this.mg.isValidRef(this.tile)){console.warn(`cannot build construction invalid tile ${this.tile}`),this.active=!1;return}}tick(t){if(this.structure===null){const e=this.mg.unitInfo(this.constructionType);if(!this.isStructure(this.constructionType)){this.completeConstruction(),this.active=!1;return}const r=this.player.canBuild(this.constructionType,this.tile);if(r===!1){console.warn(`cannot build ${this.constructionType}`),this.active=!1;return}this.structure=this.player.buildUnit(this.constructionType,r,{});const s=e.constructionDuration??0;if(s>0){this.structure.setUnderConstruction(!0),this.ticksUntilComplete=s;return}this.completeConstruction(),this.active=!1;return}if(!this.structure.isActive()){this.active=!1;return}if(this.player!==this.structure.owner()&&(this.player=this.structure.owner()),this.ticksUntilComplete===0){this.player=this.structure.owner(),this.completeConstruction(),this.active=!1;return}this.ticksUntilComplete--}completeConstruction(){this.structure&&this.structure.setUnderConstruction(!1);const t=this.player;switch(this.constructionType){case m.AtomBomb:case m.HydrogenBomb:this.mg.addExecution(new va(this.constructionType,t,this.tile,null,-1,0,this.rocketDirectionUp));break;case m.MIRV:this.mg.addExecution(new Gh(t,this.tile));break;case m.Warship:this.mg.addExecution(new O5({owner:t,patrolTile:this.tile}));break;case m.Port:this.mg.addExecution(new P5(this.structure));break;case m.MissileSilo:this.mg.addExecution(new x5(this.structure));break;case m.DefensePost:this.mg.addExecution(new k5(this.structure));break;case m.SAMLauncher:this.mg.addExecution(new R5(t,null,this.structure));break;case m.City:this.mg.addExecution(new E5(this.structure));break;case m.Factory:this.mg.addExecution(new M5(this.structure));break;default:console.warn(`unit type ${this.constructionType} cannot be constructed`);break}}isStructure(t){switch(t){case m.Port:case m.MissileSilo:case m.DefensePost:case m.SAMLauncher:case m.City:case m.Factory:return!0;default:return!1}}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class B5{constructor(t,e,i){this.sender=t,this.recipientID=e,this.active=!0,this.gold=De(i??0)}init(t,e){if(this.mg=t,this.random=new gt(t.ticks()),!t.hasPlayer(this.recipientID)){console.warn(`DonateGoldExecution recipient ${this.recipientID} not found`),this.active=!1;return}this.recipient=t.player(this.recipientID),this.gold??=this.sender.gold()/3n}tick(t){if(this.gold===null)throw new Error("not initialized");if(this.sender.canDonateGold(this.recipient)&&this.sender.donateGold(this.recipient,this.gold)){const e=this.calculateRelationUpdate(this.gold,t);if(e>0&&this.recipient.updateRelation(this.sender,e),this.recipient.type()===P.Nation&&this.recipient.canSendEmoji(this.sender)){const i=e>=50?oi:e>0?s5:zh;this.mg.addExecution(new je(this.recipient,this.sender.id(),this.random.randElement(i)))}}else console.warn(`cannot send gold from ${this.sender.name()} to ${this.recipient.name()}`);this.active=!1}getGoldChunkSize(){const{difficulty:t}=this.mg.config().gameConfig();switch(t){case _.Easy:return 2500;case _.Medium:return 5e3;case _.Hard:return 12500;case _.Impossible:return 25e3;default:dt(t)}}calculateRelationUpdate(t,e){const i=this.getGoldChunkSize(),r=e/(3e3+this.mg.config().numSpawnPhaseTurns()),s=BigInt(Math.round(i+i*r)),o=Number(t/s)*5;return o>100?100:o}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class L5{constructor(t,e){this.player=t,this.action=e}init(t,e){if(!this.player.canEmbargoAll())return;const i=this.player;for(const r of t.players())r.id()!==i.id()&&r.type()!==P.Bot&&(i.isOnSameTeam(r)||(this.action==="start"?i.hasEmbargoAgainst(r)||i.addEmbargo(r,!1):i.hasEmbargoAgainst(r)&&i.stopEmbargo(r)));this.player.recordEmbargoAll()}tick(t){}isActive(){return!1}activeDuringSpawnPhase(){return!1}}class z5{constructor(t,e,i){this.player=t,this.targetID=e,this.action=i,this.active=!0}init(t,e){if(!t.hasPlayer(this.targetID)){console.warn(`EmbargoExecution recipient ${this.targetID} not found`),this.active=!1;return}this.target=t.player(this.targetID)}tick(t){this.action==="start"?this.player.addEmbargo(this.target,!1):this.player.stopEmbargo(this.target),this.active=!1}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class U5{constructor(t,e){this.player=t,this.isDisconnected=e}init(t,e){this.player.markDisconnected(this.isDisconnected)}tick(t){}isActive(){return!1}activeDuringSpawnPhase(){return!1}}class W5{constructor(t,e,i){this.owner=t,this.unitId=e,this.position=i}init(t,e){if(!t.isValidRef(this.position)){console.warn(`MoveWarshipExecution: position ${this.position} not valid`);return}const i=this.owner.units(m.Warship).find(r=>r.id()===this.unitId);if(!i){console.warn("MoveWarshipExecution: warship not found");return}if(!i.isActive()){console.warn("MoveWarshipExecution: warship is not active");return}i.setPatrolTile(this.position),i.setTargetTile(void 0)}tick(t){}isActive(){return!1}activeDuringSpawnPhase(){return!1}}class $5{constructor(t,e,i,r){this.random=t,this.game=e,this.player=i,this.emojiBehavior=r}handleAllianceRequests(){for(const t of this.player.incomingAllianceRequests())this.getAllianceDecision(t.requestor(),!0)?t.accept():t.reject()}handleAllianceExtensionRequests(){for(const t of this.player.alliances()){if(!t.onlyOneAgreedToExtend())continue;const e=t.other(this.player);this.getAllianceDecision(e,!0)&&this.game.addExecution(new la(this.player,e.id()))}}maybeSendAllianceRequests(t){const e=i=>i.type()===P.Bot&&this.game.config().gameConfig().difficulty===_.Easy||i.type()!==P.Bot;for(const i of t)this.random.chance(30)&&e(i)&&this.player.canSendAllianceRequest(i)&&this.getAllianceDecision(i,!1)&&this.game.addExecution(new Ih(this.player,i.id()))}getAllianceDecision(t,e){return this.isConfused()?this.random.chance(2):t.isTraitor()&&this.random.nextInt(0,100)>=10?(e&&this.random.chance(3)&&this.emojiBehavior.sendEmoji(t,ci),!1):this.hasTooManyAlliances(t)?!1:this.isAlliancePartnerThreat(t)?(!e&&this.random.chance(6)&&this.emojiBehavior.sendEmoji(t,n5),e&&this.random.chance(6)&&this.emojiBehavior.sendEmoji(t,oi),!0):this.shouldRejectInTeamGame()?!1:this.player.relation(t)<Pt.Neutral?(e&&this.random.chance(3)&&this.emojiBehavior.sendEmoji(t,ci),!1):this.isAlliancePartnerFriendly(t)?(this.random.chance(3)&&this.emojiBehavior.sendEmoji(t,r5),!0):this.checkAlreadyEnoughAlliances(t)?!1:this.isEarlygame()?!0:this.isAlliancePartnerSimilarlyStrong(t)}hasTooManyAlliances(t){const{difficulty:e}=this.game.config().gameConfig();if(e!==_.Hard&&e!==_.Impossible)return!1;const i=this.game.players().filter(s=>s.type()!==P.Bot).length,r=t.alliances().length;return e!==_.Hard?r>=i*.5:r>=i*.25}isConfused(){const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return this.random.chance(10);case _.Medium:return this.random.chance(20);case _.Hard:return this.random.chance(40);case _.Impossible:return!1;default:dt(t)}}isEarlygame(){const t=this.game.config().numSpawnPhaseTurns(),{difficulty:e}=this.game.config().gameConfig();switch(e){case _.Easy:return this.game.ticks()<3e3+t&&this.random.nextInt(0,100)>=10;case _.Medium:return this.game.ticks()<1800+t&&this.random.nextInt(0,100)>=30;case _.Hard:return this.game.ticks()<1800+t&&this.random.nextInt(0,100)>=50;case _.Impossible:return this.game.ticks()<600+t&&this.random.nextInt(0,100)>=70;default:dt(e)}}isAlliancePartnerThreat(t){const{difficulty:e}=this.game.config().gameConfig();switch(e){case _.Easy:return!1;case _.Medium:return t.troops()>this.player.troops()*2.5;case _.Hard:return t.troops()>this.player.troops()&&this.game.config().maxTroops(t)>this.game.config().maxTroops(this.player)*2;case _.Impossible:{const i=t.troops()>this.player.troops()*1.5,r=t.troops()>this.player.troops()&&this.game.config().maxTroops(t)>this.game.config().maxTroops(this.player)*1.5,s=t.troops()>this.player.troops()&&t.numTilesOwned()>this.player.numTilesOwned()*1.5;return i||r||s}default:dt(e)}}shouldRejectInTeamGame(){if(this.game.config().gameConfig().gameMode!==Ct.Team)return!1;const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return this.random.nextInt(0,100)<25;case _.Medium:return this.random.nextInt(0,100)<50;case _.Hard:return this.random.nextInt(0,100)<75;case _.Impossible:return!0;default:dt(t)}}checkAlreadyEnoughAlliances(t){const{difficulty:e}=this.game.config().gameConfig();switch(e){case _.Easy:return!1;case _.Medium:return this.player.alliances().length>=this.random.nextInt(4,6);case _.Hard:case _.Impossible:{const i=this.player.neighbors().filter(s=>s.isPlayer()&&s.type()!==P.Bot),r=i.filter(s=>this.player?.isFriendly(s)===!0);return i.length>=2&&i.includes(t)?i.length<=r.length+1:e===_.Hard?this.player.alliances().length>=this.random.nextInt(3,5):this.player.alliances().length>=this.random.nextInt(2,4)}default:dt(e)}}isAlliancePartnerFriendly(t){const{difficulty:e}=this.game.config().gameConfig();switch(e){case _.Easy:case _.Medium:return this.player.relation(t)===Pt.Friendly;case _.Hard:return this.player.relation(t)===Pt.Friendly&&this.random.nextInt(0,100)>=17;case _.Impossible:return this.player.relation(t)===Pt.Friendly&&this.random.nextInt(0,100)>=33;default:dt(e)}}isAlliancePartnerSimilarlyStrong(t){const{difficulty:e}=this.game.config().gameConfig(),i={[_.Easy]:[60,70],[_.Medium]:[70,80],[_.Hard]:[75,85],[_.Impossible]:[80,90]},r={[_.Easy]:[70,80],[_.Medium]:[80,90],[_.Hard]:[85,95],[_.Impossible]:[90,100]},s=i[e],a=r[e],o=this.player.outgoingAttacks().reduce((b,S)=>b+S.troops(),0),c=t.outgoingAttacks().reduce((b,S)=>b+S.troops(),0),l=this.player.troops()+o,h=t.troops()+c,d=l*(this.random.nextInt(s[0],s[1])/100),f=this.player.numTilesOwned()*(this.random.nextInt(a[0],a[1])/100),g=h>d,p=t.numTilesOwned()>f&&h>l*.5;return g||p}maybeBetray(t,e){if(!this.player.isAlliedWith(t))return!1;const{difficulty:i}=this.game.config().gameConfig();if(i!==_.Easy&&i!==_.Medium){const r=this.game.config().maxTroops(t),s=t.outgoingAttacks().reduce((a,o)=>a+o.troops(),0);if(t.troops()+s<r*.2&&t.troops()<this.player.troops())return this.betray(t),!0}return(i===_.Easy||i===_.Medium)&&this.player.troops()>=t.troops()*10?(this.betray(t),!0):i!==_.Easy&&t.isTraitor()&&t.troops()<this.player.troops()*1.2?(this.betray(t),!0):i!==_.Easy&&e===1&&t.troops()*3<this.player.troops()?(this.betray(t),!0):!1}betray(t){const e=this.player.allianceWith(t);e&&this.player.breakAlliance(e)}}class F5{constructor(t,e,i,r){this.random=t,this.game=e,this.player=i,this.emojiBehavior=r}get hesitationOdds(){const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return 2;case _.Medium:return 4;case _.Hard:return 8;case _.Impossible:return 16;default:dt(t)}}get victoryDenialTeamThreshold(){const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return .9;case _.Medium:return .8;case _.Hard:return .7;case _.Impossible:return .6;default:dt(t)}}get victoryDenialIndividualThreshold(){const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return .75;case _.Medium:return .65;case _.Hard:return .55;case _.Impossible:return .4;default:dt(t)}}get steamrollCityGapMultiplier(){const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return 1.5;case _.Medium:return 1.3;case _.Hard:return 1.2;case _.Impossible:return 1.15;default:dt(t)}}get steamrollMinLeaderCities(){const{difficulty:t}=this.game.config().gameConfig();switch(t){case _.Easy:return 15;case _.Medium:case _.Hard:return 10;case _.Impossible:return 8;default:dt(t)}}considerMIRV(){if(this.player===null)throw new Error("not initialized");if(this.player.units(m.MissileSilo).length===0||this.player.gold()<this.cost(m.MIRV)||this.random.chance(this.hesitationOdds))return!1;const t=this.selectCounterMirvTarget();if(t)return this.maybeSendMIRV(t),!0;const e=this.selectVictoryDenialTarget();if(e)return this.maybeSendMIRV(e),!0;const i=this.selectSteamrollStopTarget();return i?(this.maybeSendMIRV(i),!0):!1}selectCounterMirvTarget(){if(this.player===null)throw new Error("not initialized");const t=this.getValidMirvTargetPlayers().filter(e=>this.isInboundMIRVFrom(e));return t.length===0?null:(t.sort((e,i)=>i.numTilesOwned()-e.numTilesOwned()),t[0])}selectVictoryDenialTarget(){if(this.player===null)throw new Error("not initialized");const t=this.game.numLandTiles();if(t===0)return null;let e=null;for(const i of this.getValidMirvTargetPlayers()){let r=0;const s=i.team();if(s!==null){const a=this.game.players().filter(l=>l.team()===s&&l.isPlayer()),c=a.map(l=>l.numTilesOwned()).reduce((l,h)=>l+h,0)/t;if(c>=this.victoryDenialTeamThreshold){let l=null,h=-1;for(const d of a){const f=d.numTilesOwned();f>h&&(h=f,l=d)}l===i?r=c:r=0}}else{const a=i.numTilesOwned()/t;a>=this.victoryDenialIndividualThreshold&&(r=a)}r>0&&(e===null||r>e.severity)&&(e={p:i,severity:r})}return e?e.p:null}selectSteamrollStopTarget(){if(this.player===null)throw new Error("not initialized");const t=this.getValidMirvTargetPlayers();if(t.length===0)return null;const e=this.game.players().filter(a=>a.isPlayer()).map(a=>({p:a,cityCount:this.countCities(a)})).sort((a,o)=>o.cityCount-a.cityCount);if(e.length<2)return null;const i=e[0];if(i.cityCount<=this.steamrollMinLeaderCities)return null;const s=e[1].cityCount*this.steamrollCityGapMultiplier;return i.cityCount>=s&&t.some(a=>a===i.p)?i.p:null}getValidMirvTargetPlayers(){if(this.player===null)throw new Error("not initialized");return this.game.players().filter(t=>t!==this.player&&t.isPlayer()&&t.type()!==P.Bot&&!this.player.isOnSameTeam(t))}isInboundMIRVFrom(t){if(this.player===null)throw new Error("not initialized");const e=t.units(m.MIRV);for(const i of e){const r=i.targetTile();if(!r||!this.game.hasOwner(r))continue;if(this.game.owner(r)===this.player)return!0}return!1}maybeSendMIRV(t){if(this.player===null)throw new Error("not initialized");this.emojiBehavior.maybeSendAttackEmoji(t);const e=this.calculateTerritoryCenter(t);e&&this.player.canBuild(m.MIRV,e)&&(this.game.addExecution(new Gh(this.player,e)),this.emojiBehavior.sendEmoji(xt,Oh),l5(this.game,this.random,t))}countCities(t){return t.unitCount(m.City)}calculateTerritoryCenter(t){return g5(this.game,t)}cost(t){if(this.player===null)throw new Error("not initialized");return this.game.unitInfo(t).cost(this.game,this.player)}}function Zh(n,t,e,i){const r=Ze(t,e.borderTiles()),s=[];for(let a=0;a<i;a++){const o=q5(n,t,e,r);o!==null&&s.push(o)}return s}function q5(n,t,e,i=null){i??=Ze(t,e.borderTiles());for(let r=0;r<100;r++){const s=n.nextInt(i.min.x,i.max.x),a=n.nextInt(i.min.y,i.max.y);if(!t.isOnMap(new Dt(s,a)))continue;const o=t.ref(s,a);if(t.owner(o)===e)return o}return e.numTilesOwned()<=100?n.randElement(Array.from(e.tiles())):null}class j5{constructor(t,e,i,r,s){this.random=t,this.game=e,this.player=i,this.attackBehavior=r,this.emojiBehavior=s,this.recentlySentNukes=[],this.atomBombsLaunched=0,this.atomBombPerceivedCost=this.cost(m.AtomBomb),this.hydrogenBombsLaunched=0,this.hydrogenBombPerceivedCost=this.cost(m.HydrogenBomb),this.isHydroNation=this.random.chance(3)}maybeSendNuke(){const t=this.findBestNukeTarget();if(t===null)return;const e=this.player.units(m.MissileSilo);if(e.length===0||t.type()===P.Bot||this.player.isOnSameTeam(t)||this.attackBehavior.shouldAttack(t)===!1)return;const i=this.getPerceivedNukeCost(m.HydrogenBomb),r=this.getPerceivedNukeCost(m.AtomBomb);let s;if(!this.game.config().isUnitDisabled(m.HydrogenBomb)&&this.player.gold()>=i)s=m.HydrogenBomb;else if(!this.game.config().isUnitDisabled(m.AtomBomb)&&(!this.isHydroNation||this.isUnderHeavyAttack())&&this.player.gold()>=r)s=m.AtomBomb;else return;const a=this.game.config().nukeMagnitudes(s).outer,o=t.units(m.City,m.DefensePost,m.MissileSilo,m.Port,m.SAMLauncher,m.Factory),c=o.map(b=>b.tile()),l=this.game.config().gameConfig().difficulty,h=l===_.Impossible?30:10,f=Zh(this.random,this.game,t,h).concat(c);let g=null,p=-1;this.removeOldNukeEvents();t:for(const b of new Set(f)){if(b===null)continue;const S=co(this.game,b,a).concat(co(this.game,b,Math.floor(a/2)));for(const A of S)if(!this.isValidNukeTile(A,t))continue t;const w=this.player.canBuild(s,b);if(w===!1||this.game.config().gameConfig().gameMode===Ct.Team&&l!==_.Easy&&this.isTeammateAlreadyNukingThisSpot(b,s)||(l===_.Hard||l===_.Impossible)&&this.isTrajectoryInterceptableBySam(w,b))continue;const v=this.nukeTileScore(b,e,o,s);v>p&&(g=b,p=v)}g!==null&&this.sendNuke(g,s,t)}findBestNukeTarget(){const t=this.attackBehavior.findIncomingAttackPlayer();if(t)return t;const{difficulty:e,gameMode:i}=this.game.config().gameConfig();if(e===_.Impossible&&i===Ct.FFA){const o=this.game.numLandTiles()-this.game.numTilesWithFallout();if(o>0){const l=this.game.players().slice().sort((h,d)=>d.numTilesOwned()-h.numTilesOwned())[0];if(l&&l!==this.player&&!this.player.isFriendly(l)&&l.numTilesOwned()/o>.5)return l}}for(const o of this.player.allies())if(o.targets().length!==0&&!(this.player.relation(o)<Pt.Friendly)){for(const c of o.targets())if(c!==this.player&&!this.player.isFriendly(c))return c}const r=this.game.config().maxTroops(this.player);for(const o of this.player.allRelationsSorted()){if(o.relation!==Pt.Hostile)continue;const c=o.player;if(this.player.isFriendly(c))continue;const l=this.game.config().maxTroops(c);if(!(r>=l*2))return c}const s=this.findFFACrownTarget();if(s)return s;const a=this.findStrongestTeamTarget();return a||null}findFFACrownTarget(){const{difficulty:t,gameMode:e}=this.game.config().gameConfig();if(e!==Ct.FFA||this.game.players().length<=1)return null;const i=this.game.players().slice().sort((l,h)=>h.numTilesOwned()-l.numTilesOwned()),r=i[0];if(t===_.Impossible&&r===this.player&&i.length>=2){const l=i[1];if(!this.player.isFriendly(l))return l}if(r===this.player||this.player.isFriendly(r))return null;const s=this.game.numLandTiles()-this.game.numTilesWithFallout();if(s<=0)return null;const a=r.numTilesOwned()/s,o=this.player.numTilesOwned()/s;let c;switch(t){case _.Easy:c=.4;break;case _.Medium:c=.3;break;case _.Hard:c=.2;break;case _.Impossible:c=.1;break;default:dt(t)}return a-o>c?r:null}findStrongestTeamTarget(){if(this.game.config().gameConfig().gameMode!==Ct.Team||this.game.players().length<=1)return null;const t=new Map,e=new Map;for(const o of this.game.players()){const c=o.team();if(c===null)continue;t.set(c,(t.get(c)??0)+o.numTilesOwned());let l=e.get(c);l||(l=[],e.set(c,l)),l.push(o)}const i=Array.from(t.entries()).sort((o,c)=>c[1]-o[1]);if(i.length===0)return null;let r=i[0][0];if(r===this.player.team())if(i.length>1)r=i[1][0];else return null;const a=e.get(r).filter(o=>!this.player.isFriendly(o));return a.length===0?null:this.random.chance(2)?a.reduce((o,c)=>this.game.config().maxTroops(o)>this.game.config().maxTroops(c)?o:c):this.random.randElement(a)}getPerceivedNukeCost(t){if(this.game.config().isUnitDisabled(m.MIRV))return this.cost(t);if(this.game.config().gameConfig().gameMode===Ct.Team||this.player.gold()>this.cost(m.MIRV)+this.cost(m.HydrogenBomb))return this.cost(t);const e=this.game.config().gameConfig().difficulty;return(e===_.Hard||e===_.Impossible)&&this.isUnderHeavyAttack()?this.cost(t):t===m.AtomBomb?this.atomBombPerceivedCost:this.hydrogenBombPerceivedCost}isUnderHeavyAttack(){const t=this.player.incomingAttacks();let e=0;for(const r of t)e+=r.troops();const i=this.player.troops();return e>=i}removeOldNukeEvents(){const e=this.game.ticks();for(;this.recentlySentNukes.length>0&&this.recentlySentNukes[0][0]+600<e;)this.recentlySentNukes.shift()}isTeammateAlreadyNukingThisSpot(t,e){const i=this.game.config().nukeMagnitudes(e).inner,r=this.game.units(m.AtomBomb,m.HydrogenBomb);for(const s of r){const a=s.owner();if(a===this.player||!this.player.isFriendly(a))continue;const o=s.targetTile();if(!o)continue;const c=this.game.config().nukeMagnitudes(s.type()).inner,l=this.game.euclideanDistSquared(t,o),h=i+c,d=h*h;if(l<=d)return!0}return!1}isTrajectoryInterceptableBySam(t,e){const i=this.game.config().defaultNukeSpeed(),s=fa.Parabola(this.game,{increment:i,distanceBasedHeight:!0,directionUp:!0}).findPath(t,e)??[];if(s.length===0)return!1;const a=this.game.config().defaultNukeTargetableRange()**2;let o=-1,c=-1;for(let l=0;l<s.length;l++){const h=s[l];if(o===-1){if(this.game.euclideanDistSquared(h,t)>a){if(this.game.euclideanDistSquared(h,e)<a)break;o=l}}else if(this.game.euclideanDistSquared(h,e)<a){c=l;break}}for(let l=0;l<s.length;l++){if(o!==-1&&c!==-1&&l===o){l=c-1;continue}const h=s[l],d=this.game.nearbyUnits(h,this.game.config().maxSamRange(),m.SAMLauncher);for(const f of d){const g=f.unit.owner();if(g===this.player||this.player.isFriendly(g))continue;const p=this.game.config().samRange(f.unit.level())**2;if(f.distSquared<=p)return!0}}return!1}isValidNukeTile(t,e){const i=this.game.config().gameConfig().difficulty,r=this.game.owner(t);return!!(r===e||(i===_.Hard||i===_.Impossible)&&(!r.isPlayer()||this.game.config().gameConfig().gameMode===Ct.Team&&r.isPlayer()&&!this.player.isFriendly(r)))}nukeTileScore(t,e,i,r){const s=this.game.config().nukeMagnitudes(r),a=wa(t,s.outer,!1);let o=i.filter(S=>a(this.game,S.tile())).map(S=>{const w=S.level();switch(S.type()){case m.City:return 25e3*w;case m.DefensePost:return 5e3*w;case m.MissileSilo:return 5e4*w;case m.Port:return 15e3*w;case m.Factory:return 15e3*w;default:return 0}}).reduce((S,w)=>S+w,0);const c=this.game.config().gameConfig().difficulty;if(c===_.Medium){const S=wa(t,50,!1);if(i.some(v=>v.type()===m.SAMLauncher&&S(this.game,v.tile())))return-1}if(c===_.Impossible&&r===m.HydrogenBomb){const S=this.game.config().nukeMagnitudes(m.HydrogenBomb),w=this.game.nearbyUnits(t,S.outer,m.SAMLauncher);for(const v of w){const A=v.unit.level();if(A>=5)continue;const E=this.game.config().samRange(A);Math.sqrt(this.game.euclideanDistSquared(t,v.unit.tile()))>E&&(o+=1e5*A)}}const l=e.map(S=>S.tile()),h=en(this.game,l,[t]);if(h===null)throw new Error("Missing result");const{x:d}=h,f=this.game.euclideanDistSquared(t,d),p=Math.sqrt(f)*30;return o=Math.max(o*.2,o-p),o-=this.recentlySentNukes.filter(([S,w,v])=>{const A=this.game.config().nukeMagnitudes(v).inner;return this.game.euclideanDistSquared(t,w)<=A*A}).map(S=>1e6).reduce((S,w)=>S+w,0),o}sendNuke(t,e,i){const r=this.game.ticks();this.recentlySentNukes.push([r,t,e]),e===m.AtomBomb?(this.atomBombsLaunched++,this.atomBombPerceivedCost=this.atomBombPerceivedCost*135n/100n):e===m.HydrogenBomb&&(this.hydrogenBombsLaunched++,this.hydrogenBombPerceivedCost=this.hydrogenBombPerceivedCost*125n/100n),this.game.addExecution(new va(e,this.player,t)),this.emojiBehavior.maybeSendEmoji(i,Oh)}cost(t){return this.game.unitInfo(t).cost(this.game,this.player)}}class Yh{constructor(t,e){this.player=t,this.unitId=e}init(t,e){if(this.structure=this.player.units().find(i=>i.id()===this.unitId),this.structure===void 0){console.warn("structure is undefined");return}if(!this.player.canUpgradeUnit(this.structure)){console.warn(`[UpgradeStructureExecution] unit type ${this.structure.type()} cannot be upgraded`);return}this.player.upgradeUnit(this.structure)}tick(t){}isActive(){return!1}activeDuringSpawnPhase(){return!1}}const H5={[_.Easy]:.15,[_.Medium]:.2,[_.Hard]:.25,[_.Impossible]:.3};function Xh(n){return{[m.Port]:{ratioPerCity:.75,perceivedCostIncreasePerOwned:1},[m.Factory]:{ratioPerCity:.75,perceivedCostIncreasePerOwned:1},[m.DefensePost]:{ratioPerCity:.25,perceivedCostIncreasePerOwned:1},[m.SAMLauncher]:{ratioPerCity:H5[n],perceivedCostIncreasePerOwned:1},[m.MissileSilo]:{ratioPerCity:.2,perceivedCostIncreasePerOwned:1}}}const G5=1,Z5=.33,Y5=3,Vh=1/1500,X5=1/5e3,V5=2e3;class K5{constructor(t,e,i){this.random=t,this.game=e,this.player=i}handleStructures(){const t=this.game.config(),e=t.isUnitDisabled(m.City),i=e?Math.max(1,Math.floor(this.player.numTilesOwned()/V5)):this.player.unitsOwned(m.City),r=this.hasCoastalTiles(),s=[m.DefensePost,m.Port,m.Factory,m.SAMLauncher,m.MissileSilo],a=!t.isUnitDisabled(m.AtomBomb)||!t.isUnitDisabled(m.HydrogenBomb)||!t.isUnitDisabled(m.MIRV),o=!t.isUnitDisabled(m.MissileSilo);for(const c of s)if(!t.isUnitDisabled(c)&&!(c===m.Port&&!r)&&!(!a&&(c===m.MissileSilo||c===m.SAMLauncher))&&!(!o&&c===m.SAMLauncher)&&this.shouldBuildStructure(c,i,r)&&this.maybeSpawnStructure(c))return!0;return!!(!e&&this.maybeSpawnStructure(m.City))}hasCoastalTiles(){for(const t of this.player.borderTiles())if(this.game.isOceanShore(t))return!0;return!1}shouldBuildStructure(t,e,i){const{difficulty:r}=this.game.config().gameConfig(),a=Xh(r)[t];if(a===void 0)return!1;let o=a.ratioPerCity;t===m.Factory&&i&&!this.game.config().isUnitDisabled(m.Port)&&(o*=Z5);const c=this.player.unitsOwned(t);if(t===m.MissileSilo&&c>=Y5)return!1;if(t===m.DefensePost){const h=this.player.numTilesOwned();if(h>0&&c/h>=X5)return!1}const l=Math.floor(e*o);return c<l}cost(t){return this.game.unitInfo(t).cost(this.game,this.player)}maybeSpawnStructure(t){const e=this.getPerceivedCost(t);if(this.player.gold()<e)return!1;const i=this.player.units(t);if(this.getTotalStructureDensity()>Vh&&t!==m.DefensePost){if(this.maybeUpgradeStructure(i))return!0;if(i.length>0)return!1}const r=this.structureSpawnTile(t);return r===null||this.player.canBuild(t,r)===!1?!1:(this.game.addExecution(new li(this.player,t,r)),!0)}getPerceivedCost(t){const e=this.cost(t),i=this.getSaveUpTarget();if(i===0n||this.player.gold()>=i)return e;const r=this.player.unitsOwned(t);let s;if(t===m.City)s=G5;else{const{difficulty:o}=this.game.config().gameConfig();s=Xh(o)[t]?.perceivedCostIncreasePerOwned??.1}const a=1+s*r;return BigInt(Math.ceil(Number(e)*a))}getSaveUpTarget(){const t=this.game.config();if(t.isUnitDisabled(m.MissileSilo))return 0n;const e=!t.isUnitDisabled(m.MIRV),i=!t.isUnitDisabled(m.HydrogenBomb),r=!t.isUnitDisabled(m.AtomBomb);return e?this.cost(m.MIRV)+this.cost(m.HydrogenBomb):i?this.cost(m.HydrogenBomb)*5n:r?this.cost(m.AtomBomb)*20n:0n}maybeUpgradeStructure(t){if(this.getTotalStructureDensity()<=Vh||t.length===0)return!1;const e=this.findBestStructureToUpgrade(t);return e!==null&&this.player.canUpgradeUnit(e)?(this.game.addExecution(new Yh(this.player,e.id())),!0):!1}getTotalStructureDensity(){let t=0;for(const i of is)t+=this.player.units(i).length;const e=this.player.numTilesOwned();return e>0?t/e:0}findBestStructureToUpgrade(t){if(t.length===0)return null;const e=t.filter(o=>this.player.canUpgradeUnit(o));if(e.length===0)return null;const{difficulty:i}=this.game.config().gameConfig();let r;switch(i){case _.Easy:r=70;break;case _.Medium:r=40;break;case _.Hard:r=25;break;case _.Impossible:r=10;break;default:dt(i)}if(this.random.nextInt(0,100)<r)return this.random.randElement(e);const s=this.player.units(m.SAMLauncher),a=[];for(const o of e){let c=0;for(const l of s){const h=this.game.config().samRange(l.level()),d=h*h;this.game.euclideanDistSquared(o.tile(),l.tile())<=d&&(c+=10,l.level()>1&&(c+=(l.level()-1)*7.5))}c+=this.random.nextInt(0,5),a.push({structure:o,score:c})}if(a.length===0)return null;if(a.sort((o,c)=>c.score-o.score),a.length>=2&&this.random.chance(2)){const o=a.length>=3?this.random.nextInt(1,3):1;return a[o].structure}return a[0].structure}structureSpawnTile(t){const e=t===m.Port?this.randCoastalTileArray(25):Zh(this.random,this.game,this.player,25);if(e.length===0)return null;const i=this.structureSpawnTileValue(t);if(i===null)return null;let r=null,s=0;for(const a of e){const o=i(a);o<=s&&r!==null||this.player.canBuild(t,a)&&(r=a,s=o)}return r}randCoastalTileArray(t){const e=Array.from(this.player.borderTiles()).filter(i=>this.game.isOceanShore(i));return Array.from(this.arraySampler(e,t))}*arraySampler(t,e){if(t.length<=e)yield*t;else{const i=new Set(t);for(;e--;){const r=this.random.randFromSet(i);i.delete(r),yield r}}}structureSpawnTileValue(t){switch(t){case m.City:case m.Factory:case m.MissileSilo:return this.interiorStructureValue(t);case m.Port:return this.portValue();case m.DefensePost:return this.defensePostValue();case m.SAMLauncher:return this.samLauncherValue();default:throw new Error(`Value function not implemented for ${t}`)}}interiorStructureValue(t){const e=this.game,i=this.player.borderTiles(),r=this.player.units(t),{borderSpacing:s,structureSpacing:a}=this.spacingConstants();return o=>{let c=0;c+=e.magnitude(o);const[,l]=_a(e,i,o);c+=Math.min(l,s);const h=new Set(r.map(f=>f.tile()));h.delete(o);const d=en(e,h,[o]);if(d!==null){const f=e.manhattanDist(d.x,o);c+=Math.min(f,a)}return c}}portValue(){const t=this.game,e=this.player.units(m.Port),{structureSpacing:i}=this.spacingConstants();return r=>{let s=0;const a=new Set(e.map(c=>c.tile()));a.delete(r);const[,o]=_a(t,a,r);return s+=Math.min(o,i),s}}defensePostValue(){const t=this.game,e=this.player,i=e.borderTiles(),r=e.units(m.DefensePost),{borderSpacing:s,structureSpacing:a}=this.spacingConstants();return e.neighbors().filter(c=>c.isPlayer()&&e.isFriendly(c)===!1&&c.type()!==P.Bot&&c.troops()>e.troops()).length>0?c=>{let l=0;l+=t.magnitude(c);const[h,d]=_a(t,i,c);if(h!==null){l+=Math.max(0,s-Math.abs(s-d));const p=new Set;for(const b of t.neighbors(h)){if(!t.isLand(b))continue;const S=t.ownerID(b);if(S===e.smallID())continue;const w=t.playerBySmallID(S);w.isPlayer()&&w.type()!==P.Bot&&(w.troops()<=e.troops()||p.add(w))}for(const b of p)l+=s*(Pt.Friendly-e.relation(b))}const f=new Set(r.map(p=>p.tile()));f.delete(c);const g=en(t,f,[c]);if(g!==null){const p=t.manhattanDist(g.x,c);l+=Math.min(p,a)}return l}:null}samLauncherValue(){const t=this.game,e=this.player,i=e.borderTiles(),r=e.units(m.SAMLauncher),{borderSpacing:s,structureSpacing:a}=this.spacingConstants(),{difficulty:o}=t.config().gameConfig(),c=o===_.Hard||o===_.Impossible,l=[];for(const p of e.units())switch(p.type()){case m.City:case m.Factory:case m.MissileSilo:case m.Port:l.push({tile:p.tile(),weight:c?p.level():1})}const h=t.config().defaultSamRange(),d=h*h,f=o!==_.Easy&&this.random.nextInt(0,100)<25;let g=null;if(f){g=new Map;const p=e.units(m.SAMLauncher);for(const b of l){let S=0;for(const w of p){const v=t.config().samRange(w.level());t.euclideanDistSquared(b.tile,w.tile())<=v*v&&(S+=w.level())}g.set(b.tile,S)}}return p=>{let b=0;b+=t.magnitude(p);const S=en(t,i,[p]);if(S!==null){const A=t.manhattanDist(S.x,p);b+=Math.min(A,s)}const w=new Set(r.map(A=>A.tile()));w.delete(p);const v=en(t,w,[p]);if(v!==null){const A=t.manhattanDist(v.x,p);b+=Math.min(A,a)}if(o!==_.Easy){for(const A of l)if(!(t.euclideanDistSquared(p,A.tile)>d))if(f&&g!==null){const x=1/(1+(g.get(A.tile)??0));b+=a*A.weight*x}else b+=a*A.weight}return b}}spacingConstants(){const t=this.game.config().nukeMagnitudes(m.AtomBomb).outer;return{borderSpacing:t,structureSpacing:t*2}}}class J5{constructor(t,e,i,r){this.random=t,this.game=e,this.player=i,this.emojiBehavior=r,this.trackedTransportShips=new Set,this.trackedTradeShips=new Set}maybeSpawnWarship(){if(this.player===null)throw new Error("not initialized");if(!this.random.chance(50))return!1;const t=this.player.units(m.Port),e=this.player.units(m.Warship);if(t.length>0&&e.length===0&&this.player.gold()>this.cost(m.Warship)){const i=this.random.randElement(t),r=this.warshipSpawnTile(i.tile());return r===null||this.player.canBuild(m.Warship,r)===!1?!1:(this.game.addExecution(new li(this.player,m.Warship,r)),!0)}return!1}warshipSpawnTile(t){for(let i=0;i<50;i++){const r=this.random.nextInt(this.game.x(t)-250,this.game.x(t)+250),s=this.random.nextInt(this.game.y(t)-250,this.game.y(t)+250);if(!this.game.isValidCoord(r,s))continue;const a=this.game.ref(r,s);if(this.game.isOcean(a))return a}return null}trackShipsAndRetaliate(){this.trackTransportShipsAndRetaliate(),this.trackTradeShipsAndRetaliate()}trackTransportShipsAndRetaliate(){this.player.units(m.TransportShip).forEach(t=>this.trackedTransportShips.add(t));for(const t of Array.from(this.trackedTransportShips))t.isActive()||(t.wasDestroyedByEnemy()&&t.destroyer()!==void 0&&this.maybeRetaliateWithWarship(t.tile(),t.destroyer(),"transport"),this.trackedTransportShips.delete(t))}trackTradeShipsAndRetaliate(){this.player.units(m.TradeShip).forEach(t=>this.trackedTradeShips.add(t));for(const t of Array.from(this.trackedTradeShips)){if(!t.isActive()){this.trackedTradeShips.delete(t);continue}t.owner().id()!==this.player.id()&&(this.maybeRetaliateWithWarship(t.tile(),t.owner(),"trade"),this.trackedTradeShips.delete(t))}}maybeRetaliateWithWarship(t,e,i){if(this.player.units(m.Warship).length>=10)return;const{difficulty:r}=this.game.config().gameConfig();if(r===_.Medium&&this.random.nextInt(0,100)<15||r===_.Hard&&this.random.nextInt(0,100)<50||r===_.Impossible&&this.random.nextInt(0,100)<80){if(this.player.canBuild(m.Warship,t)===!1)return;this.game.addExecution(new li(this.player,m.Warship,t)),this.emojiBehavior.maybeSendEmoji(e,Rh),this.player.updateRelation(e,i==="trade"?-7.5:-15)}}counterWarshipInfestation(){if(!this.shouldCounterWarshipInfestation())return;const t=this.player.team()!==null;if(!this.isRichPlayer(t))return;const e=this.findWarshipInfestationCounterTarget(t);e!==null&&this.buildCounterWarship(e)}shouldCounterWarshipInfestation(){const{difficulty:t}=this.game.config().gameConfig();return!(t!==_.Hard&&t!==_.Impossible||this.game.unitCount(m.Warship)<=10||this.cost(m.Warship)>this.player.gold()||this.player.units(m.Port).length===0||this.player.units(m.Warship).length>=10)}isRichPlayer(t){return this.game.players().filter(r=>r.type()===P.Human?!1:t?r.team()===this.player.team():!0).sort((r,s)=>Number(s.gold()-r.gold())).slice(0,3).some(r=>r.id()===this.player.id())}findWarshipInfestationCounterTarget(t){return t?this.findTeamGameWarshipTarget():this.findFreeForAllWarshipTarget()}findTeamGameWarshipTarget(){const t=new Map;for(const e of this.game.players()){if(this.player.isFriendly(e)||e.id()===this.player.id())continue;const i=e.team();if(i===null)continue;const r=i.toString(),s=e.units(m.Warship).length;t.has(r)||t.set(r,{count:0,team:r,players:[]});const a=t.get(r);a.count+=s,a.players.push(e)}for(const[,e]of t.entries())if(e.count>15){const i=e.players.reduce((r,s)=>{const a=s.units(m.Warship).length,o=r?r.units(m.Warship).length:0;return a>o?s:r},null);if(i){const r=i.units(m.Warship);if(r.length>3)return{player:i,warship:this.random.randElement(r)}}}return null}findFreeForAllWarshipTarget(){const t=this.game.players().filter(e=>!this.player.isFriendly(e)&&e.id()!==this.player.id());for(const e of t){const i=e.units(m.Warship);if(i.length>10)return{player:e,warship:this.random.randElement(i)}}return null}buildCounterWarship(t){this.player.canBuild(m.Warship,t.warship.tile())!==!1&&(this.game.addExecution(new li(this.player,m.Warship,t.warship.tile())),this.emojiBehavior.sendEmoji(xt,Rh))}cost(t){return this.game.unitInfo(t).cost(this.game,this.player)}}class Q5{constructor(t,e){this.gameID=t,this.nation=e,this.active=!0,this.behaviorsInitialized=!1,this.player=null,this.embargoMalusApplied=new Set,this.random=new gt(It(e.playerInfo.id)+It(t)),this.triggerRatio=this.random.nextInt(50,60)/100,this.reserveRatio=this.random.nextInt(30,40)/100,this.expandRatio=this.random.nextInt(10,20)/100}init(t){this.mg=t,this.attackRate=this.getAttackRate(),this.attackTick=this.random.nextInt(0,this.attackRate),this.mg.hasPlayer(this.nation.playerInfo.id)?this.player=this.mg.player(this.nation.playerInfo.id):this.player=this.mg.addPlayer(this.nation.playerInfo)}getAttackRate(){const{difficulty:t}=this.mg.config().gameConfig();switch(t){case _.Easy:return this.random.nextInt(65,80);case _.Medium:return this.random.nextInt(55,70);case _.Hard:return this.random.nextInt(45,60);case _.Impossible:return this.random.nextInt(30,50);default:dt(t)}}tick(t){if(this.behaviorsInitialized&&this.player!==null&&this.player.isAlive()&&this.mg.config().gameConfig().difficulty!==_.Easy&&this.warshipBehavior.trackShipsAndRetaliate(),t%this.attackRate!==this.attackTick){if(this.behaviorsInitialized&&this.player!==null&&this.player.isAlive()){const e=t%this.attackRate,i=(this.attackTick+Math.floor(this.attackRate/3))%this.attackRate,r=(this.attackTick+Math.floor(this.attackRate*2/3))%this.attackRate;(e===i||e===r)&&this.structureBehavior.handleStructures()}return}if(this.player!==null){if(this.mg.inSpawnPhase()){if(this.nation.spawnCell===void 0){this.mg.addExecution(new nn(this.gameID,this.nation.playerInfo));return}const e=this.randomSpawnLand();if(e===null){console.warn(`cannot spawn ${this.nation.playerInfo.name}`);return}this.mg.addExecution(new nn(this.gameID,this.nation.playerInfo,e));return}if(!this.player.isAlive()){this.active=!1;return}if(!this.behaviorsInitialized){this.initializeBehaviors(),this.attackBehavior.forceSendAttack(this.mg.terraNullius());return}this.emojiBehavior.maybeSendCasualEmoji(),this.updateRelationsFromEmbargos(),this.allianceBehavior.handleAllianceRequests(),this.allianceBehavior.handleAllianceExtensionRequests(),this.mirvBehavior.considerMIRV(),this.structureBehavior.handleStructures(),this.warshipBehavior.maybeSpawnWarship(),this.handleEmbargoesToHostileNations(),this.attackBehavior.maybeAttack(),this.warshipBehavior.counterWarshipInfestation(),this.nukeBehavior.maybeSendNuke()}}initializeBehaviors(){if(this.player===null)throw new Error("Player not initialized");this.emojiBehavior=new o5(this.random,this.mg,this.player),this.mirvBehavior=new F5(this.random,this.mg,this.player,this.emojiBehavior),this.allianceBehavior=new $5(this.random,this.mg,this.player,this.emojiBehavior),this.warshipBehavior=new J5(this.random,this.mg,this.player,this.emojiBehavior),this.attackBehavior=new $h(this.random,this.mg,this.player,this.triggerRatio,this.reserveRatio,this.expandRatio,this.allianceBehavior,this.emojiBehavior),this.nukeBehavior=new j5(this.random,this.mg,this.player,this.attackBehavior,this.emojiBehavior),this.structureBehavior=new K5(this.random,this.mg,this.player),this.behaviorsInitialized=!0}randomSpawnLand(){if(this.nation.spawnCell===void 0)throw new Error("not initialized");const t=25;let e=0;for(;e<50;){e++;const i=this.nation.spawnCell,r=this.random.nextInt(i.x-t,i.x+t),s=this.random.nextInt(i.y-t,i.y+t);if(!this.mg.isValidCoord(r,s))continue;const a=this.mg.ref(r,s);if(this.mg.isLand(a)&&!this.mg.hasOwner(a)){if(this.mg.terrainType(a)===_t.Mountain&&this.random.chance(2))continue;return a}}return null}updateRelationsFromEmbargos(){const t=this.player;if(t===null)return;this.mg.players().filter(i=>i.id()!==t.id()).forEach(i=>{i.hasEmbargoAgainst(t)&&!this.embargoMalusApplied.has(i.id())?(t.updateRelation(i,-20),this.embargoMalusApplied.add(i.id())):!i.hasEmbargoAgainst(t)&&this.embargoMalusApplied.has(i.id())&&(t.updateRelation(i,20),this.embargoMalusApplied.delete(i.id()))})}handleEmbargoesToHostileNations(){const t=this.player;if(t===null)return;this.mg.players().filter(i=>i.id()!==t.id()).forEach(i=>{t.relation(i)<=Pt.Hostile&&!t.hasEmbargoAgainst(i)&&!t.isOnSameTeam(i)?t.addEmbargo(i,!1):(t.relation(i)>=Pt.Neutral&&t.hasEmbargoAgainst(i)&&this.mg.config().gameConfig().difficulty!==_.Hard&&this.mg.config().gameConfig().difficulty!==_.Impossible||t.relation(i)>=Pt.Friendly&&t.hasEmbargoAgainst(i)&&this.mg.config().gameConfig().difficulty!==_.Impossible)&&t.stopEmbargo(i)})}isActive(){return this.active}activeDuringSpawnPhase(){return!0}}class tw{isActive(){return!1}activeDuringSpawnPhase(){return!1}init(t,e){}tick(t){}}class ew{constructor(t,e){this.player=t,this.paused=e}isActive(){return!1}activeDuringSpawnPhase(){return!0}init(t,e){(this.player.isLobbyCreator()||t.config().gameConfig().gameType===Ln.Singleplayer)&&t.setPaused(this.paused)}tick(t){}}class nw{constructor(t,e,i,r){this.sender=t,this.recipientID=e,this.quickChatKey=i,this.target=r,this.active=!0}init(t,e){if(this.mg=t,!t.hasPlayer(this.recipientID)){console.warn(`QuickChatExecution: recipient ${this.recipientID} not found`),this.active=!1;return}this.recipient=t.player(this.recipientID)}tick(t){const e=this.getMessageFromKey(this.quickChatKey);this.mg.displayChat(e[1],e[0],this.target,this.recipient.id(),!0,this.sender.id()),this.mg.displayChat(e[1],e[0],this.target,this.sender.id(),!1,this.recipient.id()),console.log(`[QuickChat] ${this.sender.name} â†’ ${this.recipient.displayName}: ${e}`),this.active=!1}owner(){return this.sender}isActive(){return this.active}activeDuringSpawnPhase(){return!1}getMessageFromKey(t){return t.split(".")}}const iw=20;class rw{constructor(t,e){this.player=t,this.attackID=e,this.active=!0,this.retreatOrdered=!1}init(t,e){this.mg=t,this.startTick=t.ticks()}tick(t){this.retreatOrdered||(this.player.orderRetreat(this.attackID),this.retreatOrdered=!0),this.mg.ticks()>=this.startTick+iw&&(this.player.executeRetreat(this.attackID),this.active=!1)}owner(){return this.player}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class sw{constructor(t,e){this.requestor=t,this.targetID=e,this.active=!0}init(t,e){if(!t.hasPlayer(this.targetID)){console.warn(`TargetPlayerExecution: target ${this.targetID} not found`),this.active=!1;return}this.target=t.player(this.targetID)}tick(t){this.requestor.canTarget(this.target)&&(this.requestor.target(this.target),this.target.updateRelation(this.requestor,-40)),this.active=!1}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class aw{constructor(t,e){this.gm=t,this.gameID=e,this.players=[]}spawnPlayers(){for(const t of this.gm.allPlayers())t.type()===P.Human&&this.players.push(new nn(this.gameID,t.info()));return this.players}}class ow{constructor(t,e,i){this.mg=t,this.gameID=e,this.clientID=i,this.random=new gt(It(e)+1)}createExecs(t){return t.intents.map(e=>this.createExec(e))}createExec(t){const e=this.mg.playerByClientID(t.clientID);if(!e)return console.warn(`player with clientID ${t.clientID} not found`),new tw;switch(t.type){case"attack":return new Ar(t.troops,e,t.targetID,null);case"cancel_attack":return new rw(e,t.attackID);case"cancel_boat":return new Ab(e,t.unitID);case"move_warship":return new W5(e,t.unitId,t.tile);case"spawn":return new nn(this.gameID,e.info(),t.tile);case"boat":return new ya(e,t.dst,t.troops);case"allianceRequest":return new Ih(e,t.recipient);case"allianceRequestReply":return new _b(t.requestor,e,t.accept);case"breakAlliance":return new Sb(e,t.recipient);case"targetPlayer":return new sw(e,t.target);case"emoji":return new je(e,t.recipient,t.emoji);case"donate_troops":return new Uh(e,t.recipient,t.troops);case"donate_gold":return new B5(e,t.recipient,t.gold);case"embargo":return new z5(e,t.targetID,t.action);case"embargo_all":return new L5(e,t.action);case"build_unit":return new li(e,t.unit,t.tile,t.rocketDirectionUp);case"allianceExtension":return new la(e,t.recipient);case"upgrade_structure":return new Yh(e,t.unitId);case"delete_unit":return new xh(e,t.unitId);case"quick_chat":return new nw(e,t.recipient,t.quickChatKey,t.target);case"mark_disconnected":return new U5(e,t.isDisconnected);case"toggle_pause":return new ew(e,t.paused);default:throw new Error(`intent type ${t} not found`)}}spawnBots(t){return new b5(this.mg,this.gameID).spawnBots(t)}spawnPlayers(){return new aw(this.mg,this.gameID).spawnPlayers()}nationExecutions(){const t=[];for(const e of this.mg.nations())t.push(new Q5(this.gameID,e));return t}}class cw{constructor(){this.active=!0,this.mg=null}init(t,e){this.mg=t}tick(t){if(t%10===0){if(this.mg===null)throw new Error("Not initialized");this.mg.config().gameConfig().gameMode===Ct.FFA?this.checkWinnerFFA():this.checkWinnerTeam()}}checkWinnerFFA(){if(this.mg===null)throw new Error("Not initialized");const t=this.mg.players().sort((s,a)=>a.numTilesOwned()-s.numTilesOwned());if(t.length===0)return;if(this.mg.config().gameConfig().rankedType===ns.OneVOne){const s=t.filter(a=>a.type()===P.Human&&!a.isDisconnected());if(s.length===1){this.mg.setWinner(s[0],this.mg.stats().stats()),console.log(`${s[0].name()} has won the game`),this.active=!1;return}}const e=t[0],i=(this.mg.ticks()-this.mg.config().numSpawnPhaseTurns())/10,r=this.mg.numLandTiles()-this.mg.numTilesWithFallout();(e.numTilesOwned()/r*100>this.mg.config().percentageTilesOwnedToWin()||this.mg.config().gameConfig().maxTimerValue!==void 0&&i-this.mg.config().gameConfig().maxTimerValue*60>=0)&&(this.mg.setWinner(e,this.mg.stats().stats()),console.log(`${e.name()} has won the game`),this.active=!1)}checkWinnerTeam(){if(this.mg===null)throw new Error("Not initialized");const t=new Map;for(const o of this.mg.players()){const c=o.team();c!==null&&t.set(c,(t.get(c)??0)+o.numTilesOwned())}const e=Array.from(t.entries()).sort((o,c)=>c[1]-o[1]);if(e.length===0)return;const i=e[0],r=(this.mg.ticks()-this.mg.config().numSpawnPhaseTurns())/10,s=this.mg.numLandTiles()-this.mg.numTilesWithFallout();if(i[1]/s*100>this.mg.config().percentageTilesOwnedToWin()||this.mg.config().gameConfig().maxTimerValue!==void 0&&r-this.mg.config().gameConfig().maxTimerValue*60>=0){if(i[0]===ft.Bot)return;this.mg.setWinner(i[0],this.mg.stats().stats()),console.log(`${i[0]} has won the game`),this.active=!1}}isActive(){return this.active}activeDuringSpawnPhase(){return!1}}class Kh{constructor(t){this.stamp=1,this.visitedStamp=new Uint32Array(t),this.queue=new Int32Array(t),this.dist=new Uint16Array(t)}search(t,e,i,r,s,a){const o=this.nextStamp(),c=(e-1)*t,l=typeof i=="number"?[i]:i;let h=0,d=0;for(const f of l)this.visitedStamp[f]=o,this.dist[f]=0,this.queue[d++]=f;for(;h<d;){const f=this.queue[h++],g=this.dist[f],p=a(f,g);if(p!=null)return p;if(p===null)continue;const b=g+1;if(b>r)continue;const S=f%t;if(f>=t){const w=f-t;this.visitedStamp[w]!==o&&s(w)&&(this.visitedStamp[w]=o,this.dist[w]=b,this.queue[d++]=w)}if(f<c){const w=f+t;this.visitedStamp[w]!==o&&s(w)&&(this.visitedStamp[w]=o,this.dist[w]=b,this.queue[d++]=w)}if(S!==0){const w=f-1;this.visitedStamp[w]!==o&&s(w)&&(this.visitedStamp[w]=o,this.dist[w]=b,this.queue[d++]=w)}if(S!==t-1){const w=f+1;this.visitedStamp[w]!==o&&s(w)&&(this.visitedStamp[w]=o,this.dist[w]=b,this.queue[d++]=w)}}return null}nextStamp(){const t=this.stamp++;return this.stamp>4294967295&&(this.visitedStamp.fill(0),this.stamp=1),t}}const Aa=255;class lw{constructor(t,e=!0){this.map=t,this.accessTerrainDirectly=e,this.componentIds=null,this.width=t.width(),this.height=t.height(),this.numTiles=this.width*this.height,this.lastRowStart=(this.height-1)*this.width,this.queue=new Int32Array(this.numTiles)}initialize(){G.start("ConnectedComponents:initialize");let t=this.createPrefilledIds(),e=0;for(let i=0;i<this.numTiles;i++){const r=t[i];r===Aa||r>0||(e++,e===254&&t instanceof Uint8Array&&(t=this.upgradeToUint16Array(t)),this.floodFillComponent(t,i,e))}this.componentIds=t,G.end()}createPrefilledIds(){const t=new Uint8Array(this.numTiles);return this.accessTerrainDirectly?this.premarkLandTilesDirect(t):this.premarkLandTiles(t),t}premarkLandTiles(t){for(let e=0;e<this.numTiles;e++)t[e]=this.map.isWater(e)?0:Aa}premarkLandTilesDirect(t){const e=this.map.terrain,i=Math.floor(this.numTiles/4),r=new Uint32Array(e.buffer,e.byteOffset,i),s=new Uint32Array(t.buffer,t.byteOffset,i);for(let a=0;a<i;a++){const o=r[a],c=-(o>>7&1)&255,l=-(o>>15&1)&255,h=-(o>>23&1)&255,d=-(o>>31&1);s[a]=c|l<<8|h<<16|d<<24}for(let a=i*4;a<this.numTiles;a++)t[a]=-(e[a]>>7)}upgradeToUint16Array(t){const e=new Uint16Array(this.numTiles);for(let i=0;i<this.numTiles;i++)e[i]=t[i];return e}floodFillComponent(t,e,i){let r=0,s=0;for(this.queue[s++]=e;r<s;){const a=this.queue[r++];if(t[a]!==0)continue;let o=a;const c=a-a%this.width;for(;o>c&&t[o-1]===0;)o--;let l=a;const h=c+this.width-1;for(;l<h&&t[l+1]===0;)l++;for(let d=o;d<=l;d++){if(t[d]=i,d>=this.width){const f=d-this.width;t[f]===0&&(this.queue[s++]=f)}if(d<this.lastRowStart){const f=d+this.width;t[f]===0&&(this.queue[s++]=f)}}}}getComponentId(t){return this.componentIds?this.componentIds[t]??0:0}}class hw{constructor(t,e,i){this.clusterSize=t,this.clustersX=e,this.clustersY=i,this._nodes=[],this._edges=[],this._nodeEdgeIds=[],this._clusters=[],this._pathCache=[],this._waterComponents=null}getNode(t){return this._nodes[t]}getAllNodes(){return this._nodes}get nodeCount(){return this._nodes.length}getEdge(t){return this._edges[t]}getNodeEdges(t){const e=this._nodeEdgeIds[t];return e?e.map(i=>this._edges[i]):[]}getEdgeBetween(t,e){const i=this._nodeEdgeIds[t];if(i)for(const r of i){const s=this._edges[r];if(s.nodeA===e||s.nodeB===e)return s}}getOtherNode(t,e){return t.nodeA===e?t.nodeB:t.nodeA}getAllEdges(){return this._edges}get edgeCount(){return this._edges.length}getCachedPath(t,e){const i=this._edges[t];if(!i)return null;const r=e===i.nodeA?0:1,s=t*2+r;return this._pathCache[s]??null}setCachedPath(t,e,i){const r=this._edges[t];if(!r)return;const s=e===r.nodeA?0:1,a=t*2+s;this._pathCache[a]=i}_initPathCache(){this._pathCache=new Array(this._edges.length*2).fill(null)}setWaterComponents(t){this._waterComponents=t}getComponentId(t){return this._waterComponents?.getComponentId(t)??0}getClusterKey(t,e){return e*this.clustersX+t}getCluster(t,e){return this._clusters[this.getClusterKey(t,e)]}getClusterNodes(t,e){const i=this.getCluster(t,e);return i?i.nodeIds.map(r=>this._nodes[r]):[]}getNearbyClusterNodes(t,e){const i=[];for(let r=-1;r<=1;r++)for(let s=-1;s<=1;s++){const a=this.getCluster(t+s,e+r);if(a)for(const o of a.nodeIds)i.push(this._nodes[o])}return i}_addNode(t){this._nodes[t.id]=t,this._nodeEdgeIds[t.id]=[]}_addEdge(t){this._edges[t.id]=t,this._nodeEdgeIds[t.nodeA].push(t.id),this._nodeEdgeIds[t.nodeB].push(t.id)}_setCluster(t,e){this._clusters[t]=e}_addNodeToCluster(t,e){this._clusters[t]&&this._clusters[t].nodeIds.push(e)}}const Wr=class Wr{constructor(t,e=Wr.CLUSTER_SIZE){this.map=t,this.clusterSize=e,this.tileToNode=new Map,this.nextNodeId=0,this.nextEdgeId=0,this.edgeBetween=new Map,this.width=t.width(),this.height=t.height(),this.clustersX=Math.ceil(this.width/e),this.clustersY=Math.ceil(this.height/e),this.tileBFS=new Kh(this.width*this.height),this.waterComponents=new lw(t)}build(){G.start("AbstractGraphBuilder:build"),this.graph=new hw(this.clusterSize,this.clustersX,this.clustersY),this.waterComponents.initialize();for(let t=0;t<this.clustersY;t++)for(let e=0;e<this.clustersX;e++){const i=this.graph.getClusterKey(e,t);this.graph._setCluster(i,{x:e,y:t,nodeIds:[]})}G.start("nodes");for(let t=0;t<this.clustersY;t++)for(let e=0;e<this.clustersX;e++)this.processCluster(e,t);G.end(),G.start("edges");for(let t=0;t<this.clustersY;t++)for(let e=0;e<this.clustersX;e++){const i=this.graph.getCluster(e,t);!i||i.nodeIds.length===0||this.buildClusterConnections(e,t)}return G.end(),G.set("nodes",()=>this.graph.getAllNodes()),G.set("edges",()=>this.graph.getAllEdges()),G.set("nodesCount",()=>this.graph.nodeCount),G.set("edgesCount",()=>this.graph.edgeCount),G.set("clustersCount",()=>this.clustersX*this.clustersY),this.graph._initPathCache(),this.graph.setWaterComponents(this.waterComponents),G.end(),this.graph}getOrCreateNode(t,e){const i=this.map.ref(t,e),r=this.tileToNode.get(i);if(r)return r;const s={id:this.nextNodeId++,x:t,y:e,tile:i,componentId:this.waterComponents.getComponentId(i)};return this.graph._addNode(s),this.tileToNode.set(i,s),s}addNodeToCluster(t,e,i){const r=this.graph.getCluster(t,e);r&&(r.nodeIds.includes(i.id)||r.nodeIds.push(i.id))}processCluster(t,e){const i=t*this.clusterSize,r=e*this.clusterSize;if(t<this.clustersX-1){const s=Math.min(i+this.clusterSize-1,this.width-1),a=this.findNodesOnVerticalEdge(s,r);for(const o of a)this.addNodeToCluster(t,e,o),this.addNodeToCluster(t+1,e,o)}if(e<this.clustersY-1){const s=Math.min(r+this.clusterSize-1,this.height-1),a=this.findNodesOnHorizontalEdge(s,i);for(const o of a)this.addNodeToCluster(t,e,o),this.addNodeToCluster(t,e+1,o)}}findNodesOnVerticalEdge(t,e){const i=[],r=Math.min(e+this.clusterSize,this.height);let s=-1;const a=o=>{if(s===-1)return;const c=o-s,l=s+Math.floor(c/2);s=-1;const h=this.getOrCreateNode(t,l);i.push(h)};for(let o=e;o<r;o++){const c=this.map.ref(t,o),l=t+1<this.map.width()?this.map.ref(t+1,o):-1;this.map.isWater(c)&&l!==-1&&this.map.isWater(l)?s===-1&&(s=o):a(o)}return a(r),i}findNodesOnHorizontalEdge(t,e){const i=[],r=Math.min(e+this.clusterSize,this.width);let s=-1;const a=o=>{if(s===-1)return;const c=o-s,l=s+Math.floor(c/2);s=-1;const h=this.getOrCreateNode(l,t);i.push(h)};for(let o=e;o<r;o++){const c=this.map.ref(o,t),l=t+1<this.map.height()?this.map.ref(o,t+1):-1;this.map.isWater(c)&&l!==-1&&this.map.isWater(l)?s===-1&&(s=o):a(o)}return a(r),i}buildClusterConnections(t,e){const i=this.graph.getCluster(t,e);if(!i)return;const s=i.nodeIds.map(h=>this.graph.getNode(h)),a=t*this.clusterSize,o=e*this.clusterSize,c=Math.min(this.width-1,a+this.clusterSize-1),l=Math.min(this.height-1,o+this.clusterSize-1);for(let h=0;h<s.length;h++){const d=s[h],f=[];for(let p=h+1;p<s.length;p++)s[h].componentId===s[p].componentId&&f.push(s[p]);if(f.length===0)continue;const g=this.findAllReachableNodesInBounds(d.tile,f,a,c,o,l);for(const[p,b]of g.entries())this.addOrUpdateEdge(d.id,p,b,t,e)}}addOrUpdateEdge(t,e,i,r,s){const[a,o]=t<e?[t,e]:[e,t];let c=this.edgeBetween.get(a);c||(c=new Map,this.edgeBetween.set(a,c));const l=c.get(o);if(l){i<l.cost&&(l.cost=i,l.clusterX=r,l.clusterY=s);return}const h={id:this.nextEdgeId++,nodeA:a,nodeB:o,cost:i,clusterX:r,clusterY:s};c.set(o,h),this.graph._addEdge(h)}findAllReachableNodesInBounds(t,e,i,r,s,a){const o=this.map.x(t),c=this.map.y(t),l=new Map;let h=0;for(const p of e){l.set(p.tile,p.id);const b=Math.abs(p.x-o),S=Math.abs(p.y-c);h=Math.max(h,b+S)}const d=h*4,f=new Map;let g=0;return this.tileBFS.search(this.map.width(),this.map.height(),t,d,p=>this.map.isWater(p),(p,b)=>{const S=this.map.x(p),w=this.map.y(p);if(!(p===t||l.has(p))&&(S<i||S>r||w<s||w>a))return null;const A=l.get(p);if(A!==void 0&&(f.set(A,b),g++,g===e.length))return b}),f}};Wr.CLUSTER_SIZE=32;let Ea=Wr;class uw{constructor(t,e){this.stamp=1,this.graph=t,this.heuristicWeight=e?.heuristicWeight??1,this.maxIterations=e?.maxIterations??1e5;const i=t.nodeCount;if(this.closedStamp=new Uint32Array(i),this.gScoreStamp=new Uint32Array(i),this.gScore=new Float32Array(i),this.cameFrom=new Int32Array(i),this.startNode=new Int32Array(i),e?.useMinHeap)this.queue=new ha(i);else{const r=t.clusterSize*Math.max(t.clustersX,10)*2,s=this.heuristicWeight*r;this.queue=new Ch(s)}}findPath(t,e){return Array.isArray(t)?this.findPathMultiSource(t,e):this.findPathSingle(t,e)}findPathSingle(t,e){this.stamp++,this.stamp>4294967295&&(this.closedStamp.fill(0),this.gScoreStamp.fill(0),this.stamp=1);const i=this.stamp,r=this.graph,s=this.closedStamp,a=this.gScoreStamp,o=this.gScore,c=this.cameFrom,l=this.queue,h=this.heuristicWeight,d=r.getNode(e);if(!d)return null;const f=d.x,g=d.y,p=r.getNode(t);if(!p)return null;l.clear(),o[t]=0,a[t]=i,c[t]=-1;const b=h*(Math.abs(p.x-f)+Math.abs(p.y-g));l.push(t,b);let S=this.maxIterations;for(;!l.isEmpty();){if(--S<=0)return null;const w=l.pop();if(s[w]===i)continue;if(s[w]=i,w===e)return this.buildPathFromGoal(e);const v=o[w],A=r.getNodeEdges(w);for(let E=0;E<A.length;E++){const C=A[E],x=r.getOtherNode(C,w);if(s[x]===i)continue;const O=v+C.cost;if(a[x]!==i||O<o[x]){c[x]=w,o[x]=O,a[x]=i;const N=r.getNode(x);if(N){const I=h*(Math.abs(N.x-f)+Math.abs(N.y-g));l.push(x,O+I)}}}}return null}findPathMultiSource(t,e){if(t.length===0)return null;if(t.length===1)return this.findPathSingle(t[0],e);this.stamp++,this.stamp>4294967295&&(this.closedStamp.fill(0),this.gScoreStamp.fill(0),this.stamp=1);const i=this.stamp,r=this.graph,s=this.closedStamp,a=this.gScoreStamp,o=this.gScore,c=this.cameFrom,l=this.startNode,h=this.queue,d=this.heuristicWeight,f=r.getNode(e);if(!f)return null;const g=f.x,p=f.y;h.clear();for(const S of t){const w=r.getNode(S);if(!w)continue;o[S]=0,a[S]=i,c[S]=-1,l[S]=S;const v=d*(Math.abs(w.x-g)+Math.abs(w.y-p));h.push(S,v)}let b=this.maxIterations;for(;!h.isEmpty();){if(--b<=0)return null;const S=h.pop();if(s[S]===i)continue;if(s[S]=i,S===e)return this.buildPathFromGoal(e);const w=o[S],v=l[S],A=r.getNodeEdges(S);for(let E=0;E<A.length;E++){const C=A[E],x=r.getOtherNode(C,S);if(s[x]===i)continue;const O=w+C.cost;if(a[x]!==i||O<o[x]){c[x]=S,o[x]=O,a[x]=i,l[x]=v;const N=r.getNode(x);if(N){const I=d*(Math.abs(N.x-g)+Math.abs(N.y-p));h.push(x,O+I)}}}}return null}buildPathFromGoal(t){const e=[];let i=t;for(;i!==-1;)e.push(i),i=this.cameFrom[i];return e.reverse(),e}}class dw{constructor(t,e,i={}){this.map=t,this.graph=e,this.options=i,this.tileBFS=new Kh(t.width()*t.height());const r=e.clusterSize;this.abstractAStar=new uw(this.graph);const s=r*r;this.localAStar=new ai(t,s);const a=r*3,o=a*a;this.localAStarMultiCluster=new ai(t,o);const c=260,l=c*c;this.localAStarShortPath=new ai(t,l),this.sourceResolver=new fw(this.map,this.graph)}findPath(t,e){return G.wrap("AStar.WaterHierarchical:findPath",()=>(G.set("$to",()=>e),G.set("$from",()=>t),Array.isArray(t)?this.findPathMultiSource(t,e):this.findPathSingle(t,e)))}findPathMultiSource(t,e){const i=this.tryShortPathMultiSource(t,e);if(i)return i;const r=this.sourceResolver.resolveTarget(e);if(!r)return null;const s=this.sourceResolver.resolveSourcesToNodes(t);if(s.size===0)return null;const a=[...s.keys()],o=this.abstractAStar.findPath(a,r.id);if(!o)return null;const c=s.get(o[0]);return this.findPathSingle(c,e)}tryShortPathMultiSource(t,e){const s=t.filter(g=>this.map.manhattanDist(g,e)<=120);if(s.length===0)return null;const a=this.map.x(e),o=this.map.y(e);let c=a,l=a,h=o,d=o;for(const g of s){const p=this.map.x(g),b=this.map.y(g);c=Math.min(c,p),l=Math.max(l,p),h=Math.min(h,b),d=Math.max(d,b)}const f={minX:Math.max(0,c-10),maxX:Math.min(this.map.width()-1,l+10),minY:Math.max(0,h-10),maxY:Math.min(this.map.height()-1,d+10)};return this.localAStarShortPath.searchBounded(s,e,f)}findPathSingle(t,e){if(this.map.manhattanDist(t,e)<=this.graph.clusterSize){G.start("earlyExit");const x=this.map.x(t),O=this.map.y(t),N=Math.floor(x/this.graph.clusterSize),I=Math.floor(O/this.graph.clusterSize),q=this.findLocalPath(t,e,N,I,!0);if(G.end(),q)return q}G.start("nodeLookup");const r=this.findNearestNode(t),s=this.findNearestNode(e);if(G.end(),!r||!s)return null;if(r.id===s.id){G.start("sameNodeLocalPath");const x=Math.floor(r.x/this.graph.clusterSize),O=Math.floor(r.y/this.graph.clusterSize),N=this.findLocalPath(t,e,x,O,!0);return G.end(),N}G.start("abstractPath");const a=this.findAbstractPath(r.id,s.id);if(G.end(),!a)return null;G.set("nodePath",()=>a.map(x=>{const O=this.graph.getNode(x);return O?O.tile:-1}).filter(x=>x!==-1));const o=[];G.start("initialPath");const l=this.graph.getNode(a[0]).tile,h=this.map.x(t),d=this.map.y(t),f=Math.floor(h/this.graph.clusterSize),g=Math.floor(d/this.graph.clusterSize),p=this.findLocalPath(t,l,f,g);if(!p)return null;o.push(...p);for(let x=0;x<a.length-1;x++){const O=a[x],N=a[x+1],I=this.graph.getEdgeBetween(O,N);if(!I)return null;const q=this.graph.getNode(O),U=this.graph.getNode(N),K=q.tile,D=U.tile;if(this.options.cachePaths){const ct=this.graph.getCachedPath(I.id,O);if(ct&&ct.length>0){o.push(...ct.slice(1)),G.set("$cachedSegmentsUsed",et=>(et??0)+1);continue}}const X=this.findLocalPath(K,D,I.clusterX,I.clusterY);if(!X)return null;o.push(...X.slice(1)),this.options.cachePaths&&this.graph.setCachedPath(I.id,O,X)}const S=this.graph.getNode(a[a.length-1]).tile,w=this.map.x(e),v=this.map.y(e),A=Math.floor(w/this.graph.clusterSize),E=Math.floor(v/this.graph.clusterSize),C=this.findLocalPath(S,e,A,E);return C?(o.push(...C.slice(1)),G.set("initialPath",()=>o),o):null}findNearestNode(t){const e=this.map.x(t),i=this.map.y(t),r=Math.floor(e/this.graph.clusterSize),s=Math.floor(i/this.graph.clusterSize),a=this.graph.clusterSize,o=r*a,c=s*a,l=Math.min(this.map.width()-1,o+a-1),h=Math.min(this.map.height()-1,c+a-1),d=this.graph.getCluster(r,s);if(!d||d.nodeIds.length===0)return null;const f=d.nodeIds.map(p=>this.graph.getNode(p)),g=a*a;return this.tileBFS.search(this.map.width(),this.map.height(),t,g,p=>this.graph.getComponentId(p)!==Aa,(p,b)=>{const S=this.map.x(p),w=this.map.y(p);for(const v of f)if(v.x===S&&v.y===w)return v;if(S<o||S>l||w<c||w>h)return null})}findAbstractPath(t,e){return this.abstractAStar.findPath(t,e)}findLocalPath(t,e,i,r,s=!1){const a=this.graph.clusterSize;let o,c,l,h;s?(o=Math.max(0,(i-1)*a),c=Math.max(0,(r-1)*a),l=Math.min(this.map.width()-1,(i+2)*a-1),h=Math.min(this.map.height()-1,(r+2)*a-1)):(o=i*a,c=r*a,l=Math.min(this.map.width()-1,o+a-1),h=Math.min(this.map.height()-1,c+a-1));const f=(s?this.localAStarMultiCluster:this.localAStar).searchBounded(t,e,{minX:o,maxX:l,minY:c,maxY:h});return!f||f.length===0?null:(f[0]!==t&&f.unshift(t),f[f.length-1]!==e&&f.push(e),f)}}class fw{constructor(t,e){this.map=t,this.graph=e}resolveTarget(t){return this.getClusterNode(t)}resolveSourcesToNodes(t){const e=new Map,i=new Map;for(const r of t){const s=this.getClusterNode(r);if(s===null)continue;const a=this.map.x(r),o=this.map.y(r),c=Math.abs(s.x-a)+Math.abs(s.y-o),l=i.get(s.id);(l===void 0||c<l)&&(e.set(s.id,r),i.set(s.id,c))}return e}getClusterNode(t){const e=this.map.x(t),i=this.map.y(t),r=Math.floor(e/this.graph.clusterSize),s=Math.floor(i/this.graph.clusterSize),a=this.graph.getCluster(r,s);if(!a||a.nodeIds.length===0)return null;let o=null,c=1/0;for(const l of a.nodeIds){const h=this.graph.getNode(l);if(!h)continue;const d=Math.abs(h.x-e)+Math.abs(h.y-i);d<c&&(c=d,o=h)}return o}}const mw=Ut(["abomb","hbomb","mirv","mirvw"]),gw={[m.AtomBomb]:"abomb",[m.HydrogenBomb]:"hbomb",[m.MIRV]:"mirv",[m.MIRVWarhead]:"mirvw"},pw=Ut(["trade","trans"]),yw=Ut(["city","defp","port","wshp","silo","saml","fact"]),bw={[m.City]:"city",[m.DefensePost]:"defp",[m.MissileSilo]:"silo",[m.Port]:"port",[m.SAMLauncher]:"saml",[m.Warship]:"wshp",[m.Factory]:"fact"},ka=0,Jh=1,ww=2,_w=0,Sw=1,Tw=2,Qh=0,tu=1,vw=2,eu=3,Aw=0,Ew=1,kw=2,Mw=0,Iw=1,nu=2,xw=3,Cw=4,Pw=5,Dw=0,Nw=1,Rw=2,Ow=3,Bw=4,Ma=l0(n=>typeof n=="string"&&/^-?\d+$/.test(n)?BigInt(n):n,Bp()),vn=Ma.array().min(1),iu=B({attacks:vn.optional(),betrayals:Ma.optional(),killedAt:Ma.optional(),conquests:vn.optional(),boats:gs(pw,vn).optional(),bombs:gs(mw,vn).optional(),gold:vn.optional(),units:gs(yw,vn).optional()}).optional();class Lw{constructor(t,e,i,r,s){this.mg=t,this.requestor_=e,this.recipient_=i,this.createdAt_=r,this.id_=s,this.extensionRequestedRequestor_=!1,this.extensionRequestedRecipient_=!1,this.expiresAt_=r+t.config().allianceDuration()}other(t){return this.requestor_===t?this.recipient_:this.requestor_}requestor(){return this.requestor_}recipient(){return this.recipient_}createdAt(){return this.createdAt_}expire(){this.mg.expireAlliance(this)}addExtensionRequest(t){this.requestor_===t?this.extensionRequestedRequestor_=!0:this.recipient_===t&&(this.extensionRequestedRecipient_=!0)}bothAgreedToExtend(){return this.extensionRequestedRequestor_&&this.extensionRequestedRecipient_}onlyOneAgreedToExtend(){return this.extensionRequestedRequestor_!==this.extensionRequestedRecipient_}id(){return this.id_}extend(){this.extensionRequestedRequestor_=!1,this.extensionRequestedRecipient_=!1,this.expiresAt_=this.mg.ticks()+this.mg.config().allianceDuration()}expiresAt(){return this.expiresAt_}}class zw{constructor(t,e,i,r){this.requestor_=t,this.recipient_=e,this.tickCreated=i,this.game=r,this.status_="pending"}status(){return this.status_}requestor(){return this.requestor_}recipient(){return this.recipient_}createdAt(){return this.tickCreated}accept(){this.status_="accepted",this.game.acceptAllianceRequest(this)}reject(){this.status_="rejected",this.game.rejectAllianceRequest(this)}toUpdate(){return{type:rt.AllianceRequest,requestorID:this.requestor_.smallID(),recipientID:this.recipient_.smallID(),createdAt:this.tickCreated}}}class Uw{constructor(t,e,i,r,s,a,o){this._id=t,this._target=e,this._attacker=i,this._troops=r,this._sourceTile=s,this._border=a,this._mg=o,this._isActive=!0,this._borderSize=0,this._retreating=!1,this._retreated=!1}sourceTile(){return this._sourceTile}target(){return this._target}attacker(){return this._attacker}troops(){return this._troops}setTroops(t){this._troops=t}isActive(){return this._isActive}id(){return this._id}delete(){this._target.isPlayer()&&(this._target._incomingAttacks=this._target._incomingAttacks.filter(t=>t!==this)),this._attacker._outgoingAttacks=this._attacker._outgoingAttacks.filter(t=>t!==this),this._isActive=!1}orderRetreat(){this._retreating=!0}executeRetreat(){this._retreated=!0}retreating(){return this._retreating}retreated(){return this._retreated}borderSize(){return this._borderSize}clearBorder(){this._borderSize=0,this._border.clear()}addBorderTile(t){this._border.has(t)||(this._borderSize+=1,this._border.add(t))}removeBorderTile(t){this._border.has(t)&&(this._borderSize-=1,this._border.delete(t))}averagePosition(){if(this._borderSize===0){if(this.sourceTile()===null)return null;const i=this.sourceTile();return new Dt(this._mg.map().x(i),this._mg.map().y(i))}let t=0,e=0;for(const i of this._border)t+=this._mg.map().x(i),e+=this._mg.map().y(i);return t=t/this._borderSize,e=e/this._borderSize,new Dt(t,e)}}class Ww{constructor(t,e,i,r,s,a={}){switch(this._type=t,this.mg=e,this._tile=i,this._id=r,this._owner=s,this._active=!0,this._retreating=!1,this._targetedBySAM=!1,this._reachedTarget=!1,this._wasDestroyedByEnemy=!1,this._destroyer=void 0,this._underConstruction=!1,this._lastOwner=null,this._missileTimerQueue=[],this._hasTrainStation=!1,this._level=1,this._targetable=!0,this._trajectoryIndex=0,this._deletionAt=null,this._lastTile=i,this._health=De(this.mg.unitInfo(t).maxHealth??1),this._targetTile="targetTile"in a?a.targetTile??void 0:void 0,this._trajectory="trajectory"in a?a.trajectory??[]:[],this._troops="troops"in a?a.troops??0:0,this._lastSetSafeFromPirates="lastSetSafeFromPirates"in a?a.lastSetSafeFromPirates??0:0,this._patrolTile="patrolTile"in a?a.patrolTile??void 0:void 0,this._targetUnit="targetUnit"in a?a.targetUnit??void 0:void 0,this._loaded="loaded"in a?a.loaded??void 0:void 0,this._trainType="trainType"in a?a.trainType:void 0,this._type){case m.Warship:case m.Port:case m.MissileSilo:case m.DefensePost:case m.SAMLauncher:case m.City:case m.Factory:this.mg.stats().unitBuild(s,this._type)}}setTargetable(t){this._targetable!==t&&(this._targetable=t,this.mg.addUpdate(this.toUpdate()))}isTargetable(){return this._targetable}setPatrolTile(t){this._patrolTile=t}patrolTile(){return this._patrolTile}isUnit(){return!0}touch(){this.mg.addUpdate(this.toUpdate())}setTileTarget(t){this._targetTile=t}tileTarget(){return this._targetTile}id(){return this._id}toUpdate(){return{type:rt.Unit,unitType:this._type,id:this._id,troops:this._troops,ownerID:this._owner.smallID(),lastOwnerID:this._lastOwner?.smallID(),isActive:this._active,reachedTarget:this._reachedTarget,retreating:this._retreating,pos:this._tile,markedForDeletion:this._deletionAt??!1,targetable:this._targetable,lastPos:this._lastTile,health:this.hasHealth()?Number(this._health):void 0,underConstruction:this._underConstruction,targetUnitId:this._targetUnit?.id()??void 0,targetTile:this.targetTile()??void 0,missileTimerQueue:this._missileTimerQueue,level:this.level(),hasTrainStation:this._hasTrainStation,trainType:this._trainType,loaded:this._loaded}}type(){return this._type}lastTile(){return this._lastTile}move(t){if(t===null)throw new Error("tile cannot be null");this._lastTile=this._tile,this._tile=t,this.mg.updateUnitTile(this),this.mg.addUpdate(this.toUpdate())}setTroops(t){this._troops=t}troops(){return this._troops}health(){return Number(this._health)}hasHealth(){return this.info().maxHealth!==void 0}tile(){return this._tile}owner(){return this._owner}info(){return this.mg.unitInfo(this._type)}setOwner(t){switch(this.clearPendingDeletion(),this._type){case m.Warship:case m.Port:case m.MissileSilo:case m.DefensePost:case m.SAMLauncher:case m.City:case m.Factory:this.mg.stats().unitCapture(t,this._type),this.mg.stats().unitLose(this._owner,this._type);break}this._lastOwner=this._owner,this._lastOwner._units=this._lastOwner._units.filter(e=>e!==this),this._owner=t,this._owner._units.push(this),this.mg.addUpdate(this.toUpdate()),this.mg.displayMessage("events_display.unit_captured_by_enemy",at.UNIT_CAPTURED_BY_ENEMY,this._lastOwner.id(),void 0,{unit:this.type(),name:t.displayName()}),this.mg.displayMessage("events_display.captured_enemy_unit",at.CAPTURED_ENEMY_UNIT,t.id(),void 0,{unit:this.type(),name:this._lastOwner.displayName()})}modifyHealth(t,e){this._health=Jd(this._health+De(t),0n,De(this.info().maxHealth??1)),this._health===0n&&this.delete(!0,e)}clearPendingDeletion(){this._deletionAt=null}isMarkedForDeletion(){return this._deletionAt!==null}markForDeletion(){this.isActive()&&(this._deletionAt=this.mg.ticks()+this.mg.config().deletionMarkDuration(),this.mg.addUpdate(this.toUpdate()))}isOverdueDeletion(){return this.isActive()?this._deletionAt!==null&&this.mg.ticks()-this._deletionAt>0:!1}delete(t,e){if(!this.isActive())throw new Error(`cannot delete ${this} not active`);if(this._wasDestroyedByEnemy=e!==void 0,this._destroyer=e??void 0,this._owner._units=this._owner._units.filter(i=>i!==this),this._active=!1,this.mg.addUpdate(this.toUpdate()),this.mg.removeUnit(this),t!==!1&&this.displayMessageOnDeleted(),e!==void 0)switch(this._type){case m.TransportShip:this.mg.stats().boatDestroyTroops(e,this._owner,this._troops);break;case m.TradeShip:this.mg.stats().boatDestroyTrade(e,this._owner);break;case m.City:case m.DefensePost:case m.MissileSilo:case m.Port:case m.SAMLauncher:case m.Warship:case m.Factory:this.mg.stats().unitDestroy(e,this._type),this.mg.stats().unitLose(this.owner(),this._type);break}}displayMessageOnDeleted(){this._type!==m.MIRVWarhead&&(this._type===m.Train&&this._trainType!==zn.Engine||this.mg.displayMessage("events_display.unit_destroyed",at.UNIT_DESTROYED,this.owner().id(),void 0,{unit:this._type}))}isActive(){return this._active}wasDestroyedByEnemy(){return this._wasDestroyedByEnemy}destroyer(){return this._destroyer}retreating(){return this._retreating}orderBoatRetreat(){if(this.type()!==m.TransportShip)throw new Error(`Cannot retreat ${this.type()}`);this._retreating=!0}isUnderConstruction(){return this._underConstruction}setUnderConstruction(t){this._underConstruction!==t&&(this._underConstruction=t,this.mg.addUpdate(this.toUpdate()))}hash(){return this.tile()+It(this.type())*this._id}toString(){return`Unit:${this._type},owner:${this.owner().name()}`}launch(){this._missileTimerQueue.push(this.mg.ticks()),this.mg.addUpdate(this.toUpdate())}ticksLeftInCooldown(){return this._missileTimerQueue[0]}isInCooldown(){return this._missileTimerQueue.length===this._level}missileTimerQueue(){return this._missileTimerQueue}reloadMissile(){this._missileTimerQueue.shift(),this.mg.addUpdate(this.toUpdate())}setTargetTile(t){this._targetTile=t}targetTile(){return this._targetTile}setTrajectoryIndex(t){const e=this._trajectory.length-1;this._trajectoryIndex=t<0?0:t>e?e:t}trajectoryIndex(){return this._trajectoryIndex}trajectory(){return this._trajectory}setTargetUnit(t){this._targetUnit=t}targetUnit(){return this._targetUnit}setTargetedBySAM(t){this._targetedBySAM=t}targetedBySAM(){return this._targetedBySAM}setReachedTarget(){this._reachedTarget=!0}reachedTarget(){return this._reachedTarget}setSafeFromPirates(){this._lastSetSafeFromPirates=this.mg.ticks()}isSafeFromPirates(){return this.mg.ticks()-this._lastSetSafeFromPirates<this.mg.config().safeFromPiratesCooldownMax()}level(){return this._level}setTrainStation(t){this._hasTrainStation=t,this.mg.addUpdate(this.toUpdate())}hasTrainStation(){return this._hasTrainStation}increaseLevel(){this._level++,[m.MissileSilo,m.SAMLauncher].includes(this.type())&&this._missileTimerQueue.push(this.mg.ticks()),this.mg.addUpdate(this.toUpdate())}decreaseLevel(t){if(this._level--,[m.MissileSilo,m.SAMLauncher].includes(this.type())&&this._missileTimerQueue.pop(),this._level<=0){this.delete(!0,t);return}this.mg.addUpdate(this.toUpdate())}trainType(){return this._trainType}isLoaded(){return this._loaded}setLoaded(t){this._loaded!==t&&(this._loaded=t,this.mg.addUpdate(this.toUpdate()))}}class ru{constructor(t,e){this.recipient=t,this.tick=e}}class $w{constructor(t,e,i,r,s){this.mg=t,this._smallID=e,this.playerInfo=i,this._team=s,this._lastTileChange=0,this.markedTraitorTick=-1,this._betrayalCount=0,this.embargoes=new Map,this._borderTiles=new Set,this._units=[],this._tiles=new Set,this.pastOutgoingAllianceRequests=[],this._expiredAlliances=[],this.targets_=[],this.outgoingEmojis_=[],this.sentDonations=[],this.relations=new Map,this.lastDeleteUnitTick=-1,this.lastEmbargoAllTick=-1,this._incomingAttacks=[],this._outgoingAttacks=[],this._outgoingLandAttacks=[],this._isDisconnected=!1,this.numUnitsConstructed={},this._name=i.name,this._troops=De(r),this._gold=t.config().startingGold(i),this._displayName=this._name,this._pseudo_random=new gt(It(this.playerInfo.id))}toUpdate(){const t=this.outgoingAllianceRequests().map(e=>e.recipient().id());return{type:rt.Player,clientID:this.clientID(),name:this.name(),displayName:this.displayName(),id:this.id(),team:this.team()??void 0,smallID:this.smallID(),playerType:this.type(),isAlive:this.isAlive(),isDisconnected:this.isDisconnected(),tilesOwned:this.numTilesOwned(),gold:this._gold,troops:this.troops(),allies:this.alliances().map(e=>e.other(this).smallID()),embargoes:new Set([...this.embargoes.keys()].map(e=>e.toString())),isTraitor:this.isTraitor(),traitorRemainingTicks:this.getTraitorRemainingTicks(),targets:this.targets().map(e=>e.smallID()),outgoingEmojis:this.outgoingEmojis(),outgoingAttacks:this._outgoingAttacks.map(e=>({attackerID:e.attacker().smallID(),targetID:e.target().smallID(),troops:e.troops(),id:e.id(),retreating:e.retreating()})),incomingAttacks:this._incomingAttacks.map(e=>({attackerID:e.attacker().smallID(),targetID:e.target().smallID(),troops:e.troops(),id:e.id(),retreating:e.retreating()})),outgoingAllianceRequests:t,alliances:this.alliances().map(e=>({id:e.id(),other:e.other(this).id(),createdAt:e.createdAt(),expiresAt:e.expiresAt(),hasExtensionRequest:e.expiresAt()<=this.mg.ticks()+this.mg.config().allianceExtensionPromptOffset()})),hasSpawned:this.hasSpawned(),betrayals:this._betrayalCount,lastDeleteUnitTick:this.lastDeleteUnitTick,isLobbyCreator:this.isLobbyCreator()}}smallID(){return this._smallID}name(){return this._name}displayName(){return this._displayName}clientID(){return this.playerInfo.clientID}id(){return this.playerInfo.id}type(){return this.playerInfo.playerType}clan(){return this.playerInfo.clan}units(...t){if(t.length===0)return this._units;const e=new Set(t);return this._units.filter(i=>e.has(i.type()))}recordUnitConstructed(t){this.numUnitsConstructed[t]!==void 0?this.numUnitsConstructed[t]++:this.numUnitsConstructed[t]=1}unitsConstructed(t){const e=this.numUnitsConstructed[t]??0;let i=0;for(const s of this._units)s.type()===t&&s.isUnderConstruction()&&i++;return i+e}unitCount(t){let e=0;for(const i of this._units)i.type()===t&&(e+=i.level());return e}unitsOwned(t){let e=0;for(const i of this._units)i.type()===t&&(i.isUnderConstruction()?e++:e+=i.level());return e}sharesBorderWith(t){for(const e of this._borderTiles)for(const i of this.mg.map().neighbors(e))if(this.mg.map().ownerID(i)===t.smallID())return!0;return!1}numTilesOwned(){return this._tiles.size}tiles(){return new Set(this._tiles.values())}borderTiles(){return this._borderTiles}neighbors(){const t=new Set;for(const e of this.borderTiles())for(const i of this.mg.map().neighbors(e))if(this.mg.map().isLand(i)){const r=this.mg.map().ownerID(i);r!==this.smallID()&&t.add(this.mg.playerBySmallID(r))}return Array.from(t)}isPlayer(){return!0}setTroops(t){this._troops=De(t)}conquer(t){this.mg.conquer(this,t)}orderRetreat(t){const e=this._outgoingAttacks.filter(i=>i.id()===t);if(!e||!e[0]){console.warn(`Didn't find outgoing attack with id ${t}`);return}e[0].orderRetreat()}executeRetreat(t){const e=this._outgoingAttacks.filter(i=>i.id()===t);!e||!e[0]||e[0].executeRetreat()}relinquish(t){if(this.mg.owner(t)!==this)throw new Error("Cannot relinquish tile not owned by this player");this.mg.relinquish(t)}info(){return this.playerInfo}isLobbyCreator(){return this.playerInfo.isLobbyCreator}isAlive(){return this._tiles.size>0}hasSpawned(){return this._spawnTile!==void 0}setSpawnTile(t){this._spawnTile=t}spawnTile(){return this._spawnTile}incomingAllianceRequests(){return this.mg.allianceRequests.filter(t=>t.recipient()===this)}outgoingAllianceRequests(){return this.mg.allianceRequests.filter(t=>t.requestor()===this)}alliances(){return this.mg.alliances_.filter(t=>t.requestor()===this||t.recipient()===this)}expiredAlliances(){return[...this._expiredAlliances]}allies(){return this.alliances().map(t=>t.other(this))}isAlliedWith(t){return t===this?!1:this.allianceWith(t)!==null}allianceWith(t){return t===this?null:this.alliances().find(e=>e.recipient()===t||e.requestor()===t)??null}canSendAllianceRequest(t){if(t===this||this.isDisconnected()||t.isDisconnected()||this.isFriendly(t)||!this.isAlive()||this.outgoingAllianceRequests().some(a=>a.recipient()===t))return!1;if(this.incomingAllianceRequests().some(a=>a.requestor()===t))return!0;const r=this.pastOutgoingAllianceRequests.filter(a=>a.recipient()===t).sort((a,o)=>o.createdAt()-a.createdAt());return r.length===0?!0:this.mg.ticks()-r[0].createdAt()>=this.mg.config().allianceRequestCooldown()}breakAlliance(t){this.mg.breakAlliance(this,t)}isTraitor(){return this.getTraitorRemainingTicks()>0}getTraitorRemainingTicks(){if(this.markedTraitorTick<0)return 0;const t=this.mg.ticks()-this.markedTraitorTick,i=this.mg.config().traitorDuration()-t;return i>0?i:0}markTraitor(){this.markedTraitorTick=this.mg.ticks(),this._betrayalCount++,this.mg.stats().betray(this)}betrayals(){return this._betrayalCount}createAllianceRequest(t){if(this.isAlliedWith(t))throw new Error("cannot create alliance request, already allies");return this.mg.createAllianceRequest(this,t)}relation(t){if(t===this)throw new Error(`cannot get relation with self: ${this}`);const e=this.relations.get(t)??0;return this.relationFromValue(e)}relationFromValue(t){return t<-50?Pt.Hostile:t<0?Pt.Distrustful:t<50?Pt.Neutral:Pt.Friendly}allRelationsSorted(){return Array.from(this.relations,([t,e])=>({player:t,relation:e})).filter(t=>t.player.isAlive()).sort((t,e)=>t.relation-e.relation).map(t=>({player:t.player,relation:this.relationFromValue(t.relation)}))}updateRelation(t,e){if(t===this)throw new Error(`cannot update relation with self: ${this}`);const i=this.relations.get(t)??0,r=Pe(i+e,-100,100);this.relations.set(t,r)}decayRelations(){this.relations.forEach((t,e)=>{const i=-1*Math.sign(t),r=.05;t+=i*r,Math.abs(t)<r*2&&(t=0),this.relations.set(e,t)})}canTarget(t){if(this===t||this.isFriendly(t))return!1;for(const e of this.targets_)if(this.mg.ticks()-e.tick<this.mg.config().targetCooldown())return!1;return!0}target(t){this.targets_.push({tick:this.mg.ticks(),target:t}),this.mg.target(this,t)}targets(){return this.targets_.filter(t=>this.mg.ticks()-t.tick<this.mg.config().targetDuration()).map(t=>t.target)}transitiveTargets(){const t=this.alliances().map(e=>e.other(this)).flatMap(e=>e.targets());return t.push(...this.targets()),[...new Set(t)]}sendEmoji(t,e){if(t===this)throw Error(`Cannot send emoji to oneself: ${this}`);const i={message:e,senderID:this.smallID(),recipientID:t===xt?t:t.smallID(),createdAt:this.mg.ticks()};this.outgoingEmojis_.push(i),this.mg.sendEmojiUpdate(i)}outgoingEmojis(){return this.outgoingEmojis_.filter(t=>this.mg.ticks()-t.createdAt<this.mg.config().emojiMessageDuration()).sort((t,e)=>e.createdAt-t.createdAt)}canSendEmoji(t){if(t===this)return!1;const e=t===xt?xt:t.smallID(),i=this.outgoingEmojis_.filter(r=>r.recipientID===e);for(const r of i)if(this.mg.ticks()-r.createdAt<this.mg.config().emojiMessageCooldown())return!1;return!0}canDonateGold(t){if(!this.isAlive()||!t.isAlive()||!this.isFriendly(t)||t.type()===P.Human&&this.mg.config().donateGold()===!1)return!1;for(const e of this.sentDonations)if(e.recipient===t&&this.mg.ticks()-e.tick<this.mg.config().donateCooldown())return!1;return!0}canDonateTroops(t){if(!this.isAlive()||!t.isAlive()||!this.isFriendly(t)||t.type()===P.Human&&this.mg.config().donateTroops()===!1)return!1;for(const e of this.sentDonations)if(e.recipient===t&&this.mg.ticks()-e.tick<this.mg.config().donateCooldown())return!1;return!0}donateTroops(t,e){if(e<=0)return!1;const i=this.removeTroops(e);return i===0?!1:(t.addTroops(i),this.sentDonations.push(new ru(t,this.mg.ticks())),this.mg.displayMessage("events_display.sent_troops_to_player",at.SENT_TROOPS_TO_PLAYER,this.id(),void 0,{troops:si(e),name:t.name()}),this.mg.displayMessage("events_display.received_troops_from_player",at.RECEIVED_TROOPS_FROM_PLAYER,t.id(),void 0,{troops:si(e),name:this.name()}),!0)}donateGold(t,e){if(e<=0n)return!1;const i=this.removeGold(e);return i===0n?!1:(t.addGold(i),this.sentDonations.push(new ru(t,this.mg.ticks())),this.mg.displayMessage("events_display.sent_gold_to_player",at.SENT_GOLD_TO_PLAYER,this.id(),void 0,{gold:Qe(e),name:t.name()}),this.mg.displayMessage("events_display.received_gold_from_player",at.RECEIVED_GOLD_FROM_PLAYER,t.id(),e,{gold:Qe(e),name:this.name()}),!0)}canDeleteUnit(){return this.mg.ticks()-this.lastDeleteUnitTick>=this.mg.config().deleteUnitCooldown()}recordDeleteUnit(){this.lastDeleteUnitTick=this.mg.ticks()}canEmbargoAll(){if(this.mg.ticks()-this.lastEmbargoAllTick<this.mg.config().embargoAllCooldown())return!1;for(const t of this.mg.players())if(t.id()!==this.id()&&t.type()!==P.Bot&&!this.isOnSameTeam(t))return!0;return!1}recordEmbargoAll(){this.lastEmbargoAllTick=this.mg.ticks()}hasEmbargoAgainst(t){return this.embargoes.has(t.id())}canTrade(t){return!(t.hasEmbargoAgainst(this)||this.hasEmbargoAgainst(t))&&t.id()!==this.id()}getEmbargoes(){return[...this.embargoes.values()]}addEmbargo(t,e){const i=this.embargoes.get(t.id());i!==void 0&&!i.isTemporary||(this.mg.addUpdate({type:rt.EmbargoEvent,event:"start",playerID:this.smallID(),embargoedID:t.smallID()}),this.embargoes.set(t.id(),{createdAt:this.mg.ticks(),isTemporary:e,target:t}))}stopEmbargo(t){this.embargoes.delete(t.id()),this.mg.addUpdate({type:rt.EmbargoEvent,event:"stop",playerID:this.smallID(),embargoedID:t.smallID()})}endTemporaryEmbargo(t){const e=this.embargoes.get(t.id());e!==void 0&&!e.isTemporary||this.stopEmbargo(t)}tradingPartners(){return this.mg.players().filter(t=>t!==this&&this.canTrade(t))}team(){return this._team}isOnSameTeam(t){return t===this||this.team()===null||t.team()===null||this.team()===ft.Bot||t.team()===ft.Bot?!1:this._team===t.team()}isFriendly(t,e=!1){return t.isDisconnected()&&!e?!1:this.isOnSameTeam(t)||this.isAlliedWith(t)}gold(){return this._gold}addGold(t,e){this._gold+=t,e&&this.mg.addUpdate({type:rt.BonusEvent,player:this.id(),tile:e,gold:Number(t),troops:0})}removeGold(t){if(t<=0n)return 0n;const e=ts(this._gold,t);return this._gold-=e,e}troops(){return Number(this._troops)}addTroops(t){if(t<0){this.removeTroops(-1*t);return}this._troops+=De(t)}removeTroops(t){if(t<=0)return 0;const e=ts(this._troops,De(t));return this._troops-=e,Number(e)}captureUnit(t){if(t.owner()===this)throw new Error(`Cannot capture unit, ${this} already owns ${t}`);t.setOwner(this)}buildUnit(t,e,i){if(this.mg.config().isUnitDisabled(t))throw new Error(`Attempted to build disabled unit ${t} at tile ${e} by player ${this.name()}`);const r=this.mg.unitInfo(t).cost(this.mg,this),s=new Ww(t,this.mg,e,this.mg.nextUnitID(),this,i);return this._units.push(s),this.recordUnitConstructed(t),this.removeGold(r),this.removeTroops("troops"in i?i.troops??0:0),this.mg.addUpdate(s.toUpdate()),this.mg.addUnit(s),s}findUnitToUpgrade(t,e){const i=this.mg.config().structureMinDist(),r=this.mg.nearbyUnits(e,i,t,void 0,!0).sort((a,o)=>a.distSquared-o.distSquared);if(r.length===0)return!1;const s=r[0].unit;return this.canUpgradeUnit(s)?s:!1}canUpgradeUnit(t){return!(t.isMarkedForDeletion()||t.isUnderConstruction()||!this.mg.config().unitInfo(t.type()).upgradable||this.mg.config().isUnitDisabled(t.type())||this._gold<this.mg.config().unitInfo(t.type()).cost(this.mg,this)||t.owner()!==this)}upgradeUnit(t){const e=this.mg.unitInfo(t.type()).cost(this.mg,this);this.removeGold(e),t.increaseLevel(),this.recordUnitConstructed(t.type())}buildableUnits(t){const e=t!==null?this.validStructureSpawnTiles(t):[];return Object.values(m).map(i=>{let r=!1,s=!1;if(!this.mg.inSpawnPhase()){const a=t!==null&&this.findUnitToUpgrade(i,t);a!==!1&&(r=a.id()),t!==null&&(s=this.canBuild(i,t,e))}return{type:i,canBuild:s,canUpgrade:r,cost:this.mg.config().unitInfo(i).cost(this.mg,this),overlappingRailroads:s!==!1?this.mg.railNetwork().overlappingRailroads(s):[]}})}canBuild(t,e,i=null){if(this.mg.config().isUnitDisabled(t))return!1;const r=this.mg.unitInfo(t).cost(this.mg,this);if(t!==m.MIRVWarhead&&(!this.isAlive()||this.gold()<r))return!1;switch(t){case m.MIRV:return this.mg.hasOwner(e)?this.nukeSpawn(e,t):!1;case m.AtomBomb:case m.HydrogenBomb:return this.nukeSpawn(e,t);case m.MIRVWarhead:return e;case m.Port:return this.portSpawn(e,i);case m.Warship:return this.warshipSpawn(e);case m.Shell:case m.SAMMissile:return e;case m.TransportShip:return Pr(this.mg,this,e);case m.TradeShip:return this.tradeShipSpawn(e);case m.Train:return this.landBasedUnitSpawn(e);case m.MissileSilo:case m.DefensePost:case m.SAMLauncher:case m.City:case m.Factory:return this.landBasedStructureSpawn(e,i);default:dt(t)}}nukeSpawn(t,e){if(this.mg.isSpawnImmunityActive())return!1;const i=this.mg.owner(t);if(i.isPlayer()&&this.isOnSameTeam(i))return!1;if(this.mg.config().gameConfig().gameMode===Ct.Team&&e!==m.MIRV){const s=this.mg.config().nukeMagnitudes(e);if(this.mg.anyUnitNearby(t,s.outer,is,o=>o.owner().isPlayer()&&this.isOnSameTeam(o.owner())))return!1}const r=this.units(m.MissileSilo).filter(s=>!s.isInCooldown()&&!s.isUnderConstruction()).sort(oo(this.mg,t));return r.length===0?!1:r[0].tile()}portSpawn(t,e){const i=Array.from(this.mg.bfs(t,Wh(t,this.mg.config().radiusPortSpawn()))).filter(s=>this.mg.owner(s)===this&&this.mg.isOceanShore(s)).sort((s,a)=>this.mg.manhattanDist(s,t)-this.mg.manhattanDist(a,t)),r=new Set(e??this.validStructureSpawnTiles(t));for(const s of i)if(r.has(s))return s;return!1}warshipSpawn(t){if(!this.mg.isOcean(t))return!1;const e=this.units(m.Port).sort((i,r)=>this.mg.manhattanDist(i.tile(),t)-this.mg.manhattanDist(r.tile(),t));return e.length===0?!1:e[0].tile()}landBasedUnitSpawn(t){return this.mg.isLand(t)?t:!1}landBasedStructureSpawn(t,e=null){const i=e??this.validStructureSpawnTiles(t);return i.length===0?!1:i[0]}validStructureSpawnTiles(t){if(this.mg.owner(t)!==this)return[];const e=15,i=e**2,r=Object.values(m).filter(h=>this.mg.config().unitInfo(h).territoryBound),s=this.mg.nearbyUnits(t,e*2,r,void 0,!0),a=this.mg.bfs(t,(h,d)=>this.mg.euclideanDistSquared(t,d)<i&&h.ownerID(d)===this.smallID()),o=new Set(a),c=this.mg.config().structureMinDist()**2;for(const h of a)for(const{unit:d}of s)if(this.mg.euclideanDistSquared(d.tile(),h)<c){o.delete(h);break}const l=Array.from(o);return l.sort((h,d)=>this.mg.euclideanDistSquared(h,t)-this.mg.euclideanDistSquared(d,t)),l}tradeShipSpawn(t){const e=this.units(m.Port).filter(i=>i.tile()===t);return e.length===0?!1:e[0].tile()}lastTileChange(){return this._lastTileChange}isDisconnected(){return this._isDisconnected}markDisconnected(t){this._isDisconnected=t}hash(){return It(this.id())*(this.troops()+this.numTilesOwned())+this._units.reduce((t,e)=>t+e.hash(),0)}toString(){return`Player:{name:${this.info().name},clientID:${this.info().clientID},isAlive:${this.isAlive()},troops:${this._troops},numTileOwned:${this.numTilesOwned()}}]`}playerProfile(){return{relations:Object.fromEntries(this.allRelationsSorted().map(({player:e,relation:i})=>[e.smallID(),i])),alliances:this.alliances().map(e=>e.other(this).smallID())}}createAttack(t,e,i,r){const s=new Uw(this._pseudo_random.nextID(),t,this,e,i,r,this.mg);return this._outgoingAttacks.push(s),t.isPlayer()&&t._incomingAttacks.push(s),s}outgoingAttacks(){return this._outgoingAttacks}incomingAttacks(){return this._incomingAttacks}isImmune(){return this.type()===P.Human&&this.mg.isSpawnImmunityActive()}canAttackPlayer(t,e=!1){return this.type()===P.Human?!t.isImmune()&&!this.isFriendly(t,e):!this.isFriendly(t,e)}canAttack(t){const e=this.mg.owner(t);if(e===this||e.isPlayer()&&!this.canAttackPlayer(e)||!this.mg.isLand(t))return!1;if(this.mg.hasOwner(t))return this.sharesBorderWith(e);for(const i of this.mg.bfs(t,u5((r,s)=>!r.hasOwner(s)&&r.isLand(s),Wh(t,200))))for(const r of this.mg.neighbors(i))if(this.mg.owner(r)===this)return!0;return!1}bestTransportShipSpawn(t){return jb(this.mg,this,t)??!1}}class Fw{constructor(t,e){if(this.game=t,this.cellSize=e,this.cells=new Map,this.railToCells=new Map,e<=0)throw new Error("cellSize must be > 0")}register(t){this.unregister(t);const e=new Set;for(const i of t.tiles){const{cx:r,cy:s}=this.cellOf(this.game.x(i),this.game.y(i)),a=this.key(r,s);if(e.has(a))continue;let o=this.cells.get(a);o||(o=new Set,this.cells.set(a,o)),e.add(a),o.add(t)}e.size>0&&this.railToCells.set(t,e)}unregister(t){const e=this.railToCells.get(t);if(e){for(const i of e){const r=this.cells.get(i);r&&(r.delete(t),r.size===0&&this.cells.delete(i))}this.railToCells.delete(t)}}query(t,e){const i=this.game.x(t),r=this.game.y(t),s=i-e,a=r-e,o=i+e,c=r+e,l=this.cellOf(s,a),h=this.cellOf(o,c),d=new Set;for(let f=l.cx;f<=h.cx;f++)for(let g=l.cy;g<=h.cy;g++){const p=this.cells.get(this.key(f,g));if(p)for(const b of p)d.add(b)}return d}key(t,e){return`${t}:${e}`}cellOf(t,e){return{cx:Math.floor(t/this.cellSize),cy:Math.floor(e/this.cellSize)}}}class qw{constructor(){this.stations=new Set,this.stationsById=[],this.nextId=1}addStation(t){t.id=this.nextId++,this.stationsById[t.id]=t,this.stations.add(t)}removeStation(t){this.stationsById[t.id]=void 0,this.stations.delete(t)}findStation(t){for(const e of this.stations)if(e.unit===t)return e;return null}getAll(){return this.stations}getById(t){return this.stationsById[t]}count(){return this.nextId}}class jw{constructor(t){this.game=t}findTilePath(t,e){return ye.Rail(this.game).findPath(t,e)??[]}findStationsPath(t,e){return ye.Stations(this.game).findPath(t,e)??[]}}function Hw(n){const t=new qw,e=new jw(n);return new Gw(n,t,e)}class Gw{constructor(t,e,i){this.game=t,this._stationManager=e,this.pathService=i,this.maxConnectionDistance=4,this.stationRadius=3,this.gridCellSize=4,this.nextId=0,this.railGrid=new Fw(t,this.gridCellSize)}stationManager(){return this._stationManager}connectStation(t){this._stationManager.addStation(t),this.connectToExistingRails(t)||this.connectToNearbyStations(t)}removeStation(t){const e=this._stationManager.findStation(t);if(!e)return;const i=e.neighbors();this.disconnectFromNetwork(e),this._stationManager.removeStation(e);const r=e.getCluster();if(r){if(i.length===1)r.removeStation(e);else if(i.length>1)for(const s of i){const a=this.computeCluster(s);new Sa().addStations(a)}e.unit.setTrainStation(!1)}}findStationsPath(t,e){return this.pathService.findStationsPath(t,e)}connectToExistingRails(t){const e=this.railGrid.query(t.tile(),this.stationRadius),i=new Set;for(const r of e){const s=r.from,a=r.to,o=r.id,c=r.getClosestTileIndex(this.game,t.tile());if(c===0||c>=r.tiles.length)continue;s.removeRailroad(r),a.removeRailroad(r),this.railGrid.unregister(r);const l=new Ta(s,t,r.tiles.slice(0,c),this.nextId++),h=new Ta(t,a,r.tiles.slice(c),this.nextId++);t.addRailroad(l),t.addRailroad(h),s.addRailroad(l),a.addRailroad(h),this.railGrid.register(h),this.railGrid.register(l);const d=s.getCluster();d&&(d.addStation(t),i.add(d)),this.game.addUpdate({type:rt.RailroadSnapEvent,originalId:o,newId1:l.id,newId2:h.id,tiles1:l.tiles,tiles2:h.tiles})}return i.size>1&&this.mergeClusters(i),i.size!==0}overlappingRailroads(t){return[...this.railGrid.query(t,this.stationRadius)].map(e=>e.id)}connectToNearbyStations(t){const e=this.game.nearbyUnits(t.tile(),this.game.config().trainStationMaxRange(),[m.City,m.Factory,m.Port]),i=new Set;e.sort((r,s)=>r.distSquared-s.distSquared);for(const r of e){if(r.unit===t.unit)continue;const s=this._stationManager.findStation(r.unit);if(!s)continue;const a=this.distanceFrom(s,t,this.maxConnectionDistance),o=s.getCluster();if(o===null)continue;(a>this.maxConnectionDistance||a===-1)&&r.distSquared>this.game.config().trainStationMinRange()**2&&this.connect(t,s)&&(o.addStation(t),i.add(o))}i.size>1?this.mergeClusters(i):i.size===0&&new Sa().addStation(t)}disconnectFromNetwork(t){for(const i of t.getRailroads())i.delete(this.game),this.railGrid.unregister(i);t.clearRailroads();const e=t.getCluster();e!==null&&e.size()===1&&this.deleteCluster(e)}deleteCluster(t){for(const e of t.stations)e.setCluster(null);t.clear()}connect(t,e){const i=this.pathService.findTilePath(t.tile(),e.tile());if(i.length>0&&i.length<this.game.config().railroadMaxSize()){const r=new Ta(t,e,i,this.nextId++);return this.game.addUpdate({type:rt.RailroadConstructionEvent,id:r.id,tiles:r.tiles}),t.addRailroad(r),e.addRailroad(r),this.railGrid.register(r),!0}return!1}distanceFrom(t,e,i){if(t===e)return 0;const r=new Set,s=[{station:t,distance:0}];for(;s.length>0;){const{station:a,distance:o}=s.shift();if(!r.has(a)&&(r.add(a),!(o>=i)))for(const c of a.neighbors()){if(c===e)return o+1;r.has(c)||s.push({station:c,distance:o+1})}}return-1}computeCluster(t){const e=new Set,i=[t];for(;i.length>0;){const r=i.shift();if(!e.has(r)){e.add(r);for(const s of r.neighbors())e.has(s)||i.push(s)}}return e}mergeClusters(t){const e=new Sa;for(const i of t)e.merge(i)}}function He(n){switch(typeof n){case"bigint":return n;case"number":return BigInt(Math.floor(n))}}const Zw={[P.Human]:_w,[P.Nation]:Sw,[P.Bot]:Tw};class Yw{constructor(){this.data={},this._numMirvLaunched=0n}numMirvsLaunched(){return this._numMirvLaunched}getPlayerStats(t){const e=t.clientID();if(e!==null)return this.data[e]}stats(){return this.data}_makePlayerStats(t){const e=t.clientID();if(e===null)return;if(e in this.data)return this.data[e];const i={};return this.data[e]=i,i}_addAttack(t,e,i){const r=this._makePlayerStats(t);if(r!==void 0){for(r.attacks??=[0n];r.attacks.length<=e;)r.attacks.push(0n);r.attacks[e]+=He(i)}}_addBetrayal(t,e){const i=this._makePlayerStats(t);i!==void 0&&(i.betrayals??=0n,i.betrayals+=He(e))}_addBoat(t,e,i,r){const s=this._makePlayerStats(t);if(s!==void 0){for(s.boats??={[e]:[0n]},s.boats[e]??=[0n];s.boats[e].length<=i;)s.boats[e].push(0n);s.boats[e][i]+=He(r)}}_addBomb(t,e,i,r){const s=gw[e],a=this._makePlayerStats(t);if(a!==void 0){for(a.bombs??={[s]:[0n]},a.bombs[s]??=[0n];a.bombs[s].length<=i;)a.bombs[s].push(0n);a.bombs[s][i]+=He(r)}}_addGold(t,e,i){const r=this._makePlayerStats(t);if(r!==void 0){for(r.gold??=[0n];r.gold.length<=e;)r.gold.push(0n);r.gold[e]+=He(i)}}_addOtherUnit(t,e,i,r){const s=bw[e],a=this._makePlayerStats(t);if(a!==void 0){for(a.units??={[s]:[0n]},a.units[s]??=[0n];a.units[s].length<=i;)a.units[s].push(0n);a.units[s][i]+=He(r)}}_addConquest(t,e){const i=this._makePlayerStats(t);if(i!==void 0){for(i.conquests??=[0n];i.conquests.length<=e;)i.conquests.push(0n);i.conquests[e]+=He(1)}}_addPlayerKilled(t,e){const i=this._makePlayerStats(t);i!==void 0&&(i.killedAt=He(e))}attack(t,e,i){this._addAttack(t,ka,i),e.isPlayer()&&this._addAttack(e,Jh,i)}attackCancel(t,e,i){this._addAttack(t,ww,i),this._addAttack(t,ka,-i),e.isPlayer()&&this._addAttack(e,Jh,-i)}betray(t){this._addBetrayal(t,1)}boatSendTrade(t,e){this._addBoat(t,"trade",Qh,1)}boatArriveTrade(t,e,i){this._addBoat(t,"trade",tu,1),this._addGold(t,nu,i),this._addGold(e,nu,i)}boatCapturedTrade(t,e,i){this._addBoat(t,"trade",vw,1),this._addGold(t,xw,i)}boatDestroyTrade(t,e){this._addBoat(t,"trade",eu,1)}boatSendTroops(t,e,i){this._addBoat(t,"trans",Qh,1)}boatArriveTroops(t,e,i){this._addBoat(t,"trans",tu,1)}boatDestroyTroops(t,e,i){this._addBoat(t,"trans",eu,1)}bombLaunch(t,e,i){i===m.MIRV&&this._numMirvLaunched++,this._addBomb(t,i,Aw,1)}bombLand(t,e,i){this._addBomb(t,i,Ew,1)}bombIntercept(t,e,i){this._addBomb(t,e,kw,i)}goldWork(t,e){this._addGold(t,Mw,e)}goldWar(t,e,i){this._addGold(t,Iw,i);const r=Zw[e.type()];r!==void 0&&this._addConquest(t,r)}unitBuild(t,e){this._addOtherUnit(t,e,Dw,1)}unitCapture(t,e){this._addOtherUnit(t,e,Rw,1)}unitUpgrade(t,e){this._addOtherUnit(t,e,Bw,1)}unitDestroy(t,e){this._addOtherUnit(t,e,Nw,1)}unitLose(t,e){this._addOtherUnit(t,e,Ow,1)}playerKilled(t,e){this._addPlayerKilled(t,e)}trainSelfTrade(t,e){this._addGold(t,Cw,e)}trainExternalTrade(t,e){this._addGold(t,Pw,e)}lobbyFillTime(t){}}function Xw(n,t,e=Vw(n.length,t.length)){const i=new Map,r=new Map,s=new Map,a=[];for(const h of n)h.clan?(s.has(h.clan)||s.set(h.clan,[]),s.get(h.clan).push(h)):a.push(h);const o=Array.from(s.entries()).sort((h,d)=>d[1].length-h[1].length);for(const[h,d]of o){let f=null,g=0;for(const p of t){const b=r.get(p)??0;f!==null&&g<=b||(g=b,f=p)}if(f!==null){for(const p of d)g<e?(g++,i.set(p,f)):i.set(p,"kicked");r.set(f,g)}}let c=a.filter(h=>h.playerType===P.Nation);c.length>0&&(c=new gt(It(c[0].id)).shuffleArray(c));const l=a.filter(h=>h.playerType!==P.Nation);for(const h of l.concat(c)){let d=null,f=0;for(const g of t){const p=r.get(g)??0;d!==null&&f<=p||(f=p,d=g)}d!==null&&(r.set(d,f+1),i.set(h,d))}return i}function Vw(n,t){return Math.ceil(n/t)}class Kw{constructor(){}smallID(){return 0}clientID(){return"TERRA_NULLIUS_CLIENT_ID"}id(){return null}isPlayer(){return!1}}class Jw{constructor(t){this.gm=t,this.cellSize=100,this.grid=Array(Math.ceil(t.height()/this.cellSize)).fill(null).map(()=>Array(Math.ceil(t.width()/this.cellSize)).fill(null).map(()=>new Map))}getGridCoords(t,e){return[Math.floor(t/this.cellSize),Math.floor(e/this.cellSize)]}addUnit(t){const e=t.tile(),[i,r]=this.getGridCoords(this.gm.x(e),this.gm.y(e));if(this.isValidCell(i,r)){const s=this.grid[r][i].get(t.type());s!==void 0?s.add(t):this.grid[r][i].set(t.type(),new Set([t]))}}removeUnit(t){const e=t.tile();this.removeUnitByTile(t,e)}removeUnitByTile(t,e){const[i,r]=this.getGridCoords(this.gm.x(e),this.gm.y(e));if(this.isValidCell(i,r)){const s=this.grid[r][i].get(t.type());s!==void 0&&s.delete(t)}}updateUnitCell(t){const e=t.tile(),i=t.lastTile(),[r,s]=this.getGridCoords(this.gm.x(i),this.gm.y(i)),[a,o]=this.getGridCoords(this.gm.x(e),this.gm.y(e));(r!==a||s!==o)&&(this.removeUnitByTile(t,i),this.addUnit(t))}isValidCell(t,e){return t>=0&&t<this.grid[0].length&&e>=0&&e<this.grid.length}getCellsInRange(t,e){const i=this.gm.x(t),r=this.gm.y(t),s=this.cellSize,[a,o]=this.getGridCoords(i,r),c=Math.max(0,a-Math.ceil((e-i%s)/s)),l=Math.min(this.grid[0].length-1,a+Math.ceil((e-(s-i%s))/s)),h=Math.max(0,o-Math.ceil((e-r%s)/s)),d=Math.min(this.grid.length-1,o+Math.ceil((e-(s-r%s))/s));return{startGridX:c,endGridX:l,startGridY:h,endGridY:d}}squaredDistanceFromTile(t,e){const i=this.gm.x(e),r=this.gm.y(e),s=this.gm.x(t.tile()),a=this.gm.y(t.tile()),o=s-i,c=a-r;return o*o+c*c}nearbyUnits(t,e,i,r,s=!1){const a=[],{startGridX:o,endGridX:c,startGridY:l,endGridY:h}=this.getCellsInRange(t,e),d=e*e,f=Array.isArray(i)?new Set(i):new Set([i]);for(let g=l;g<=h;g++)for(let p=o;p<=c;p++)for(const b of f){const S=this.grid[g][p].get(b);if(S!==void 0)for(const w of S){if(!w.isActive()||!s&&w.isUnderConstruction())continue;const v=this.squaredDistanceFromTile(w,t);if(v>d)continue;const A={unit:w,distSquared:v};r!==void 0&&!r(A)||a.push(A)}}return a}unitIsInRange(t,e,i,r,s=!1){return!t.isActive()||!s&&t.isUnderConstruction()||r!==void 0&&t.owner().id()!==r?!1:this.squaredDistanceFromTile(t,e)<=i}hasUnitNearby(t,e,i,r,s=!1){const{startGridX:a,endGridX:o,startGridY:c,endGridY:l}=this.getCellsInRange(t,e),h=e*e;for(let d=c;d<=l;d++)for(let f=a;f<=o;f++){const g=this.grid[d][f].get(i);if(g!==void 0){for(const p of g)if(this.unitIsInRange(p,t,h,r,s))return!0}}return!1}anyUnitNearby(t,e,i,r,s,a=!1){const{startGridX:o,endGridX:c,startGridY:l,endGridY:h}=this.getCellsInRange(t,e),d=e*e;for(let f=l;f<=h;f++)for(let g=o;g<=c;g++)for(const p of i){const b=this.grid[f][g].get(p);if(b!==void 0){for(const S of b)if(this.unitIsInRange(S,t,d,s,a)&&r(S))return!0}}return!1}}function Qw(n,t,e,i,r){const s=new Yw;return new t2(n,t,e,i,r,s)}class t2{constructor(t,e,i,r,s,a){this._humans=t,this._nations=e,this._map=i,this.miniGameMap=r,this._config=s,this._stats=a,this._ticks=0,this.unInitExecs=[],this._players=new Map,this._playersBySmallID=[],this.execs=[],this.allianceRequests=[],this.alliances_=[],this.nextPlayerID=1,this._nextUnitID=1,this.updates=su(),this.botTeam=ft.Bot,this._railNetwork=Hw(this),this.nextAllianceID=0,this._isPaused=!1,this._winner=null,this._miniWaterGraph=null,this._miniWaterHPA=null;const o=performance.now();if(this._terraNullius=new Kw,this._width=i.width(),this._height=i.height(),this.unitGrid=new Jw(this._map),s.gameConfig().gameMode===Ct.Team&&this.populateTeams(),this.addPlayers(),!s.disableNavMesh()){const c=new Ea(this.miniGameMap);this._miniWaterGraph=c.build(),this._miniWaterHPA=new dw(this.miniGameMap,this._miniWaterGraph,{cachePaths:!0})}console.log(`[GameImpl] Constructor total: ${(performance.now()-o).toFixed(0)}ms`)}populateTeams(){let t=this._config.playerTeams();if(t===On){this.playerTeams=[ft.Humans,ft.Nations];return}if(typeof t!="number"){const e=this._humans.length+this._nations.length;switch(t){case mo:t=Math.ceil(e/2);break;case go:t=Math.ceil(e/3);break;case po:t=Math.ceil(e/4);break;default:throw new Error(`Unknown TeamCountConfig ${t}`)}}if(t<2)throw new Error(`Too few teams: ${t}`);if(t<8)this.playerTeams=[ft.Red,ft.Blue],t>=3&&this.playerTeams.push(ft.Yellow),t>=4&&this.playerTeams.push(ft.Green),t>=5&&this.playerTeams.push(ft.Purple),t>=6&&this.playerTeams.push(ft.Orange),t>=7&&this.playerTeams.push(ft.Teal);else{this.playerTeams=[];for(let e=1;e<=t;e++)this.playerTeams.push(`Team ${e}`)}}addPlayers(){if(this.config().gameConfig().gameMode===Ct.FFA){this._humans.forEach(i=>this.addPlayer(i)),this._nations.forEach(i=>this.addPlayer(i.playerInfo));return}if(this._config.playerTeams()===On){this._humans.forEach(i=>this.addPlayer(i,ft.Humans)),this._nations.forEach(i=>this.addPlayer(i.playerInfo,ft.Nations));return}const t=[...this._humans,...this._nations.map(i=>i.playerInfo)],e=Xw(t,this.playerTeams);for(const[i,r]of e.entries()){if(r==="kicked"){console.warn(`Player ${i.name} was kicked from team`);continue}this.addPlayer(i,r)}}isOnEdgeOfMap(t){return this._map.isOnEdgeOfMap(t)}owner(t){return this.playerBySmallID(this.ownerID(t))}alliances(){return this.alliances_}playerBySmallID(t){return t===0?this.terraNullius():this._playersBySmallID[t-1]}map(){return this._map}miniMap(){return this.miniGameMap}addUpdate(t){this.updates[t.type].push(t)}nextUnitID(){const t=this._nextUnitID;return this._nextUnitID++,t}setFallout(t,e){if(e&&this.hasOwner(t))throw Error(`cannot set fallout, tile ${t} has owner`);this._map.hasFallout(t)||(this._map.setFallout(t,e),this.addUpdate({type:rt.Tile,update:this.toTileUpdate(t)}))}units(...t){return Array.from(this._players.values()).flatMap(e=>e.units(...t))}unitCount(t){let e=0;for(const i of this._players.values())e+=i.unitCount(t);return e}unitInfo(t){return this.config().unitInfo(t)}nations(){return this._nations}createAllianceRequest(t,e){if(t.isAlliedWith(e))return console.log("cannot request alliance, already allied"),null;if(e.incomingAllianceRequests().find(s=>s.requestor()===t)!==void 0)return console.log(`duplicate alliance request from ${t.name()}`),null;const i=t.incomingAllianceRequests().find(s=>s.requestor()===e);if(i!==void 0)return console.log("got corresponding alliance requests, accepting"),i.accept(),null;const r=new zw(t,e,this._ticks,this);return this.allianceRequests.push(r),this.addUpdate(r.toUpdate()),r}acceptAllianceRequest(t){this.allianceRequests=this.allianceRequests.filter(a=>a!==t);const e=t.requestor(),i=t.recipient();if(e.allianceWith(i))throw new Error(`cannot accept alliance request, already allied with ${i.name()}`);const s=new Lw(this,e,i,this._ticks,this.nextAllianceID++);this.alliances_.push(s),t.requestor().pastOutgoingAllianceRequests.push(t),e.hasEmbargoAgainst(i)&&e.endTemporaryEmbargo(i),i.hasEmbargoAgainst(e)&&i.endTemporaryEmbargo(e),this.addUpdate({type:rt.AllianceRequestReply,request:t.toUpdate(),accepted:!0})}rejectAllianceRequest(t){this.allianceRequests=this.allianceRequests.filter(e=>e!==t),t.requestor().pastOutgoingAllianceRequests.push(t),this.addUpdate({type:rt.AllianceRequestReply,request:t.toUpdate(),accepted:!1})}hasPlayer(t){return this._players.has(t)}config(){return this._config}isPaused(){return this._isPaused}setPaused(t){this._isPaused=t,this.addUpdate({type:rt.GamePaused,paused:t})}inSpawnPhase(){return this._ticks<=this.config().numSpawnPhaseTurns()}ticks(){return this._ticks}executeNextTick(){this.updates=su(),this.execs.forEach(i=>{(!this.inSpawnPhase()||i.activeDuringSpawnPhase())&&i.isActive()&&i.tick(this._ticks)});const t=[],e=[];this.unInitExecs.forEach(i=>{!this.inSpawnPhase()||i.activeDuringSpawnPhase()?(i.init(this,this._ticks),t.push(i)):e.push(i)}),this.removeInactiveExecutions(),this.execs.push(...t),this.unInitExecs=e;for(const i of this._players.values())this.addUpdate(i.toUpdate());return this.ticks()%10===0&&this.addUpdate({type:rt.Hash,tick:this.ticks(),hash:this.hash()}),this._ticks++,this.updates}hash(){let t=1;return this._players.forEach(e=>{t+=e.hash()}),t}terraNullius(){return this._terraNullius}removeInactiveExecutions(){const t=[];for(const e of this.execs)this.inSpawnPhase()?e.activeDuringSpawnPhase()?e.isActive()&&t.push(e):t.push(e):e.isActive()&&t.push(e);this.execs=t}players(){return Array.from(this._players.values()).filter(t=>t.isAlive())}allPlayers(){return Array.from(this._players.values())}executions(){return[...this.execs,...this.unInitExecs]}addExecution(...t){this.unInitExecs.push(...t)}removeExecution(t){this.execs=this.execs.filter(e=>e!==t),this.unInitExecs=this.unInitExecs.filter(e=>e!==t)}playerView(t){return this.player(t)}addPlayer(t,e=null){const i=new $w(this,this.nextPlayerID,t,this.config().startManpower(t),e??this.maybeAssignTeam(t));return this._playersBySmallID.push(i),this.nextPlayerID++,this._players.set(t.id,i),i}maybeAssignTeam(t){if(this._config.gameConfig().gameMode!==Ct.Team)return null;if(t.playerType===P.Bot)return this.botTeam;const e=It(t.id);return this.playerTeams[e%this.playerTeams.length]}player(t){const e=this._players.get(t);if(e===void 0)throw new Error(`Player with id ${t} not found`);return e}playerByClientID(t){for(const[,e]of this._players)if(e.clientID()===t)return e;return null}isOnMap(t){return t.x>=0&&t.x<this._width&&t.y>=0&&t.y<this._height}neighborsWithDiag(t){const e=this.x(t),i=this.y(t),r=[];for(let s=-1;s<=1;s++)for(let a=-1;a<=1;a++){if(s===0&&a===0)continue;const o=e+s,c=i+a;o>=0&&o<this._width&&c>=0&&c<this._height&&r.push(this._map.ref(o,c))}return r}forEachNeighborWithDiag(t,e){const i=this.x(t),r=this.y(t);for(let s=-1;s<=1;s++)for(let a=-1;a<=1;a++){if(s===0&&a===0)continue;const o=i+s,c=r+a;o>=0&&o<this._width&&c>=0&&c<this._height&&e(this._map.ref(o,c))}}conquer(t,e){if(!this.isLand(e))throw Error("cannot conquer water");const i=this.owner(e);i.isPlayer()&&(i._lastTileChange=this._ticks,i._tiles.delete(e),i._borderTiles.delete(e)),this._map.setOwnerID(e,t.smallID()),t._tiles.add(e),t._lastTileChange=this._ticks,this.updateBorders(e),this._map.setFallout(e,!1),this.addUpdate({type:rt.Tile,update:this.toTileUpdate(e)})}relinquish(t){if(!this.hasOwner(t))throw new Error("Cannot relinquish tile because it is unowned");if(this.isWater(t))throw new Error("Cannot relinquish water");const e=this.owner(t);e._lastTileChange=this._ticks,e._tiles.delete(t),e._borderTiles.delete(t),this._map.setOwnerID(t,0),this.updateBorders(t),this.addUpdate({type:rt.Tile,update:this.toTileUpdate(t)})}updateBorders(t){const e=i=>{if(!this.hasOwner(i))return;const r=this.owner(i);this.calcIsBorder(i)?r._borderTiles.add(i):r._borderTiles.delete(i)};e(t),this.forEachNeighbor(t,e)}calcIsBorder(t){if(!this.hasOwner(t))return!1;const e=this.ownerID(t),i=this.x(t),r=this.y(t);return i>0&&this.ownerID(this._map.ref(i-1,r))!==e||i+1<this._width&&this.ownerID(this._map.ref(i+1,r))!==e||r>0&&this.ownerID(this._map.ref(i,r-1))!==e||r+1<this._height&&this.ownerID(this._map.ref(i,r+1))!==e}target(t,e){this.addUpdate({type:rt.TargetPlayer,playerID:t.smallID(),targetID:e.smallID()})}breakAlliance(t,e){let i;if(e.requestor()===t?i=e.recipient():i=e.requestor(),!t.isAlliedWith(i))throw new Error(`${t} not allied with ${i}, cannot break alliance`);!i.isTraitor()&&!i.isDisconnected()&&t.markTraitor(),this.alliances_=this.alliances_.filter(r=>r!==e),this.addUpdate({type:rt.BrokeAlliance,traitorID:t.smallID(),betrayedID:i.smallID(),allianceID:e.id()})}expireAlliance(t){const e=new Set(t.recipient().alliances()),i=t.requestor().alliances().filter(r=>e.has(r));if(i.length!==1)throw new Error(`cannot expire alliance: must have exactly one alliance, have ${i.length}`);this.alliances_=this.alliances_.filter(r=>r!==i[0]),this.addUpdate({type:rt.AllianceExpired,player1ID:t.requestor().smallID(),player2ID:t.recipient().smallID()})}isSpawnImmunityActive(){return this.config().numSpawnPhaseTurns()+this.config().spawnImmunityDuration()>=this.ticks()}sendEmojiUpdate(t){this.addUpdate({type:rt.Emoji,emoji:t})}setWinner(t,e){this._winner=t,this.addUpdate({type:rt.Win,winner:this.makeWinner(t),allPlayersStats:e})}getWinner(){return this._winner}makeWinner(t){if(typeof t=="string")return["team",t,...this.players().filter(e=>e.team()===t&&e.clientID()!==null).map(e=>e.clientID())];{const e=t.clientID();return e===null?["nation",t.name()]:["player",e]}}teams(){return this._config.gameConfig().gameMode!==Ct.Team?[]:[this.botTeam,...this.playerTeams]}displayMessage(t,e,i,r,s){let a=null;i!==null&&(a=this.player(i).smallID()),this.addUpdate({type:rt.DisplayEvent,messageType:e,message:t,playerID:a,goldAmount:r,params:s})}displayChat(t,e,i,r,s,a){let o=null;r!==null&&(o=this.player(r).smallID()),this.addUpdate({type:rt.DisplayChatEvent,key:t,category:e,target:i,playerID:o,isFrom:s,recipient:a})}displayIncomingUnit(t,e,i,r){const s=this.player(r).smallID();this.addUpdate({type:rt.UnitIncoming,unitID:t,message:e,messageType:i,playerID:s})}addUnit(t){this.unitGrid.addUnit(t)}removeUnit(t){this.unitGrid.removeUnit(t),t.hasTrainStation()&&this._railNetwork.removeStation(t)}updateUnitTile(t){this.unitGrid.updateUnitCell(t)}hasUnitNearby(t,e,i,r,s){return this.unitGrid.hasUnitNearby(t,e,i,r,s)}anyUnitNearby(t,e,i,r,s,a){return this.unitGrid.anyUnitNearby(t,e,i,r,s,a)}nearbyUnits(t,e,i,r,s){return this.unitGrid.nearbyUnits(t,e,i,r,s)}ref(t,e){return this._map.ref(t,e)}isValidRef(t){return this._map.isValidRef(t)}x(t){return this._map.x(t)}y(t){return this._map.y(t)}cell(t){return this._map.cell(t)}width(){return this._map.width()}height(){return this._map.height()}numLandTiles(){return this._map.numLandTiles()}isValidCoord(t,e){return this._map.isValidCoord(t,e)}isLand(t){return this._map.isLand(t)}isOceanShore(t){return this._map.isOceanShore(t)}isOcean(t){return this._map.isOcean(t)}isShoreline(t){return this._map.isShoreline(t)}magnitude(t){return this._map.magnitude(t)}ownerID(t){return this._map.ownerID(t)}hasOwner(t){return this._map.hasOwner(t)}setOwnerID(t,e){return this._map.setOwnerID(t,e)}hasFallout(t){return this._map.hasFallout(t)}isBorder(t){return this._map.isBorder(t)}neighbors(t){return this._map.neighbors(t)}forEachNeighbor(t,e){const i=this.x(t),r=this.y(t);i>0&&e(this._map.ref(i-1,r)),i+1<this._width&&e(this._map.ref(i+1,r)),r>0&&e(this._map.ref(i,r-1)),r+1<this._height&&e(this._map.ref(i,r+1))}isWater(t){return this._map.isWater(t)}isLake(t){return this._map.isLake(t)}isShore(t){return this._map.isShore(t)}cost(t){return this._map.cost(t)}terrainType(t){return this._map.terrainType(t)}forEachTile(t){return this._map.forEachTile(t)}manhattanDist(t,e){return this._map.manhattanDist(t,e)}euclideanDistSquared(t,e){return this._map.euclideanDistSquared(t,e)}circleSearch(t,e,i){return this._map.circleSearch(t,e,i)}bfs(t,e){return this._map.bfs(t,e)}toTileUpdate(t){return this._map.toTileUpdate(t)}updateTile(t){return this._map.updateTile(t)}numTilesWithFallout(){return this._map.numTilesWithFallout()}stats(){return this._stats}railNetwork(){return this._railNetwork}miniWaterHPA(){return this._miniWaterHPA}miniWaterGraph(){return this._miniWaterGraph}getWaterComponent(t){if(!this._miniWaterGraph)return 0;const e=Math.floor(this._map.x(t)/2),i=Math.floor(this._map.y(t)/2),r=this.miniGameMap.ref(e,i);if(this.miniGameMap.isWater(r))return this._miniWaterGraph.getComponentId(r);for(const s of this.miniGameMap.neighbors(r))if(this.miniGameMap.isWater(s))return this._miniWaterGraph.getComponentId(s);for(const s of this.miniGameMap.neighbors(r))for(const a of this.miniGameMap.neighbors(s))if(this.miniGameMap.isWater(a))return this._miniWaterGraph.getComponentId(a);return null}hasWaterComponent(t,e){if(!this._miniWaterGraph)return!0;const i=Math.floor(this._map.x(t)/2),r=Math.floor(this._map.y(t)/2),s=this.miniGameMap.ref(i,r);if(this.miniGameMap.isWater(s)&&this._miniWaterGraph.getComponentId(s)===e)return!0;for(const a of this.miniGameMap.neighbors(s))if(this.miniGameMap.isWater(a)&&this._miniWaterGraph.getComponentId(a)===e)return!0;for(const a of this.miniGameMap.neighbors(s))for(const o of this.miniGameMap.neighbors(a))if(this.miniGameMap.isWater(o)&&this._miniWaterGraph.getComponentId(o)===e)return!0;return!1}conquerPlayer(t,e){if(e.isDisconnected()&&t.isOnSameTeam(e)){const o=e.units().filter(c=>c.type()===m.Warship||c.type()===m.TransportShip);for(const c of o)t.captureUnit(c)}const s=(this._stats.getPlayerStats(e)?.attacks?.[ka]??0n)===0n&&e.type()===P.Human,a=s?0n:e.gold();s?this.displayMessage("events_display.conquered_no_gold",at.CONQUERED_PLAYER,t.id(),void 0,{name:e.displayName()}):(this.displayMessage("events_display.received_gold_from_conquest",at.CONQUERED_PLAYER,t.id(),a,{gold:Qe(a),name:e.displayName()}),t.addGold(a),e.removeGold(a),this.stats().goldWar(t,e,a)),this.addUpdate({type:rt.ConquestEvent,conquerorId:t.id(),conqueredId:e.id(),gold:a})}}const su=()=>{const n={};return Object.values(rt).filter(t=>!isNaN(Number(t))).forEach(t=>{n[t]=[]}),n};function e2(n,t,e,i){if(n.config.disableNations)return[];const r=g=>new wo(new Dt(g.coordinates[0],g.coordinates[1]),new Bi(g.name,P.Nation,null,i.nextID())),s=n.config.gameMapSize===Ne.Compact,a=n.config.gameMode===Ct.Team&&n.config.playerTeams===On;let o=t;if(s&&!a){const g=n2(t.length);o=i.shuffleArray(t).slice(0,g)}if(!a)return o.map(r);const l=n.config.gameType===Ln.Singleplayer?1:e;if(l===0)return[];if(t.length>=l)return i.shuffleArray(t).slice(0,l).map(r);const h=t.map(r),d=new Set(h.map(g=>g.playerInfo.name)),f=l-t.length;for(let g=0;g<f;g++){const p=i2(i,d);d.add(p),h.push(new wo(void 0,new Bi(p,P.Nation,null,i.nextID())))}return h}function n2(n,t){return n===0?0:Math.max(1,Math.floor(n*.25))}function i2(n,t){for(let r=0;r<1e3;r++){const s=au(n);if(!t.has(s))return s}let e=1;const i=au(n);for(;t.has(`${i} ${e}`);)e++;return`${i} ${e}`}function au(n){const t=ou[n.nextInt(0,ou.length)],e=cu[n.nextInt(0,cu.length)],i=[];for(const r of t)r===$t?i.push(s2(e)):r===k?i.push(e):i.push(r);return i.join(" ")}const $t=Symbol("plural!"),k=Symbol("noun!"),ou=[["World Famous",k],["Famous",$t],["Comically Large",k],["Comically Small",k],["Massive",$t],["Friendly",k],["Evil",k],["Malicious",k],["Spiteful",k],["Suspicious",k],["Canonically Evil",k],["Limited Edition",k],["Patent Pending",k],["Patented",k],["Space",k],["Defend The",$t],["Anarchist",k],["Republic of",$t],["Slippery",k],["Wealthy",$t],["Certified",k],["Dr",k],["Runaway",k],["Chrome",k],["All New",k],["Top Shelf",$t],["Invading",$t],["Loyal To",$t],["United States of",k],["United States of",$t],["Flowing Rivers of",k],["House of",$t],["Certified Organic",k],["Unregulated",k],[k,"For Hire"],[$t,"That Bite"],[$t,"Are Opps"],[k,"Hotel"],[$t,"The Movie"],[k,"Corporation"],[$t,"Inc"],[k,"Democracy"],[k,"Network"],[k,"Railway"],[k,"Congress"],[k,"Alliance"],[k,"Island"],[k,"Kingdom"],[k,"Empire"],[k,"Dynasty"],[k,"Cartel"],[k,"Cabal"],[k,"Land"],[k,"Oligarchy"],[k,"Nationalist"],[k,"State"],[k,"Duchy"],[k,"Ocean"],["Alternate",k,"Universe"],["Famous",k,"Collection"],["Supersonic",k,"Spaceship"],["Secret",k,"Agenda"],["Ballistic",k,"Missile"],["The",$t,"are SPIES"],["Traveling",k,"Circus"],["The",$t,"Lied"],["Sacred",k,"Knowledge"],["Quantum",k,"Computer"],["Hadron",k,"Collider"],["Large",k,"Obliterator"],["Interstellar",k,"Cabal"],["Interstellar",k,"Army"],["Interstellar",k,"Pirates"],["Interstellar",k,"Dynasty"],["Interstellar",k,"Clan"],["Galactic",k,"Smugglers"],["Galactic",k,"Cabal"],["Galactic",k,"Alliance"],["Galactic",k,"Empire"],["Galactic",k,"Army"],["Galactic",k,"Crown"],["Galactic",k,"Pirates"],["Galactic",k,"Dynasty"],["Galactic",k,"Clan"],["Alien",k,"Army"],["Alien",k,"Cabal"],["Alien",k,"Alliance"],["Alien",k,"Empire"],["Alien",k,"Pirates"],["Alien",k,"Clan"],["Grand",k,"Empire"],["Grand",k,"Dynasty"],["Grand",k,"Army"],["Grand",k,"Cabal"],["Grand",k,"Alliance"],["Royal",k,"Army"],["Royal",k,"Cabal"],["Royal",k,"Empire"],["Royal",k,"Dynasty"],["Holy",k,"Dynasty"],["Holy",k,"Empire"],["Holy",k,"Alliance"],["Eternal",k,"Empire"],["Eternal",k,"Cabal"],["Eternal",k,"Alliance"],["Eternal",k,"Dynasty"],["Invading",k,"Cabal"],["Invading",k,"Empire"],["Invading",k,"Alliance"],["Immortal",k,"Pirates"],["Shadow",k,"Cabal"],["Secret",k,"Dynasty"],["The Great",k,"Army"],["The",k,"Matrix"]],cu=["Snail","Cow","Giraffe","Donkey","Horse","Mushroom","Salad","Kitten","Fork","Apple","Pancake","Tree","Fern","Seashell","Turtle","Casserole","Gnome","Frog","Cheese","Mold","Clown","Boat","Robot","Millionaire","Billionaire","Pigeon","Fish","Bumblebee","Jelly","Wizard","Worm","Rat","Pumpkin","Zombie","Grass","Bear","Skunk","Sandwich","Butter","Soda","Pickle","Potato","Book","Friend","Feather","Flower","Oil","Train","Fan","Salmon","Cod","Sink","Villain","Bug","Car","Soup","Puppy","Rock","Stick","Succulent","Nerd","Mercenary","Ninja","Burger","Tomato","Penguin"],r2=new Set(["Potato","Tomato"]);function s2(n){return n.endsWith("s")||n.endsWith("ch")||n.endsWith("sh")||n.endsWith("x")||n.endsWith("z")?`${n}es`:n.endsWith("y")&&!"aeiou".includes(n[n.length-2])?`${n.slice(0,-1)}ies`:r2.has(n)?`${n}es`:`${n}s`}const lu=new Map;async function a2(n,t,e){const i=lu.get(n);if(i!==void 0)return i;const r=e.getMapData(n),s=await r.manifest(),a=t===Ne.Normal?await Nr(s.map,await r.mapBin()):await Nr(s.map4x,await r.map4xBin()),o=t===Ne.Normal?await Nr(t===Ne.Normal?s.map4x:s.map16x,await r.map4xBin()):await Nr(s.map16x,await r.map16xBin());t===Ne.Compact&&s.nations.forEach(l=>{l.coordinates=[Math.floor(l.coordinates[0]/2),Math.floor(l.coordinates[1]/2)]});const c={nations:s.nations,gameMap:a,miniGameMap:o};return lu.set(n,c),c}async function Nr(n,t){if(t.length!==n.width*n.height)throw new Error(`Invalid data: buffer size ${t.length} incorrect for ${n.width}x${n.height} terrain plus 4 bytes for dimensions.`);return new ba(n.width,n.height,t,n.num_land_tiles)}var rn={},Ft={},vt={},hu;function Ge(){if(hu)return vt;hu=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.getAndAssertSingleCodePoint=vt.invertCaseOfAlphabeticChar=vt.isUpperCase=vt.isLowerCase=vt.isAlphabetic=vt.isDigit=vt.isWordChar=vt.convertSurrogatePairToCodePoint=vt.isLowSurrogate=vt.isHighSurrogate=void 0;function n(h){return 55296<=h&&h<=56319}vt.isHighSurrogate=n;function t(h){return 56320<=h&&h<=57343}vt.isLowSurrogate=t;function e(h,d){return(h-55296)*1024+d-56320+65536}vt.convertSurrogatePairToCodePoint=e;function i(h){return r(h)||s(h)}vt.isWordChar=i;function r(h){return 48<=h&&h<=57}vt.isDigit=r;function s(h){return a(h)||o(h)}vt.isAlphabetic=s;function a(h){return 97<=h&&h<=122}vt.isLowerCase=a;function o(h){return 65<=h&&h<=90}vt.isUpperCase=o;function c(h){return h^32}vt.invertCaseOfAlphabeticChar=c;function l(h){if([...h].length!==1)throw new RangeError("Expected the input string to be one code point in length.");return h.codePointAt(0)}return vt.getAndAssertSingleCodePoint=l,vt}var uu;function du(){if(uu)return Ft;uu=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.randomCharFromSetCensorStrategy=Ft.fixedCharCensorStrategy=Ft.fixedPhraseCensorStrategy=Ft.grawlixCensorStrategy=Ft.asteriskCensorStrategy=Ft.keepEndCensorStrategy=Ft.keepStartCensorStrategy=void 0;const n=Ge();function t(c){return l=>l.overlapsAtStart?c(l):String.fromCodePoint(l.input.codePointAt(l.startIndex))+c({...l,matchLength:l.matchLength-1})}Ft.keepStartCensorStrategy=t;function e(c){return l=>{if(l.overlapsAtEnd)return c(l);const h=String.fromCodePoint(l.input.codePointAt(l.endIndex));return c({...l,matchLength:l.matchLength-1})+h}}Ft.keepEndCensorStrategy=e;function i(){return a("*")}Ft.asteriskCensorStrategy=i;function r(){return o("%@$&*")}Ft.grawlixCensorStrategy=r;function s(c){return()=>c}Ft.fixedPhraseCensorStrategy=s;function a(c){return(0,n.getAndAssertSingleCodePoint)(c),l=>c.repeat(l.matchLength)}Ft.fixedCharCensorStrategy=a;function o(c){const l=[...c];if(l.length<2)throw new Error("The character set passed must have at least 2 characters.");return h=>{if(h.matchLength===0)return"";let d=Math.floor(Math.random()*l.length),f=l[d];for(let g=1;g<h.matchLength;g++){let p=Math.floor(Math.random()*(l.length-1));p>=d&&p++,d=p,f+=l[p]}return f}}return Ft.randomCharFromSetCensorStrategy=o,Ft}var hi={},ui={},di={},fu;function o2(){if(fu)return di;fu=1,Object.defineProperty(di,"__esModule",{value:!0}),di.compareIntervals=void 0;function n(t,e,i,r){return t<i?-1:i<t?1:e<r?-1:r<e?1:0}return di.compareIntervals=n,di}var mu;function Ia(){if(mu)return ui;mu=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.compareMatchByPositionAndId=void 0;const n=o2();function t(e,i){const r=(0,n.compareIntervals)(e.startIndex,e.endIndex,i.startIndex,i.endIndex);return r!==0?r:e.termId===i.termId?0:e.termId<i.termId?-1:1}return ui.compareMatchByPositionAndId=t,ui}var gu;function c2(){if(gu)return hi;gu=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.TextCensor=void 0;const n=Ia(),t=du();let e=class{constructor(){this.strategy=(0,t.grawlixCensorStrategy)()}setStrategy(r){return this.strategy=r,this}applyTo(r,s){if(s.length===0)return r;const a=[...s].sort(n.compareMatchByPositionAndId);let o="",c=0;for(let l=0;l<a.length;l++){const h=a[l];if(c>h.endIndex)continue;const d=h.startIndex<c;d||(o+=r.slice(c,h.startIndex));const f=Math.max(c,h.startIndex),g=l<a.length-1&&h.endIndex>=a[l+1].startIndex&&h.endIndex<a[l+1].endIndex;o+=this.strategy({...h,startIndex:f,input:r,overlapsAtStart:d,overlapsAtEnd:g}),c=h.endIndex+1}return o+=r.slice(c),o}};return hi.TextCensor=e,hi}var sn={},fi={},pu;function yu(){if(pu)return fi;pu=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.assignIncrementingIds=void 0;function n(t){let e=0;return t.map(i=>({id:e++,pattern:i}))}return fi.assignIncrementingIds=n,fi}var bu;function wu(){if(bu)return sn;bu=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.PhraseBuilder=sn.DataSet=void 0;const n=yu();let t=class{constructor(){this.containers=[],this.patternCount=0,this.patternIdToPhraseContainer=new Map}addAll(r){for(const s of r.containers)this.registerContainer(s);return this}removePhrasesIf(r){this.patternCount=0,this.patternIdToPhraseContainer.clear();const s=this.containers.splice(0);for(const a of s)r(a)||this.registerContainer(a);return this}addPhrase(r){const s=r(new e).build();return this.registerContainer(s),this}getPayloadWithPhraseMetadata(r){const s=this.patternIdToPhraseContainer.get(r.termId);if(s===void 0)throw new Error(`The pattern with ID ${r.termId} does not exist in this dataset.`);return{...r,phraseMetadata:this.containers[s].metadata}}build(){return{blacklistedTerms:(0,n.assignIncrementingIds)(this.containers.flatMap(r=>r.patterns)),whitelistedTerms:this.containers.flatMap(r=>r.whitelistedTerms)}}registerContainer(r){const s=this.containers.push(r)-1;for(let a=0,o=this.patternCount;a<r.patterns.length;a++,o++)this.patternIdToPhraseContainer.set(o,s),this.patternCount++}};sn.DataSet=t;class e{constructor(){this.patterns=[],this.whitelistedTerms=[]}addPattern(r){return this.patterns.push(r),this}addWhitelistedTerm(r){return this.whitelistedTerms.push(r),this}setMetadata(r){return this.metadata=r,this}build(){return{patterns:this.patterns,whitelistedTerms:this.whitelistedTerms,metadata:this.metadata}}}return sn.PhraseBuilder=e,sn}var mi={},Me={},gi={},_u;function xa(){if(_u)return gi;_u=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.SyntaxKind=void 0;var n;return(function(t){t[t.Optional=0]="Optional",t[t.Wildcard=1]="Wildcard",t[t.Literal=2]="Literal",t[t.BoundaryAssertion=3]="BoundaryAssertion"})(n||(gi.SyntaxKind=n={})),gi}var Su;function l2(){if(Su)return Me;Su=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.getRegExpStringForNode=Me.compilePatternToRegExp=Me.potentiallyMatchesEmptyString=void 0;const n=xa();function t(s){return s.nodes.every(a=>a.kind===n.SyntaxKind.Optional)}Me.potentiallyMatchesEmptyString=t;function e(s){let a="";s.requireWordBoundaryAtStart&&(a+="\\b");for(const o of s.nodes)a+=r(o);return s.requireWordBoundaryAtEnd&&(a+="\\b"),new RegExp(a,"gs")}Me.compilePatternToRegExp=e;const i=["[",".","*","+","?","^","$","{","}","(",")","|","[","\\","]"].map(s=>s.charCodeAt(0));function r(s){switch(s.kind){case n.SyntaxKind.Literal:{let a="";for(const o of s.chars)i.includes(o)&&(a+="\\"),a+=String.fromCodePoint(o);return a}case n.SyntaxKind.Optional:return`(?:${r(s.childNode)})?`;case n.SyntaxKind.Wildcard:return"."}}return Me.getRegExpStringForNode=r,Me}var pi={},Tu;function h2(){if(Tu)return pi;Tu=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.TransformerSet=void 0;let n=class{constructor(e){this.transformers=e,this.statefulTransformers=Array.from({length:this.transformers.length});for(let i=0;i<this.transformers.length;i++){const r=this.transformers[i];r.type===1&&(this.statefulTransformers[i]=r.factory())}}applyTo(e){let i=e;for(let r=0;r<this.transformers.length&&i!==void 0;r++){const s=this.transformers[r];s.type===0?i=s.transform(i):i=this.statefulTransformers[r].transform(i)}return i}resetAll(){for(let e=0;e<this.transformers.length;e++)this.transformers[e].type===1&&this.statefulTransformers[e].reset()}};return pi.TransformerSet=n,pi}var yi={},vu;function Ca(){if(vu)return yi;vu=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.CharacterIterator=void 0;const n=Ge();let t=class{constructor(i){this.lastPosition=-1,this.currentPosition=0,this._lastWidth=0,this._input=i??""}get input(){return this._input}setInput(i){return this._input=i,this.reset(),this}reset(){this.lastPosition=-1,this.currentPosition=0,this._lastWidth=0}next(){if(this.done)return{done:!0,value:void 0};this.lastPosition=this.currentPosition;const i=this._input.charCodeAt(this.currentPosition++);if(this._lastWidth=1,this.done||!(0,n.isHighSurrogate)(i))return{done:!1,value:i};const r=this._input.charCodeAt(this.currentPosition);return(0,n.isLowSurrogate)(r)?(this._lastWidth++,this.currentPosition++,{done:!1,value:(0,n.convertSurrogatePairToCodePoint)(i,r)}):{done:!1,value:i}}get position(){return this.lastPosition}get lastWidth(){return this._lastWidth}get done(){return this.currentPosition>=this._input.length}[Symbol.iterator](){return this}};return yi.CharacterIterator=t,yi}var bi={},Au;function u2(){if(Au)return bi;Au=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.IntervalCollection=void 0;let n=class{constructor(){this.dirty=!1,this.intervals=[]}insert(e,i){this.intervals.push([e,i]),this.dirty=!0}query(e,i){if(this.intervals.length===0)return!1;this.dirty&&(this.dirty=!1,this.intervals.sort((r,s)=>r[0]<s[0]?-1:s[0]<r[0]?1:0));for(const r of this.intervals){if(r[0]>e)break;if(r[0]<=e&&i<=r[1])return!0}return!1}values(){return this.intervals.values()}[Symbol.iterator](){return this.values()}};return bi.IntervalCollection=n,bi}var Eu;function d2(){if(Eu)return mi;Eu=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.RegExpMatcher=void 0;const n=Ge(),t=l2(),e=h2(),i=Ca(),r=u2(),s=Ia();class a{constructor({blacklistedTerms:c,whitelistedTerms:l=[],blacklistMatcherTransformers:h=[],whitelistMatcherTransformers:d=[]}){this.blacklistedTerms=this.compileTerms(c),this.validateWhitelistedTerms(l),this.whitelistedTerms=l,this.blacklistMatcherTransformers=new e.TransformerSet(h),this.whitelistMatcherTransformers=new e.TransformerSet(d)}getAllMatches(c,l=!1){const h=this.getWhitelistedIntervals(c),[d,f]=this.applyTransformers(c,this.blacklistMatcherTransformers),g=[];for(const p of this.blacklistedTerms)for(const b of f.matchAll(p.regExp)){const S=d[b.index];let w=d[b.index+b[0].length-1];w<c.length-1&&(0,n.isHighSurrogate)(c.charCodeAt(w))&&(0,n.isLowSurrogate)(c.charCodeAt(w+1))&&w++,h.query(S,w)||g.push({termId:p.id,startIndex:S,endIndex:w,matchLength:[...b[0]].length})}return l&&g.sort(s.compareMatchByPositionAndId),g}hasMatch(c){const l=this.getWhitelistedIntervals(c),[h,d]=this.applyTransformers(c,this.blacklistMatcherTransformers);for(const f of this.blacklistedTerms)for(const g of d.matchAll(f.regExp)){const p=h[g.index];let b=h[g.index+g[0].length-1];if(b<c.length-1&&(0,n.isHighSurrogate)(c.charCodeAt(b))&&(0,n.isLowSurrogate)(c.charCodeAt(b+1))&&b++,!l.query(p,b))return!0}return!1}getWhitelistedIntervals(c){const l=new r.IntervalCollection,[h,d]=this.applyTransformers(c,this.whitelistMatcherTransformers);for(const f of this.whitelistedTerms){let g=0;for(let p=d.indexOf(f,g);p!==-1;p=d.indexOf(f,g)){let b=h[p+f.length-1];b<c.length-1&&(0,n.isHighSurrogate)(c.charCodeAt(b))&&(0,n.isLowSurrogate)(c.charCodeAt(b+1))&&b++,l.insert(h[p],b),g=p+f.length}}return l}applyTransformers(c,l){const h=[];let d="";const f=new i.CharacterIterator(c);for(const g of f){const p=l.applyTo(g);if(p!==void 0)for(d+=String.fromCodePoint(p);h.length<d.length;)h.push(f.position)}return l.resetAll(),[h,d]}compileTerms(c){const l=[],h=new Set;for(const d of c){if(h.has(d.id))throw new Error(`Duplicate blacklisted term ID ${d.id}.`);if((0,t.potentiallyMatchesEmptyString)(d.pattern))throw new Error(`Pattern with ID ${d.id} potentially matches empty string; this is unsupported.`);l.push({id:d.id,regExp:(0,t.compilePatternToRegExp)(d.pattern)}),h.add(d.id)}return l}validateWhitelistedTerms(c){if(c.some(l=>l.length===0))throw new Error("Whitelisted term set contains empty string; this is unsupported.")}}return mi.RegExpMatcher=a,mi}var Pa={},ku;function f2(){return ku||(ku=1,Object.defineProperty(Pa,"__esModule",{value:!0})),Pa}var wi={},Mu;function Iu(){if(Mu)return wi;Mu=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.ParserError=void 0;let n=class extends Error{constructor(e,i,r){super(`${i}:${r}: ${e}`),this.name="ParserError",this.line=i,this.column=r}};return wi.ParserError=n,wi}var an={},_i={},xu;function m2(){if(xu)return _i;xu=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.Parser=void 0;const n=Ge(),t=Ca(),e=xa(),i=Iu(),r=[92,91,93,63,124],s=r.map(c=>`'${String.fromCodePoint(c)}'`).join(", "),a=-1;let o=class{constructor(){this.input="",this.line=1,this.column=1,this.position=0,this.lastColumn=1,this.lastWidth=0}parse(l){this.setInput(l);const h=[],d=this.nextNode(),f=d?.kind===e.SyntaxKind.BoundaryAssertion;d&&!f&&h.push(d);let g=!1;for(;!this.done;){const p=this.mark(),b=this.nextNode();if(b.kind!==e.SyntaxKind.BoundaryAssertion){h.push(b);continue}this.done||this.reportError("Boundary assertions are not supported in this position; they are only allowed at the start / end of the pattern.",p),g=!0}return{requireWordBoundaryAtStart:f,requireWordBoundaryAtEnd:g,nodes:h}}setInput(l){return this.input=l,this.line=1,this.column=1,this.position=0,this.lastColumn=1,this.lastWidth=0,this}nextNode(){switch(this.peek()){case a:return;case 91:return this.parseOptional();case 93:this.reportError("Unexpected ']' with no corresponding '['.");case 63:return this.parseWildcard();case 124:return this.parseBoundaryAssertion();default:return this.parseLiteral()}}get done(){return this.position>=this.input.length}parseOptional(){const l=this.mark();this.next();const h=this.mark();this.done&&this.reportError("Unexpected unclosed '['.",l),this.accept("[")&&this.reportError("Unexpected nested optional node.",h);const d=this.nextNode();return d.kind===e.SyntaxKind.BoundaryAssertion&&this.reportError("Boundary assertions are not supported in this position; they are only allowed at the start / end of the pattern.",h),this.accept("]")||this.reportError("Unexpected unclosed '['."),{kind:e.SyntaxKind.Optional,childNode:d}}parseWildcard(){return this.next(),{kind:e.SyntaxKind.Wildcard}}parseBoundaryAssertion(){return this.next(),{kind:e.SyntaxKind.BoundaryAssertion}}parseLiteral(){const l=[];for(;!this.done;){if(this.accept("[]?|")){this.backup();break}const h=this.next();if(h===92){this.done&&(this.backup(),this.reportError("Unexpected trailing backslash."));const d=this.next();if(!r.includes(d)){const f=String.fromCodePoint(d);this.backup(),this.reportError(`Cannot escape character '${f}'; the only characters that can be escaped are the following: ${s}.`)}l.push(d)}else l.push(h)}return{kind:e.SyntaxKind.Literal,chars:l}}reportError(l,{line:h=this.line,column:d=this.column}={}){throw new i.ParserError(l,h,d)}mark(){return{line:this.line,column:this.column}}accept(l){const h=this.next(),d=new t.CharacterIterator(l);for(const f of d)if(f===h)return!0;return this.backup(),!1}peek(){const l=this.next();return this.backup(),l}next(){if(this.done)return a;const l=this.input.charCodeAt(this.position++);if(this.lastWidth=1,l===10)return this.lastColumn=this.column,this.column=1,this.line++,l;if(this.lastColumn=this.column++,!(0,n.isHighSurrogate)(l)||this.done)return l;const h=this.input.charCodeAt(this.position);return(0,n.isLowSurrogate)(h)?(this.position++,this.lastWidth++,(0,n.convertSurrogatePairToCodePoint)(l,h)):l}backup(){this.position-=this.lastWidth,this.column=this.lastColumn,this.lastWidth===1&&this.input.charCodeAt(this.position)===10&&this.line--}};return _i.Parser=o,_i}var Cu;function Pu(){if(Cu)return an;Cu=1,Object.defineProperty(an,"__esModule",{value:!0}),an.parseRawPattern=an.pattern=void 0;const n=m2(),t=new n.Parser;function e(r,...s){let a=r.raw[0];for(const[o,c]of s.entries())a+=c,a+=r.raw[o+1];return t.parse(a)}an.pattern=e;function i(r){return t.parse(r)}return an.parseRawPattern=i,an}var Da={},Si={},on={},Du;function Rr(){if(Du)return on;Du=1,Object.defineProperty(on,"__esModule",{value:!0}),on.createStatefulTransformer=on.createSimpleTransformer=void 0;function n(e){return{type:0,transform:e}}on.createSimpleTransformer=n;function t(e){return{type:1,factory:e}}return on.createStatefulTransformer=t,on}var Ti={},Nu;function g2(){if(Nu)return Ti;Nu=1,Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.CollapseDuplicatesTransformer=void 0;class n{constructor({defaultThreshold:e,customThresholds:i}){this.remaining=-1,this.lastChar=-1,this.defaultThreshold=e,this.customThresholds=i}transform(e){if(e===this.lastChar)return this.remaining-- >0?e:void 0;const i=this.customThresholds.get(e)??this.defaultThreshold;return this.remaining=i-1,this.lastChar=e,i>0?e:void 0}reset(){this.remaining=-1,this.lastChar=-1}}return Ti.CollapseDuplicatesTransformer=n,Ti}var Ru;function Ou(){if(Ru)return Si;Ru=1,Object.defineProperty(Si,"__esModule",{value:!0}),Si.collapseDuplicatesTransformer=void 0;const n=Ge(),t=Rr(),e=g2();function i({defaultThreshold:s=1,customThresholds:a=new Map}={}){const o=r(a);return(0,t.createStatefulTransformer)(()=>new e.CollapseDuplicatesTransformer({defaultThreshold:s,customThresholds:o}))}Si.collapseDuplicatesTransformer=i;function r(s){const a=new Map;for(const[o,c]of s){if(c<0)throw new RangeError("Expected all thresholds to be non-negative.");const l=(0,n.getAndAssertSingleCodePoint)(o);a.set(l,c)}return a}return Si}var vi={},Ai={},Bu;function Na(){if(Bu)return Ai;Bu=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.remapCharactersTransformer=void 0;const n=Ge(),t=Ca(),e=Rr();function i(s){const a=r(s);return(0,e.createSimpleTransformer)(o=>a.get(o)??o)}Ai.remapCharactersTransformer=i;function r(s){const a=new Map,o=s instanceof Map?s.entries():Object.entries(s);for(const[c,l]of o){const h=(0,n.getAndAssertSingleCodePoint)(c),d=new t.CharacterIterator(l);for(const f of d)a.set(f,h)}return a}return Ai}var Ei={},Lu;function p2(){return Lu||(Lu=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.confusables=void 0,Ei.confusables=new Map([[" "," "],["0","â“¿"],["1","â“µâžŠâ‘´Â¹ðŸðŸ™ï¼‘ðŸ·ðŸ£â’ˆðŸ­1âž€â‚â‘ â¶â¥ "],["2","â“¶â’‰â‘µâž‹Æ»Â²á’¿ðŸšï¼’ðŸ®ðŸ¤á’¾ðŸ¸Æ§ðŸâ‘¡á´¤â‚‚âžâ·á˜Æ¨"],["3","Â³â³Œêž«ðŸ‘â„¨ðŸ›ðŸ¯ðŸ¥êªâžŒÐ—Èœâ“·Ó Æ·ï¼“ðŸ¹â‘¶â’ŠÊ’Ê“Ç¯Ç®Æºð•´á¶¾Ð·á¦¡âž‚â‘¢â‚ƒá¶šá´£á´Ÿâ¸Ò˜Ò™Ó¬Ó¡Ó­ÓŸÓž"],["4","âžÒ¶áŽðŸœÒ·â“¸Ò¸Ò¹Ó´Óµá¶£ï¼”Ñ‡ã„©â´âžƒâ‚„â‘£â¹Ó‹â‘·â’‹"],["5","ðŸ±â“¹âžŽÆ¼ðŸ“ðŸ»ðŸðŸ§ï¼•âž„â‚…â‘¤âµâºÆ½â‘¸â’Œ"],["6","â³’á®ðŸžðŸ¨ðŸ”âžâ“ºÏ¬Ï­â¶Ð±ï¼–á§ˆâ‘¥âž…â‚†â»â‘¹â’"],["7","â“»ð“’âžï¼—â·â‘¦â‚‡â¼âž†â‘ºâ’Ž"],["8","ðŒšâž‘â“¼ï¼˜ðŸ ðŸªà§ªâ¸â‚ˆðŸ´âž‡â‘§â½ðŸ¾ðŸ–â‘»â’"],["9","ê®â³Šâ“½âž’à©§à§­à­¨ï¼™ðŸ«ðŸ¿ðŸ—â¹â‚‰Ô³âžˆâ‘¨â¾â‘¼â’"],["A","ðŸ„°áŽ¯ðŠ ð•¬ðœœð´ê“®áŽªðš¨ê­ºð–ðŸ…â„«âˆ€ðŸ‡¦â‚³ðŸ…°ð’œð˜ˆð€ð”¸Ð´Çºá—…â’¶ï¼¡Î‘á¾‹á—©Ä‚ÃƒÃ…ÇÈ€È‚Ä€ÈºÄ„ÊŒÎ›Î»Æ›á´€á´¬Ð”ÐáˆÃ„â‚á•±ÂªÇžÓ’Î†áº áº¢áº¦áº¨áº¬áº®áº°áº²áº´áº¶á¾¸á¾¹á¾ºá¾»á¾¼á¾ˆá¾‰á¾Šá¾Œá¾á¾Žá¾á¼ˆá¼‰á¼Šá¼‹á¼Œá¼á¼Žá¼á¸€È¦Ç ÓÃ€ÃÃ‚áº¤áºªð›¢ð“ð™°ð˜¼"],["a","âˆ‚âºâ“Õ±ÇŸáµƒá¶â’œÐ°É’ï½Î±ÈƒÈà¸„ÇŽáƒ›Ã¤É‘ÄÉÄ…á¾„áºšáº¡áº£Ç¡áº§áºµá¸È§Ó‘Ó“Ã£Ã¥Î¬á½°á½±Äƒáº©áº±áº³áº·á¾€á¾á¾‚á¾ƒá¾…á¾†á¾°á¾±á¾²á¾³á¾´á¶á¾¶á¾·á¼€á¼á¼‚á¼ƒá¼„á¼…á¼†á¼‡á¾‡áº­áº¯Ã Ã¡Ã¢áº¥áº«Ç»â±¥ðšð‘Žð’‚ð’¶ð“ªð”žð•’ð–†ð–ºð—®ð˜¢ð™–ðšŠð›‚ð›¼ðœ¶ð°ðžªâ¶"],["B","ðŒð‘©ð•­ðŸ„±ðŠ¡ð–¡ð˜½ê“ð—•ð˜‰ðœðŠ‚ðš©ðð›£ð—ðµð™±ð”¹á´á¼ðž‘êž´ð”…ðŸ…‘à¸¿ð“‘á—¿á—¾á—½ðŸ…±â’·ï¼¢Ð²Ïá—·Æä¹ƒÃŸáƒªáƒ©à¹–Î²É®Ð‘Õ…à¹’á™–Ê™á´®áµ‡áŒŒá¸„â„¬Î’Ð’áºžá¸‚á¸†Éƒà´¦á—¹á—¸áµá™žá™Ÿá™á›’á™—á™˜á´ƒðŸ‡§"],["b","áð›ð˜£ð’·ð”Ÿð“«ð–‡ð–»ð‘ð™—ð•“ð’ƒð—¯ðš‹â™­á‘³á’ˆï½‚á–šá•¹á•ºâ“‘á¸ƒá¸…ÒÑŠá¸‡ÆƒÉ“Æ…á–¯Æ„Ð¬á‘²Ã¾Æ‚â’Ðªá¶€á‘¿á’€á’‚á’á‘¾ÑŒÆ€ÒŒÑ¢Ñ£á”Ž"],["C","áŸâ²¤ðŸ„²ê“šðŠ¢ðŒ‚ðŸ…²ð•ðŸ…’â˜¾ÄŒÃ‡â’¸ï¼£â†ƒÆ‡á‘•ã„ˆÂ¢à¥®â†»ÄˆÏ¾Õ‡È»á™…á¶œâ’žÄ†Ò€ÄŠÂ©à¤ŸÆ†â„‚â„­Ï¹Ð¡åŒšá¸ˆÒªÊ—á‘–á‘¡á‘¢á‘£á‘¤á‘¥â…­ð‚ð¶ð‘ªð’žð“’ð•®ð–¢ð—–ð˜Šð˜¾á”"],["c","â²¥ð½ê®¯Ä‰ï½ƒâ“’Ä‡ÄÄ‹Ã§ÒÆˆá¸‰È¼â†„Ñáˆ­á´„Ï²Ò«ê’Ï‚É½Ï›ð™²á‘¦á§šðœð‘ð’„ð’¸ð“¬ð” ð•”ð–ˆð–¼ð—°ð˜¤ð™˜ðšŒâ‚µðŸ‡¨á¥´á’¼â…½"],["D","áŽ ðŸ„³ð”¡ð–‰ð”»ð——ð˜‹ð™³ð·ð““ðƒð‘«ð•¯ð–£ð”‡ð˜¿ê­°â……ð’Ÿê““ðŸ…³ðŸ…“â’¹ï¼¤Æ‰á—ªÆŠÃÔºá´…á´°â†á¸ŠÄÃžâ…®á—žá‘¯ÄŽá¸Œá¸á¸’á¸Žá—«á—¬á—Ÿá— á¶›á´†ðŸ‡©"],["d","á§ê“’ð“­áµ­â‚«Ôƒâ““ï½„á¸‹Äá¸á¸‘á¸“á¸Ä‘ÆŒÉ–É—áµˆâ’ŸÔâ…¾á¶Ô€á‘ºá‘»á‘¼á‘½á’„á‘°á‘±á¶‘ð••ð–½ð‘‘ð˜¥ð’…ð™™ðð—±ðšâ…†ð’¹Ê Õª"],["E","ê­¼ðŸ„´ð™€ð”¼ðŠ†ðš¬ê“°ðšðž”ð“”ð‘¬ð—˜ðŸ…´ðŸ…”â’ºÎˆï¼¥ÆŽá¼á•®Æãƒ¢Ð„á´‡á´±áµ‰Ã‰ä¹‡ÐÉ†ê‚…â‚¬Ãˆâ„°Î•Ð•â´¹áŽ¬Ä’Ä”Ä–Ä˜ÄšÃŠÃ‹Ôá»€áº¾á»„á»‚áº¼á¸”á¸–áººÈ„È†áº¸á»†È¨á¸œá¸˜á¸šá¼˜á¼™á¼šá¼›á¼œá¿ˆá¿‰Ó–á½²á½³Ð€ÏµðŸ‡ª"],["e","ð‘’ð“®ð•–ð–Šð˜¦ð—²ðšŽð™šð’†ð”¢ð–¾ðžÒ¾Ò¿â“”ï½…â’ Ã¨á§‰Ã©á¶’ÃªÉ˜á¼”á»áº¿á»…à«¯ÇÑ”ÎµÄ“Ò½É›á»ƒáº½á¸•á¸—Ä•Ä—Ã«áº»Ä›È…È‡áº¹á»‡È©É‡â‚‘Ä™á¸á¸™á¸›â„®ÐµÔ‘ÑÓ—á¥±Ñ‘á¼á¼‘á¼’á¼“á¼•â„¯"],["F","ðŸ„µðŠ‡ð”‰ð˜ðŠ¥ê“êž˜ðŸ…µðŸ…•ð“•â’»ï¼¦Ò“Ò’á–´Æ‘Ô²Ïá‰»á¸žâ„±Ïœâ‚£ðŸ‡«â„²"],["f","ðŸð–‹â“•ï½†Æ’á¸ŸÊƒÕ¢á¶ â’¡Å¿êŠ°Ê„âˆ±á¶‚ð˜§"],["G","ê“–á³ðŸ„¶á€á»ð”¾ð“–ð‘®ð•²ê®ð’¢ð™‚ð–¦ð™¶ð”Šðºð†ðŸ…¶ðŸ…–â’¼ï¼§É¢Æ“Ê›Ä¢á˜œá´³Ç´Ä ÔŒÄœá¸ ÄžÇ¦Ç¤Ôâ‚²ðŸ‡¬â…"],["g","â“–ï½‡ÇµÄá¸¡ÄŸÄ¡Ç§Ä£Öà«­Ç¥É ï»­ï»®áµâ’¢â„ŠÉ¡á§ð ð‘”ð’ˆð“°ð”¤ð•˜ð–Œð—€ð—´ð˜¨ð™œðš"],["H","ðŸ„·ðœ¢ê“§ð˜ð»ðœð–§ð‹ð—›ê®‹â„áŽ»â„Œâ²Žð‘¯ðž–ðŸ…·ðŸ…—á‹žÇ¶Ô‹â’½ï¼¨Ä¤ášºá¸¢á¸¦Èžá¸¤á¸¨á¸ªÄ¦â±§Ò¢Ò£Ò¤á¿Šá¿‹á¿Œá¼¨á¼©á¼ªá¼«á¼­á¼®á¼¯á¾˜á¾™á¾šá¾›á¾œá¾á¾žá¾ŸÓ‰ÓˆÒ¥Î‰Ð½å„â™“ð“—â„‹Ðð‡ð™ƒð™·Êœð›¨Î—ðš®á•¼Ó‡á´´áµ¸ðŸ‡­"],["h","Òºâ’£Ñ’â“—ï½ˆÄ¥á¸£á¸§ÈŸá¸¥á¸©á¸«áº–Ä§â±¨Õ°Ò»áŠ¨áŠ©áŠªáŠ«É¦â„Žð¡ð’‰ð’½ð“±ð”¥ð•™ð–ð—ð—µð˜©ð™ðš‘Õ«Ê°á‘‹á—É§ã‚“É¥"],["I","ðŸ„¸Ð‡ê€¤á†ðŸ…¸ðŸ…˜Ø¥ïº‡Ù³Ø£ïºƒÙ²Ùµâ’¾ï¼©áŸ¸ÃŒÃÃŽÄ¨ÄªÄ¬Ä°Ãá¸®á»ˆÇÈˆÈŠá»ŠÄ®á¸¬Æ—ã‚§ã‚¨á¿˜á¿™á¿šá¿›á¼¸á¼¹á¼ºá¼»á¼¼á¼½á¼¾â… ÎªÎŠÉªá¶¦á‘Šá¥£ð›ªðˆð™„ð™¸ð“µð™¡ð¼á´µðš°ð‘°ðŸ‡®"],["i","â“˜ï½‰Ã¬Ã­Ã®Ä©Ä«Ä­Ã¯á¸¯á»‰ÇÈ‰È‹á»‹á¸­á¿á¿‘á¿’á¿“á¿–á¿—á¼°á¼±á¼²â…°â…¼âˆ£âµï¿¨×€Ø§Ù¡Û±ßŠá›á¼³á¼´á¼µÉ¨Ñ–á½¶á½·á¶–ð”¦ðš’ð¸ð—‚ð¢ð•šð–Žð—¶ð˜ªð™žÎ¯â±áµ¢ð“²â’¤"],["J","ðŸ„¹ðŸ…¹ðŸ…™â’¿ï¼ªÐˆÊá’× ï¾ŒÄ´Ê†à¸§Ù„ÕµÊ–á´Šá´¶ï»áŒ‹Éˆâ±¼Õ‚à¹…á‚±Ä¯áŽ«È·ä¸¿â„â„‘á’˜á’™á’šá’›á’´á’µá’Žá’ðŸ‡¯"],["j","â“™ï½ŠÏ³Ê²â’¥É‰ÄµÇ°Ñ˜Ú¶á¶¨ð’¿ð˜«ð—·ð‘—ð™Ÿð”§ð’‹ð—ƒð“³ð•›ðš“ð–ð£"],["K","ð—žðŸ„ºðœ¥ð˜’ê“—ð™†ð•‚â²”ð”Žð›«á¦ðž™ð’¦ðŸ…ºðŸ…šâ‚­â“€ï¼«Ä¸á¸°ÑœÆ˜ÐºÒ ÎºÒ›ÒŸÓ„ÊžÒšÐšÒ¡á´‹á´·áµâ’¦á›•ÐŒáŒ•á¸²Îšâ„ªÒœÒÒžÄ¶á¸´Ç¨â±©Ï—ÓƒðŸ‡°"],["k","â“šï½‹á¸±Ç©á¸³Ä·á¸µÆ™â±ªá¶„ð¤ð˜¬ð—„ð•œðœ…ðœ˜ðœ¿ð’ð¹ðžŒðž³ð™ ðš”ð‘˜ð’ŒÏ°ð›‹ð›žðŸ†ð—¸ð“´ð“€"],["L","ðŸ„»ð›â³ð‘³ð™»ð‘ƒð“›â³‘ê®®ážê“¡ðŸ…»ðŸ…›ïºˆâ””â“Ö‚ï¼¬Ä¿á’ªä¹šÕ†ÊŸê“¶Î¹Ô¼á´¸Ë¡Ä¹áˆ¨á¸¶â‚—Î“Õ¬Ä»á„‚â…¬â„’â±¢á¥§á¥¨á’»á’¶á’·á¶«ïºŽá’ºá’¹á’¸á’«âŽ³ã„¥Åâ± ïº„È½ðŸ‡±"],["l","â“›ï½ŒÅ€ÄºÄ¾á¸·á¸¹Ä¼Ó€â„“á¸½á¸»Å‚ï¾šÉ­ÆšÉ«â±¡|Æ–â’§Ê…Ç€×•×ŸÎ™Ð†ï½œá¶©Óð“˜ð•€ð–¨ð—œð˜ð¥ð‘™ð’ð“ð”©ð•ð–‘ð—…ð—¹ð˜­ðš•ðœ¤ðžÄ±ðš¤É©á¾¾ð›Šðœ„ðœ¾ðž²"],["M","ðŸ„¼ðŒ‘ðŠ°ê“Ÿâ²˜áŽ·ðŸ…¼ðŸ…œâ“‚ï¼­Ð¼á¹‚àµ±á—°å·žá˜»áƒà¹“â™Êá™á´á´¹áµâ’¨á¸¾Ðœá¹€à¯±â…¯â„³ÎœÏºá›–ÓÓŽðŒð‘€ð‘´ð“œð”ð•„ð•¸ð–¬ð— ð˜”ð™ˆð™¼ðš³ð›­ðœ§ð¡ðž›ðŸ‡²"],["m","â‚¥áµ¯ð–’ð¦ð—†ð”ªð•žð“‚â“œï½à´¨á™¢àµ©á¸¿á¹â…¿Ï»á¹ƒáŒ É±áŸ³á¶†ð™¢ð“¶ðš–ð‘šð—ºá§•á§—"],["N","ðŸ„½â„•ê“ ð›®ð¢ð™½ðš´ð‘µð‘â²šðð’©ðžœð—¡ð˜•ðœ¨ð“ð–­ðŸ…½â‚¦ðŸ…Ð™Ðâ“ƒÒ‹áŸ·ï¼®á´ŽÉ´Æá‘Žå‡ Ð¸ÕˆÕ¼Ð˜×”Ð›Ï€á´ºá¶°Åƒåˆ€áŠ­á¹„â¿Ã‘ÐŸÎá´¨Õ¸Ï–Ç¸Å‡á¹†Å…á¹Šá¹ˆà¸—ÅŠÓ¢Ó£Ó¤Ó¥Ñ›ÑÐ¹á¥¢ÒŠá´»ðŸ‡³"],["n","×—ð’ð“·ð™£ð‘›ð–“ð”«ð—‡ðš—ð—»á¥’â“Î®ï½ŽÇ¹á´’Å„Ã±á¾—Î·á¹…Åˆá¹‡É²Å†á¹‹á¹‰Õ²àº–ÕŒÆžÅ‹â’©à¸ à¸É³Ð¿Å‰Ð»Ô‰È á¼ á¼¡á¿ƒÕ¤á¾á¾‘á¾’á¾“á¾”á¾•á¾–á¿„á¿†á¿‡á¿‚á¼¢á¼£á¼¤á¼¥á¼¦á¼§á½´á½µá‰ á‰¡á‰¢á‰£á‰¤á‰¥á‰¦Èµð›ˆðœ‚ðœ¼ð¶ðž°ð•Ÿð˜¯ð§ð“ƒá¶‡áµ°á¥¥âˆ©"],["O","ê„²ðŸ„¾ðŠ’ðŸ¬ê“³â²žð„ðŠ«ð“‚ðžžðŸ…žâ¥â—¯âµâŠ–ï¼âŠð¤Ñ²Ï´ðš¶ðœªÑºÓ¦Ó¨ÓªÎŒÊ˜ðŽÇ‘Ã’ÅŽÃ“Ã”Ã•ÈŒÈŽã‡¿ââ“„ï¼¯á½‹ãƒ­â¤à«¦âŠ•Ã˜Ð¤Ô¾Î˜Æ á´¼áµ’â’ªÅÃ–â‚’Â¤â—ŠÎ¦ã€‡ÎŸÐžÕ•à¬ à´ à¯¦×¡á»’á»á»–á»”á¹ŒÈ¬á¹ŽÅŒá¹á¹’È®È°Èªá»Žá»œá»šá» á»žá»¢á»Œá»˜ÇªÇ¬Ç¾ÆŸâµ”ß€áŸ°âœâŽ”âŽ•â¦°â¦±â¦²â¦³â¦´â¦µâ¦¶â¦·â¦¸â¦¹â¦ºâ¦»â¦¼â¦½â¦¾â¦¿â§€â§â§‚â§ƒá½ˆá½‰á½Šá½Œá½"],["o","ðš˜ð›ð—ˆðž¼á€â²Ÿð™¤á€ð¬ð”¬ð“ªð“¸ðŸ‡´â¤â—‹Ï™ðŸ…¾ð’ªð–®ðŸ¢ðŸ¶ð™¾ð˜°ð—¼ð• ðœŠð¨ð¾ðž¸á¤â“žÑ³á§á¥²Ã°ï½à° á¦žÕ“Ã²Ó©Ó§Ã³ÂºÅÃ´Ç’ÈÅá»“á»‘Èá»—á»•ÃµÏƒá¹È­á¹á½„á¹‘á¹“È¯È«à¹á´Å‘Ã¶Ñ»Ð¾á‹Ç­È±à§¦à­¦Ù¥à±¦à³¦àµ¦à¹à»Î¿Ö…á´‘à¥¦à©¦á»Æ¡á»á»›á»¡á»Ÿá»£á»á»™Ç«Ã¸Ç¿ÉµÕ®á½€á½ÏŒá½¸á½¹á½‚á½ƒá½…"],["P","ðŸ„¿ê“‘ðš¸ð™¿ðž ð™‹ê®²â²¢ð’«ð¦ð‘ƒð‘·ð—£ððŠ•ðœ¬ð˜—ð“Ÿð–¯ð›²á¢ðŸ…ŸÒŽðŸ…¿â“…ï¼°Æ¤á‘­å°¸á¹–Ö€Ï†Ö„á´˜á´¾áµ–â’«á¹”ï½±×§Ð á‹¨á´©â±£â„™Î¡á¿¬á‘¸á‘¶á‘·á‘¹á‘¬á‘®ðŸ‡µâ‚±"],["p","Òâ„—â“Ÿï½á¹•á¹—Æ¥áµ½á¿¥ÏÑ€Æ¿Ç·á¿¤â´ð“¹ð“…ð©ð‘ð’‘ð”­ð•¡ð–•ð—‰ð—½ð˜±ð™¥ðš™ð›’ð†ðžºðœŒðž€"],["Q","ðŸ…€ðŸ†€ðŸ… â“†ï¼±â„šâµ•Ôšðð‘„ð‘¸ð’¬ð“ ðš€ð˜˜ð™Œð–°ð•¼ð””ð—¤ðŸ‡¶"],["q","â“ ï½‘Õ£â’¬Û¹Õ¦á‘«É‹ÉŠÔ›ð—Šð‘žð˜²ð•¢ðššð’’ð––ðªð”®ð“ºð™¦"],["R","â„žâ„Ÿê­±á’ð’´ê®¢áŽ¡ê“£ðŸ†ðŸ…¡â“‡ï¼²á´™È’Ê€á–‡Ñå°ºÅ”Ð¯àª°Æ¦á´¿á‹ªá¹šÉŒÊâ„›â„œâ„á¹˜Å˜Èá¹œÅ–á¹žâ±¤ð‘ð‘…ð‘¹ð“¡ð•½ð–±ð—¥ð˜™ð™ðšáš±ðŸ‡·á´š"],["r","â“¡ï½’Å•á¹™Å™È‘È“á¹›á¹Å—Ð³ÕÉ¾á¥¬á¹ŸÉÊ³â’­É¼Ñ“á´¦á¶‰ð«ð‘Ÿð’“ð“‡ð“»ð”¯ð•£ð–—ð—‹ð—¿ð˜³ð™§áµ²Ò‘áµ£"],["S","ðŸ…‚ê‡™ð“¢ð—¦ášð’®á•ðš‚ð’ê“¢ð–²ð”–ð™ŽðŠ–ð•¾ð ð˜šð•Šð‘†ð‘ºðŸ†‚ðŸ…¢â“ˆï¼³á¹¨ÅžÖ†ÕÈ˜Ë¢â’®Ð…á¹ Å Åšá¹¤Åœá¹¦á¹¢à´Ÿá”•á”–á”¢á”¡á”£á”¤"],["s","â“¢êœ±ð‘ˆê®ªï½“Å›á¹¥Åá¹¡Å¡á¹§Ê‚á¹£á¹©Ñ•ÅŸÈ™È¿á¶Šà°•ð¬ð‘ ð’”ð“ˆð“¼ð”°ð•¤ð–˜ð—Œð˜€ð˜´ð™¨ðšœÞŽðŸ‡¸"],["T","ðŸ…ƒðŸ†ƒðŒ•ðš»ð›µð•‹ð•¿ð‘»ðŠ±ðŠ—ð–³ð™ðŸ¨ð©ðž£ðšƒð˜›ð‘‡ê“”âŸ™ð“â²¦ð—§âŠ¤ð”—áŽ¢ê­²ð’¯ðŸ…£â‡â‰â“‰ï¼´Ñ‚Ò¬Ò­Æ¬ã‚¤Å¦ÔµÏ„á´›áµ€ï½²á•Ï®Å¤âŠ¥Æ®Î¤Ð¢ä¸‹á¹ªá¹¬ÈšÅ¢á¹°á¹®ä¸…ä¸áªð›•ðœð‰ðžƒðž½ð“£ã„’ðŸ‡¹áŒ¥"],["t","â“£ï½”á¹«áº—Å¥á¹­È›È¶à©®Õ§Ê‡â€ Å£á¹±á¹¯Æ­Å§áµ—â’¯ÊˆÕ¥Æ«ð­ð‘¡ð’•ð“‰ð“½ð”±ð•¥ð–™ð—ð˜ð˜µð™©ðšãƒŠ"],["U","ðŸ…„ê“´ð“Žê’¤ðŸ†„ðŸ…¤Å¨Å¬Å®á‘—á‘˜Ç“Ç•Ç—Ç™â“Šï¼µÈ–á‘Œå‡µÆ±Õ´Ô±ê“µÐ¦ÅªÕ„Æ²á™€áµáµ˜â’°Å°àªªÃœÕÃ™ÃšÃ›á¹¸á¹ºÇ›á»¦È”Æ¯á»ªá»¨á»®á»¬á»°á»¤á¹²Å²á¹¶á¹´É„á¥©á‘§âˆªá˜®â‹ƒð”ð‘ˆð‘¼ð’°ð“¤ð”˜ð•Œð–€ð–´ð—¨ð˜œð™ðš„ðŸ‡º"],["u","á½ºá½»â“¤ï½•Ã¹Å©Å«á»«á¹·á¹¹Å­Ç–á»¯á¥™ÇšÇœá½—Ï…Î°à¸™Õ½ÊŠÇ˜Ç”ÃºÅ¯á´œÅ±Å³à¸¢Ã»á¹»Ñ†áˆÃ¼áµ¾áµ¤ÂµÊ‹á»§È•È—Æ°á»©á»­á»±á»¥á¹³á¹µÊ‰á¿ á¿¡á¿¢á¿£á¿¦á¿§á½á½‘Ï‹Ïá½’á½“á½”á½•á½–á¥”ð®ð‘¢ð’–ð“Šð“¾ð”²ð•¦ð–šð—Žá¶™"],["V","ðŸ……ê“¦ð‘½ð–µð˜á™ðš…ð™‘ð•ðŸ†…ðŸ…¥â“‹ï¼¶á¯Ñ´áµ›â’±Û·á¹¾â…´â…¤á¹¼Ù§â´¸Ñ¶áºá»ðŸ‡»ð“¥"],["v","áˆ€â“¥ï½–ðœðŠá¹½á¹¿à±®à¸‡Ñµ×¢á´ Î½×˜áµ¥Ñ·áŸ´á˜ð™«ðšŸð›Žðœˆð‚ð¼ðž¶ð˜·ð˜ƒð“¿"],["W","ðŸ…†á”áŽ³ð‘¾ê“ªð’²ð˜žðŸ††â“ŒðŸ…¦ï½—ï¼·áº‚á¾§á—¯á¥•å±±Ñ àºŸà°šÕ¡Ð©Ð¨ÏŽÑ‰à¸¬Ñˆá™Žáµ‚Ê·â’²à¸áˆ áº„Ôœáº€Å´áº†áºˆà´§á˜ºÑ¿á™¡Æœâ‚©ðŸ‡¼"],["w","áºê®ƒáºƒâ“¦âµÅµáº‡áº…áº˜áº‰â±³á½¼á½ á½¡á½¢á½£Ï‰á½¤á½¥á½¦á½§á¿²á¿³á¿´á¿¶á¿·â±²Ñ¡Ôá´¡á½½á¾ á¾¡á¾¢á¾£á¾¤á¾¥á¾¦É¯ð•ðŸ‰ðž"],["X","ðŸž¨ðŸž©ðŸžªðŸ…‡ðŸž«ðŸž¬ðŒ—â²¬ê“«ð–ƒðž¦ð˜ŸðŠðš¾ð¬ðœ²êž³ðŒ¢ð–·ð‘‹ð•ð”›ðŠ´ð—«ðŸ†‡ðŸ…§âŒâ“ð“§ï¼¸áºŠá™­Ï‡ã„¨ð’³Ó¾áƒ¯Ó¼Ò³Ð–Î§Ò²áµ¡Ë£â’³×áˆ¸áºŒêŠ¼â…©Ð¥â•³á™®á•á•½â…¹áš·âµð™“ðš‡ä¹‚ð—ðŸ‡½"],["x","â“§ï½˜Ñ…áº‹Ã—â‚“â¤«â¤¬â¨¯áºá¶ð™­Ó½ð˜¹ð±ðš¡â¨°ï¾’ð”"],["Y","â²¨ðšˆð‘Œð—¬ð˜ê“¬ð’€ðœ°ðŠ²ðŸ†ˆðŸ…¨â“Žï¼¹á½›Æ³ã„šÊâ…„Ï”ï¿¥Â¥ÕŽÏ“Î³×¥Ó²Ð§ÐŽáˆƒÅ¸ÉŽÏ¤Î¥Ï’Ò®á»²ÃÅ¶á»¸È²áºŽá»¶á»´á¿¨á¿©á¿ªá¿«á½™á½á½ŸÎ«ÎŽÓ®Ó°Ò°Ò±ð•ðŸ‡¾"],["y","ðŸ…ˆáŽ½áŽ©â“¨ï½™á»³Ã½Å·á»¹È³áºÃ¿á»·Ñƒáƒ§áº™á»µÆ´ÉáµžÉ£Ê¸á¶ŒÒ¯â’´Ó³Ó±Ó¯ÑžÐ£ÊŽ"],["Z","ðŸ…‰ê“œð—­ð™â˜¡áƒð˜¡ðŸ†‰ðŸ…©â“ï¼ºáº”Æµä¹™áºÈ¤á¶»â’µÅ¹â„¤Î–Å»Å½áº’â±«ðŸ‡¿"],["z","ê®“â“©ï½šÅºáº‘Å¼Å¾áº“áº•Æ¶È¥É€á´¢áŒŠÊâ±¬á¶ŽÊ‘á™†"]])),Ei}var zu;function Uu(){if(zu)return vi;zu=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.resolveConfusablesTransformer=void 0;const n=Na(),t=p2();function e(){return(0,n.remapCharactersTransformer)(t.confusables)}return vi.resolveConfusablesTransformer=e,vi}var ki={},Mi={},Wu;function y2(){return Wu||(Wu=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.dictionary=void 0,Mi.dictionary=new Map([["a","@4"],["c","("],["e","3"],["i","1|!"],["g","6"],["o","0"],["s","$5"],["t","7"],["z","2"]])),Mi}var $u;function Fu(){if($u)return ki;$u=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.resolveLeetSpeakTransformer=void 0;const n=Na(),t=y2();function e(){return(0,n.remapCharactersTransformer)(t.dictionary)}return ki.resolveLeetSpeakTransformer=e,ki}var Ii={},qu;function ju(){if(qu)return Ii;qu=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.toAsciiLowerCaseTransformer=void 0;const n=Ge(),t=Rr();function e(){return(0,t.createSimpleTransformer)(i=>(0,n.isUpperCase)(i)?(0,n.invertCaseOfAlphabeticChar)(i):i)}return Ii.toAsciiLowerCaseTransformer=e,Ii}var Hu;function b2(){return Hu||(Hu=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.englishDataset=n.englishRecommendedTransformers=n.englishRecommendedWhitelistMatcherTransformers=n.englishRecommendedBlacklistMatcherTransformers=void 0;const t=wu(),e=Pu(),i=Ou(),r=Uu(),s=Fu(),a=ju();n.englishRecommendedBlacklistMatcherTransformers=[(0,r.resolveConfusablesTransformer)(),(0,s.resolveLeetSpeakTransformer)(),(0,a.toAsciiLowerCaseTransformer)(),(0,i.collapseDuplicatesTransformer)({defaultThreshold:1,customThresholds:new Map([["b",2],["e",2],["o",2],["l",2],["s",2],["g",2]])})],n.englishRecommendedWhitelistMatcherTransformers=[(0,a.toAsciiLowerCaseTransformer)(),(0,i.collapseDuplicatesTransformer)({defaultThreshold:Number.POSITIVE_INFINITY,customThresholds:new Map([[" ",1]])})],n.englishRecommendedTransformers={blacklistMatcherTransformers:n.englishRecommendedBlacklistMatcherTransformers,whitelistMatcherTransformers:n.englishRecommendedWhitelistMatcherTransformers},n.englishDataset=new t.DataSet().addPhrase(o=>o.setMetadata({originalWord:"abo"}).addPattern((0,e.pattern)`|ab[b]o[s]|`)).addPhrase(o=>o.setMetadata({originalWord:"abeed"}).addPattern((0,e.pattern)`ab[b]eed`)).addPhrase(o=>o.setMetadata({originalWord:"africoon"}).addPattern((0,e.pattern)`africoon`)).addPhrase(o=>o.setMetadata({originalWord:"anal"}).addPattern((0,e.pattern)`|anal`).addWhitelistedTerm("analabos").addWhitelistedTerm("analagous").addWhitelistedTerm("analav").addWhitelistedTerm("analy").addWhitelistedTerm("analog").addWhitelistedTerm("an al").addPattern((0,e.pattern)`danal`).addPattern((0,e.pattern)`eanal`).addPattern((0,e.pattern)`fanal`).addWhitelistedTerm("fan al").addPattern((0,e.pattern)`ganal`).addWhitelistedTerm("gan al").addPattern((0,e.pattern)`ianal`).addWhitelistedTerm("ian al").addPattern((0,e.pattern)`janal`).addWhitelistedTerm("trojan al").addPattern((0,e.pattern)`kanal`).addPattern((0,e.pattern)`lanal`).addWhitelistedTerm("lan al").addPattern((0,e.pattern)`lanal`).addWhitelistedTerm("lan al").addPattern((0,e.pattern)`oanal|`).addPattern((0,e.pattern)`panal`).addWhitelistedTerm("pan al").addPattern((0,e.pattern)`qanal`).addPattern((0,e.pattern)`ranal`).addPattern((0,e.pattern)`sanal`).addPattern((0,e.pattern)`tanal`).addWhitelistedTerm("tan al").addPattern((0,e.pattern)`uanal`).addWhitelistedTerm("uan al").addPattern((0,e.pattern)`vanal`).addWhitelistedTerm("van al").addPattern((0,e.pattern)`wanal`).addPattern((0,e.pattern)`xanal`).addWhitelistedTerm("texan al").addPattern((0,e.pattern)`yanal`).addPattern((0,e.pattern)`zanal`)).addPhrase(o=>o.setMetadata({originalWord:"anus"}).addPattern((0,e.pattern)`anus`).addWhitelistedTerm("an us").addWhitelistedTerm("tetanus").addWhitelistedTerm("uranus").addWhitelistedTerm("janus").addWhitelistedTerm("manus")).addPhrase(o=>o.setMetadata({originalWord:"arabush"}).addPattern((0,e.pattern)`arab[b]ush`)).addPhrase(o=>o.setMetadata({originalWord:"arse"}).addPattern((0,e.pattern)`|ars[s]e`).addWhitelistedTerm("arsen")).addPhrase(o=>o.setMetadata({originalWord:"ass"}).addPattern((0,e.pattern)`|ass`).addWhitelistedTerm("assa").addWhitelistedTerm("assem").addWhitelistedTerm("assen").addWhitelistedTerm("asser").addWhitelistedTerm("asset").addWhitelistedTerm("assev").addWhitelistedTerm("assi").addWhitelistedTerm("assoc").addWhitelistedTerm("assoi").addWhitelistedTerm("assu")).addPhrase(o=>o.setMetadata({originalWord:"bastard"}).addPattern((0,e.pattern)`bas[s]tard`)).addPhrase(o=>o.setMetadata({originalWord:"bestiality"}).addPattern((0,e.pattern)`be[e][a]s[s]tial`)).addPhrase(o=>o.setMetadata({originalWord:"bitch"}).addPattern((0,e.pattern)`bitch`).addPattern((0,e.pattern)`bich|`)).addPhrase(o=>o.setMetadata({originalWord:"blowjob"}).addPattern((0,e.pattern)`b[b]l[l][o]wj[o]b`)).addPhrase(o=>o.setMetadata({originalWord:"bollocks"}).addPattern((0,e.pattern)`bol[l]ock`)).addPhrase(o=>o.setMetadata({originalWord:"boob"}).addPattern((0,e.pattern)`boob`)).addPhrase(o=>o.setMetadata({originalWord:"boonga"}).addPattern((0,e.pattern)`boonga`).addWhitelistedTerm("baboon ga")).addPhrase(o=>o.setMetadata({originalWord:"buttplug"}).addPattern((0,e.pattern)`buttplug`)).addPhrase(o=>o.setMetadata({originalWord:"chingchong"}).addPattern((0,e.pattern)`chingchong`)).addPhrase(o=>o.setMetadata({originalWord:"chink"}).addPattern((0,e.pattern)`chink`).addWhitelistedTerm("chin k")).addPhrase(o=>o.setMetadata({originalWord:"cock"}).addPattern((0,e.pattern)`|cock|`).addPattern((0,e.pattern)`|cocks`).addPattern((0,e.pattern)`|cockp`).addPattern((0,e.pattern)`|cocke[e]|`).addWhitelistedTerm("cockney")).addPhrase(o=>o.setMetadata({originalWord:"cuck"}).addPattern((0,e.pattern)`cuck`).addWhitelistedTerm("cuckoo")).addPhrase(o=>o.setMetadata({originalWord:"cum"}).addPattern((0,e.pattern)`|cum`).addWhitelistedTerm("cumu").addWhitelistedTerm("cumb")).addPhrase(o=>o.setMetadata({originalWord:"cunt"}).addPattern((0,e.pattern)`|cunt`).addPattern((0,e.pattern)`cunt|`)).addPhrase(o=>o.setMetadata({originalWord:"deepthroat"}).addPattern((0,e.pattern)`deepthro[o]at`).addPattern((0,e.pattern)`deepthro[o]t`)).addPhrase(o=>o.setMetadata({originalWord:"dick"}).addPattern((0,e.pattern)`|dck|`).addPattern((0,e.pattern)`dick`).addWhitelistedTerm("benedick").addWhitelistedTerm("dickens")).addPhrase(o=>o.setMetadata({originalWord:"dildo"}).addPattern((0,e.pattern)`dildo`)).addPhrase(o=>o.setMetadata({originalWord:"doggystyle"}).addPattern((0,e.pattern)`d[o]g[g]ys[s]t[y]l[l]`)).addPhrase(o=>o.setMetadata({originalWord:"double penetration"}).addPattern((0,e.pattern)`double penetra`)).addPhrase(o=>o.setMetadata({originalWord:"dyke"}).addPattern((0,e.pattern)`dyke`).addWhitelistedTerm("van dyke")).addPhrase(o=>o.setMetadata({originalWord:"ejaculate"}).addPattern((0,e.pattern)`e[e]jacul`).addPattern((0,e.pattern)`e[e]jakul`).addPattern((0,e.pattern)`e[e]acul[l]ate`)).addPhrase(o=>o.setMetadata({originalWord:"fag"}).addPattern((0,e.pattern)`|fag`).addPattern((0,e.pattern)`fggot`)).addPhrase(o=>o.setMetadata({originalWord:"felch"}).addPattern((0,e.pattern)`fe[e]l[l]ch`)).addPhrase(o=>o.setMetadata({originalWord:"fellatio"}).addPattern((0,e.pattern)`f[e][e]llat`)).addPhrase(o=>o.setMetadata({originalWord:"finger bang"}).addPattern((0,e.pattern)`fingerbang`)).addPhrase(o=>o.setMetadata({originalWord:"fisting"}).addPattern((0,e.pattern)`fistin`)).addPhrase(o=>o.setMetadata({originalWord:"fuck"}).addPattern((0,e.pattern)`f[?]ck`).addPattern((0,e.pattern)`|fk`).addPattern((0,e.pattern)`|fu|`).addPattern((0,e.pattern)`|fuk`).addWhitelistedTerm("fick").addWhitelistedTerm("kung-fu").addWhitelistedTerm("kung fu")).addPhrase(o=>o.setMetadata({originalWord:"gangbang"}).addPattern((0,e.pattern)`g[?]ngbang`)).addPhrase(o=>o.setMetadata({originalWord:"handjob"}).addPattern((0,e.pattern)`h[?]ndjob`)).addPhrase(o=>o.setMetadata({originalWord:"hentai"}).addPattern((0,e.pattern)`h[e][e]ntai`)).addPhrase(o=>o.setMetadata({originalWord:"hooker"}).addPattern((0,e.pattern)`hooker`)).addPhrase(o=>o.setMetadata({originalWord:"incest"}).addPattern((0,e.pattern)`incest`)).addPhrase(o=>o.setMetadata({originalWord:"jerk off"}).addPattern((0,e.pattern)`jerkoff`)).addPhrase(o=>o.setMetadata({originalWord:"jizz"}).addPattern((0,e.pattern)`jizz`)).addPhrase(o=>o.setMetadata({originalWord:"kike"}).addPattern((0,e.pattern)`kike`)).addPhrase(o=>o.setMetadata({originalWord:"lubejob"}).addPattern((0,e.pattern)`lubejob`)).addPhrase(o=>o.setMetadata({originalWord:"masturbate"}).addPattern((0,e.pattern)`m[?]sturbate`).addPattern((0,e.pattern)`masterbate`)).addPhrase(o=>o.setMetadata({originalWord:"negro"}).addPattern((0,e.pattern)`negro`).addWhitelistedTerm("montenegro").addWhitelistedTerm("negron").addWhitelistedTerm("stoneground").addWhitelistedTerm("winegrow")).addPhrase(o=>o.setMetadata({originalWord:"nigger"}).addPattern((0,e.pattern)`n[i]gger`).addPattern((0,e.pattern)`n[i]gga`).addPattern((0,e.pattern)`|nig|`).addPattern((0,e.pattern)`|nigs|`).addWhitelistedTerm("snigger")).addPhrase(o=>o.setMetadata({originalWord:"orgasm"}).addPattern((0,e.pattern)`[or]gasm`).addWhitelistedTerm("gasma")).addPhrase(o=>o.setMetadata({originalWord:"orgy"}).addPattern((0,e.pattern)`orgy`).addPattern((0,e.pattern)`orgies`).addWhitelistedTerm("porgy")).addPhrase(o=>o.setMetadata({originalWord:"penis"}).addPattern((0,e.pattern)`pe[e]nis`).addPattern((0,e.pattern)`|pnis`).addWhitelistedTerm("pen is")).addPhrase(o=>o.setMetadata({originalWord:"piss"}).addPattern((0,e.pattern)`|piss`)).addPhrase(o=>o.setMetadata({originalWord:"porn"}).addPattern((0,e.pattern)`|prn|`).addPattern((0,e.pattern)`porn`).addWhitelistedTerm("p orna")).addPhrase(o=>o.setMetadata({originalWord:"prick"}).addPattern((0,e.pattern)`|prick[s]|`)).addPhrase(o=>o.setMetadata({originalWord:"pussy"}).addPattern((0,e.pattern)`p[u]ssy`)).addPhrase(o=>o.setMetadata({originalWord:"rape"}).addPattern((0,e.pattern)`|rape`).addPattern((0,e.pattern)`|rapis[s]t`)).addPhrase(o=>o.setMetadata({originalWord:"retard"}).addPattern((0,e.pattern)`retard`)).addPhrase(o=>o.setMetadata({originalWord:"scat"}).addPattern((0,e.pattern)`|s[s]cat|`)).addPhrase(o=>o.setMetadata({originalWord:"semen"}).addPattern((0,e.pattern)`|s[s]e[e]me[e]n`)).addPhrase(o=>o.setMetadata({originalWord:"sex"}).addPattern((0,e.pattern)`|s[s]e[e]x|`).addPattern((0,e.pattern)`|s[s]e[e]xy|`)).addPhrase(o=>o.setMetadata({originalWord:"shit"}).addPattern((0,e.pattern)`|shit`).addPattern((0,e.pattern)`shit|`).addWhitelistedTerm("s hit").addWhitelistedTerm("sh it").addWhitelistedTerm("shi t").addWhitelistedTerm("shitake")).addPhrase(o=>o.setMetadata({originalWord:"slut"}).addPattern((0,e.pattern)`s[s]lut`)).addPhrase(o=>o.setMetadata({originalWord:"spastic"}).addPattern((0,e.pattern)`|spastic`)).addPhrase(o=>o.setMetadata({originalWord:"tit"}).addPattern((0,e.pattern)`|tit|`).addPattern((0,e.pattern)`|tits|`).addPattern((0,e.pattern)`|titt`).addPattern((0,e.pattern)`|tiddies`).addPattern((0,e.pattern)`|tities`)).addPhrase(o=>o.setMetadata({originalWord:"tranny"}).addPattern((0,e.pattern)`tranny`)).addPhrase(o=>o.setMetadata({originalWord:"turd"}).addPattern((0,e.pattern)`|turd`).addWhitelistedTerm("turducken")).addPhrase(o=>o.setMetadata({originalWord:"twat"}).addPattern((0,e.pattern)`|twat`).addWhitelistedTerm("twattle")).addPhrase(o=>o.setMetadata({originalWord:"vagina"}).addPattern((0,e.pattern)`vagina`).addPattern((0,e.pattern)`|v[?]gina`)).addPhrase(o=>o.setMetadata({originalWord:"wank"}).addPattern((0,e.pattern)`|wank`)).addPhrase(o=>o.setMetadata({originalWord:"whore"}).addPattern((0,e.pattern)`|wh[o]re|`).addPattern((0,e.pattern)`|who[o]res[s]|`).addWhitelistedTerm("who're"))})(Da)),Da}var xi={},Gu;function w2(){if(Gu)return xi;Gu=1,Object.defineProperty(xi,"__esModule",{value:!0}),xi.skipNonAlphabeticTransformer=void 0;const n=Ge(),t=Rr();function e(){return(0,t.createSimpleTransformer)(i=>(0,n.isAlphabetic)(i)?i:void 0)}return xi.skipNonAlphabeticTransformer=e,xi}var Zu;function _2(){return Zu||(Zu=1,(function(n){var t=rn&&rn.__createBinding||(Object.create?(function(i,r,s,a){a===void 0&&(a=s);var o=Object.getOwnPropertyDescriptor(r,s);(!o||("get"in o?!r.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(i,a,o)}):(function(i,r,s,a){a===void 0&&(a=s),i[a]=r[s]})),e=rn&&rn.__exportStar||function(i,r){for(var s in i)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&t(r,i,s)};Object.defineProperty(n,"__esModule",{value:!0}),e(du(),n),e(c2(),n),e(wu(),n),e(d2(),n),e(yu(),n),e(Ia(),n),e(f2(),n),e(xa(),n),e(Iu(),n),e(Pu(),n),e(b2(),n),e(Ou(),n),e(Na(),n),e(Uu(),n),e(Fu(),n),e(w2(),n),e(ju(),n)})(rn)),rn}var S2=_2(),ht=Ac(S2);ht.DataSet,ht.ParserError,ht.PhraseBuilder;const T2=ht.RegExpMatcher;ht.SyntaxKind,ht.TextCensor,ht.assignIncrementingIds,ht.asteriskCensorStrategy;const v2=ht.collapseDuplicatesTransformer;ht.compareMatchByPositionAndId;const A2=ht.englishDataset;ht.englishRecommendedBlacklistMatcherTransformers;const E2=ht.englishRecommendedTransformers;ht.englishRecommendedWhitelistMatcherTransformers,ht.fixedCharCensorStrategy,ht.fixedPhraseCensorStrategy,ht.grawlixCensorStrategy,ht.keepEndCensorStrategy,ht.keepStartCensorStrategy,ht.parseRawPattern,ht.pattern,ht.randomCharFromSetCensorStrategy,ht.remapCharactersTransformer;const k2=ht.resolveConfusablesTransformer,M2=ht.resolveLeetSpeakTransformer,I2=ht.skipNonAlphabeticTransformer;ht.toAsciiLowerCaseTransformer;var x2=JSON.parse(`[{"code":"xx","name":"None"},{"code":"Abbasid Caliphate","continent":"Asia","name":"Abbasid Caliphate"},{"code":"Achaemenid Empire","continent":"Asia","name":"Achaemenid Empire"},{"code":"ae","continent":"Asia","name":"United Arab Emirates"},{"code":"af","continent":"Asia","name":"Afghanistan"},{"code":"African union","continent":"Africa","name":"African Union"},{"code":"ag","continent":"North America","name":"Antigua and Barbuda"},{"code":"ai","continent":"North America","name":"Anguilla"},{"code":"1_Airgialla","continent":"Europe","name":"Airgialla"},{"code":"al","continent":"Europe","name":"Albania"},{"code":"Alabama","continent":"North America","name":"Alabama"},{"code":"ax","continent":"Europe","name":"Aland Islands"},{"code":"Alaska","continent":"North America","name":"Alaska"},{"code":"dz","continent":"Africa","name":"Algeria"},{"code":"Amazigh flag","continent":"Africa","name":"Amazigh Flag"},{"code":"amazonas","continent":"South America","name":"Amazonas"},{"code":"as","continent":"Oceania","name":"American Samoa"},{"code":"am","continent":"Asia","name":"Armenia"},{"code":"Anarchist flag","name":"Anarchist Flag"},{"code":"ad","continent":"Europe","name":"Andorra"},{"code":"ao","continent":"Africa","name":"Angola"},{"code":"aq","name":"Antarctica"},{"code":"antipope","continent":"Europe","name":"Anti-Pope"},{"code":"aquitaine","continent":"Europe","name":"Aquitaine"},{"code":"ar","continent":"South America","name":"Argentina"},{"code":"Aram Damascus","continent":"Asia","name":"Aram Damascus"},{"code":"Arabia","continent":"Asia","name":"Arabia"},{"code":"Arizona","continent":"North America","name":"Arizona"},{"code":"Arkansas","continent":"North America","name":"Arkansas"},{"code":"armagnac","continent":"Europe","name":"Armagnac"},{"code":"aw","continent":"South America","name":"Aruba"},{"code":"sh-ac","continent":"Africa","name":"Ascension Island"},{"code":"Assyria","continent":"Asia","name":"Assyria"},{"code":"asturias","continent":"Europe","name":"Asturias"},{"code":"Athens","continent":"Europe","name":"Athens"},{"code":"at","continent":"Europe","name":"Austria"},{"code":"austria-hungary","continent":"Europe","name":"Austria-Hungary"},{"code":"au","continent":"Oceania","name":"Australia"},{"code":"az","continent":"Asia","name":"Azerbaijan"},{"code":"Aztec Empire","continent":"North America","name":"Aztec Empire"},{"code":"bs","continent":"North America","name":"Bahamas"},{"code":"bahia","continent":"South America","name":"Bahia"},{"code":"bh","continent":"Asia","name":"Bahrain"},{"code":"baguette","name":"Baguette"},{"code":"bd","continent":"Asia","name":"Bangladesh"},{"code":"bb","continent":"North America","name":"Barbados"},{"code":"Babylonia","continent":"Asia","name":"Babylonia"},{"code":"es-pv","continent":"Europe","name":"Basque Country"},{"code":"by","continent":"Europe","name":"Belarus"},{"code":"be","continent":"Europe","name":"Belgium"},{"code":"bz","continent":"North America","name":"Belize"},{"code":"bj","continent":"Africa","name":"Benin"},{"code":"bm","continent":"North America","name":"Bermuda"},{"code":"bt","continent":"Asia","name":"Bhutan"},{"code":"bo","continent":"South America","name":"Bolivia"},{"code":"bq","continent":"South America","name":"Bonaire, Sint Eustatius and Saba"},{"code":"ba","continent":"Europe","name":"Bosnia and Herzegovina"},{"code":"bw","continent":"Africa","name":"Botswana"},{"code":"bv","name":"Bouvet Island"},{"code":"br","continent":"South America","name":"Brazil"},{"code":"io","continent":"Asia","name":"British Indian Ocean Territory"},{"code":"brittany","continent":"Europe","name":"Brittany"},{"code":"bn","continent":"Asia","name":"Brunei Darussalam"},{"code":"buenos_aires","continent":"South America","name":"Buenos Aires"},{"code":"bg","continent":"Europe","name":"Bulgaria"},{"code":"bf","continent":"Africa","name":"Burkina Faso"},{"code":"burgundy","continent":"Europe","name":"Burgundy"},{"code":"Burma","continent":"Asia","name":"Burma"},{"code":"bi","continent":"Africa","name":"Burundi"},{"code":"Byzantine Empire","continent":"Europe","name":"Byzantine Empire"},{"code":"cv","continent":"Africa","name":"Cabo Verde"},{"code":"California","continent":"North America","name":"California"},{"code":"kh","continent":"Asia","name":"Cambodia"},{"code":"cm","continent":"Africa","name":"Cameroon"},{"code":"ca","continent":"North America","name":"Canada"},{"code":"ic","continent":"Africa","name":"Canary Islands"},{"code":"Capybara","name":"Capybara"},{"code":"Carthage","continent":"Africa","name":"Carthage"},{"code":"castille","continent":"Europe","name":"Castille"},{"code":"catamarca","continent":"South America","name":"Catamarca"},{"code":"es-ct","continent":"Europe","name":"Catalonia"},{"code":"ky","continent":"North America","name":"Cayman Islands"},{"code":"Ceara","continent":"South America","name":"CearÃ¡"},{"code":"cf","continent":"Africa","name":"Central African Republic"},{"code":"td","continent":"Africa","name":"Chad"},{"code":"cl","continent":"South America","name":"Chile"},{"code":"cn","continent":"Asia","name":"China"},{"code":"Chinook","continent":"North America","name":"Chinook"},{"code":"cx","continent":"Asia","name":"Christmas Island"},{"code":"Chuvashia","continent":"Europe","name":"Chuvashia"},{"code":"Circassia","continent":"Asia","name":"Circassia"},{"code":"cp","name":"Clipperton Island"},{"code":"cc","continent":"Asia","name":"Cocos (Keeling) Islands"},{"code":"Colchis","continent":"Asia","name":"Colchis"},{"code":"co","continent":"South America","name":"Colombia"},{"code":"Colorado","continent":"North America","name":"Colorado"},{"code":"km","continent":"Africa","name":"Comoros"},{"code":"Communist flag","name":"Communist Flag"},{"code":"Confederate States","continent":"North America","name":"Confederate States","restricted":true},{"code":"1_Connacht","continent":"Europe","name":"Connacht"},{"code":"ck","continent":"Oceania","name":"Cook Islands"},{"code":"cordoba","continent":"Europe","name":"Cordoba"},{"code":"Corsica","continent":"Europe","name":"Corsica"},{"code":"cr","continent":"North America","name":"Costa Rica"},{"code":"ci","continent":"Africa","name":"CÃ´te d'Ivoire"},{"code":"hr","continent":"Europe","name":"Croatia"},{"code":"Cthulhu Republic","name":"Cthulhu Republic"},{"code":"cu","continent":"North America","name":"Cuba"},{"code":"cw","continent":"South America","name":"CuraÃ§ao"},{"code":"cy","continent":"Europe","name":"Cyprus"},{"code":"cz","continent":"Europe","name":"Czech Republic"},{"code":"Danzig","continent":"Europe","name":"Danzig"},{"code":"1_Dalriata","continent":"Europe","name":"DÃ¡l Riata"},{"code":"dk","continent":"Europe","name":"Denmark"},{"code":"cd","continent":"Africa","name":"Democratic Republic of the Congo"},{"code":"dg","continent":"Asia","name":"Diego Garcia"},{"code":"Dilmun","continent":"Asia","name":"Dilmun"},{"code":"dj","continent":"Africa","name":"Djibouti"},{"code":"dm","continent":"North America","name":"Dominica"},{"code":"do","continent":"North America","name":"Dominican Republic"},{"code":"1_Dumnonia","continent":"Europe","name":"Dumnonia"},{"code":"Dutch East India Company","name":"Dutch East India Company"},{"code":"1_Dyfed","continent":"Europe","name":"Dyfed"},{"code":"1_East Anglia","continent":"Europe","name":"East Anglia"},{"code":"east_germany","continent":"Europe","name":"East Germany"},{"code":"ec","continent":"South America","name":"Ecuador"},{"code":"eg","continent":"Africa","name":"Egypt"},{"code":"Elam","continent":"Asia","name":"Elam"},{"code":"sv","continent":"North America","name":"El Salvador"},{"code":"granada","continent":"Europe","name":"Emirate of Granada"},{"code":"Empire of Japan","continent":"Asia","name":"Empire of Japan"},{"code":"Empire of Japan1","continent":"Asia","name":"Empire of Japan"},{"code":"gb-eng","continent":"Europe","name":"England"},{"code":"gq","continent":"Africa","name":"Equatorial Guinea"},{"code":"er","continent":"Africa","name":"Eritrea"},{"code":"1_Essex","continent":"Europe","name":"Essex"},{"code":"ee","continent":"Europe","name":"Estonia"},{"code":"sz","continent":"Africa","name":"Eswatini"},{"code":"et","continent":"Africa","name":"Ethiopia"},{"code":"eu","continent":"Europe","name":"Europe"},{"code":"fk","continent":"South America","name":"Falkland Islands"},{"code":"fo","continent":"Europe","name":"Faroe Islands"},{"code":"Fascist Spain","continent":"Europe","name":"Fascist Spain","restricted":true},{"code":"fm","continent":"Oceania","name":"Federated States of Micronesia"},{"code":"fj","continent":"Oceania","name":"Fiji"},{"code":"fi","continent":"Europe","name":"Finland"},{"code":"Flanders","continent":"Europe","name":"Flanders"},{"code":"Florida","continent":"North America","name":"Florida"},{"code":"1_Fortriu","continent":"Europe","name":"Fortriu"},{"code":"fr","continent":"Europe","name":"France"},{"code":"1_Franks","continent":"Europe","name":"Franks"},{"code":"French foreign legion","name":"French Foreign Legion"},{"code":"gf","continent":"South America","name":"French Guiana"},{"code":"pf","continent":"Oceania","name":"French Polynesia"},{"code":"frost_giant","name":"Frost Giant"},{"code":"tf","continent":"Africa","name":"French Southern Territories"},{"code":"ga","continent":"Africa","name":"Gabon"},{"code":"galapagos","continent":"South America","name":"GalÃ¡pagos"},{"code":"es-ga","continent":"Europe","name":"Galicia"},{"code":"gm","continent":"Africa","name":"Gambia"},{"code":"Garamant","continent":"Africa","name":"Garamantes"},{"code":"ge","continent":"Asia","name":"Georgia"},{"code":"Georgia_US","continent":"North America","name":"Georgia (US State)"},{"code":"German Empire","continent":"Europe","name":"German Empire","restricted":true},{"code":"de","continent":"Europe","name":"Germany"},{"code":"gh","continent":"Africa","name":"Ghana"},{"code":"gi","continent":"Europe","name":"Gibraltar"},{"code":"gr","continent":"Europe","name":"Greece"},{"code":"gl","continent":"North America","name":"Greenland"},{"code":"gd","continent":"North America","name":"Grenada"},{"code":"gp","continent":"North America","name":"Guadeloupe"},{"code":"gu","continent":"Oceania","name":"Guam"},{"code":"gt","continent":"North America","name":"Guatemala"},{"code":"gg","continent":"Europe","name":"Guernsey"},{"code":"gn","continent":"Africa","name":"Guinea"},{"code":"gw","continent":"Africa","name":"Guinea-Bissau"},{"code":"1_Gwent","continent":"Europe","name":"Gwent"},{"code":"1_Gwynedd","continent":"Europe","name":"Gwynedd"},{"code":"gy","continent":"South America","name":"Guyana"},{"code":"Habsburg Austria","continent":"Europe","name":"Habsburg Austria"},{"code":"ht","continent":"North America","name":"Haiti"},{"code":"Hawaii","continent":"Oceania","name":"Hawaii"},{"code":"hm","name":"Heard Island and McDonald Islands"},{"code":"va","continent":"Europe","name":"Holy See"},{"code":"Holy Roman Empire","continent":"Europe","name":"Holy Roman Empire"},{"code":"hn","continent":"North America","name":"Honduras"},{"code":"hk","continent":"Asia","name":"Hong Kong"},{"code":"hu","continent":"Europe","name":"Hungary"},{"code":"Hyrcania","continent":"Asia","name":"Hyrcania"},{"code":"is","continent":"Europe","name":"Iceland"},{"code":"Idaho","continent":"North America","name":"Idaho"},{"code":"Illinois","continent":"North America","name":"Illinois"},{"code":"in","continent":"Asia","name":"India"},{"code":"Indiana","continent":"North America","name":"Indiana"},{"code":"id","continent":"Asia","name":"Indonesia"},{"code":"Iowa","continent":"North America","name":"Iowa"},{"code":"iq","continent":"Asia","name":"Iraq"},{"code":"ir","continent":"Asia","name":"Iran"},{"code":"Pahlavi Iran","continent":"Asia","name":"Pahlavi Iran"},{"code":"ie","continent":"Europe","name":"Ireland"},{"code":"im","continent":"Europe","name":"Isle of Man"},{"code":"il","continent":"Asia","name":"Israel"},{"code":"it","continent":"Europe","name":"Italy"},{"code":"italy","continent":"Europe","name":"Kingdom of Italy"},{"code":"jm","continent":"North America","name":"Jamaica"},{"code":"jp","continent":"Asia","name":"Japan"},{"code":"je","continent":"Europe","name":"Jersey"},{"code":"jo","continent":"Asia","name":"Jordan"},{"code":"Kansas","continent":"North America","name":"Kansas"},{"code":"kz","continent":"Asia","name":"Kazakhstan"},{"code":"Kemet","continent":"Africa","name":"Kemet"},{"code":"ke","continent":"Africa","name":"Kenya"},{"code":"1_Kent","continent":"Europe","name":"Kent"},{"code":"Kentucky","continent":"North America","name":"Kentucky"},{"code":"Khemet","continent":"Africa","name":"Khemet"},{"code":"Kingdom of Egypt","continent":"Africa","name":"Kingdom of Egypt"},{"code":"Kingdom of Iraq","continent":"Asia","name":"Kingdom of Iraq"},{"code":"Kingdom of Jerusalem","continent":"Asia","name":"Kingdom of Jerusalem"},{"code":"Kingdom of Judah","continent":"Asia","name":"Kingdom of Judah"},{"code":"ki","continent":"Oceania","name":"Kiribati"},{"code":"Kiwi","name":"Kiwi"},{"code":"xk","continent":"Europe","name":"Kosovo"},{"code":"kurdistan","continent":"Asia","name":"Kurdistan"},{"code":"Kush","continent":"Africa","name":"Kush"},{"code":"kw","continent":"Asia","name":"Kuwait"},{"code":"kg","continent":"Asia","name":"Kyrgyzstan"},{"code":"1_Laigin","continent":"Europe","name":"Laigin"},{"code":"la","continent":"Asia","name":"Laos"},{"code":"lv","continent":"Europe","name":"Latvia"},{"code":"League of Nations","name":"League of Nations"},{"code":"lb","continent":"Asia","name":"Lebanon"},{"code":"Leinster","continent":"Europe","name":"Leinster"},{"code":"leon","continent":"Europe","name":"LeÃ³n"},{"code":"ls","continent":"Africa","name":"Lesotho"},{"code":"lr","continent":"Africa","name":"Liberia"},{"code":"Liberalism_flag","name":"Liberalism Flag"},{"code":"Libyan Jamahiriya","continent":"Africa","name":"Libyan Jamahiriya"},{"code":"ly","continent":"Africa","name":"Libya"},{"code":"li","continent":"Europe","name":"Liechtenstein"},{"code":"Listenbourg","name":"Listenbourg"},{"code":"lt","continent":"Europe","name":"Lithuania"},{"code":"Louisiana","continent":"North America","name":"Louisiana"},{"code":"Lower Silesia","continent":"Europe","name":"Lower Silesia"},{"code":"lu","continent":"Europe","name":"Luxembourg"},{"code":"Lydia","continent":"Asia","name":"Lydia"},{"code":"Macedonia","continent":"Europe","name":"Macedonia"},{"code":"mo","continent":"Asia","name":"Macau"},{"code":"mg","continent":"Africa","name":"Madagascar"},{"code":"Maine","continent":"North America","name":"Maine"},{"code":"mw","continent":"Africa","name":"Malawi"},{"code":"my","continent":"Asia","name":"Malaysia"},{"code":"mv","continent":"Asia","name":"Maldives"},{"code":"ml","continent":"Africa","name":"Mali"},{"code":"mt","continent":"Europe","name":"Malta"},{"code":"Maori flag","continent":"Oceania","name":"MÄori Flag"},{"code":"mh","continent":"Oceania","name":"Marshall Islands"},{"code":"mq","continent":"North America","name":"Martinique"},{"code":"Maryland","continent":"North America","name":"Maryland"},{"code":"mr","continent":"Africa","name":"Mauritania"},{"code":"mu","continent":"Africa","name":"Mauritius"},{"code":"yt","continent":"Africa","name":"Mayotte"},{"code":"Median Empire","continent":"Asia","name":"Median Empire"},{"code":"1_Mercia","continent":"Europe","name":"Mercia"},{"code":"mx","continent":"North America","name":"Mexico"},{"code":"Michigan","continent":"North America","name":"Michigan"},{"code":"minas_gerais","continent":"South America","name":"Minas Gerais"},{"code":"Minnesota","continent":"North America","name":"Minnesota"},{"code":"Mississippi","continent":"North America","name":"Mississippi"},{"code":"Missouri","continent":"North America","name":"Missouri"},{"code":"md","continent":"Europe","name":"Moldova"},{"code":"mc","continent":"Europe","name":"Monaco"},{"code":"Mongol Empire","continent":"Asia","name":"Mongol Empire"},{"code":"mn","continent":"Asia","name":"Mongolia"},{"code":"Montana","continent":"North America","name":"Montana"},{"code":"me","continent":"Europe","name":"Montenegro"},{"code":"ms","continent":"North America","name":"Montserrat"},{"code":"ma","continent":"Africa","name":"Morocco"},{"code":"mz","continent":"Africa","name":"Mozambique"},{"code":"1_Munster","continent":"Europe","name":"Munster"},{"code":"mm","continent":"Asia","name":"Myanmar"},{"code":"na","continent":"Africa","name":"Namibia"},{"code":"NATO","name":"NATO"},{"code":"nr","continent":"Oceania","name":"Nauru"},{"code":"Nebraska","continent":"North America","name":"Nebraska"},{"code":"np","continent":"Asia","name":"Nepal"},{"code":"nl","continent":"Europe","name":"Netherlands"},{"code":"neuragic_empire","name":"Neuragic Empire"},{"code":"Nevada","continent":"North America","name":"Nevada"},{"code":"nc","continent":"Oceania","name":"New Caledonia"},{"code":"New_Hampshire","continent":"North America","name":"New Hampshire"},{"code":"New_Jersey","continent":"North America","name":"New Jersey"},{"code":"New_Mexico","continent":"North America","name":"New Mexico"},{"code":"New_York","continent":"North America","name":"New York"},{"code":"nz","continent":"Oceania","name":"New Zealand"},{"code":"ni","continent":"North America","name":"Nicaragua"},{"code":"ne","continent":"Africa","name":"Niger"},{"code":"ng","continent":"Africa","name":"Nigeria"},{"code":"nu","continent":"Oceania","name":"Niue"},{"code":"nf","continent":"Oceania","name":"Norfolk Island"},{"code":"normandy","continent":"Europe","name":"Normandy"},{"code":"North karelia","continent":"Europe","name":"North Karelia"},{"code":"North_Carolina","continent":"North America","name":"North Carolina"},{"code":"North_Dakota","continent":"North America","name":"North Dakota"},{"code":"kp","continent":"Asia","name":"North Korea"},{"code":"mk","continent":"Europe","name":"North Macedonia"},{"code":"northern_ireland","continent":"Europe","name":"Northern Ireland"},{"code":"mp","continent":"Oceania","name":"Northern Mariana Islands"},{"code":"1_Northern Ui Neill","continent":"Europe","name":"Northern UÃ­ NÃ©ill"},{"code":"1_Northumbria","continent":"Europe","name":"Northumbria"},{"code":"no","continent":"Europe","name":"Norway"},{"code":"Ohio","continent":"North America","name":"Ohio"},{"code":"Oklahoma","continent":"North America","name":"Oklahoma"},{"code":"om","continent":"Asia","name":"Oman"},{"code":"Oregon","continent":"North America","name":"Oregon"},{"code":"Ottoman Empire","continent":"Asia","name":"Ottoman Empire"},{"code":"pk","continent":"Asia","name":"Pakistan"},{"code":"pw","continent":"Oceania","name":"Palau"},{"code":"Palekh","continent":"Europe","name":"Palekh"},{"code":"pa","continent":"North America","name":"Panama"},{"code":"pg","continent":"Oceania","name":"Papua New Guinea"},{"code":"Para","continent":"South America","name":"ParÃ¡"},{"code":"py","continent":"South America","name":"Paraguay"},{"code":"paris","continent":"Europe","name":"Paris"},{"code":"Pennsylvania","continent":"North America","name":"Pennsylvania"},{"code":"pe","continent":"South America","name":"Peru"},{"code":"Persia","continent":"Asia","name":"Persia"},{"code":"ph","continent":"Asia","name":"Philippines"},{"code":"Phrygia","continent":"Asia","name":"Phrygia"},{"code":"pn","continent":"Oceania","name":"Pitcairn"},{"code":"pl","continent":"Europe","name":"Poland"},{"code":"polar_bears","name":"Polar Bears"},{"code":"Polishâ€“Lithuanian Commonwealth","continent":"Europe","name":"Polishâ€“Lithuanian Commonwealth"},{"code":"pt","continent":"Europe","name":"Portugal"},{"code":"1_Powys","continent":"Europe","name":"Powys"},{"code":"provence","continent":"Europe","name":"Provence"},{"code":"prussia","continent":"Europe","name":"Prussia"},{"code":"pr","continent":"North America","name":"Puerto Rico"},{"code":"qa","continent":"Asia","name":"Qatar"},{"code":"Qing Dynasty","continent":"Asia","name":"Qing Dynasty"},{"code":"Quebec","continent":"North America","name":"Quebec"},{"code":"Republic of China","continent":"Asia","name":"Republic of China"},{"code":"cg","continent":"Africa","name":"Republic of the Congo"},{"code":"Republic of Egypt","continent":"Africa","name":"Republic of Egypt"},{"code":"Republic of Formosa","continent":"Asia","name":"Republic of Formosa"},{"code":"Republic of Korea","continent":"Asia","name":"Republic of Korea"},{"code":"Republic of Pirates","continent":"North America","name":"Republic of Pirates"},{"code":"re","continent":"Africa","name":"RÃ©union"},{"code":"Rhode_Island","continent":"North America","name":"Rhode Island"},{"code":"rio_de_janeiro","continent":"South America","name":"Rio de Janeiro"},{"code":"Romanov Russia","continent":"Europe","name":"Romanov Russia"},{"code":"ro","continent":"Europe","name":"Romania"},{"code":"Ror Empire","name":"Ror Empire"},{"code":"ru","continent":"Europe","name":"Russia"},{"code":"rw","continent":"Africa","name":"Rwanda"},{"code":"Saba kingdom","continent":"Asia","name":"Saba Kingdom"},{"code":"bl","continent":"North America","name":"Saint BarthÃ©lemy"},{"code":"sh-hl","continent":"Africa","name":"Saint Helena"},{"code":"kn","continent":"North America","name":"Saint Kitts and Nevis"},{"code":"lc","continent":"North America","name":"Saint Lucia"},{"code":"mf","continent":"North America","name":"Saint Martin"},{"code":"pm","continent":"North America","name":"Saint Pierre and Miquelon"},{"code":"vc","continent":"North America","name":"Saint Vincent and the Grenadines"},{"code":"Sami flag","continent":"Europe","name":"Sami Flag"},{"code":"ws","continent":"Oceania","name":"Samoa"},{"code":"sm","continent":"Europe","name":"San Marino"},{"code":"Santa Cruz","continent":"South America","name":"Santa Cruz"},{"code":"santa_claus","name":"Santa Claus"},{"code":"st","continent":"Africa","name":"Sao Tome and Principe"},{"code":"Sao Paulo","continent":"South America","name":"SÃ£o Paulo"},{"code":"sardines","name":"Sardines"},{"code":"Sassanid Empire","continent":"Asia","name":"Sassanid Empire"},{"code":"sa","continent":"Asia","name":"Saudi Arabia"},{"code":"gb-sct","continent":"Europe","name":"Scotland"},{"code":"Second Republic of Iraq","continent":"Asia","name":"Second Republic of Iraq"},{"code":"Second Spanish Republic","continent":"Europe","name":"Second Spanish Republic"},{"code":"sn","continent":"Africa","name":"Senegal"},{"code":"rs","continent":"Europe","name":"Serbia"},{"code":"seville","continent":"Europe","name":"Seville"},{"code":"sc","continent":"Africa","name":"Seychelles"},{"code":"Siam","continent":"Asia","name":"Siam"},{"code":"Siberia","continent":"Asia","name":"Siberia"},{"code":"Sicily","continent":"Europe","name":"Sicily"},{"code":"sl","continent":"Africa","name":"Sierra Leone"},{"code":"sg","continent":"Asia","name":"Singapore"},{"code":"sx","continent":"North America","name":"Sint Maarten"},{"code":"sk","continent":"Europe","name":"Slovakia"},{"code":"si","continent":"Europe","name":"Slovenia"},{"code":"Socialist_flag","name":"Socialist Flag"},{"code":"sb","continent":"Oceania","name":"Solomon Islands"},{"code":"so","continent":"Africa","name":"Somalia"},{"code":"za","continent":"Africa","name":"South Africa"},{"code":"South_Carolina","continent":"North America","name":"South Carolina"},{"code":"South_Dakota","continent":"North America","name":"South Dakota"},{"code":"gs","continent":"Antarctica","name":"South Georgia and the South Sandwich Islands"},{"code":"kr","continent":"Asia","name":"South Korea"},{"code":"ss","continent":"Africa","name":"South Sudan"},{"code":"1_Southern Ui Neill","continent":"Europe","name":"Southern UÃ­ NÃ©ill"},{"code":"es","continent":"Europe","name":"Spain"},{"code":"spanish_empire","continent":"Europe","name":"Spanish Empire"},{"code":"Sparta","continent":"Europe","name":"Sparta"},{"code":"SPQR","continent":"Europe","name":"SPQR"},{"code":"lk","continent":"Asia","name":"Sri Lanka"},{"code":"ps","continent":"Asia","name":"State of Palestine"},{"code":"1_Strathclyde","continent":"Europe","name":"Strathclyde"},{"code":"sd","continent":"Africa","name":"Sudan"},{"code":"Sultanate of Nejd","continent":"Asia","name":"Sultanate of Nejd"},{"code":"sr","continent":"South America","name":"Suriname"},{"code":"1_Sussex","continent":"Europe","name":"Sussex"},{"code":"sj","continent":"Europe","name":"Svalbard and Jan Mayen"},{"code":"se","continent":"Europe","name":"Sweden"},{"code":"Sweden Norway Union","continent":"Europe","name":"Sweden Norway Union"},{"code":"ch","continent":"Europe","name":"Switzerland"},{"code":"sy","continent":"Asia","name":"Syria"},{"code":"tw","continent":"Asia","name":"Taiwan"},{"code":"tj","continent":"Asia","name":"Tajikistan"},{"code":"tz","continent":"Africa","name":"Tanzania"},{"code":"Tennessee","continent":"North America","name":"Tennessee"},{"code":"Texas","continent":"North America","name":"Texas"},{"code":"th","continent":"Asia","name":"Thailand"},{"code":"tibet","continent":"Asia","name":"Tibet"},{"code":"tl","continent":"Asia","name":"Timor-Leste"},{"code":"tg","continent":"Africa","name":"Togo"},{"code":"tk","continent":"Oceania","name":"Tokelau"},{"code":"to","continent":"Oceania","name":"Tonga"},{"code":"tt","continent":"South America","name":"Trinidad and Tobago"},{"code":"sh-ta","continent":"Africa","name":"Tristan da Cunha"},{"code":"Trucial States","continent":"Asia","name":"Trucial States"},{"code":"tn","continent":"Africa","name":"Tunisia"},{"code":"tr","continent":"Asia","name":"TÃ¼rkiye"},{"code":"tm","continent":"Asia","name":"Turkmenistan"},{"code":"tc","continent":"North America","name":"Turks and Caicos Islands"},{"code":"tv","continent":"Oceania","name":"Tuvalu"},{"code":"USA 1776","continent":"North America","name":"USA 1776"},{"code":"ussr","continent":"Europe","name":"USSR"},{"code":"ug","continent":"Africa","name":"Uganda"},{"code":"ua","continent":"Europe","name":"Ukraine"},{"code":"1_Ulaid","continent":"Europe","name":"Ulaid"},{"code":"Umayyad Caliphate","continent":"Asia","name":"Umayyad Caliphate"},{"code":"United Arab Republic","continent":"Asia","name":"United Arab Republic"},{"code":"gb","continent":"Europe","name":"United Kingdom"},{"code":"un","name":"United Nations"},{"code":"us","continent":"North America","name":"United States of America"},{"code":"Upper Silesia","continent":"Europe","name":"Upper Silesia"},{"code":"Urartu","continent":"Asia","name":"Urartu"},{"code":"uy","continent":"South America","name":"Uruguay"},{"code":"Utah","continent":"North America","name":"Utah"},{"code":"uz","continent":"Asia","name":"Uzbekistan"},{"code":"valencia","continent":"Europe","name":"Valencia"},{"code":"vu","continent":"Oceania","name":"Vanuatu"},{"code":"ve","continent":"South America","name":"Venezuela"},{"code":"venice","continent":"Europe","name":"Venice"},{"code":"Vermont","continent":"North America","name":"Vermont"},{"code":"vn","continent":"Asia","name":"Vietnam"},{"code":"vg","continent":"North America","name":"Virgin Islands (British)"},{"code":"vi","continent":"North America","name":"Virgin Islands (U.S.)"},{"code":"Virginia","continent":"North America","name":"Virginia"},{"code":"gb-wls","continent":"Europe","name":"Wales"},{"code":"Wallonia","continent":"Europe","name":"Wallonia"},{"code":"wf","continent":"Oceania","name":"Wallis and Futuna"},{"code":"Washington","continent":"North America","name":"Washington"},{"code":"1_Wessex","continent":"Europe","name":"Wessex"},{"code":"west_germany","continent":"Europe","name":"West Germany"},{"code":"West Roman Empire","continent":"Europe","name":"West Roman Empire"},{"code":"West_Virginia","continent":"North America","name":"West Virginia"},{"code":"eh","continent":"Africa","name":"Western Sahara"},{"code":"Wisconsin","continent":"North America","name":"Wisconsin"},{"code":"Wyoming","continent":"North America","name":"Wyoming"},{"code":"Yellow_Flag","name":"Yellow Flag"},{"code":"ye","continent":"Asia","name":"Yemen"},{"code":"yugoslavia","continent":"Europe","name":"Yugoslavia"},{"code":"Zaire","continent":"Africa","name":"Zaire"},{"code":"zm","continent":"Africa","name":"Zambia"},{"code":"Zheleznogorsk","continent":"Asia","name":"Zheleznogorsk"},{"code":"zw","continent":"Africa","name":"Zimbabwe"}]`),C2={help:[{key:"troops",requiresPlayer:!1},{key:"troops_frontlines",requiresPlayer:!1},{key:"gold",requiresPlayer:!1},{key:"no_attack",requiresPlayer:!1},{key:"sorry_attack",requiresPlayer:!1},{key:"alliance",requiresPlayer:!1},{key:"help_defend",requiresPlayer:!0},{key:"trade_partners",requiresPlayer:!1}],attack:[{key:"attack",requiresPlayer:!0},{key:"mirv",requiresPlayer:!0},{key:"focus",requiresPlayer:!0},{key:"finish",requiresPlayer:!0},{key:"build_warships",requiresPlayer:!1}],defend:[{key:"defend",requiresPlayer:!0},{key:"defend_from",requiresPlayer:!0},{key:"dont_attack",requiresPlayer:!0},{key:"ally",requiresPlayer:!0},{key:"build_posts",requiresPlayer:!1}],greet:[{key:"hello",requiresPlayer:!1},{key:"good_job",requiresPlayer:!1},{key:"good_luck",requiresPlayer:!1},{key:"have_fun",requiresPlayer:!1},{key:"gg",requiresPlayer:!1},{key:"nice_to_meet",requiresPlayer:!1},{key:"well_played",requiresPlayer:!1},{key:"hi_again",requiresPlayer:!1},{key:"bye",requiresPlayer:!1},{key:"thanks",requiresPlayer:!1},{key:"oops",requiresPlayer:!1},{key:"trust_me",requiresPlayer:!1},{key:"trust_broken",requiresPlayer:!1},{key:"ruining_games",requiresPlayer:!1},{key:"dont_do_that",requiresPlayer:!1},{key:"same_team",requiresPlayer:!1}],misc:[{key:"go",requiresPlayer:!1},{key:"strategy",requiresPlayer:!1},{key:"fun",requiresPlayer:!1},{key:"team_up",requiresPlayer:!0},{key:"pr",requiresPlayer:!1},{key:"build_closer",requiresPlayer:!1},{key:"coastline",requiresPlayer:!1}],warnings:[{key:"strong",requiresPlayer:!0},{key:"weak",requiresPlayer:!0},{key:"mirv_soon",requiresPlayer:!0},{key:"number1_warning",requiresPlayer:!1},{key:"stalemate",requiresPlayer:!1},{key:"has_allies",requiresPlayer:!0},{key:"no_allies",requiresPlayer:!0},{key:"betrayed",requiresPlayer:!0},{key:"betrayed_me",requiresPlayer:!0},{key:"getting_big",requiresPlayer:!0},{key:"danger_base",requiresPlayer:!0},{key:"saving_for_mirv",requiresPlayer:!0},{key:"mirv_ready",requiresPlayer:!0},{key:"snowballing",requiresPlayer:!0},{key:"cheating",requiresPlayer:!0},{key:"stop_trading",requiresPlayer:!0}]};new TextEncoder;const Yu=new TextDecoder;function P2(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(n);const t=atob(n),e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}function D2(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof n=="string"?n:Yu.decode(n),{alphabet:"base64url"});let t=n;t instanceof Uint8Array&&(t=Yu.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return P2(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}function N2(n,t){const e=t(n);if(e.length<3)throw new Error("Pattern data is too short to contain required metadata.");const i=e[0];if(i!==0)throw new Error(`Unrecognized pattern version ${i}.`);const r=e[1],s=e[2],a=r&7,o=((s&3)<<5|r>>3&31)+2,c=(s>>2&63)+2,h=o*c+7>>3;if(e.length-3<h)throw new Error("Pattern data is too short for the specified dimensions.");return{height:c,width:o,scale:a,bytes:e}}const R2=B({productId:H(),priceId:H(),price:H()}),Ra=H().regex(/^[a-z0-9_]+$/).max(32),Xu=H().max(1403).base64url().refine(n=>{try{return N2(n,D2),!0}catch(t){return t instanceof Error?console.error(JSON.stringify(t.message,null,2)):console.error(String(t)),!1}},{message:"Invalid pattern"}),Vu=B({name:H(),primaryColor:H(),secondaryColor:H()}),O2=B({name:Ra,pattern:Xu,colorPalettes:B({name:H(),isArchived:zt()}).array().optional(),affiliateCode:H().nullable(),product:R2.nullable()});B({colorPalettes:Gn(H(),Vu).optional(),patterns:Gn(H(),O2),flag:B({layers:Gn(H(),B({name:H(),flares:Yi(H()).optional()})),color:Gn(H(),B({color:H(),name:H(),flares:Yi(H()).optional()}))}).optional()});const B2=B({clientID:H(),username:H()}),L2=B({gameID:H(),clients:Yi(B2).optional(),lobbyCreatorClientID:H().optional(),startsAt:j().optional(),serverTime:j(),gameConfig:dc(()=>Or).optional()}),z2=B({gameID:H(),numClients:j(),startsAt:j(),gameConfig:dc(()=>Or).optional()});B({serverTime:j(),games:z2.array()});var Ku=(n=>(n.Debug="DEBUG",n.Info="INFO",n.Warn="WARN",n.Error="ERROR",n.Fatal="FATAL",n))(Ku||{});const U2=Xe([j(),$(mo),$(go),$(po),$(On)]),Or=B({gameMap:Ut(Bn),difficulty:Ut(_),donateGold:zt(),donateTroops:zt(),gameType:Ut(Ln),gameMode:Ut(Ct),rankedType:Ut(ns).optional(),gameMapSize:Ut(Ne),publicGameModifiers:B({isCompact:zt(),isRandomSpawn:zt(),isCrowded:zt(),startingGold:j().int().min(0).optional()}).optional(),disableNations:zt(),bots:j().int().min(0).max(400),infiniteGold:zt(),infiniteTroops:zt(),instantBuild:zt(),disableNavMesh:zt().optional(),randomSpawn:zt(),maxPlayers:j().optional(),maxTimerValue:j().int().min(1).max(120).optional(),spawnImmunityDuration:j().int().min(0).optional(),disabledUnits:Ut(m).array().optional(),playerTeams:U2.optional(),goldMultiplier:j().min(.1).max(1e3).optional(),startingGold:j().int().min(0).max(1e9).optional()});H();const Ju=H().regex(/^([a-zA-Z0-9\s.,!?@#$%&*()\-_+=[\]{}|;:"'/\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff]|[Ã¼Ãœ])*$/u).max(1e3),Qu=pp(),W2=Dp(),td=H().refine(n=>Qu.safeParse(n).success||W2.safeParse(n).success,{message:"Token must be a valid UUID or JWT"}),$2=j().nonnegative().max(es.length-1),F2=/^[A-Za-z0-9]{8}$/,ut=H().regex(F2),q2=Gn(ut,iu),ed=H().regex(/^[a-zA-Z0-9_ [\]Ã¼Ãœ.]+$/u).min(3).max(27),j2=x2.filter(n=>!n.restricted).map(n=>n.code),H2=Ut(Object.entries(C2).flatMap(([n,t])=>t.map(e=>`${n}.${e.key}`))),G2=B({type:$("allianceExtension"),recipient:ut}),Z2=B({type:$("attack"),targetID:ut.nullable(),troops:j().nonnegative().nullable()}),Y2=B({type:$("spawn"),tile:j()}),X2=B({type:$("boat"),troops:j().nonnegative(),dst:j()}),V2=B({type:$("allianceRequest"),recipient:ut}),K2=B({type:$("allianceRequestReply"),requestor:ut,accept:zt()}),J2=B({type:$("breakAlliance"),recipient:ut}),Q2=B({type:$("targetPlayer"),target:ut}),t_=B({type:$("emoji"),recipient:Xe([ut,$(xt)]),emoji:$2}),e_=B({type:$("embargo"),targetID:ut,action:Xe([$("start"),$("stop")])}),n_=B({type:$("embargo_all"),action:Xe([$("start"),$("stop")])}),i_=B({type:$("donate_gold"),recipient:ut,gold:j().nonnegative().nullable()}),r_=B({type:$("donate_troops"),recipient:ut,troops:j().nonnegative().nullable()}),s_=B({type:$("build_unit"),unit:Ut(m),tile:j(),rocketDirectionUp:zt().optional()}),a_=B({type:$("upgrade_structure"),unit:Ut(m),unitId:j()}),o_=B({type:$("cancel_attack"),attackID:H()}),c_=B({type:$("cancel_boat"),unitID:j()}),l_=B({type:$("move_warship"),unitId:j(),tile:j()}),h_=B({type:$("delete_unit"),unitId:j()}),u_=B({type:$("quick_chat"),recipient:ut,quickChatKey:H2,target:ut.optional()}),d_=B({type:$("mark_disconnected"),clientID:ut,isDisconnected:zt()}),f_=B({type:$("kick_player"),target:ut}),m_=B({type:$("toggle_pause"),paused:zt().default(!1)}),g_=B({type:$("update_game_config"),config:Or.partial()}),nd=fs("type",[Z2,o_,Y2,d_,X2,c_,V2,K2,J2,Q2,t_,i_,r_,s_,a_,e_,n_,l_,u_,G2,h_,f_,m_,g_]),p_=nd.and(B({clientID:ut})),Br=B({turnNumber:j(),intents:p_.array(),hash:j().nullable().optional()}),id=H().max(128).optional().refine(n=>n===void 0||n===""||n.startsWith("!")?!0:j2.includes(n),{message:"Invalid flag: must be a valid country code or start with !"}),y_=B({flag:id.optional(),color:H().optional(),patternName:Ra.optional(),patternColorPaletteName:H().optional()}),b_=B({name:Ra,patternData:Xu,colorPalette:Vu.optional()}),w_=B({color:H()}),__=B({flag:id.optional(),pattern:b_.optional(),color:w_.optional()}),rd=B({clientID:ut,username:ed,cosmetics:__.optional(),isLobbyCreator:zt().optional()}),sd=B({gameID:ut,lobbyCreatedAt:j(),config:Or,players:rd.array()}),ad=Xe([ms([$("player"),ut]).rest(ut),ms([$("team"),Ju]).rest(ut),ms([$("nation"),Ju]).rest(ut)]).optional(),S_=B({type:$("turn"),turn:Br}),T_=B({type:$("ping")}),v_=B({type:$("prestart"),gameMap:Ut(Bn),gameMapSize:Ut(Ne)}),A_=B({type:$("start"),turns:Br.array(),gameStartInfo:sd,lobbyCreatedAt:j(),myClientID:ut}),E_=B({type:$("desync"),turn:j(),correctHash:j().nullable(),clientsWithCorrectHash:j(),totalActiveClients:j(),yourHash:j().optional()}),k_=B({type:$("error"),error:H(),message:H().optional()}),M_=B({type:$("lobby_info"),lobby:L2,myClientID:ut});fs("type",[S_,v_,A_,T_,E_,k_,M_]);const I_=B({type:$("winner"),winner:ad,allPlayersStats:q2}),x_=B({type:$("hash"),hash:j(),turnNumber:j()}),C_=B({type:$("log"),severity:Ut(Ku),log:ut}),P_=B({type:$("ping")}),D_=B({type:$("intent"),intent:nd}),N_=B({type:$("join"),token:td,gameID:ut,username:ed,cosmetics:y_.optional(),turnstileToken:H().nullable()}),R_=B({type:$("rejoin"),gameID:ut,lastTurn:j(),token:td});fs("type",[I_,P_,D_,N_,R_,C_,x_]);const O_=rd.extend({persistentID:Qu.nullable(),clanTag:H().optional(),stats:iu}),B_=sd.extend({players:O_.array(),start:j(),end:j(),duration:j().nonnegative(),num_turns:j(),winner:ad,lobbyFillTime:j().nonnegative()}),L_=H().regex(/^[0-9a-fA-F]{40}$/).or($("DEV")),od=B({info:B_,version:$("v0.0.2")});od.extend({gitCommit:L_,subdomain:H(),domain:H()}).extend({turns:Br.array()}),od.extend({turns:Br.array()});const z_=new T2({...A2.build(),...E2,...k2(),...I2(),...v2(),...M2()}),cd=["NicePeopleOnly","BeKindPlz","LearningManners","StayClassy","BeNicer","NeedHugs","MakeFriends"];function U_(n){return Oa(n)?cd[It(n)%cd.length]:n}function Oa(n){return z_.hasMatch(n)}function W_(n){const t=tf(n),e=t?n.replace(`[${t}]`,"").trim():n,i=t?Oa(t):!1,s=Oa(e)?U_(e):e;return t&&!i?`[${t.toUpperCase()}] ${s}`:s}async function $_(n,t,e,i){const r=await yb(n.config,null),s=await a2(n.config.gameMap,n.config.gameMapSize,e),a=new gt(It(n.gameID)),o=n.players.map(d=>new Bi(d.clientID===t?d.username:W_(d.username),P.Human,d.clientID,a.nextID(),d.isLobbyCreator??!1)),c=e2(n,s.nations,o.length,a),l=Qw(o,c,s.gameMap,s.miniGameMap,r),h=new F_(l,new ow(l,n.gameID,t),i);return h.init(),h}class F_{constructor(t,e,i){this.game=t,this.execManager=e,this.callBack=i,this.turns=[],this.currTurn=0,this.isExecuting=!1,this.playerViewData={}}init(){this.game.config().isRandomSpawn()&&this.game.addExecution(...this.execManager.spawnPlayers()),this.game.config().bots()>0&&this.game.addExecution(...this.execManager.spawnBots(this.game.config().numBots())),this.game.config().spawnNations()&&this.game.addExecution(...this.execManager.nationExecutions()),this.game.addExecution(new cw)}addTurn(t){this.turns.push(t)}executeNextTick(){if(this.isExecuting||this.currTurn>=this.turns.length)return!1;this.isExecuting=!0,this.game.addExecution(...this.execManager.createExecs(this.turns[this.currTurn])),this.currTurn++;let t,e=0;try{const r=performance.now();t=this.game.executeNextTick(),e=performance.now()-r}catch(r){return r instanceof Error?(console.error("Game tick error:",r.message),this.callBack({errMsg:r.message,stack:r.stack})):console.error("Game tick error:",r),this.isExecuting=!1,!1}this.game.inSpawnPhase()&&this.game.ticks()%2===0&&this.game.players().filter(r=>r.type()===P.Human||r.type()===P.Nation).forEach(r=>this.playerViewData[r.id()]=_o(this.game,r)),(this.game.ticks()<3||this.game.ticks()%30===0)&&this.game.players().forEach(r=>{this.playerViewData[r.id()]=_o(this.game,r)});const i=t[rt.Tile].map(r=>r.update);return t[rt.Tile]=[],this.callBack({tick:this.game.ticks(),packedTileUpdates:new BigUint64Array(i),updates:t,playerNameViewData:this.playerViewData,tickExecutionDuration:e}),this.isExecuting=!1,!0}pendingTurns(){return Math.max(0,this.turns.length-this.currTurn)}playerActions(t,e,i){const r=this.game.player(t),s=e!==void 0&&i!==void 0?this.game.ref(e,i):null,a={canAttack:s!==null&&r.canAttack(s),buildableUnits:r.buildableUnits(s),canSendEmojiAllPlayers:r.canSendEmoji(xt),canEmbargoAll:r.canEmbargoAll()};if(s!==null&&this.game.hasOwner(s)){const o=this.game.owner(s);a.interaction={sharedBorder:r.sharesBorderWith(o),canSendEmoji:r.canSendEmoji(o),canTarget:r.canTarget(o),canSendAllianceRequest:r.canSendAllianceRequest(o),canBreakAlliance:r.isAlliedWith(o),canDonateGold:r.canDonateGold(o),canDonateTroops:r.canDonateTroops(o),canEmbargo:!r.hasEmbargoAgainst(o)};const c=r.allianceWith(o);c&&(a.interaction.allianceExpiresAt=c.expiresAt())}return a}playerProfile(t){const e=this.game.playerBySmallID(t);if(!e.isPlayer())throw new Error(`player with id ${t} not found`);return e.playerProfile()}playerBorderTiles(t){const e=this.game.player(t);if(!e.isPlayer())throw new Error(`player with id ${t} not found`);return{borderTiles:e.borderTiles()}}attackAveragePosition(t,e){const i=this.game.playerBySmallID(t);if(!i.isPlayer())throw new Error(`player with id ${t} not found`);const r=a=>a.id()===e,s=i.outgoingAttacks().find(r)??i.incomingAttacks().find(r);return s===void 0?null:s.averagePosition()}bestTransportShipSpawn(t,e){const i=this.game.player(t);if(!i.isPlayer())throw new Error(`player with id ${t} not found`);return i.bestTransportShipSpawn(e)}}class q_{constructor(t,e){this.prefix=t,this.cacheBuster=e,this.maps=new Map}getMapData(t){const e=this.maps.get(t);if(e)return e;const r=Object.keys(Bn).find(a=>Bn[a]===t)?.toLowerCase();if(!r)throw new Error(`Unknown map: ${t}`);const s={mapBin:()=>this.loadBinaryFromUrl(this.url(r,"map.bin")),map4xBin:()=>this.loadBinaryFromUrl(this.url(r,"map4x.bin")),map16xBin:()=>this.loadBinaryFromUrl(this.url(r,"map16x.bin")),manifest:()=>this.loadJsonFromUrl(this.url(r,"manifest.json")),webpPath:async()=>this.url(r,"thumbnail.webp")};return this.maps.set(t,s),s}url(t,e){let i=`${this.prefix}/${t}/${e}`;return this.cacheBuster&&(i+=`${i.includes("?")?"&":"?"}v=${encodeURIComponent(this.cacheBuster.trim())}`),i}async loadBinaryFromUrl(t){const e=performance.now(),i=await fetch(t);if(!i.ok)throw new Error(`Failed to load ${t}: ${i.statusText}`);const r=await i.arrayBuffer();return console.log(`[MapLoader] ${t}: ${(performance.now()-e).toFixed(0)}ms`),new Uint8Array(r)}async loadJsonFromUrl(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to load ${t}: ${e.statusText}`);return e.json()}}const Lr=self;let te=null;const j_=new q_("/maps",Md),H_=4;function G_(n){"updates"in n&&cn({type:"game_update",gameUpdate:n})}function cn(n){Lr.postMessage(n)}Lr.addEventListener("message",async n=>{const t=n.data;switch(t.type){case"heartbeat":{const e=await te;if(!e)break;const i=Math.min(e.pendingTurns(),H_);for(let r=0;r<i&&e.executeNextTick();r++);break}case"init":try{te=$_(t.gameStartInfo,t.clientID,j_,G_).then(e=>(cn({type:"initialized",id:t.id}),e))}catch(e){throw console.error("Failed to initialize game runner:",e),e}break;case"turn":if(!te)throw new Error("Game runner not initialized");try{await(await te).addTurn(t.turn)}catch(e){throw console.error("Failed to process turn:",e),e}break;case"player_actions":if(!te)throw new Error("Game runner not initialized");try{const e=(await te).playerActions(t.playerID,t.x,t.y);cn({type:"player_actions_result",id:t.id,result:e})}catch(e){throw console.error("Failed to check borders:",e),e}break;case"player_profile":if(!te)throw new Error("Game runner not initialized");try{const e=(await te).playerProfile(t.playerID);cn({type:"player_profile_result",id:t.id,result:e})}catch(e){throw console.error("Failed to check borders:",e),e}break;case"player_border_tiles":if(!te)throw new Error("Game runner not initialized");try{const e=(await te).playerBorderTiles(t.playerID);cn({type:"player_border_tiles_result",id:t.id,result:e})}catch(e){throw console.error("Failed to get border tiles:",e),e}break;case"attack_average_position":if(!te)throw new Error("Game runner not initialized");try{const e=(await te).attackAveragePosition(t.playerID,t.attackID);cn({type:"attack_average_position_result",id:t.id,x:e?e.x:null,y:e?e.y:null})}catch(e){throw console.error("Failed to get attack average position:",e),e}break;case"transport_ship_spawn":if(!te)throw new Error("Game runner not initialized");try{const e=(await te).bestTransportShipSpawn(t.playerID,t.targetTile);cn({type:"transport_ship_spawn_result",id:t.id,result:e})}catch(e){console.error("Failed to spawn transport ship:",e)}break;default:console.warn("Unknown message :",t)}}),Lr.addEventListener("error",n=>{console.error("Worker error:",n)}),Lr.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection in worker:",n)})})();
